{"componentChunkName":"component---src-templates-blog-post-js","path":"/mysql-select-type/","result":{"data":{"site":{"siteMetadata":{"title":"GoToBill"}},"markdownRemark":{"id":"cb47e515-3ee5-5d97-9ac4-0ac02482380b","excerpt":"실행 계획 포맷 MySQL 8.0부터는 실행 계획을 세 가지 포맷으로 출력할 수 있습니다. TABLE 포맷 (기본): 가장 일반적인 표 형태 TREE 포맷: 실행 순서를 들여쓰기로 표현 JSON 포맷: 상세한 정보를 JSON으로 제공 TABLE…","html":"<h2>실행 계획 포맷</h2>\n<p>MySQL 8.0부터는 실행 계획을 세 가지 포맷으로 출력할 수 있습니다.</p>\n<ul>\n<li><strong>TABLE 포맷</strong> (기본): 가장 일반적인 표 형태</li>\n<li><strong>TREE 포맷</strong>: 실행 순서를 들여쓰기로 표현</li>\n<li><strong>JSON 포맷</strong>: 상세한 정보를 JSON으로 제공</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 기본 TABLE 포맷</span>\n<span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> salaries s <span class=\"token keyword\">ON</span> s<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>emp_no\n<span class=\"token keyword\">WHERE</span> first_name <span class=\"token operator\">=</span> <span class=\"token string\">'ABC'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- TREE 포맷</span>\n<span class=\"token keyword\">EXPLAIN</span> FORMAT<span class=\"token operator\">=</span>TREE\n<span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- JSON 포맷</span>\n<span class=\"token keyword\">EXPLAIN</span> FORMAT<span class=\"token operator\">=</span>JSON\n<span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>TABLE 포맷 실행 계획 예시</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |\n|----|-------------|-------|------------|------|---------------|-----|---------|-----|------|----------|-------|\n| 1 | SIMPLE | e | NULL | ref | PRIMARY,ix_firstname | ix_firstname | 58 | const | 1 | 100.00 | NULL |\n| 1 | SIMPLE | s | NULL | ref | PRIMARY | PRIMARY | 4 | employees.e.emp_no | 10 | 100.00 | NULL |</code></pre></div>\n<p>이 포스트에서는 가독성이 높은 <strong>TABLE 포맷</strong>을 중심으로 설명합니다.</p>\n<h2>실행 계획 읽는 기본 원칙</h2>\n<p><strong>기본 규칙</strong></p>\n<ul>\n<li>조인 쿼리의 경우 id가 같으며, 위에서 아래로 순서대로 실행됩니다</li>\n<li>서브쿼리나 UNION이 포함되면 실행 순서가 복잡해지므로 TREE 포맷으로 확인해야 합니다</li>\n</ul>\n<h2>id 칼럼</h2>\n<p>단위 SELECT 쿼리별로 부여되는 식별자입니다.</p>\n<h3>같은 id - 조인</h3>\n<p>하나의 SELECT 문장에서 여러 테이블을 조인하면 같은 id가 부여됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> e<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>first_name<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">.</span>from_date<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">.</span>salary\n<span class=\"token keyword\">FROM</span> employees e<span class=\"token punctuation\">,</span> salaries s\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>emp_no <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>ref</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>e</td>\n<td>index</td>\n<td>ix_firstname</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>s</td>\n<td>ref</td>\n<td>PRIMARY</td>\n<td>employees.e.emp_no</td>\n<td>10</td>\n<td>NULL</td>\n</tr>\n</tbody>\n</table>\n<p>두 테이블 모두 <strong>id=1</strong>로 동일합니다. 같은 SELECT 쿼리 안에서 조인되었기 때문입니다.</p>\n<h3>다른 id - 서브쿼리</h3>\n<p>서브쿼리가 포함되면 각 단위 SELECT마다 다른 id가 부여됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> employees<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> departments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> total_count<span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>ref</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>No tables used</td>\n</tr>\n<tr>\n<td>3</td>\n<td>SUBQUERY</td>\n<td>departments</td>\n<td>index</td>\n<td>ux_deptname</td>\n<td>NULL</td>\n<td>9</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>2</td>\n<td>SUBQUERY</td>\n<td>employees</td>\n<td>index</td>\n<td>ix_hiredate</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p>3개의 단위 SELECT 쿼리가 각각 <strong>id=1, 2, 3</strong>을 받았습니다.</p>\n<h3>실행 순서 확인 - TREE 포맷</h3>\n<p>TABLE 포맷에서는 실행 순서가 헷갈릴 수 있습니다. TREE 포맷을 사용하면 명확합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span> FORMAT<span class=\"token operator\">=</span>TREE\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> dept_emp de\n<span class=\"token keyword\">WHERE</span> de<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span> e<span class=\"token punctuation\">.</span>emp_no\n    <span class=\"token keyword\">FROM</span> employees e\n    <span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>first_name <span class=\"token operator\">=</span> <span class=\"token string\">'Georgi'</span>\n      <span class=\"token operator\">AND</span> e<span class=\"token punctuation\">.</span>last_name <span class=\"token operator\">=</span> <span class=\"token string\">'Facello'</span>\n    <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>TABLE 포맷</strong></p>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>de</td>\n<td>ref</td>\n<td>ix_empno_fromdate</td>\n<td>1</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>2</td>\n<td>SUBQUERY</td>\n<td>e</td>\n<td>ref</td>\n<td>ix_firstname</td>\n<td>253</td>\n<td>Using where</td>\n</tr>\n</tbody>\n</table>\n<p>TABLE 포맷만 보면 dept_emp가 먼저 실행될 것 같지만, 실제로는 <strong>employees → dept_emp</strong> 순서입니다.</p>\n<p><strong>TREE 포맷</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-> Filter: (de.emp_no = (select #2)) (cost=1.10 rows=1)\n   -> Index lookup on de using ix_empno_fromdate (emp_no=(select #2)) (cost=1.10 rows=1)\n   -> Select #2 (subquery in condition; run only once)\n         -> Limit: 1 row(s)\n            -> Filter: (e.last_name = 'Facello') (cost=70.49 rows=25)\n               -> Index lookup on e using ix_firstname (first_name='Georgi') (cost=70.49 rows=253)</code></pre></div>\n<p>가장 들여쓰기가 많은 부분(employees 테이블)부터 실행됩니다.\nIndex lookup on de가 <code class=\"language-text\">emp_no=(select #2)</code>를 사용하므로, Select #2가 완료되어야 emp_no 값을 알 수 있습니다.</p>\n<hr>\n<h2>select_type 칼럼</h2>\n<p>각 단위 SELECT 쿼리가 어떤 타입인지 표시하는 칼럼입니다.</p>\n<h3>SIMPLE</h3>\n<p>UNION이나 서브쿼리를 사용하지 않는 단순한 SELECT 쿼리입니다. 조인이 포함되어도 SIMPLE입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> employees <span class=\"token keyword\">WHERE</span> emp_no <span class=\"token operator\">=</span> <span class=\"token number\">10001</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>실행 계획에서 <strong>SIMPLE은 하나만</strong> 존재합니다. 가장 바깥쪽 SELECT가 SIMPLE로 표시됩니다.</p>\n<h3>PRIMARY</h3>\n<p>UNION이나 서브쿼리가 있는 SELECT 쿼리에서 가장 바깥쪽 쿼리입니다.</p>\n<p>바깥쪽 SELECT가 <strong>PRIMARY</strong>로 표시되고, <strong>PRIMARY도 하나만</strong> 존재합니다.</p>\n<h3>UNION</h3>\n<p>UNION으로 결합하는 단위 SELECT 중 <strong>두 번째 이후</strong> 쿼리입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> employees e1 <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">ALL</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> employees e2 <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">UNION</span> <span class=\"token keyword\">ALL</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> employees e3 <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> tb<span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>ref</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>&#x3C;derived2></td>\n<td>ALL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>30</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DERIVED</td>\n<td>e1</td>\n<td>index</td>\n<td>ix_hiredate</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>3</td>\n<td>UNION</td>\n<td>e2</td>\n<td>index</td>\n<td>ix_hiredate</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>4</td>\n<td>UNION</td>\n<td>e3</td>\n<td>index</td>\n<td>ix_hiredate</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p>첫 번째(e1)는 DERIVED, 나머지(e2, e3)는 <strong>UNION</strong>입니다.</p>\n<h3>DEPENDENT UNION</h3>\n<p>UNION이면서 외부 쿼리에 의존하는 경우입니다.</p>\n<h4>Before</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> employees e1\n<span class=\"token keyword\">WHERE</span> e1<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span> e2<span class=\"token punctuation\">.</span>emp_no <span class=\"token keyword\">FROM</span> employees e2 <span class=\"token keyword\">WHERE</span> e2<span class=\"token punctuation\">.</span>first_name <span class=\"token operator\">=</span> <span class=\"token string\">'Matt'</span>\n    <span class=\"token keyword\">UNION</span>\n    <span class=\"token keyword\">SELECT</span> e3<span class=\"token punctuation\">.</span>emp_no <span class=\"token keyword\">FROM</span> employees e3 <span class=\"token keyword\">WHERE</span> e3<span class=\"token punctuation\">.</span>last_name <span class=\"token operator\">=</span> <span class=\"token string\">'Matt'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>After</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> employees e1\n<span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">FROM</span> employees e2 \n     <span class=\"token keyword\">WHERE</span> e2<span class=\"token punctuation\">.</span>first_name <span class=\"token operator\">=</span> <span class=\"token string\">'Matt'</span> <span class=\"token operator\">AND</span> e2<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e1<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">)</span>  <span class=\"token comment\">-- e1 추가됨!</span>\n    <span class=\"token keyword\">UNION</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token number\">1</span> <span class=\"token keyword\">FROM</span> employees e3 \n     <span class=\"token keyword\">WHERE</span> e3<span class=\"token punctuation\">.</span>last_name <span class=\"token operator\">=</span> <span class=\"token string\">'Matt'</span> <span class=\"token operator\">AND</span> e3<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e1<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">)</span>   <span class=\"token comment\">-- e1 추가됨!</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>mysql이 자동으로 <strong>semijoin</strong>으로 변환</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>ref</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e1</td>\n<td>ALL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DEPENDENT SUBQUERY</td>\n<td>e2</td>\n<td>eq_ref</td>\n<td>PRIMARY</td>\n<td>func</td>\n<td>1</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>3</td>\n<td>DEPENDENT UNION</td>\n<td>e3</td>\n<td>eq_ref</td>\n<td>PRIMARY</td>\n<td>func</td>\n<td>1</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>NULL</td>\n<td>UNION RESULT</td>\n<td>&#x3C;union2,3></td>\n<td>ALL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>Using temporary</td>\n</tr>\n</tbody>\n</table>\n<p>UNION의 두 번째 쿼리(e3)가 외부 쿼리(e1.emp_no)에 의존하므로 <strong>DEPENDENT UNION</strong>입니다.</p>\n<p>내부적으로 <code class=\"language-text\">e2.emp_no = e1.emp_no</code>, <code class=\"language-text\">e3.emp_no = e1.emp_no</code> 조건이 자동 추가됩니다.</p>\n<h3>UNION RESULT</h3>\n<p>UNION 결과를 담는 임시 테이블입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> salaries <span class=\"token keyword\">WHERE</span> salary <span class=\"token operator\">></span> <span class=\"token number\">100000</span>\n<span class=\"token keyword\">UNION</span> <span class=\"token keyword\">DISTINCT</span>\n<span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> dept_emp <span class=\"token keyword\">WHERE</span> from_date <span class=\"token operator\">></span> <span class=\"token string\">'2001-01-01'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>salaries</td>\n<td>range</td>\n<td>ix_salary</td>\n<td>191348</td>\n<td>Using where; Using index</td>\n</tr>\n<tr>\n<td>2</td>\n<td>UNION</td>\n<td>dept_emp</td>\n<td>range</td>\n<td>ix_fromdate</td>\n<td>5325</td>\n<td>Using where; Using index</td>\n</tr>\n<tr>\n<td>NULL</td>\n<td>UNION RESULT</td>\n<td>&#x3C;union1,2></td>\n<td>ALL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>Using temporary</td>\n</tr>\n</tbody>\n</table>\n<p>&#x3C;union1,2>는 <strong>id=1과 id=2</strong>의 결과를 UNION했다는 의미입니다.</p>\n<p><strong>UNION ALL vs UNION</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- UNION ALL은 UNION RESULT 없음</span>\n<span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> salaries <span class=\"token keyword\">WHERE</span> salary <span class=\"token operator\">></span> <span class=\"token number\">100000</span>\n<span class=\"token keyword\">UNION</span> <span class=\"token keyword\">ALL</span>\n<span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> dept_emp <span class=\"token keyword\">WHERE</span> from_date <span class=\"token operator\">></span> <span class=\"token string\">'2001-01-01'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e3e463cb04c524b114bd76987d743a48/1bba8/10.3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42n2RWYvCQBCE8///iiAo+hIVjYiYRBEVDJ5R0XiC4n2XVi1Z8rDswEfXVNI93TPGdrvFbDbDfD4XUU0WiwWCIBDUUT+E+9VqhefzCaNSqSAej8M0TSSTSaTTacVUKiWvXC4jkUhoT02PlEol5PN5WJaFYrGIQqGA4/EIg2YsFoPneWi328jlcqjVauj3++h0OhiNRnAcB7btYDwey+/1eupqOp0Kavqn0+mnYCaT0UiHw+Gb7H7HDrDb7TQGY7fbhe/7+r7ZbLBcLnE+n9URoaangvV6XZ0xgV3ato1ms4nhcPiL67oak51PJhPdGwvt93tBzS5VMLxsJlarVRVvNBoYDAbyWq2WDshms4Lj8uHW67UmINT0rtcrjMvlAnK/3/F6vfRSjI/HQ0Q1Rwv/+Qsu4/1+43a7CZ4QEvVCHSb9tz7LX0hrR//+RAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"그림 10.3\"\n        title=\"\"\n        src=\"/static/e3e463cb04c524b114bd76987d743a48/f058b/10.3.png\"\n        srcset=\"/static/e3e463cb04c524b114bd76987d743a48/c26ae/10.3.png 158w,\n/static/e3e463cb04c524b114bd76987d743a48/6bdcf/10.3.png 315w,\n/static/e3e463cb04c524b114bd76987d743a48/f058b/10.3.png 630w,\n/static/e3e463cb04c524b114bd76987d743a48/1bba8/10.3.png 642w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>MySQL 8.0부터 UNION ALL은 임시 테이블을 사용하지 않으므로 UNION RESULT가 없습니다.</p>\n<p><strong>그러나 UNION이나 UNION DISTINCT는 여전히 중복 제거를 위해 임시 테이블에서 버퍼링하기에 UNION RESULT가 필요함.</strong></p>\n<h3>SUBQUERY</h3>\n<p><strong>FROM 절 이외에서 사용되는 서브쿼리만을 의미합니다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> e<span class=\"token punctuation\">.</span>first_name<span class=\"token punctuation\">,</span>\n       <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">FROM</span> dept_emp de<span class=\"token punctuation\">,</span> dept_manager dm\n        <span class=\"token keyword\">WHERE</span> dm<span class=\"token punctuation\">.</span>dept_no <span class=\"token operator\">=</span> de<span class=\"token punctuation\">.</span>dept_no<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> cnt\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> <span class=\"token number\">10001</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e</td>\n<td>const</td>\n<td>PRIMARY</td>\n<td>1</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>2</td>\n<td>SUBQUERY</td>\n<td>dm</td>\n<td>index</td>\n<td>PRIMARY</td>\n<td>24</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>2</td>\n<td>SUBQUERY</td>\n<td>de</td>\n<td>ref</td>\n<td>PRIMARY</td>\n<td>41392</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p><strong>서브쿼리 용어 정리</strong></p>\n<blockquote>\n<p><strong>서브쿼리는 사용하는 위치에 따라 각각 다른 이름을 지니고 있다.</strong></p>\n<ul>\n<li><strong>중첩된 쿼리(Nested Query)</strong>: SELECT되는 칼럼에 사용된 서브쿼리</li>\n<li><strong>서브쿼리(Subquery)</strong>: WHERE 절에 사용된 서브쿼리</li>\n<li><strong>파생 테이블(Derived Table)</strong>: FROM 절에 사용된 서브쿼리 (인라인 뷰, 서브 셀렉트라고도 함)</li>\n</ul>\n<p><strong>서브쿼리가 반환하는 값의 특성에 따라:</strong></p>\n<ul>\n<li><strong>스칼라 서브쿼리(Scalar Subquery)</strong>: 하나의 값만 반환 (칼럼 1개, 레코드 1건)</li>\n<li><strong>로우 서브쿼리(Row Subquery)</strong>: 하나의 레코드만 반환 (칼럼 개수 무관)</li>\n</ul>\n</blockquote>\n<h3>DEPENDENT SUBQUERY</h3>\n<p>서브쿼리가 외부 SELECT 쿼리의 칼럼을 사용하는 경우입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> e<span class=\"token punctuation\">.</span>first_name<span class=\"token punctuation\">,</span>\n       <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">FROM</span> dept_emp de<span class=\"token punctuation\">,</span> dept_manager dm\n        <span class=\"token keyword\">WHERE</span> dm<span class=\"token punctuation\">.</span>dept_no <span class=\"token operator\">=</span> de<span class=\"token punctuation\">.</span>dept_no <span class=\"token operator\">AND</span> de<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> cnt\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>first_name <span class=\"token operator\">=</span> <span class=\"token string\">'Matt'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e</td>\n<td>ref</td>\n<td>ix_firstname</td>\n<td>233</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DEPENDENT SUBQUERY</td>\n<td>de</td>\n<td>ref</td>\n<td>ix_empno_fromdate</td>\n<td>1</td>\n<td>Using index</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DEPENDENT SUBQUERY</td>\n<td>dm</td>\n<td>ref</td>\n<td>PRIMARY</td>\n<td>2</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p>서브쿼리가 외부 쿼리의 <code class=\"language-text\">e.emp_no</code>를 참조하므로 <strong>DEPENDENT SUBQUERY</strong>입니다.</p>\n<p>외부 쿼리가 먼저 실행되고, 각 레코드마다 서브쿼리가 실행되므로 일반 SUBQUERY보다 느릴 수 있습니다.</p>\n<h3>DERIVED</h3>\n<p>FROM 절에 사용된 서브쿼리입니다. 임시 테이블(파생 테이블)을 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> de<span class=\"token punctuation\">.</span>emp_no <span class=\"token keyword\">FROM</span> dept_emp de <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> de<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">)</span> tb<span class=\"token punctuation\">,</span>\n     employees e\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> tb<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>&#x3C;derived2></td>\n<td>ALL</td>\n<td>NULL</td>\n<td>331143</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e</td>\n<td>eq_ref</td>\n<td>PRIMARY</td>\n<td>1</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DERIVED</td>\n<td>de</td>\n<td>index</td>\n<td>ix_empno_fromdate</td>\n<td>331143</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p>FROM 절의 서브쿼리(tb)가 <strong>DERIVED</strong>로 표시되고, &#x3C;derived2>라는 임시 테이블이 생성됩니다.</p>\n<p><strong>MySQL 8.0부터는 가능하면 서브쿼리를 조인으로 재작성하여 최적화합니다.</strong></p>\n<blockquote>\n<p>쿼리를 튜닝하기 위해 실행 계획을 확인할 때 가장 먼저 select_type 칼럼의 값이 DERIVED인 것이 있는지 확인해야 한다.\n<br>\n<br>\n<strong>서브쿼리를 조인으로 해결할 수 있는 경우라면 서브쿼리보다는 조인을 사용할 것을 강력히 권장한다.</strong></p>\n</blockquote>\n<h3>DEPENDENT DERIVED</h3>\n<p>MySQL 8.0부터 지원하는 래터럴 조인(LATERAL JOIN)에서 사용됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> LATERAL <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n    <span class=\"token keyword\">FROM</span> salaries s\n    <span class=\"token keyword\">WHERE</span> s<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>emp_no\n    <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> s<span class=\"token punctuation\">.</span>from_date <span class=\"token keyword\">DESC</span>\n    <span class=\"token keyword\">LIMIT</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> s2 <span class=\"token keyword\">ON</span> s2<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>emp_no<span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e</td>\n<td>ALL</td>\n<td>NULL</td>\n<td>Rematerialize (&#x3C;derived2>)</td>\n</tr>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>&#x3C;derived2></td>\n<td>ref</td>\n<td>&#x3C;auto_key0></td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>2</td>\n<td>DEPENDENT DERIVED</td>\n<td>s</td>\n<td>ref</td>\n<td>PRIMARY</td>\n<td>Using filesort</td>\n</tr>\n</tbody>\n</table>\n<p>FROM 절의 서브쿼리가 외부 칼럼(e.emp_no)을 참조하므로 <strong>DEPENDENT DERIVED</strong>입니다.</p>\n<h3>UNCACHEABLE SUBQUERY</h3>\n<p>서브쿼리 결과를 캐시할 수 없는 경우입니다.</p>\n<p><strong>서브쿼리 캐시 동작</strong></p>\n<ul>\n<li><strong>SUBQUERY</strong>: 처음 한 번만 실행하고 결과를 캐시</li>\n<li><strong>DEPENDENT SUBQUERY</strong>: 외부 쿼리 값마다 캐시 생성</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/80b519a7d4e901878d481ad124e0936b/ddc81/10.4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVR42pVSyYrCUBD0/7/Bq+hBJbgmiKioBzVG3IOQuKGi4hJxFy2nenCZw+BMQ5Pkpbu6qvq58BaXywWHwwGj0QjD4RDdbhebzQan0wm3201qzuczdrsdJpMJBoOB1Gy3WxyPR/nvIggP+Gy32wgEAohEIlAUBcFgEIlEAplMBtPpFI7jIJvNwufzyf9wOIx8Po9yuSzgArher2FZFsbjMXK5HLxeL0KhkDQw4/E4YrEYUqmU1BmGgWQyiXQ6jWg0Kmo4aLVavRjygDJY6Ha7BdTj8Uj6/X5hSuaUN5vNUK1WYZqmDOr1elgul5JPQH5QNht0XUetVpMmZqPRQKfTEfatVkukk2Wz2YSmaQK4WCxegPgQj2XYti0ecxmFQkGG0kN6R9t+ALLpt7xer1JoWbYwpFeUy3dVVYUhfZzP51L/L4b1ev15vt/vxQ5aRYbcA6/UnwH7/f4XI02Ai8USSqXvJPB7fAR8BKVTZqViPO8eF0RW74PvODzfb7zPfSgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"그림 10.4\"\n        title=\"\"\n        src=\"/static/80b519a7d4e901878d481ad124e0936b/f058b/10.4.png\"\n        srcset=\"/static/80b519a7d4e901878d481ad124e0936b/c26ae/10.4.png 158w,\n/static/80b519a7d4e901878d481ad124e0936b/6bdcf/10.4.png 315w,\n/static/80b519a7d4e901878d481ad124e0936b/f058b/10.4.png 630w,\n/static/80b519a7d4e901878d481ad124e0936b/ddc81/10.4.png 837w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>캐시 불가능한 경우</strong></p>\n<ul>\n<li>사용자 변수 사용</li>\n<li>NOT-DETERMINISTIC 스토어드 루틴 사용</li>\n<li>UUID(), RAND() 같은 비결정적 함수 사용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@status</span>\n    <span class=\"token keyword\">FROM</span> dept_emp de\n    <span class=\"token keyword\">WHERE</span> de<span class=\"token punctuation\">.</span>dept_no <span class=\"token operator\">=</span> <span class=\"token string\">'d005'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>PRIMARY</td>\n<td>e</td>\n<td>ALL</td>\n<td>NULL</td>\n<td>300252</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>2</td>\n<td>UNCACHEABLE SUBQUERY</td>\n<td>de</td>\n<td>ref</td>\n<td>PRIMARY</td>\n<td>165571</td>\n<td>Using index</td>\n</tr>\n</tbody>\n</table>\n<p>사용자 변수 <code class=\"language-text\">@status</code>를 사용하므로 <strong>UNCACHEABLE SUBQUERY</strong>입니다.</p>\n<h3>UNCACHEABLE UNION</h3>\n<p>UNION이면서 캐시할 수 없는 경우입니다. UNION과 UNCACHEABLE의 속성을 모두 가집니다.</p>\n<h3>MATERIALIZED</h3>\n<p>MySQL 5.7부터 IN(subquery)나 FROM 절 서브쿼리를 임시 테이블로 구체화하여 최적화합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> employees e\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>emp_no <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span> emp_no <span class=\"token keyword\">FROM</span> salaries <span class=\"token keyword\">WHERE</span> salary <span class=\"token operator\">BETWEEN</span> <span class=\"token number\">100</span> <span class=\"token operator\">AND</span> <span class=\"token number\">1000</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>key</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>&#x3C;subquery2></td>\n<td>ALL</td>\n<td>NULL</td>\n<td>NULL</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>e</td>\n<td>eq_ref</td>\n<td>PRIMARY</td>\n<td>1</td>\n<td>NULL</td>\n</tr>\n<tr>\n<td>2</td>\n<td>MATERIALIZED</td>\n<td>salaries</td>\n<td>range</td>\n<td>ix_salary</td>\n<td>1</td>\n<td>Using where; Using index</td>\n</tr>\n</tbody>\n</table>\n<p>서브쿼리 내용이 임시 테이블로 <strong>구체화</strong>(Materialization)되어 employees 테이블과 조인됩니다.</p>\n<p><strong>MySQL 5.6까지는 employees 테이블의 각 레코드마다 서브쿼리를 실행했지만, 5.7부터는 서브쿼리를 먼저 구체화한 후 조인하므로 성능이 개선되었습니다.</strong></p>","wordCount":{"words":985},"frontmatter":{"title":"MySQL 실행 계획 - id와 select_type","date":"October 23, 2025","description":"MySQL 실행 계획의 id와 select_type 칼럼을 이해하고 쿼리 실행 순서를 파악하는 방법을 설명합니다."}},"previous":{"fields":{"slug":"/mysql-cost-model/"},"frontmatter":{"title":"MySQL 코스트 모델 이해하기"}},"next":{"fields":{"slug":"/mysql-table/"},"frontmatter":{"title":"MySQL 실행 계획 - table, partitions, type 컬럼"}}},"pageContext":{"id":"cb47e515-3ee5-5d97-9ac4-0ac02482380b","previousPostId":"29392d80-1217-5c84-9834-5067e6ef46a2","nextPostId":"94f50ada-9227-5800-ac3d-c97c790b831a"}},"staticQueryHashes":["3257411868","3517523002"],"slicesMap":{}}