{"componentChunkName":"component---src-templates-blog-post-js","path":"/async/","result":{"data":{"site":{"siteMetadata":{"title":"GoToBill"}},"markdownRemark":{"id":"7ebaac03-1a97-518a-8709-97b4c18db099","excerpt":"…","html":"<blockquote>\n<p><strong>이 글은 주니어 백엔드 개발자가 반드시 알아야 할 핵심 지식을 기반으로 작성되었습니다.</strong></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> opt <span class=\"token operator\">=</span> <span class=\"token function\">findUser</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1. User 조회</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opt<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 2. User가 없으면 false 리턴</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> opt<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">matchPassword</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 3. 암호가 일치하지 않으면 false 리턴</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">PointResult</span> result <span class=\"token operator\">=</span> pointClient<span class=\"token punctuation\">.</span><span class=\"token function\">giveLoginPoint</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4. 포인트 지급 서비스 호출</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">isFailed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 5. 포인트 지급에 실패하면 익셉션 발생</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PointException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">appendLoginHistory</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 6. 로그인 내역 추가</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>위의 코드는 <strong>전형적인 동기 방식을 따릅니다.</strong></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVR42o2TiY6DMAxE+/+fWfWgDYhwFHLi5RmlAqm7W0tDjBOPk4lziilIylERFUEOsdXX2IqQ/GEEKSddR4zx5KOTJS9iGiM+eMFsZ+V2u8n1epW+7zWWc5ZhGKRtWxnHUf/rupZ7dVeQS4ETH+ecnM9neb1emjzPs0zTpAghSDF85mKMsiyLeO81hxgFlJAdYlSnMlWBtVYTy+4gAPh7Sym9feTZEfaHScgpAnFVVWKMka7r3qf4gnA4VOe4xNglR22aRp5Po9JQhLWQse5rwiI+pOiF1sQZiQEuCSn+JURosLdPGlL0K0J2UvQigX90fDweGi/k5P1JWCZJGsZBR/RDN3wuBk3LrXN8WT5oaNutTTgmYivhWoSdQcKIjmi2t9Jab0IXJn1y/diJC7P4uIrvV/08vtueY9oQot890Q1Bn2bxvZw6Z6UZzdYW5imXy2Xtu7vUTa3gWZU+bG0recm/YhVBfgBMFvhZmQxFPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"동기 방식 플로우\"\n        title=\"\"\n        src=\"/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png\"\n        srcset=\"/static/d9c84d53066b847c3c9b65b61f6ed9ed/c26ae/1.png 158w,\n/static/d9c84d53066b847c3c9b65b61f6ed9ed/6bdcf/1.png 315w,\n/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>동기 방식의 외부 연동 고려사항</h3>\n<blockquote>\n<p>동기 방식에서 <strong>외부 연동 실패가 전체 기능의 실패인지</strong> 확인 필요</p>\n</blockquote>\n<h4>문제 상황</h4>\n<p>앞선 예에서는 포인트 지급 서비스 연동에 실패하면 로그인에도 실패한다고 가정했습니다.</p>\n<blockquote>\n<p>포인트 서비스 장애 시 로그인까지 막힐 필요가 있을까요?</p>\n</blockquote>\n<h4>해결 방안</h4>\n<p>아마도 그렇지 않을 것입니다. 포인트 지급에 실패하더라도:</p>\n<ul>\n<li><strong>로그인 자체는 정상적으로 동작</strong>해야 합니다</li>\n<li><strong>나머지 기능을 사용할 수 있어야</strong> 합니다</li>\n</ul>\n<blockquote>\n<p>포인트 지급 실패 시 <strong>후처리용 로그를 남기고 로그인은 성공 처리</strong></p>\n</blockquote>\n<h3>개선된 로그인 코드</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> opt <span class=\"token operator\">=</span> <span class=\"token function\">findUser</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1. User 조회</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opt<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 2. User가 없으면 false 리턴</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> opt<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">matchPassword</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 3. 암호가 일치하지 않으면 false 리턴</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">PointResult</span> result <span class=\"token operator\">=</span> pointClient<span class=\"token punctuation\">.</span><span class=\"token function\">giveLoginPoint</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4. 포인트 지급 서비스 호출</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">isFailed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 5. 포인트 지급에 실패하면 후처리 위해 내역 남김</span>\n        <span class=\"token function\">recordPointFailure</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">appendLoginHistory</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 6. 로그인 내역 추가</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>외부 서비스 응답 시간 고려사항</h3>\n<blockquote>\n<p>외부 서비스 응답이 느리면 <strong>전체 응답도 느려짐</strong></p>\n</blockquote>\n<h3>비동기 방식 도입의 필요성</h3>\n<blockquote>\n<p>외부 연동 결과가 <strong>즉시 필요하지 않다면 비동기 처리 고려</strong></p>\n</blockquote>\n<h4>비동기(Asynchronous) 방식의 특징</h4>\n<ul>\n<li><strong>한 작업이 끝날 때까지 기다리지 않고</strong> 바로 다음 작업을 처리</li>\n<li>비동기 방식을 사용하면 <strong>외부 연동이 끝날 때까지 기다리지 않고</strong> 바로 다음 작업을 진행할 수 있습니다</li>\n</ul>\n<blockquote>\n<p>포인트 지급을 기다리지 않고 <strong>로그인 즉시 성공 응답</strong> → 사용자 응답 속도 향상</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVR42o2T25KDIBBE8/8/ueYpiUYTb4Bc7PXgkjKVPGxbUyAz9DQzcArJa7eQR+etjJvz6LxT8S/ByTojt9jXmluM7GbE4o9r1CmEoLqutSyLwDgOappGdVOr73ullLSuq5xzGoZ+8495DWu7doutdb/fZazJok7GGFVVpWmapFWy1ubNGMkKICjrBYiYp3mPjWEnJDtK5nnW7XbLah+PRw723udE+EoCiAH7ADHlnzJshEnP5/N1DABB27bquk7n81nVT6XL5fIqwRFfCHeFR6CONRRRT8hQTiKSY4WcEv2LkOJDeCTn+DSAkkCKOuZrWsX3RkhzcKKEjSijptj1es01LKU5AoUxxndCiMiGmtLJYzepJUTEfCdMnwqPKHevgAaVa8O8HBtwsg+F3wiPSoZhyJs4AQTW2KysNAWO3JS4Efq05OfDD+bjdv/+xvzE8nw3/mOKStsT45lxkcs68TEF/QLlKKk3h/grKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"비동기 방식 플로우\"\n        title=\"\"\n        src=\"/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png\"\n        srcset=\"/static/61f06c7e3588dd8b0ffeebcca87206f5/c26ae/2.png 158w,\n/static/61f06c7e3588dd8b0ffeebcca87206f5/6bdcf/2.png 315w,\n/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>비동기 방식의 장점</h3>\n<p>포인트 서비스에 일시적으로 문제가 생겨 포인트 지급 처리에 시간이 오래 걸려도 <strong>로그인 서비스의 응답 시간은 증가하지 않습니다.</strong> 사용자는 평소처럼 로그인에 성공하고 서비스를 사용할 수 있습니다. 단지 포인트가 평소보다 조금 늦게 지급될 뿐입니다.</p>\n<blockquote>\n<p>사용자는 <strong>빠른 로그인 후 서비스 사용</strong>을 선호</p>\n</blockquote>\n<h3>비동기 방식 적용 가능한 연동 예시</h3>\n<p>생각보다 많은 연동에서 비동기 방식을 사용해도 됩니다. 다음은 비동기 방식으로 연동해도 크게 문제가 되지 않는 몇 가지 예입니다:</p>\n<ul>\n<li><strong>쇼핑몰에서 주문이 들어오면 판매자에게 푸시 보내기</strong> (푸시 서비스 연동)</li>\n<li><strong>학습을 완료하면 학생에게 포인트 지급</strong> (포인트 서비스 연동)</li>\n<li><strong>컨텐츠를 등록할 때 검색 서비스에도 등록</strong> (검색 서비스 연동)</li>\n<li><strong>인증번호를 요청하면 SMS로 인증 메시지 발송</strong> (SMS 발송 서비스 연동)</li>\n</ul>\n<h3>비동기 연동 가능 조건 - 4가지 특징</h3>\n<p>이 예시들에는 몇 가지 공통적인 특징이 있다:</p>\n<h4>1. 시차가 허용되는 경우</h4>\n<blockquote>\n<p><strong>시차 허용</strong></p>\n<ul>\n<li>주문 후 1분 뒤 푸시 발송 → 판매 지장 없음</li>\n<li>컨텐츠 등록 후 10초 뒤 검색 노출 → 문제 없음</li>\n</ul>\n</blockquote>\n<h4>2. 재시도가 가능한 경우</h4>\n<blockquote>\n<p><strong>재시도 가능</strong></p>\n<ul>\n<li>푸시 실패 → 재시도로 해결</li>\n<li>포인트 지급 실패 → 몇 초 후 재시도</li>\n<li>SMS 미수신 → \"다시 받기\" 기능</li>\n</ul>\n</blockquote>\n<h4>3. 수동 처리가 가능한 경우</h4>\n<blockquote>\n<p><strong>수동 처리</strong></p>\n<ul>\n<li>검색 연동 실패 → 관리자가 수동으로 재등록</li>\n</ul>\n</blockquote>\n<h4>4. 실패를 무시할 수 있는 경우</h4>\n<blockquote>\n<p><strong>실패 무시 가능</strong></p>\n<ul>\n<li>주문 알림 푸시 실패 → 판매 지장 없음</li>\n<li>일부 컨텐츠 검색 불가 → 서비스 계속 가능</li>\n</ul>\n</blockquote>\n<h3>실제 적용 사례</h3>\n<blockquote>\n<p>4가지 특징 중 하나라도 해당 → 비동기 처리 검토</p>\n</blockquote>\n<p><strong>실제 비동기로 외부 연동을 처리한 사례:</strong></p>\n<ul>\n<li><strong>포인트 지급</strong>: 사용자가 미션을 달성하면 포인트를 지급하는데 포인트 서비스와의 연동을 비동기로 처리했다</li>\n<li><strong>주문 정보 동기화</strong>: 주문 시스템에 생성된 주문 정보를 회원 관리 시스템에 반영할 때 비동기로 동기화했다</li>\n<li><strong>택배사에 집하 요청</strong>: 회원이 쇼핑몰에서 물건을 주문하면 택배사에 집하 요청을 하는데 비동기로 집하 요청 데이터를 전송했다</li>\n</ul>\n<h3>비동기 연동 구현 방식</h3>\n<p>비동기 연동은 다양한 방식으로 구현할 수 있다. 이 책에서는 다음의 <strong>5가지 방식</strong>에 대해 살펴볼 것이다:</p>\n<ol>\n<li><strong>별도 스레드</strong>로 실행하기</li>\n<li><strong>메시징 시스템 이용하기</strong></li>\n<li><strong>트랜잭션 아웃박스 패턴</strong> 사용하기</li>\n<li><strong>배치</strong>로 연동하기</li>\n<li><strong>CDC</strong> 이용하기</li>\n</ol>\n<blockquote>\n<p>이 5가지 방식만 알아도 대부분의 비동기 연동 구현 가능</p>\n</blockquote>\n<h2>1. 별도 스레드로 실행</h2>\n<h3>1. new Thread() 사용</h3>\n<p>가장 간단한 방법으로 새로운 스레드를 생성하여 비동기로 실행하는 방법입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PushClient</span> pushClient<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderResult</span> <span class=\"token function\">placeOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderRequest</span> req<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 주문 생성 처리</span>\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 별도 스레드에서 푸시 발송</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            pushClient<span class=\"token punctuation\">.</span><span class=\"token function\">sendPush</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token function\">successResult</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 푸시 발송을 기다리지 않고 리턴</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>2. ThreadPool 사용</h3>\n<p>매번 새로운 스레드를 생성하는 대신 스레드 풀을 사용하여 성능을 개선할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PushClient</span> pushClient<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ExecutorService</span> executor <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderResult</span> <span class=\"token function\">placeOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderRequest</span> req<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 주문 생성 처리</span>\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 스레드 풀에 푸시 발송 작업 제출</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            pushClient<span class=\"token punctuation\">.</span><span class=\"token function\">sendPush</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token function\">successResult</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 푸시 발송을 기다리지 않고 리턴</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>3. @Async 어노테이션 사용</h3>\n<p>Spring Framework에서 제공하는 <code class=\"language-text\">@Async</code> 어노테이션을 사용하여 더 간편하게 비동기 실행할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PushService</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token annotation punctuation\">@Async</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendPushAsync</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PushData</span> pushData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        pushClient<span class=\"token punctuation\">.</span><span class=\"token function\">sendPush</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        <span class=\"token comment\">// ... 기타 코드</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PushService</span> pushService<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderResult</span> <span class=\"token function\">placeOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderRequest</span> req<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 주문 생성 처리</span>\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 비동기로 푸시 발송</span>\n        pushService<span class=\"token punctuation\">.</span><span class=\"token function\">sendPushAsync</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token function\">successResult</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 푸시 발송을 기다리지 않고 리턴</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Async 주의사항</h3>\n<blockquote>\n<p><strong>@Async</strong> 사용 시 메서드명에 \"Async\" 포함 권장</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">pushService<span class=\"token punctuation\">.</span><span class=\"token function\">sendPushAsync</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>비동기 메서드는 호출 측 try-catch 블록이 작동 안 함</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 잘못된 예외 처리</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderResult</span> <span class=\"token function\">placeOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderRequest</span> req<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        pushService<span class=\"token punctuation\">.</span><span class=\"token function\">sendPushAsync</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 비동기 실행</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// sendPushAsync()가 비동기로 실행되므로 catch 블록은 동작하지 않는다.</span>\n        <span class=\"token comment\">// 에러 처리 코드</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">successResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 올바른 예외 처리</span>\n<span class=\"token annotation punctuation\">@Async</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendPushAsync</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PushData</span> pushData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        pushClient<span class=\"token punctuation\">.</span><span class=\"token function\">sendPush</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 재시도 로직</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            pushClient<span class=\"token punctuation\">.</span><span class=\"token function\">sendPush</span><span class=\"token punctuation\">(</span>pushData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 재시도</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 실패를 로그로 남기거나</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Push 발송 실패\"</span><span class=\"token punctuation\">,</span> e1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>비동기 메서드 예외는 트랜잭션 롤백에 영향 없음</p>\n</blockquote>\n<h3>스레드와 메모리 고려사항</h3>\n<ul>\n<li>각 스레드는 메모리를 소모합니다 <strong>(예: 256KB)</strong></li>\n<li>100,000개의 스레드를 생성하면 <strong>약 24GB의 메모리</strong>가 필요할 수 있습니다</li>\n<li><strong>스레드 생성 시간과 스케줄링으로 인한 CPU 시간 소모가 큽니다</strong></li>\n<li><strong>스레드 풀</strong>을 사용하여 고정된 수의 스레드를 유지하는 것이 좋습니다</li>\n<li>네트워크 I/O 작업의 경우 <strong>가상 스레드</strong>(Java) 또는 <strong>고루틴</strong>(Go) 사용을 권장합니다</li>\n</ul>\n<hr>\n<h2>2. 메시징 시스템 이용</h2>\n<h3>메시징 시스템의 개념과 장점</h3>\n<p>메시징 시스템은 시스템 간 직접 호출 대신 중간에 메시징 시스템을 두어 데이터를 전달하는 방식입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 574px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.949367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42lVQ2W7DMAzL/3/j1g5D5iKp7dmJbzllLRUN0AdCEql7ooNQqaJ1RhO/P/oJ5mnw77xPrX3UsZ3oGEGp2LZNkHNGrSOxDQybUoIxBkoplFJefBvNa0UIATFFeO+QU0apGVN/kCRwM++9NLm7Bb/rBTc7I8aIfd+htZbBxt9FU2YWnnXnnAyrVHhDwtEPmUxE6NSx2gU/6htqnYWTraih9w4X/nH9+8Jib2cdgzW+dnr/gAMG+9ZZaGugjUZpRf7HGl8TUhDe7/7kXyDZ8Aml94Qpft+F2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"메시징 시스템 디커플링\"\n        title=\"\"\n        src=\"/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png\"\n        srcset=\"/static/c5d2f63fd099e487f40c299365f72e91/c26ae/3.png 158w,\n/static/c5d2f63fd099e487f40c299365f72e91/6bdcf/3.png 315w,\n/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png 574w\"\n        sizes=\"(max-width: 574px) 100vw, 574px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>디커플링</h4>\n<ul>\n<li>시스템 A와 시스템 B가 직접 연결되지 않음</li>\n<li>시스템 B의 성능 저하가 시스템 A에 영향을 주지 않음</li>\n<li><strong>메시징 시스템이 버퍼 역할을 하여 시스템 B가 자신의 속도로 메시지를 처리할 수 있음</strong></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 587px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVR42pVS0W7DIAzs///jpkyVpmZqE6CBgm242U7bvfRhNbKMjLmzDw7cGxpVNP5zGexO0lDpBhZ6Run3M25eazWPyJ1w6KMjl4w1rEgp+b61BmFBzhkxRUxfE9I1eZ5ZwYiwbRtCDFjWBaUUJyMDHGN4YYzRi+qt4jhPWNIZJRfUWjGfZgenRk44nT4U6IK8ZYQQdiJh7ZAVEMNZReTuHef4g+stQo9UjuZ568rM4hy+Hbhrrd/RaQzn2eE7ZuR2x4CtM3Pbm3Q29kvAcV+vjBRwCQuuqqnrqCMboBHtI7/ZYe8dx8unPsjqmprmFqXL/sr7c/O/nXSsVKJ+o8eXaZ4z/Sz+Ap3dcymZeW/2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"메시징 시스템 확장성\"\n        title=\"\"\n        src=\"/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png\"\n        srcset=\"/static/fbf45aed4cc272f61fdcfe6a6f2be08e/c26ae/4.png 158w,\n/static/fbf45aed4cc272f61fdcfe6a6f2be08e/6bdcf/4.png 315w,\n/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png 587w\"\n        sizes=\"(max-width: 587px) 100vw, 587px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>확장성</h4>\n<ul>\n<li>새로운 시스템 추가 시 기존 시스템 수정 없이 메시징 시스템에만 연결</li>\n<li>예: 시스템 A가 시스템 C에도 데이터를 전송해야 할 때, 시스템 A 코드 수정 없이 시스템 C만 메시징 시스템에 연결</li>\n</ul>\n<h3>메시징 시스템 기술 비교</h3>\n<p>이 책을 쓰는 시점을 기준으로 메시징 시스템 용도로 많이 사용되는 기술은 <strong>카프카</strong>, <strong>래빗MQ</strong>, <strong>레디스 pub/sub</strong> 등이 있음. 각 기술은 서로 다른 특징을 가지고 있으므로, 사용 목적에 맞는 기술을 선택해야 함.</p>\n<h4>Kafka 특징</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 522px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVR42n1S2Y6bQBDk/38neUystczaGwy7BsJ93zYYX/i+KtMjrbVyooxUmtFQU13VtHC/3/EVn2u1WsH1PIRRDFlWoOk64iSB4zjouo5znt8ShNlsBtu24bHHQRBgvV5jv9/Bsh3IowHqQMeH+BPqsIepp0JTJJRV9RB8XsJut0Nd15jP51wwz3NcLhcoyjtMXUVbJkg8CzFDk0ewDR2GaXKX2+32sZPO8XiE8FWdKqZpCt/3uWOKmKQZbMeFz4pleYEwjFAxh5SEuKPRCJZlwTAMUFphuVwijmP+kZAwkTAMoWoa5PEvJIGD134P8pvIXNrQJh+cU5YliqLA+XzG6XTi7m63G4TFYvEQjKKIk4MghK6pGIwVjIIMvYmBH4oO0YkhqToyxiGXWZb93cPnCxL8jFxWU9Tzlkelc9MukDNXJEZTQCYkSeJ8QtM0EA6HAzabDWinihTlzCKMZRkKi1zFPsbDAVT5DWXsYfIuwzQtdNuOv2vblhcg0I/hY0NNpdFxXZcTdvs9PNdB73WIvm7h24uI730RL5PfGLKZnP5vbGhEyB019Xq9Pkjr9Qp+GMNLCoYcfprDy9iZ9bfrNv8cbBL8A6em5RwzDcPoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Kafka 특징\"\n        title=\"\"\n        src=\"/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png\"\n        srcset=\"/static/70be607d8ee5704786ca85d87c0c03c2/c26ae/5.png 158w,\n/static/70be607d8ee5704786ca85d87c0c03c2/6bdcf/5.png 315w,\n/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png 522w\"\n        sizes=\"(max-width: 522px) 100vw, 522px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><strong>높은 처리량을 자랑함</strong> - <strong>초당 백만 개 이상</strong>의 메시지를 처리할 수 있음</li>\n<li>수평 확장이 용이함 - 서버(브로커), 파티션, 소비자를 늘리면 됨</li>\n<li><strong>메시지를 파일에 보관해서 메시지가 유실되지 않음</strong></li>\n<li>파티션 단위로 순서를 보장함 - <strong>하지만 토픽 수준에서는 순서를 보장할 수 없음</strong>\n<ul>\n<li>예: \"주문\" 토픽에 파티션 2개가 있고, A고객이 주문 3개(1→2→3)를 연속으로 넣었을 때\n<ul>\n<li>파티션0: 주문1, 주문3 (순서 보장됨)</li>\n<li>파티션1: 주문2 (순서 보장됨)</li>\n<li><strong>소비자가 받는 순서: 주문2 → 주문1 → 주문3 (순서가 뒤바뀔 수 있음)</strong></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>소비자는 메시지를 언제든지 재처리할 수 있음</li>\n<li><strong>Pull 모델을 사용함</strong> - 소비자가 카프카 브로커에서 메시지를 읽어가는 방식</li>\n</ul>\n<h4>RabbitMQ 특징</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/31a1ee18bc60b0b58cbe65be9a81ee7c/23266/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42oWSS2/TQBDH8z0rcaVcQPAd4AJX4IBAqgLkQQs0EScoSUTa0gsib9d2nIcTO7bXXidxvPbu2mGcByEFidVodq2dv+fx29RyuYzj2DRNw5jAGo/Huq5blqVpY4QsuPJISHm0/NdKrTcIiiKwXRAcOaVmp1r7nOl9L+JeLQgCfeK0xcls7q8kWzHIQE4IMQxDHQ2DkAyHnix0lbcPtOw9NX2oFJ9gF5fPm7lCXe5N1vlS660nla6bx7Mp6g7kzJdXH7/lXHca8Wjhzf2VET/JRoLQxh7nfFc2FKBIpebPPHZMeSDnS0cnldeabjgo4CHkb5njYcxCiAxD5rgLvu0udXMIceKIzyTRkDrtxovD1vNb7acHwvEjZNtnlVrutC5Io6TTbdkbSxqP45WYI4tibCPhEouXjlDF/QYkNKypIJtzj+wGBhrOIzBQQgSDnpJzMsS9muLfZOJo9bEpG9looutgwFnTNGQhVVVt24armeeHlP2Hc5KW83jz/xV2xizhon6W7119wv0mZcww3ZtlbznHhATw1NSRGoSBOlgAZ/nN/XH2rpq+rRQfO9gpVRvZ05rc0/c497tlqf1hNrWVYTdfPiqcv3NdlzPuz6fEmyV+4SWDJCFyPMb2OXfFr40f2RVn6biSfl/JIORQymiQcDY0NeYUIinleOpHf3NedwueJSI2UheKqLRe3gHOnWcHnZOHFkLAOVsAzuqO85/67cCSxRl1xCtXvMDAedAAQBaaXXctbxGsB/YLzJM+z0Nd7NMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RabbitMQ 특징\"\n        title=\"\"\n        src=\"/static/31a1ee18bc60b0b58cbe65be9a81ee7c/f058b/6.png\"\n        srcset=\"/static/31a1ee18bc60b0b58cbe65be9a81ee7c/c26ae/6.png 158w,\n/static/31a1ee18bc60b0b58cbe65be9a81ee7c/6bdcf/6.png 315w,\n/static/31a1ee18bc60b0b58cbe65be9a81ee7c/f058b/6.png 630w,\n/static/31a1ee18bc60b0b58cbe65be9a81ee7c/23266/6.png 923w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>클러스터를 통해 처리량을 높일 수 있음 - 단, 카프카보다 더 많은 자원을 필요로 함</li>\n<li>메모리에만 메시지를 보관하는 큐 설정을 사용하면 <strong>장애 상황 시 메시지가 유실될 수 있음</strong></li>\n<li><strong>메시지는 큐에 등록된 순서대로 소비자에 전송됨</strong></li>\n<li>메시지가 소비자에 전달됐는지 확인하는 기능을 제공함</li>\n<li><strong>Push 모델을 사용함</strong> - 래빗MQ 브로커가 소비자에 메시지를 전송함. <strong>소비자의 성능이 느려지면 큐에 과부하가 걸려 전반적으로 성능 저하가 발생할 수 있음</strong></li>\n<li>다재다능함 - AMQP, STOMP 등 여러 프로토콜을 지원하고, 게시/구독 패턴뿐만 아니라 요청/응답, 점대점(point-to-point) 패턴을 지원함. 또한 우선순위를 지정해서 처리 순서를 변경할 수도 있음</li>\n</ul>\n<h4>Redis pub/sub 특징</h4>\n<ul>\n<li>메모리를 사용하므로 지연 시간이 짧고, 래빗MQ 대비 처리량이 높음</li>\n<li><strong>구독자가 없으면 메시지가 유실됨</strong></li>\n<li><strong>기본적으로 영구 메시지를 지원하지 않음</strong></li>\n<li>모델이 단순해서 사용하기 쉬움</li>\n</ul>\n<h4>기술 선택 가이드</h4>\n<ul>\n<li><strong>메시지가 유실되어도 상관없다면 레디스 pub/sub</strong> 기능을 고려함 - 카프카나 래빗MQ에 비해 사용법이 간단하고, 적은 장비로 높은 성능을 낼 수 있음</li>\n<li><strong>트래픽이 대량으로 발생한다면 카프카</strong>를 고려함 - 여기서 말하는 대량 트래픽은 <strong>초당 수십만에서 수백만 이상</strong>의 메시지를 말함</li>\n<li><strong>트래픽 규모가 크지 않고 메시지를 정확하게 순서대로</strong> 소비자에 전달해야 하거나 AMQP나 STOMP 프로토콜로 연동해야 한다면 <strong>래빗MQ</strong>를 고려함</li>\n</ul>\n<h3>메시지 생성 측 고려 사항</h3>\n<h4>메시지 유실 처리 방법</h4>\n<p>메시지를 생성할 때 고려할 점은 <strong>메시지 유실</strong>에 대한 것임. 예를 들어 메시지 전송 과정에서 타임아웃이 발생할 수 있음. <strong>타임아웃 문제는 생산자와 메시징 시스템 간의 네트워크 연결이 불안정하면 언제든지 발생할 수 있음.</strong></p>\n<p>오류 처리를 위해 선택할 수 있는 방법 <strong>3가지</strong>:</p>\n<h5>1. 무시함</h5>\n<ul>\n<li>오류를 무시.</li>\n<li><strong>메시지의 용도에 따라 유실이 일부 허용될 수 있음</strong>\n<ul>\n<li><strong>단순 로그 메시지</strong>: 유실되어도 괜찮음. 나중에 로그를 조회할 때 로그가 없으면 아쉬울 수 있지만 기능 동작에 문제는 없음\n<strong>-> 무시해도 기능상 이상이 없으면 무시 가능</strong></li>\n</ul>\n</li>\n</ul>\n<h5>2. 재시도함</h5>\n<ul>\n<li>일시적인 네트워크 불안정과 같은 오류는 재시도를 통해 해결될 수 있음</li>\n<li><strong>주의사항</strong>: 메시지 전송을 재시도하는 과정에서 <strong>중복된 메시지가 전송될 수 있음</strong>\n<ul>\n<li><strong>실제로는 전송에 성공했는데</strong> 일시적인 네트워크 오류로 <strong>전송에 실패한 것으로 인지하고 재시도할 수 있기 때문</strong>\n<strong>->  메시지마다 고유 식별자를 사용</strong></li>\n</ul>\n</li>\n</ul>\n<h5>3. 실패 로그를 남김</h5>\n<ul>\n<li>단순히 실패 로그를 남기는 것임. 로그는 나중에 후처리를 하는 데 사용됨</li>\n<li>실패 로그는 DB에 저장할 수도 있고 파일에 남길 수도 있음</li>\n<li>실패 로그는 <strong>후처리에 필요한 데이터를 담고 있어야 함</strong></li>\n</ul>\n<h4>DB 트랜잭션 연동 고려</h4>\n<p>메시지 생산자는 <strong>DB 트랜잭션과의 연동도 고려해야 함</strong>.\n<strong>DB 트랜잭션에 실패했는데</strong> 메시지가 발송되면 <strong>잘못된 데이터가 전달될 수 있기 때문임</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmklEQVR42n2T6ZaCMAxGff/n9IeCLC1l6UaGGyYzjkcnnAiW5CZfWi4xbRLWIGUvEnOUfuileTTig9e1XJL4ycvoRglLkLZr1Uc/Sj2ueZmlaRvphk6WbZHLevy0bStYKUWGYZCmaSSEoGv7vss0TTKOoyzLGYt77/X9uq5yv9+l6zqZ1/kAxkX/pJT0JUnAcs56Z63Wqm4F8GcrhfdFSs1yoU3n3U8wiVSnq8fjIc45LQgYe4b/AosCswGZkRnQeZ4lxqggk2rA5w7tXl87fAZidAgQCDO9Xq8KxhgFHf0r+RWIXJK2bVPJzBJHqj3TNcUoRFz5BEQGCcims9vtph2ThLF5BqQwcX3fq6J6HLM/QDoASFcEEAjMdvvTpgB/CzQDgBTOF440Ej5tigJT1A/hBH5LItlmZJti5/Md8E+HBlzjqueNBZPGXGxe9pVwhCjMZp3n7le6NVBP4KKfWslFPaX8MxPAQNzoVLZ3KInqKaYjJkk+4qcpaPGyH7sc8yZAobPteK7pfD7Wql3fzxZDsjnxsRxFSpIvtsFEj6BKGZ0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭션 롤백 문제\"\n        title=\"\"\n        src=\"/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png\"\n        srcset=\"/static/7b82af593f70b85c0480b8c7f31b47a6/c26ae/7.png 158w,\n/static/7b82af593f70b85c0480b8c7f31b47a6/6bdcf/7.png 315w,\n/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png 588w\"\n        sizes=\"(max-width: 588px) 100vw, 588px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li><strong>주문이 완료</strong> 됐다는 푸시 알림 발송</li>\n<li><strong>변경 실패 -> 트랜잭션 롤백</strong></li>\n<li>고객은 <strong>실패 화면을 보는데</strong> 주문 알림 <strong>푸시 알림을 받게됨</strong></li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVR42p2TiW6DMAyG+/6vWY5Cy32EHODxmaVjk7pKDbIcbOf3H9u5OG/FBSt+dSpx74L7bQvuT9yP/xx36YZW2r4Vlg9eyrKQNEulaRvZ+LZV6rqWx+Mhi1kkyzK53W6q13UVY4ykaSJZnkndVnLpx34/3O4HN/HeyzzPMgyD7uOy1qoAsCyLxqBZCroYmafdZo1cxnl4AiDTNEnf96phAbNxHJ8JYuLzwhZCkLD6A5CMceEgAbaqqqTrOmn3G5DkI0CCYURtyrJUUMCw/QeI7SXD839M8u7KLwFxwM45J/f7XZqm0f3HgDDkegBdr1cpikIbQ13P9XpbQ9ofxwNANHbAkiTRenIQtnGEYMW/gvlvwGHqtZNInueqGRkN2oV5IwE2AAGDPXGwpywkZQ7XLRwMzx2MTONhWMYuc+2YJMZG1vgUkJfCnBGIAzHz0RRY4ePpwQoNWGxaFGx6KwCNm8U4oz9+rwFyPHyvtrOs+7s++8+CzQYrX+doRYZszU1XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭션 완료 후 전송\"\n        title=\"\"\n        src=\"/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png\"\n        srcset=\"/static/2d2ff6e428af32c7d041f64fce82f895/c26ae/8.png 158w,\n/static/2d2ff6e428af32c7d041f64fce82f895/6bdcf/8.png 315w,\n/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png 577w\"\n        sizes=\"(max-width: 577px) 100vw, 577px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>-> 트랜잭션이 끝난 뒤에 메시지를 전송</strong></p>\n<h4>글로벌 트랜잭션</h4>\n<ul>\n<li><strong>개념</strong>: 여러 데이터베이스를 하나의 트랜잭션으로 처리</li>\n<li><strong>알고리즘</strong>: 2-Phase Commit (2PC)</li>\n<li><strong>장단점</strong>:\n<ul>\n<li>장점: DB 변경과 메시지 전송을 하나의 트랜잭션으로 묶음</li>\n<li>단점: 성능 저하, 모든 메시징 시스템이 지원하지 않음</li>\n</ul>\n</li>\n</ul>\n<h3>메시지 소비 측 고려사항</h3>\n<h4>1. 중복 메시지 처리</h4>\n<h5>고유 메시지 ID 활용</h5>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">ConsumerRecords</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> records consumer<span class=\"token punctuation\">.</span><span class=\"token function\">poll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofMillis</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumerRecord</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> record<span class=\"token operator\">:</span> records<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Message</span> m <span class=\"token operator\">=</span> messageConverter<span class=\"token punctuation\">.</span><span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">checkAlreadyHandled</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 이미 처리했는지 확인</span>\n            <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 처리하지 않고 무시함</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">recordHandledLog</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 처리 여부 기록</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>2. 멱등성 보장</h4>\n<blockquote>\n<p>메시지 처리 실패 후 재수신 시 중복 처리 가능성 주의</p>\n</blockquote>\n<hr>\n<p><strong>문제 상황:</strong></p>\n<ul>\n<li>외부 API를 호출했을 때 <strong>읽기 타임아웃이 발생하면 성공했을 가능성이 있음</strong></li>\n<li>실제로 성공했다면 수신자는 <strong>외부 API를 중복해서 두 번 호출하게 됨</strong></li>\n</ul>\n<p>-> <strong>멱등성을 갖도록 API를 구현</strong></p>\n<h4>3. 모니터링의 중요성</h4>\n<p>중복 메시지 처리와 함께 메시지 소비자를 구현할 때 고려할 점은 <strong>메시지를 잘 소비하고 있는지 모니터링하는 것임</strong></p>\n<p><strong>문제 상황:</strong></p>\n<ul>\n<li>메시지 소비자의 처리 속도가 갑자기 느려지면 <strong>큐에 메시지가 계속 쌓이게 됨</strong></li>\n<li>메시징 시스템에 따라 <strong>큐가 가득 차면 생산자가 메시지를 큐에 넣지 못하게 막는 상황도 발생할 수 있음</strong></li>\n</ul>\n<h3>메세지 종류</h3>\n<table>\n<thead>\n<tr>\n<th>이벤트</th>\n<th>커맨드</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>주문함</td>\n<td>포인트 지급하기</td>\n</tr>\n<tr>\n<td>로그인에 실패함</td>\n<td>로그인 차단하기</td>\n</tr>\n<tr>\n<td>상품 정보를 조회함</td>\n<td>배송 완료 문자 발송하기</td>\n</tr>\n<tr>\n<td>배송을 완료함</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h4>이벤트 특징:</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVR42o2Q22rDMAyG+/4vNhjdgd2MjsFu1tB4abLGR1m2/1pOM9qLwgRC6Lf0WdImJgLnCOctQvRwwUK0VLi5Dw4UAwL5FlddaqRHNInCEN9EJpRcEGPE8DPA+wp1DiklGGMQadFPvyeEEFqdRGMsvPNQvQLVmlLKBVh/ksRaC6UUtNawzuBl94iv/Sc4ctPH4wg1HbB9f4AaD2BOmOcZfd+3ARYgL0AxEVajOvXbxzM69X3zNukRr7snHKeh5cyMnDM48ZKvK692Db1nUkOR6pp0Wd20KK0NSFfA28Z7xGUyOZF413UN/ndD4oBccvX0by/I7SzazjD13trqpgvwDFDRIqxFIsvwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"메시지큐\"\n        title=\"\"\n        src=\"/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png\"\n        srcset=\"/static/d0400e8ac891f329b315bc3bf4bfbff1/c26ae/10.png 158w,\n/static/d0400e8ac891f329b315bc3bf4bfbff1/6bdcf/10.png 315w,\n/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png 577w\"\n        sizes=\"(max-width: 577px) 100vw, 577px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>과거에 일어난 일을 나타냄 (과거형 표현)</li>\n<li>\"~했다\", \"~됐다\" 형태</li>\n<li>시스템에서 발생한 사실을 알림</li>\n<li><strong>여러 시스템이 구독하여 반응할 수 있음</strong></li>\n</ul>\n<h4>커맨드 특징:</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.68354430379747%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR42kVQ62rGIAzt+z/TYDDYn8EusB+DvcC+rxetbacm0Z4ltnTC0ZiTc4zpuDBijkiULkgVBbfzyEVkPrn95Ha56rPCPMyrE92YGSGEBotFBKWUFscYW36appYnItRaQZmQUoL3Hs65Vkuc1VC7YC0y0bIsEBaM84CP71cM/o6sQsubqJaKKYx4+3pB725qfjQyz/NhKHQYWjdFSjv3usOtA54/H9H7G7Dj4lCBJXk8vT8o9wNbjVPYY/bbjgtd87K5FMVv3jCEO7a46r2cMxVUjSNtGEOPNS7q/8+ZjgrhDwCUg84+tzVJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"메세지\"\n        title=\"\"\n        src=\"/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png\"\n        srcset=\"/static/9b9e184b99a87a10365c7462019b3e22/c26ae/12.png 158w,\n/static/9b9e184b99a87a10365c7462019b3e22/6bdcf/12.png 315w,\n/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>앞으로 실행할 작업을 나타냄 (명령형 표현)</li>\n<li>\"~하기\", \"~하라\" 형태</li>\n<li><strong>특정 작업의 수행을 요청</strong></li>\n<li><strong>보통 하나의 시스템이 처리함</strong></li>\n</ul>\n<h3>궁극적 일관성</h3>\n<h4>개념</h4>\n<ul>\n<li>분산 시스템에서 데이터 복제를 다루는 일관성 모델</li>\n<li>두 데이터 저장소 간 일관성을 보장하지만 즉시는 아님</li>\n<li><strong>\"일정 시간 후에\" 일관성 달성</strong></li>\n</ul>\n<h4>예시</h4>\n<ol>\n<li>배송기사: <strong>\"배송 완료!\"</strong> (배송 시스템에 기록)</li>\n<li>고객 앱: <strong>아직 \"배송 중\"으로 표시</strong> (몇 분 지연)</li>\n<li><strong>최종</strong>: 메시지 전달 후 고객 앱도 \"배송 완료\"로 변경</li>\n</ol>\n<hr>\n<h2>3. 트랜잭션 아웃박스 패턴 사용</h2>\n<h3>트랜잭션 아웃박스 패턴의 개념</h3>\n<p>트랜잭션 완료 후 메시지 전송 방식도 완벽하지 않음.\n**재시도와 에러 처리 로직을 구현해도 메시징 시스템 연동 자체가 실패할 수 있기 때문</p>\n<p><strong>트랜잭션 아웃박스 패턴의 핵심 아이디어</strong>:</p>\n<ul>\n<li>메시지 데이터를 먼저 <strong>데이터베이스에 안전하게 저장</strong></li>\n<li><strong>별도 메세지 중계 프로세스</strong>가 저장된 메시지를 읽어서 메시징 시스템에 전송</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> 주문처리<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    transaction<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 1. 주문 데이터 저장</span>\n        orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 2. 메시지도 DB에 함께 저장 (같은 트랜잭션)</span>\n        outboxRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OutboxMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주문완료\"</span><span class=\"token punctuation\">,</span> orderData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 3. 둘 다 성공하면 커밋</span>\n        transaction<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        transaction<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 둘 다 실패하면 롤백</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42o2TiW6DMBBE8///GCUROQgNJICxja+tZ6gRqaqoiwawvbw9bHYhBpnDLO5NjvJZs7eUj45r1hmK46xlbLkWopedz7eQgjRfjdzqm3jvZWvD0EvbtvRB8Kqq5Hq7SkyROp8rOZ1O4rxjEAJTSmKtlWmaxDknTdNQxhjOQTD4qVGJ0YbvMKVUDjpwvAJhAA3jIPM8E3a5XAh6Pp8yjuOaMSooMFiMkeJa+AXUWkvf93I8HmW/3+dyzpxDpp+AIYS/gcgEJRwOB/bl8XiwnFIyDB//K0NEBhAld11HoVcFWnqIwPAtIIyhN2DClZ1L6ltDL9FTtAK7jaAAYhMRvLTqIxDv210E6H6/S13X3CRkjMxx1FAJfDZAtwJLL7aGjADBh23bSf965Z7q7JsoY+wKdASG5Q9YTv7y3EpNo0wmn71ZU9rkc0mpH02i9Lj+Sd8srlo2TBk86QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭션 아웃박스 패턴\"\n        title=\"\"\n        src=\"/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png\"\n        srcset=\"/static/a6806f9f22f3acf246dd005c2ac0ec4d/c26ae/13.png 158w,\n/static/a6806f9f22f3acf246dd005c2ac0ec4d/6bdcf/13.png 315w,\n/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png 583w\"\n        sizes=\"(max-width: 583px) 100vw, 583px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>메시지 중계 서비스 구현</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">processMessages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 이 메서드를 주기적으로 호출해서 메시지를 전송</span>\n    <span class=\"token comment\">// 아웃박스 테이블에서 대기 메시지 데이터를 순서대로 조회함</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageData</span><span class=\"token punctuation\">></span></span> waitingMessages <span class=\"token operator\">=</span> <span class=\"token function\">selectWaitingMessages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageData</span> m<span class=\"token operator\">:</span> waitingMessages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 메시지를 전송함</span>\n            <span class=\"token function\">markDone</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 발송 완료 표시함</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 메시지 발송에 실패한 경우 후속 처리함</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 에러가 났을 때 멈춤. 이유는 순서대로 발송하기 위함</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>에러 발생 시 루프 종료 이유</strong>:</p>\n<ul>\n<li>예를 들어 10개의 대기 메시지를 읽고 5번째 메시지 전송 중 에러가 발생</li>\n<li>6번째부터 계속 전송하면 메시지가 생성된 순서와 다른 순서로 전송됨</li>\n<li><strong>메시지 전송 순서가 중요한 경우 이 점이 매우 중요</strong></li>\n</ul>\n<h3>아웃박스 테이블 구조</h3>\n<table>\n<thead>\n<tr>\n<th>칼럼</th>\n<th>타입</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>id</td>\n<td>bigint</td>\n<td>단순 증가 값(PK). 저장된 순서대로 증가하는 값을 사용한다.</td>\n</tr>\n<tr>\n<td>messageId</td>\n<td>varchar</td>\n<td>메시지 고유 ID(고유키)</td>\n</tr>\n<tr>\n<td>messageType</td>\n<td>varchar</td>\n<td>LoginFailed<br>OrderPlaced</td>\n</tr>\n<tr>\n<td>payload</td>\n<td>clob</td>\n<td>메시지 데이터</td>\n</tr>\n<tr>\n<td>status</td>\n<td>varchar</td>\n<td>WAITING(대기)<br>DONE(완료)<br>FAILED(실패함)</td>\n</tr>\n<tr>\n<td>failCount</td>\n<td>int</td>\n<td>실패 횟수</td>\n</tr>\n<tr>\n<td>occuredAt</td>\n<td>timestamp</td>\n<td>메시지 발생 시간</td>\n</tr>\n<tr>\n<td>processedAt</td>\n<td>timestamp</td>\n<td>메시지 처리 시간</td>\n</tr>\n<tr>\n<td>failedAt</td>\n<td>timestamp</td>\n<td>마지막 실패 시간</td>\n</tr>\n</tbody>\n</table>\n<h4>payload</h4>\n<ul>\n<li>JSON, XML 등</li>\n</ul>\n<h4>실패 상태 변경 기준</h4>\n<ul>\n<li>\n<p><strong>자동 변경</strong>: 실패 횟수 기반 (예: 5회 실패 시 FAILED로 변경)</p>\n</li>\n<li>\n<p><strong>수동 변경/모니터링</strong>: 실패 횟수 10회 초과 시 운영팀 알림, 수동으로 FAILED 변경</p>\n</li>\n<li>\n<p><strong>후속 조치</strong>: FAILED 상태 메시지는 시스템 간 데이터 불일치 방지를 위한 적절한 후속 조치 필요</p>\n</li>\n<li>\n<p><strong>디버깅</strong>: <code class=\"language-text\">memo</code> 또는 <code class=\"language-text\">remark</code> 컬럼 추가하여 실패 원인 기록</p>\n<p><strong>주의사항</strong>:</p>\n<ul>\n<li>메시지 전송 실패 시 즉시 FAILED로 변경하지 말 것</li>\n<li>일시적 문제인 경우 몇 번 재시도 후 성공할 수 있음</li>\n</ul>\n</li>\n</ul>\n<h4>status</h4>\n<ul>\n<li><code class=\"language-text\">EXCLUDED</code> <strong>상태 추가 가능</strong></li>\n<li>실패가 아닌 특정 메시지를 수동으로 전송 방지할 때 사용</li>\n</ul>\n<hr>\n<h2>4. 배치로 연동</h2>\n<h3>배치 전송 개념 및 전형적 처리 방식</h3>\n<blockquote>\n<p>대량 데이터(10만 건)는 파일로 모아서 전송이 효율적</p>\n</blockquote>\n<ul>\n<li>배치 전송은 <strong>데이터를 비동기로 연동하는 가장 전통적인 방법</strong></li>\n<li>메시징 시스템이 거의 <strong>실시간으로 데이터를 연동</strong>했다면, 배치는 <strong>일정 간격으로 데이터를 전송</strong></li>\n<li>ex) 결제 승인 데이터를 모아서 다음날 아침에 보낸다던가</li>\n</ul>\n<h4>배치 처리의 전형적 과정</h4>\n<ol>\n<li>DB에서 전송할 데이터를 조회.</li>\n<li>조회한 결과를 파일로 기록.</li>\n<li>파일을 연동 시스템에 전송.</li>\n</ol>\n<ul>\n<li><strong>파일 전송은 FTP, SFTP 같은 파일 전송 프로토콜 또는 SCP 명령어를 사용.</strong></li>\n</ul>\n<h4>많이 사용한 파일 형식</h4>\n<h5>구분자 기준</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">홍길동,25,개발자,서울 \n김철수,30,디자이너,부산 \n이영희,28,기획자,대구</code></pre></div>\n<h5>key-value</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name=홍길동 age=25 job=개발자 city=서울\nname=김철수 age=30 job=디자이너 city=부산  \nname=이영희 age=28 job=기획자 city=대구</code></pre></div>\n<h5>Json</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"name\":\"홍길동\",\"age\":25,\"job\":\"개발자\",\"city\":\"서울\"}\n{\"name\":\"김철수\",\"age\":30,\"job\":\"디자이너\",\"city\":\"부산\"}\n{\"name\":\"이영희\",\"age\":28,\"job\":\"기획자\",\"city\":\"대구\"}</code></pre></div>\n<h4>파일 시스템 연동 시 정해야 할 항목</h4>\n<ul>\n<li>송수신 주체</li>\n<li>전송 주기/시점</li>\n<li>파일 전송 경로/파일명 규칙</li>\n</ul>\n<h5>송수신 주체 예시</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 299px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVR42mWSbauDMAyF/f8/TRCG7oMIuumY6NQ51PnuMp5AxbtbCE3Tk5OTtNY8z9I0jfR9L8Mw7Na2rSzLImZ9Ph/dp2lS/BGLEQNvcdi2TcqylCRJJIoi9SEgmdjpdBLf9+WW3LTwuq6SZZneFUUhz+dTsdhOCDAIAnEcR16vl6oBiM9e17X61+tVlbzfb8W7rqvq6HQnxDGkJJKAjeP4r2XwxDmDpxiKDY9FYp7nUlWVkmG0TOw4Q7NIejweOx5C8LQOsSpELnvXdWokcYkSki+Xi6RpKvf7XVulkMGDAW92JUQ+Vc7ns9i2rQOHkKFDFIahxHGshirGQwee5+ljoe7PDDkAQg1DNwr5Or8Lhdwjwqgnf1fIgUTzDwniE+POPAgFWST+4o//9gt6NrN9YcvmIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"송수신 주체\"\n        title=\"\"\n        src=\"/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png\"\n        srcset=\"/static/e8b85a166a2726a08b448ab74e5dcc23/c26ae/15.png 158w,\n/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png 299w\"\n        sizes=\"(max-width: 299px) 100vw, 299px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>확장하는 서비스는 <strong>소비자에 맞춰 업로드해주는 경우가 많았음.</strong>\n<ul>\n<li><strong>고객 시스템에 업로드해 준다.</strong></li>\n</ul>\n</li>\n<li>보안을 이유로 시스템을 외부에 노출시키기 어려운 조직은 <strong>다운로드 방식을 택하기도 했음.</strong></li>\n</ul>\n<h5>시간의 중요성</h5>\n<ul>\n<li><strong>소비자는 특정 시점까지 데이터를 받아야 함.</strong></li>\n<li>배치 파일은 에러나 누락을 확인할 수 있는 여유시간을 확보하려고 근무가 시작되는 시간대에 전송하는 경우가 많았음.</li>\n<li>경로, 파일명 충돌을 피하기 위해 규칙을 정했음.</li>\n</ul>\n<h5>파일 소비 프로세스 (생산자가 업로드해 줄 경우 소비자는 뭐 하냐?)</h5>\n<ol>\n<li>지정 경로에 파일 존재 확인함.</li>\n<li>파일이 있으면 데이터 읽음.</li>\n<li>파일 없으면 후처리.</li>\n<li>읽어온 데이터를 시스템에 반영.</li>\n<li>완료된 파일은 다른 폴더로 이동</li>\n</ol>\n<h4>파일 대신 API/DB 연동</h4>\n<ul>\n<li><strong>데이터가 적거나 처리 항목이 적으면 API로 일괄 전송하는 방식을 쓰기도 함.</strong></li>\n<li>같은 조직 내에는 <strong>DB 읽기 전용권한</strong>을 주고 직접 접근하게 하기도 함.</li>\n</ul>\n<h4>재처리, 빈 파일 처리</h4>\n<ul>\n<li>파일 전송 실패 시 일정 시간 뒤 <strong>재전송 기능을 구현</strong></li>\n<li><strong>수동 배치 실행 명령어나 API도 준비</strong></li>\n<li>전송할 데이터가 없을 때 파일을 생성하지 않으면, <strong>고객사는 파일이 없는 원인을 혼란스러워하므로</strong> 빈 파일도 전송하게 개선했음.</li>\n</ul>\n<hr>\n<h2>5. CDC 이용하기</h2>\n<blockquote>\n<p>데이터베이스는 데이터가 변경되면 그 변경 내용을 통지하는 기능을 가진다.</p>\n</blockquote>\n<p>모든 현대적인 데이터베이스(Oracle, MySQL 등)는 데이터의 변경 이력을 안정적으로 기록하고 관리하기 위한 <strong>트랜잭션 로그</strong>를 가지고 있음.</p>\n<p><strong>-> CDC는 바로 이 데이터베이스의 핵심 기능을 활용</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVR42pVQ26rDMAzr/39lCy30pfSWixMn0WyPlB0ODGYQJrKiKB5ySeCSDVlQWkEVdO4b8r9zwqBkr5QSQgi4rgulFPxaajpwZbTWzMB7j/M8cRzHY1hr/YPPUo1yXctVDEtjMLMlUzNNqeduprxzzlLHGJ8ZEdlMH9ees6xLwllCFfXvat/3HeM4YZom3Ndtl7Zts0vLsshsxLquoiXM82yPPYa6yMQEF25J4OGDQ2bhMlknisYpIgVbPMlM92V8dHD+futLwguj89VN29ZFkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 동작 방식\"\n        title=\"\"\n        src=\"/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png\"\n        srcset=\"/static/7b96041118acdbe715283e31dc0fd466/c26ae/16.png 158w,\n/static/7b96041118acdbe715283e31dc0fd466/6bdcf/16.png 315w,\n/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>CDC는 애플리케이션과 완전히 분리되어</strong>, 데이터베이스의 <strong>트랜잭션 로그를 직접 읽는 방식으로 동작</strong></p>\n<h4>전파 방법</h4>\n<h5>1. 변경 데이터를 그대로 대상 시스템에 전파</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 573px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVR42kWQ4W6DMAyEef9Xm6ZJ+zfWso6ihkoUCA0ksQ3XxHQd0uminM9BX0FCCBQQOenpxPElXimJ1Un+72MW7bPak5wTCmaGc3f0/Q1udggh4O/LmfcePiT5BUT0yvJ5GAfU5xqjHSEiYF1IjJM54vPwjh/znRb3sNaqru0VMUY0TaOes2makg+4mAtO7REfX2+pd9DHZRMUwoJ+vGGwadhZtG2LsixR/9a6wLkZXddhnmcYYzSrqkrv8vx477XPaY8kNEXmsoRFOfrolaFsrNzWbVVu+ay+7Tzzn2ReS9x7ua98JeIBqFqBhcpM3d4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 직접 전파\"\n        title=\"\"\n        src=\"/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png\"\n        srcset=\"/static/5621a3eb3b655dfc1af7e00698ce9ace/c26ae/17.png 158w,\n/static/5621a3eb3b655dfc1af7e00698ce9ace/6bdcf/17.png 315w,\n/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png 573w\"\n        sizes=\"(max-width: 573px) 100vw, 573px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h5>2. 변경 데이터를 가공/변환해서 전파</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 585px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR42lWPWQ7DMAhEc/97OlKt1ImU2IC3KdBUbT+eBobFeGmjojZB66o3bTTHYrGaxh/9rf3PVIw5sIzZUUrBeZ3IJYOooI/umG9eSglXviDCPmQ16zfMtxlb3vWhBXOCmZGeCTlnj0MIWMOK4zi0mRAfEcSEbdsQY/R83w9ld2Xi+whdWLsgk14mhMJv5crgxq6Z9AIpru4r9n3zvhBE9/TZ8QKKtTdapwAkGAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 변환 전파\"\n        title=\"\"\n        src=\"/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png\"\n        srcset=\"/static/5d55ecd3b1062717b9301afeb09f71e4/c26ae/18.png 158w,\n/static/5d55ecd3b1062717b9301afeb09f71e4/6bdcf/18.png 315w,\n/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png 585w\"\n        sizes=\"(max-width: 585px) 100vw, 585px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><strong>새로운 주문 데이터가 생성되거나 주문 상태가 '배송 중'으로 변경</strong>되면 통지 시스템에 전부 보낼 필요 없음.</li>\n<li><strong>주문ID랑 주문 상태만 보내면 됨.</strong></li>\n</ul>\n<h4>전파 대상</h4>\n<blockquote>\n<p>목적에 따라 DB, 메시징 시스템, API 등 선택 가능</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApUlEQVR42jVPSQ6EMAzr/7+JRDmBmNJma/E0AQ5WEtvZ0rg7bChEGWIMNoq6DwuoSfCue/7xDveGNuE9Y3Qkm4KZgaih1gut1dksuO8RfJ31dRWUUkBM6N1C+/yue+5en5V8k02TioIaRSy/gmVZsOVtLiDs+4HjOELLOWNdV5znCWYJ3aMP9Fkp3u08tzewPlG7vNB4h6QFWCm4B/JyT4/M2i/8A97LOCnEtNbUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"전파 대상 1\"\n        title=\"\"\n        src=\"/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png\"\n        srcset=\"/static/11494b74d1e631853d342f86f3c1827b/c26ae/19.png 158w,\n/static/11494b74d1e631853d342f86f3c1827b/6bdcf/19.png 315w,\n/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png 588w\"\n        sizes=\"(max-width: 588px) 100vw, 588px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR42mVQ7Y7DIAzb+79lf3Q99aZCy0chSfGRMHUnDWRhBzuK8uCLQVzBF30gBJL6reWfp+cqFxQ+UamMv46HfrZ+hQW1VkNrDXqUl9LNzKZF5NYpJazrinmejeuh0ZBHw27OOVtg33ds2wbvvYU0oFzrqhXK1asgIms4JhQVDVQJMUaball+sDwXpJjw+n1ZaJomhBDgnYdzDsdxDL45nPn8TKi7sR3qnvjN+9RyidWk8/Gq5rumvpgCQjyQz2R13ekf3DiFnUet5VQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"전파 대상 2\"\n        title=\"\"\n        src=\"/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png\"\n        srcset=\"/static/0a488d6c641a011e5b4b0d56f9e2855f/c26ae/20.png 158w,\n/static/0a488d6c641a011e5b4b0d56f9e2855f/6bdcf/20.png 315w,\n/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png 583w\"\n        sizes=\"(max-width: 583px) 100vw, 583px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>에러 상황</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dea97f9b3b148309587add5e4cb47258/d7542/22.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVR42n1UyY7bOBDV/39NjplcEsxcAswhE6TtbrTTXuW2rH2XiiL18oqyG0gmMwQeqlhkLaxXUjBZB+dmqBxGgZms399hiVEM7dNPdoWYyZ/Z236ib+Ccgy5rLXb7I+qmxa9ruz8gPL96fZ5nD13nS4TNy+7tnhYVmMn5CxqwH0YYZtX7iyN85n4Y0PfDvyrU+23Xe9+3Cp/OFo+7HGF4QtN0t4PJw9ykOtyr+r/lA55SQZpX2B1OiNMMVdMgL2vaahRlhapucI4Sb2PNmNiiwTj/PMckgwiyqvC69j/IGqud8Y6+8TMdxKLqHZut7XAoGkMILM+ViKQyJJCVM0A79nitYkzG+rPgdL7g+3aPwzFEHKfsoWHpZNUIGRQ6jj6QVqAJ7knuunM3Dii1oCDic5IkQ0xkWe5Z1kbXdet1rbzrezraN4a1z3fd7+clqH9yQQfne8Ms7Lthb7R0UUJIRlF3SOMnNNnfGLuQZ3pulju/wFfYn3jp9YI+TtCdThjzApbjMLGqiaMibQfTtbB9g6lTdP8JoV8gqxXkn6/oKNsvXyCbDVwULbhcPGwYEme4awzO1u9R1zAsIhASMTPyzAzgANuqgi1YZVkuUtnf7mD4tVg6Ojra34F+wt4HJlwj2jxgsz3ihZ/RwOALBs+wUJq+w9gv+1H3I6dA7pA3XYhAou9IXk+4Kstpzuobz2ypQ80vZyxSuCJC19JW1f5Mh3r20wtP5l33LJvqCh1tnbNzXODCoeWAQJRtBS9JlUDyC6TOFkZvdhKO8vqN88p/gLuNzXAJMSQp+pQspymaa4Ihz2FY6dS2i6yrBU1NsKdKgPaMMGVCvVz2bEuQ/fkXknfvEH/4gPLjR+R/vEf56ROm9Rry8ADzuIZZL9C9wr68wO342zoeiRBuv4ejzWQZgna1hj0cYI782zxvsP/8GenqEe2WNjpNPJvoKM/PMHSS7RZzHMNlKcKnFcL1CjZJAL7OcDKCVoPlGToaI2YLOSIhGY/OfAqfLswqlOP1CqGT1ym7+Ioo3CMOD2ipC5MMZYUf0Qm2s53DeAAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 에러 상황\"\n        title=\"\"\n        src=\"/static/dea97f9b3b148309587add5e4cb47258/f058b/22.png\"\n        srcset=\"/static/dea97f9b3b148309587add5e4cb47258/c26ae/22.png 158w,\n/static/dea97f9b3b148309587add5e4cb47258/6bdcf/22.png 315w,\n/static/dea97f9b3b148309587add5e4cb47258/f058b/22.png 630w,\n/static/dea97f9b3b148309587add5e4cb47258/d7542/22.png 810w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>잘 처리된 상황</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3b54b60ad45314c997c0ab99f487d975/d2c2a/24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACf0lEQVR42mVS2W7bMBDU/39PH9K3Am0RNEDRxolz2IkvybZOSyLFm9J0ScdG0VIYaC9yZ4/EOY9xnKC0gbEuygHej9F28U8EaSeUfIJxZz3YLd3Rxl7lxI8jwimrGl3PcDnhofV2h2EQV1vVKdzNcwjtr7bm1GKbZlEOJJJWjBDKgnEeLyul4TyxmibKbBASThQcdevBRPCfbWQitpYq0dEf7MnL3mK5KbB8W2GzTbF4WyPdHyClwiBkTBSSTHQh4MJe0yOOHruc4IsMSxbYeBhSJPWsoNJfF0sc+zrqUhkoc+6vtjbGlXVDid/x/L6L9gjnYAkJz3KYsoTMC4hjDisEvFIwYoALMsFJeUaQLyBdD3/pFG+pqsQ9PcE+ziFnD1DzOcbjEZ5KHvdHTH2PiRFOJ0x1DTAaGtkCpo//FV0HT+1JRFVCcwZNBss4HDntBxwFhOy2KKDTNLKPPnr4P5DdEONkzjZ4O6ZYbTO8Hba0ElSupl6Z8/RkKN+emz99fNdB/PPFoeyHBpIPqOsMJ8nBiUXOGmR9CUYZpVBoO45Ty84L70Z0ZkCjiVVYej/F5GGpPa1bUioqwSmI4UCTGqGdQW9FvKQ8BY4OjFhWbIg+YTRazdEohsGoCK4kuJZQ1iD5mv3Gp9133Ozu8CX/hZv0Dp93t/jZL/CoNpjJFR7UmuQ1nk2KpT9EvPsc66nEaqQd9ke8+D32tkFyXy/xzDd45SlmxRy3q2+YnTZYDDsCPUB44VvM+zUyW6GYOpSE1FX4kc1wX70iJz2gcB2StCtwon5Usseh3iArHrFrWyqpRy27iEq2KANEi1w08b9lORFY4Kla4TDUKMSJYnv8AdnrMQ+yS5lwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 잘 처리된 상황\"\n        title=\"\"\n        src=\"/static/3b54b60ad45314c997c0ab99f487d975/f058b/24.png\"\n        srcset=\"/static/3b54b60ad45314c997c0ab99f487d975/c26ae/24.png 158w,\n/static/3b54b60ad45314c997c0ab99f487d975/6bdcf/24.png 315w,\n/static/3b54b60ad45314c997c0ab99f487d975/f058b/24.png 630w,\n/static/3b54b60ad45314c997c0ab99f487d975/d2c2a/24.png 929w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>실제 사례</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR42p1S2XKDMAzM/39j8wpkoDY2PsDX1itCZjJtX2JmZyUkrxfkWy4JqaPU3PkA809Ra8ENaDDWYBwHhBhQW5VC6/wX6r8oYqgLAt55PB4P7PuOT1frT6rpFDyOA0opzPOMZVmwruvZ1NovxBjhnEMIQWL2krlegnRmjJEC423bhHPOAr4nKEIBHk5YazFNE7z374LXBuedNNDpMAzQWgnTEYV4KDcTl0OttcRvgin1CZWKGCLUt5K85CLC4zDKp9JpOhK00vJbCIrdv+6wxp6CHEpuGeWFIhO74tyvEq/TVWcedo8tbHDRwffY9Zicn/Uflmhw4KPFGewAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDC 실제 사례\"\n        title=\"\"\n        src=\"/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png\"\n        srcset=\"/static/1e3b942677f80a80d330bfb04af9c9d5/c26ae/21.png 158w,\n/static/1e3b942677f80a80d330bfb04af9c9d5/6bdcf/21.png 315w,\n/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png 577w\"\n        sizes=\"(max-width: 577px) 100vw, 577px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><code class=\"language-text\">신규 주문 시스템</code>이 평소처럼 주문을 처리하고 DB에 데이터를 저장/수정</li>\n<li>CDC가 <strong>DB의 변경 내역을 실시간으로 감지합니다.</strong></li>\n<li>CDC가 이 변경 데이터를 <code class=\"language-text\">기존 주문 시스템</code>이나 <code class=\"language-text\">콘텐츠 서비스</code>가 이해할 수 있는 형태로 <strong>가공하여 메시지 큐(카프카)로 전달합니다.</strong></li>\n<li><code class=\"language-text\">기존 주문 시스템</code> 등은 메시지 큐에서 데이터를 가져가서 자신들의 시스템에 반영</li>\n</ul>\n<h4>구현</h4>\n<p><strong>Debezium</strong></p>\n<ul>\n<li><strong>역할</strong>: <strong>실제 CDC의 핵심</strong>. 데이터베이스의 '가짜 복제본(replica)'처럼 위장하여\n트랜잭션 로그를 읽어 들이는 커넥터</li>\n<li><strong>특징</strong>: <strong>MySQL, PostgreSQL, MongoDB, SQL Server</strong> 등 거의 모든 주요 데이터베이스를 지원</li>\n</ul>\n<p><strong>Kafka Connect</strong></p>\n<ul>\n<li><strong>역할</strong>: <strong>Debezium 커넥터</strong>를 실행하고 관리하는 <strong>'실행 환경'</strong></li>\n<li><strong>특징</strong>: Debezium을 안정적으로 실행하고, 장애가 발생하면 자동으로 재시작해줌.</li>\n</ul>\n<p><strong>Apache Kafka</strong></p>\n<ul>\n<li><strong>역할</strong>: Debezium이 읽어 들인 변경 데이터를 저장하고 다른 시스템으로 전파</li>\n</ul>","wordCount":{"words":2117},"frontmatter":{"title":"비동기 처리: 메시지 큐부터 CDC까지 5가지 구현 방법","date":"September 22, 2025","description":"동기 vs 비동기 처리의 차이점과 5가지 비동기 구현 패턴(스레드, 메시지 큐, 트랜잭션 아웃박스, 배치, CDC)을 코드 예제와 함께 상세히 설명합니다."}},"previous":{"fields":{"slug":"/oneToone/"},"frontmatter":{"title":"JPA @OneToOne 양방향 관계에서 발생하는 N+1 문제 해결 방법"}},"next":{"fields":{"slug":"/network2/"},"frontmatter":{"title":"HTTP, HTTPS 그리고 웹의 동작 원리"}}},"pageContext":{"id":"7ebaac03-1a97-518a-8709-97b4c18db099","previousPostId":"88c8c3ad-07c2-5c35-a23f-b46b8737daab","nextPostId":"200e4ba5-aeca-5981-bec6-e05f77f432f8"}},"staticQueryHashes":["3257411868","3517523002"],"slicesMap":{}}