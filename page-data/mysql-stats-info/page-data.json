{"componentChunkName":"component---src-templates-blog-post-js","path":"/mysql-stats-info/","result":{"data":{"site":{"siteMetadata":{"title":"GoToBill"}},"markdownRemark":{"id":"4999f5fd-0945-585d-817d-9fc01cd371fa","excerpt":"통계 정보가 왜 중요한가? MySQL 옵티마이저는 쿼리 실행 계획을 수립할 때 통계 정보에 의존합니다. 통계 정보가 부정확하면 최악의 실행 계획이 선택될 수 있습니다. 실제 사례 1억 건의 레코드가 있는 테이블인데 통계 정보가 갱신되지 않아 1…","html":"<h2>통계 정보가 왜 중요한가?</h2>\n<p>MySQL 옵티마이저는 쿼리 실행 계획을 수립할 때 통계 정보에 의존합니다. 통계 정보가 부정확하면 최악의 실행 계획이 선택될 수 있습니다.</p>\n<p><strong>실제 사례</strong></p>\n<p>1억 건의 레코드가 있는 테이블인데 통계 정보가 갱신되지 않아 10건으로 잘못 기록된 경우:</p>\n<ul>\n<li>옵티마이저 판단: \"레코드가 10건밖에 없으니 인덱스보다 풀 테이블 스캔이 빠르겠다\"</li>\n<li>실제 실행: 1억 건을 모두 스캔</li>\n<li>결과: 0.1초면 끝날 쿼리가 1시간 소요</li>\n</ul>\n<p>비용 기반 최적화(Cost-based Optimization)에서 통계 정보의 정확도는 곧 쿼리 성능입니다.</p>\n<h2>MySQL 5.5 vs 5.6+ 통계 정보 관리</h2>\n<h3>MySQL 5.5 이전: 휘발성 통계</h3>\n<p>통계 정보가 메모리에만 존재했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 통계 정보 확인</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">INDEX</span> <span class=\"token keyword\">FROM</span> employees<span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>문제점</strong></p>\n<ul>\n<li>MySQL 재시작 시 통계 정보 소실</li>\n<li>서버 시작 시 모든 테이블 통계 재수집 필요</li>\n<li>의도하지 않은 시점에 통계 자동 갱신</li>\n<li>갱신 시점을 예측할 수 없어 실행 계획이 갑자기 변경됨</li>\n</ul>\n<p><strong>자동 갱신 조건</strong></p>\n<ul>\n<li>테이블 새로 오픈</li>\n<li>전체 레코드의 1/16 이상 변경</li>\n<li>ANALYZE TABLE 실행</li>\n<li>SHOW TABLE STATUS 실행</li>\n<li>InnoDB 모니터 활성화</li>\n</ul>\n<p>이런 조건에서 통계가 갑자기 변경되면 잘 동작하던 쿼리가 갑자기 느려질 수 있습니다.</p>\n<h3>MySQL 5.6+: 영구 통계 정보</h3>\n<p>통계 정보를 테이블에 저장하여 영구 보관합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 통계 정보 저장 테이블 확인</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">TABLES</span> <span class=\"token operator\">LIKE</span> <span class=\"token string\">'%_stats'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>Tables_in_mysql</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>innodb_index_stats</td>\n</tr>\n<tr>\n<td>innodb_table_stats</td>\n</tr>\n</tbody>\n</table>\n<p><strong>innodb_table_stats</strong>: 테이블 전체 통계</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span>innodb_table_stats\n<span class=\"token keyword\">WHERE</span> database_name<span class=\"token operator\">=</span><span class=\"token string\">'mydb'</span> <span class=\"token operator\">AND</span> table_name<span class=\"token operator\">=</span><span class=\"token string\">'orders'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>n_rows</th>\n<th>clustered_index_size</th>\n<th>sum_of_other_index_sizes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>299202</td>\n<td>929</td>\n<td>642</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><strong>n_rows</strong>: 테이블 전체 레코드 수</li>\n<li><strong>clustered_index_size</strong>: 프라이머리 키 크기 (InnoDB 페이지 개수)</li>\n<li><strong>sum_of_other_index_sizes</strong>: 프라이머리 키를 제외한 인덱스의 크기</li>\n</ul>\n<p><strong>innodb_index_stats</strong>: 인덱스별 통계</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> index_name<span class=\"token punctuation\">,</span> stat_name<span class=\"token punctuation\">,</span> stat_value<span class=\"token punctuation\">,</span> stat_description\n<span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span>innodb_index_stats\n<span class=\"token keyword\">WHERE</span> database_name<span class=\"token operator\">=</span><span class=\"token string\">'mydb'</span> <span class=\"token operator\">AND</span> table_name<span class=\"token operator\">=</span><span class=\"token string\">'orders'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>index_name</th>\n<th>stat_name</th>\n<th>stat_value</th>\n<th>stat_description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>PRIMARY</td>\n<td>n_diff_pfx01</td>\n<td>1000000</td>\n<td>order_id</td>\n</tr>\n<tr>\n<td>PRIMARY</td>\n<td>n_leaf_pages</td>\n<td>2300</td>\n<td>Number of leaf pages</td>\n</tr>\n<tr>\n<td>idx_user</td>\n<td>n_diff_pfx01</td>\n<td>50000</td>\n<td>user_id</td>\n</tr>\n<tr>\n<td>idx_user</td>\n<td>n_leaf_pages</td>\n<td>800</td>\n<td>Number of leaf pages</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><strong>n_diff_pfx01</strong>: 인덱스 유니크 값 개수 (카디널리티)</li>\n<li><strong>n_leaf_pages</strong>: 리프 노드 페이지 개수</li>\n<li><strong>size</strong>: 인덱스 전체 페이지 개수</li>\n</ul>\n<h2>영구 통계 정보 설정</h2>\n<h3>STATS_PERSISTENT 옵션</h3>\n<p>테이블 생성 시 통계 정보 관리 방식을 지정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 영구 통계 사용</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> orders <span class=\"token punctuation\">(</span>\n    order_id <span class=\"token keyword\">INT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n    user_id <span class=\"token keyword\">INT</span><span class=\"token punctuation\">,</span>\n    amount <span class=\"token keyword\">DECIMAL</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> STATS_PERSISTENT<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- 휘발성 통계 사용 (5.5 방식)</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> temp_orders <span class=\"token punctuation\">(</span>\n    order_id <span class=\"token keyword\">INT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n    amount <span class=\"token keyword\">DECIMAL</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> STATS_PERSISTENT<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- 기존 테이블 변경</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> products STATS_PERSISTENT<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>옵션 값</strong></p>\n<ul>\n<li><strong>STATS_PERSISTENT=1</strong>: 통계 정보를 innodb_table_stats, innodb_index_stats에 저장</li>\n<li><strong>STATS_PERSISTENT=0</strong>: MySQL 5.5 방식 (메모리에만 저장)</li>\n<li><strong>STATS_PERSISTENT=DEFAULT</strong>: innodb_stats_persistent 시스템 변수 값 따름 (기본값 ON)</li>\n</ul>\n<h3>STATS_AUTO_RECALC 옵션</h3>\n<p>통계 정보 자동 갱신 여부를 제어합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 자동 갱신 비활성화</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> orders <span class=\"token punctuation\">(</span>\n    order_id <span class=\"token keyword\">INT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n    user_id <span class=\"token keyword\">INT</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span>\n  STATS_PERSISTENT<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n  STATS_AUTO_RECALC<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- 기존 테이블 변경</span>\n<span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> orders STATS_AUTO_RECALC<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>옵션 값</strong></p>\n<ul>\n<li><strong>STATS_AUTO_RECALC=0</strong>: 자동 갱신 비활성화, ANALYZE TABLE로만 갱신</li>\n<li><strong>STATS_AUTO_RECALC=1</strong>: MySQL 5.5 방식처럼 자동 갱신</li>\n<li><strong>STATS_AUTO_RECALC=DEFAULT</strong>: innodb_stats_auto_recalc 시스템 변수 값 따름 -> 1이 디폴트임.</li>\n</ul>\n<h3>샘플링 설정</h3>\n<p>MySQL은 전체 데이터를 스캔하지 않고 일부 페이지만 샘플링하여 통계를 수집합니다.</p>\n<p><strong>시스템 변수</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 영구 통계 샘플링 (ANALYZE TABLE 실행 시)</span>\n<span class=\"token keyword\">SET</span> <span class=\"token keyword\">GLOBAL</span> innodb_stats_persistent_sample_pages <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">-- 기본값</span>\n\n<span class=\"token comment\">-- 자동 통계 샘플링 (자동 갱신 시)</span>\n<span class=\"token keyword\">SET</span> <span class=\"token keyword\">GLOBAL</span> innodb_stats_transient_sample_pages <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">-- 기본값</span></code></pre></div>\n<p><strong>샘플링 크기와 정확도</strong></p>\n<table>\n<thead>\n<tr>\n<th>샘플 페이지</th>\n<th>정확도</th>\n<th>수집 시간</th>\n<th>용도</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>8</td>\n<td>낮음</td>\n<td>빠름</td>\n<td>자동 갱신 (참고용)</td>\n</tr>\n<tr>\n<td>20</td>\n<td>보통</td>\n<td>보통</td>\n<td>기본 설정</td>\n</tr>\n<tr>\n<td>100</td>\n<td>높음</td>\n<td>느림</td>\n<td>대용량 테이블, 중요 쿼리</td>\n</tr>\n</tbody>\n</table>\n<p>대부분의 경우 기본값 20으로 충분합니다. 다만 수억 건 이상의 대용량 테이블이면서 쿼리 성능이 매우 중요한 경우 샘플링 값을 높일 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 특정 테이블만 정밀하게 수집</span>\n<span class=\"token keyword\">SET</span> <span class=\"token keyword\">GLOBAL</span> innodb_stats_persistent_sample_pages <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ANALYZE</span> <span class=\"token keyword\">TABLE</span> critical_orders<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token keyword\">GLOBAL</span> innodb_stats_persistent_sample_pages <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">-- 원복</span></code></pre></div>\n<h3>통계 정보 확인</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 인덱스 통계 확인</span>\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">INDEX</span> <span class=\"token keyword\">FROM</span> orders<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- 상세 통계 확인</span>\n<span class=\"token keyword\">SELECT</span>\n    index_name<span class=\"token punctuation\">,</span>\n    stat_name<span class=\"token punctuation\">,</span>\n    stat_value<span class=\"token punctuation\">,</span>\n    stat_description\n<span class=\"token keyword\">FROM</span> mysql<span class=\"token punctuation\">.</span>innodb_index_stats\n<span class=\"token keyword\">WHERE</span> database_name <span class=\"token operator\">=</span> <span class=\"token string\">'mydb'</span>\n  <span class=\"token operator\">AND</span> table_name <span class=\"token operator\">=</span> <span class=\"token string\">'orders'</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> index_name<span class=\"token punctuation\">,</span> stat_name<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>설정 확인</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 현재 설정 확인</span>\n<span class=\"token keyword\">SHOW</span> VARIABLES <span class=\"token operator\">LIKE</span> <span class=\"token string\">'innodb_stats%'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>Variable_name</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>innodb_stats_auto_recalc</td>\n<td>ON</td>\n</tr>\n<tr>\n<td>innodb_stats_persistent</td>\n<td>ON</td>\n</tr>\n<tr>\n<td>innodb_stats_persistent_sample_pages</td>\n<td>20</td>\n</tr>\n<tr>\n<td>innodb_stats_transient_sample_pages</td>\n<td>8</td>\n</tr>\n</tbody>\n</table>\n<h2>요약</h2>\n<p><strong>핵심 포인트</strong></p>\n<ol>\n<li>MySQL 5.6+에서는 영구 통계 정보를 사용하여 서버 재시작 후에도 통계가 유지됩니다.</li>\n<li>STATS_PERSISTENT=1을 통해서 실행 계획을 유지할 수 있습니다.</li>\n<li>샘플링 크기는 대부분 기본값(20)으로 충분하며, 필요시에만 조정합니다.</li>\n</ol>","wordCount":{"words":413},"frontmatter":{"title":"MySQL 테이블 통계 정보","date":"October 17, 2025","description":"MySQL 통계 정보가 쿼리 성능에 미치는 영향과 영구 통계 정보 관리 방법을 설명합니다."}},"previous":{"fields":{"slug":"/netty-eventloop/"},"frontmatter":{"title":"Netty 이벤트 루프 완전 정복"}},"next":{"fields":{"slug":"/mysql-histogram/"},"frontmatter":{"title":"MySQL 히스토그램으로 쿼리 성능 개선하기"}}},"pageContext":{"id":"4999f5fd-0945-585d-817d-9fc01cd371fa","previousPostId":"5a7d2201-d668-5e1b-842e-6da7a5f55fd3","nextPostId":"4c6d09e4-c0ee-565e-998c-5ad61669fc8b"}},"staticQueryHashes":["3257411868","3517523002"],"slicesMap":{}}