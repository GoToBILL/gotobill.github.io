{"componentChunkName":"component---src-templates-blog-post-js","path":"/db-cache-consistency/","result":{"data":{"site":{"siteMetadata":{"title":"GoToBill"}},"markdownRemark":{"id":"27682fe2-7c54-51f4-ab5c-0d9651209b5f","excerpt":"들어가며 캐시는 DB 부하를 줄이고 응답 속도를 높이는 핵심 기술입니다. 하지만 같은 데이터가 두 곳(DB, Cache)에 존재하기 때문에 일관성 문제가 발생합니다. 이 글에서는 캐시 전략별 특징과 일관성 문제, 그리고 해결 방법을 알아봅니다. 캐시 전략 개요 1. Cache-Aside…","html":"<h2>들어가며</h2>\n<p>캐시는 DB 부하를 줄이고 응답 속도를 높이는 핵심 기술입니다. 하지만 <strong>같은 데이터가 두 곳(DB, Cache)에 존재</strong>하기 때문에 일관성 문제가 발생합니다.</p>\n<p>이 글에서는 캐시 전략별 특징과 일관성 문제, 그리고 해결 방법을 알아봅니다.</p>\n<h2>캐시 전략 개요</h2>\n<h3>1. Cache-Aside (Lazy Loading)</h3>\n<p>가장 널리 사용되는 패턴입니다. <strong>애플리케이션이 캐시와 DB를 직접 관리</strong>합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/711e5dcb9d50a91fd25e204faee20601/0486e/cache.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACLElEQVR42nWTS47UMBiE5xjQmthO4nTiJM6r00m7m2nQ9AhpxGZYzAo2XAFOwRkQ9+B2Rdmeh4TEomTH+v25/keuRNZA6DaqtFB1D1l0QarsIVSLzcYgFRYmG4JqqtMTLFXnY5DJJ0jZ4ypfZmhHrTPKWwfz6QbFaUHhFmzPDlk74e0bg74YcTE7fCh3uKsXPI4nPHRH3JoFl3rFpTkgS0dcJaJBIunyWfyWdCWVpehUWlxfN2Et6KLQM1LFLNTA+BFKjcjpUGcT9wOBSQ2ZGIJqCF4MEl7x7BkomHJtjxgHh65hqizHOlgcpoHACRmBqXcoeWlDJ0K0ULpDagaojKtySDPHVz2QjmWHstqjtSeY7hazu8dh71BXI0F9gAZgmvX4Uhq0uke2rqjuTtD7I94ff+HsfvOhLgD9JZ9qXjqU9g7blqpPqOoz8vQMrdcI9A5OFWuT90joUiRtqMtgf2BovwdnSTgbeGGI9WMZ4tqgNl9xf/kDW39jTMOUZYskZcoM8oGK6SvZhWAv7yxJ7Aswpwuz3dPAzH2PpnrAfvwJU35miboIlKJ9gj0B+fqLI8oDA6zgaJULnDng0DjY3oW6+ke13rExswfaf2ARGGpGiAdLX8d0wkcz4rHqUHH+2vmI6t0Z5eEGulgI3L8C/weLGkNjFNe2WjHQmeYwZ/mOnZ1RbCNM6yUC/bj4GYvqQhP8L+Tl3XkJ0YdGeaii05T7LPUpxjS98jw6/AtU+2TdGgrSiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"캐시어사이드 전략\"\n        title=\"\"\n        src=\"/static/711e5dcb9d50a91fd25e204faee20601/f058b/cache.png\"\n        srcset=\"/static/711e5dcb9d50a91fd25e204faee20601/c26ae/cache.png 158w,\n/static/711e5dcb9d50a91fd25e204faee20601/6bdcf/cache.png 315w,\n/static/711e5dcb9d50a91fd25e204faee20601/f058b/cache.png 630w,\n/static/711e5dcb9d50a91fd25e204faee20601/40601/cache.png 945w,\n/static/711e5dcb9d50a91fd25e204faee20601/78612/cache.png 1260w,\n/static/711e5dcb9d50a91fd25e204faee20601/0486e/cache.png 2008w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CacheAsideService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 1. 캐시 조회</span>\n        <span class=\"token class-name\">User</span> cached <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> cached<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Cache Hit</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 2. Cache Miss - DB 조회</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 3. 캐시에 저장</span>\n        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofMinutes</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 1. DB 업데이트</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 2. 캐시 삭제 (무효화)</span>\n        cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>장점</strong></p>\n<ul>\n<li><strong>구현이 단순함</strong></li>\n<li>읽기가 많은 워크로드에 효과적</li>\n<li>필요한 데이터만 캐싱 (Lazy)</li>\n</ul>\n<p><strong>단점</strong></p>\n<ul>\n<li>첫 조회 시 <strong>Cache Miss로 지연 발생</strong></li>\n<li>캐시 삭제와 DB 업데이트 사이에 불일치 가능</li>\n</ul>\n<h3>2. Write-Through</h3>\n<p>쓰기 시 <strong>캐시와 DB를 동시에 업데이트</strong>합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0b687a776caf9760d9d8156e8811d01d/393aa/write-through.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKUlEQVR42o2UzW4TMRSF8x4hHtvz0/n3/E+TAKERUrspYkmfAgkJdcuODRJIrHkH1rDmuQ732jNp1AHE4sgZJ/7m3Huus/K8HEqV0CRe+fkkWdDqJGUJqSbxZ2mslJpVWa20XyGNe0TpFnE6QllIbiHiCa0id4AN7a/peU1wbwk6AX0CXjRXOOy3MOVoD1tXokDQj/Czxu6FwyWS6wPi43PoqKYXlwuYUjVWAQHj8imGukeZ9VSmcSWSVFghqHqE3YigGaDTll7QQQd0WC5hWhOQy0uo5IKg2q+nfk09Y6dUqiKAbwYLV5rKlMtSGXYCMoQDEbZfE2wW9Yl7JkUJP25I7Zk7Kl2Ra78ntTPQpShEsYRNSdo02RmHcYIZglDf83cw6Qe05ScK9+4B+E/YIs3a7oXBFfrqC17ffsfN8QeK5K0D/g9Mk6R00rohMfCIy+Ybbm9+4vrwCyZ774A8Alr+eWD15Ep4FSJKPeaRsYnSBPg71Pk96uwj+vIzsvgNj02NkIZaZztcJKM9fO6MQT4drjKDzjCkpqDqyaWTC6UjNViJsMNdWuBrvMazpIPgHyk3tBaUG+w6UmvQlBU1n5029P0MbG3CDthiJaMer6IC92KDPh2gfNdw7tWeQFXuXI1NhePW4OWeryrdHjW7a8/U0dUjF1G2R1i9QBQPtjdzmgz1JJVHJUpahddg4z24ewyzQM8rrQP+g3h8AxjkTzfAAizk7zAG/gb5Vr86t6oKlgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"wirte-through\"\n        title=\"\"\n        src=\"/static/0b687a776caf9760d9d8156e8811d01d/f058b/write-through.png\"\n        srcset=\"/static/0b687a776caf9760d9d8156e8811d01d/c26ae/write-through.png 158w,\n/static/0b687a776caf9760d9d8156e8811d01d/6bdcf/write-through.png 315w,\n/static/0b687a776caf9760d9d8156e8811d01d/f058b/write-through.png 630w,\n/static/0b687a776caf9760d9d8156e8811d01d/40601/write-through.png 945w,\n/static/0b687a776caf9760d9d8156e8811d01d/393aa/write-through.png 1190w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WriteThroughService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 캐시와 DB 동시 업데이트 (트랜잭션 내에서)</span>\n        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>장점</strong></p>\n<ul>\n<li><strong>캐시가 항상 최신 상태</strong></li>\n<li>읽기 시 Cache Miss 감소</li>\n</ul>\n<p><strong>단점</strong></p>\n<ul>\n<li><strong>쓰기 지연 증가</strong> (캐시 + DB 둘 다 기다림)</li>\n<li>사용되지 않는 데이터도 캐싱될 수 있음</li>\n</ul>\n<h3>3. Write-Behind (Write-Back)</h3>\n<p>쓰기를 <strong>캐시에만 먼저</strong> 하고, <strong>DB 반영은 비동기로</strong> 처리합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/750774d33a354b3673692a2baed7e66a/bb051/write-behind.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACBElEQVR42p2TTY7TQBSEfQ2kxG7/xT9tu9sdx07GEyCMRggOABILpFkhwYYzsOECiCUrdiyQWMPZinLbCZNEiIhFKUrL/lz16rUj/ApBoBAGFYQo4XnFpPKg4VyI6kQKvr+XPsjJ0gZJ2iGVPeKohuvKE9g56A9Mn6iGExZbtP1DbNsOfmjgucV/w4KAwIXcQOk1WtUgjAwdFhfA1BHI9w1hZgRGoSbw2sa+zNl9GM/ZgT/JAr25RFy3COLaxr0cpglYYxHfIlk85fx3/L+E484kREZYVBFYXjiz2jqT2R1W+hM6/QVd/RlRtIUzb/nA4wZebyC6JbwZXfrqHwVwXjyX6Vs8v/2GVy9/4mr5lS5vCOSa+LkeHR727RgmKNebYto2B2AJJd/j0foHbvpf2K6+E/gEjmDMKOcDEV90z2F7kCkV4w0XYFyPINBI4mcosjcos3f8vUMYdnDitIWQV4RuOAPuoVdZmCcGaVRScT6KLzCFx8WnRqixUNtwMN22kKWsswYfc4HXWQE3Zts2skaWaFw3CjWdKamxWWrs1hp9M7g2fNnYVsOwuScC22yFD/MHeLFg20l3BEwXGjO3Rp7WdEmo0VgqboQYF3kAHKvhTeFCJ3qHpOgR8atianKAemKcl/DHqHPXWHdj3HOYBQ4FyLxjQ2Yq4/hu7hUG+5h/hw3A33wWvvFU4KVdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"롸이트 비하인드\"\n        title=\"\"\n        src=\"/static/750774d33a354b3673692a2baed7e66a/f058b/write-behind.png\"\n        srcset=\"/static/750774d33a354b3673692a2baed7e66a/c26ae/write-behind.png 158w,\n/static/750774d33a354b3673692a2baed7e66a/6bdcf/write-behind.png 315w,\n/static/750774d33a354b3673692a2baed7e66a/f058b/write-behind.png 630w,\n/static/750774d33a354b3673692a2baed7e66a/40601/write-behind.png 945w,\n/static/750774d33a354b3673692a2baed7e66a/bb051/write-behind.png 1212w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WriteBehindService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Queue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WriteEvent</span><span class=\"token punctuation\">></span></span> writeQueue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentLinkedQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 1. 캐시에만 즉시 저장</span>\n        cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 2. 쓰기 큐에 추가 (비동기 처리)</span>\n        writeQueue<span class=\"token punctuation\">.</span><span class=\"token function\">offer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WriteEvent</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Scheduled</span><span class=\"token punctuation\">(</span>fixedRate <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">flushToDatabase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WriteEvent</span><span class=\"token punctuation\">></span></span> batch <span class=\"token operator\">=</span> <span class=\"token function\">drainQueue</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>batch<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">batchUpdate</span><span class=\"token punctuation\">(</span>batch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>장점</strong></p>\n<ul>\n<li><strong>쓰기 응답 속도 매우 빠름</strong></li>\n<li>DB 부하 감소 (배치 처리)</li>\n</ul>\n<p><strong>단점</strong></p>\n<ul>\n<li><strong>캐시 장애 시 데이터 유실 위험</strong></li>\n<li>복잡한 구현</li>\n<li>일관성 보장 어려움</li>\n</ul>\n<h3>4. Read-Through</h3>\n<p><strong>캐시가 DB 조회까지 담당</strong>합니다. 애플리케이션은 캐시만 바라봅니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef06a772239b44dafec0a49fbd5e9449/e72de/read-through.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVR42pWTu44TMRiF8wrUkLnYc8/MeMZzSzaz2bBEIBEpoqCAgpqOkooXoKbaHvqV6BFvdjj2JtksWiRSHNlj2Z99/v/MxPdLRFGDMGzt6HkFXDeniqPMmueVJ1JWvm9UPdBEyApZvoCql5jl8z3wf2F/A2tMJIFxe43rZY+67AlRJ7DyLJgQBBrLWTYgn81pubUHz4PVlCZM3wGdaYYw7pFXz+E4+dkv8/gthFkrOFYGmMIjOcguMX0accMjsEctKgTBJYrsE2bxZ1T5F0ThSwLdEiJbI6xfQyTjPYjr7pSvnXLuFPB5u+9RrrI2zZ443GLR3mC3vcX64ifS+P0emL8gcAs/vjgC/UgjKDsEqqV6XkBrXJNJQzDrJgxwh7H/gbdvfmEz/kYWf7irobk9ShZwrGVlD4ftgHSzQnI1Inu1hqwGBN0CMm0hbEcVLW7QlF+hZ98w1DdI4h1zyJrJeICbjpCB5u37BvDlRsIACMvqDkPFzEb3ERGigZQ9azm3o5QNgfxDVnmHd0WJOmOwbQyUBftqQNL0aAnSuWlCjal7gOmjDOigybOox8cownf3CZasj2M2GdtsQKsUBlWykxUtVRi7ClcDyxPqY/ZOYVK2mARhg1k6h2IWk2xhs3SIRkmQywZIvqhTFeaaYF0jNKV5BGaBLusUE1ZWqwcwI+dor+Zc065m+P8NM8A/Vhyjof7wMeEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"리드 쓰로우\"\n        title=\"\"\n        src=\"/static/ef06a772239b44dafec0a49fbd5e9449/f058b/read-through.png\"\n        srcset=\"/static/ef06a772239b44dafec0a49fbd5e9449/c26ae/read-through.png 158w,\n/static/ef06a772239b44dafec0a49fbd5e9449/6bdcf/read-through.png 315w,\n/static/ef06a772239b44dafec0a49fbd5e9449/f058b/read-through.png 630w,\n/static/ef06a772239b44dafec0a49fbd5e9449/40601/read-through.png 945w,\n/static/ef06a772239b44dafec0a49fbd5e9449/e72de/read-through.png 1198w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Spring Cache 추상화가 Read-Through 패턴</span>\n<span class=\"token annotation punctuation\">@Cacheable</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"users\"</span><span class=\"token punctuation\">,</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"#userId\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Cache Miss 시에만 실행됨</span>\n    <span class=\"token keyword\">return</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>일관성 문제 시나리오</h2>\n<h3>문제 1: Race Condition - 동시 읽기/쓰기</h3>\n<p>두 요청이 거의 동시에 발생할 때 <strong>캐시에 오래된 데이터가 남을 수 있습니다.</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0787c65d09c75880907d6e3f7e11d98b/10d53/race-condition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABq0lEQVR42k2SyZLbIBRF/RueJARqDUgIEGiyM1QllaS9SmfnLPL/n3FzJac7vTgF6BVHlwe7w77AKbV46n9CmRuSbIDwHmoeocYRclzHCZmJEFUPoR9kOiCrA5JzB8laHieckw67w77kxEB3H1E2VwjpIYyDjAMyHwlHGzdJWrOm/ZtU1D3OFGacq254CPeHGkqU+DYX+DyUqPMKCQXyskBOMxMynR8po6AJJP5Hxy2hsPzpMFNoH0IpKnwaNBbfoMw1bKMx2ga6bN9o6hXzjm4jocRkHkHxBKvwsAlrLH2LoTMoVIvIDdeuQ189CLV9h9sYtINnCxIes6HQvQqPxwpHEZCPd0j/AlFc8UsP+NNdcG9n3M2Cl3rCj6eAWzHgmdzKf1QT0tTByoD5iS1IHHbqpKFODQrhUPC283MLy0sKnAflNnzm4IglvXocb8WTdV8tPDRJV+GYGkQSKBmExaWIWL58wHRdMHE9SYepHPGVyX43Ey6yxzMTf2e6mPWsr4SNgtKdSVq0G2ajo8TyGVi+OZt2sFw79ihSfMn7La3nuqdo/W4pfUUJj7/WXBBh7R4p1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"캐시-레이스-컨디션\"\n        title=\"\"\n        src=\"/static/0787c65d09c75880907d6e3f7e11d98b/f058b/race-condition.png\"\n        srcset=\"/static/0787c65d09c75880907d6e3f7e11d98b/c26ae/race-condition.png 158w,\n/static/0787c65d09c75880907d6e3f7e11d98b/6bdcf/race-condition.png 315w,\n/static/0787c65d09c75880907d6e3f7e11d98b/f058b/race-condition.png 630w,\n/static/0787c65d09c75880907d6e3f7e11d98b/40601/race-condition.png 945w,\n/static/0787c65d09c75880907d6e3f7e11d98b/78612/race-condition.png 1260w,\n/static/0787c65d09c75880907d6e3f7e11d98b/10d53/race-condition.png 1724w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[시간 순서]\nT1: Thread A가 DB 조회 시작 (name: \"old\" 읽음)\nT2: Thread B가 DB 업데이트 (name: \"new\")\nT3: Thread B가 캐시 삭제\nT4: Thread A가 캐시에 저장 (name: \"old\")  &lt;-- 문제!\n\n결과: DB는 \"new\", 캐시는 \"old\"</code></pre></div>\n<h3>문제 2: 캐시 삭제 실패</h3>\n<p>DB는 업데이트됐는데 <strong>캐시 삭제가 실패하면 불일치가 발생</strong>합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 성공</span>\n\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 실패! (네트워크 오류 등)</span>\n\n    <span class=\"token comment\">// DB는 변경됐는데 캐시에는 이전 데이터가 남아있음</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>문제 3: DB 트랜잭션 롤백</h3>\n<p>캐시는 업데이트됐는데 <strong>DB 트랜잭션이 롤백</strong>되는 경우입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">,</span> newUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 캐시 먼저 업데이트</span>\n\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// DB 업데이트</span>\n\n    <span class=\"token comment\">// 이후 로직에서 예외 발생 -> 롤백</span>\n    <span class=\"token comment\">// DB는 롤백되지만 캐시는 이미 변경됨</span>\n    <span class=\"token function\">someRiskyOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>해결 전략</h2>\n<h3>전략 1: Cache Invalidation (삭제)</h3>\n<p>Cache-Aside 패턴에서 **\"DB 업데이트 후 캐시 삭제\"**는 표준적인 베스트 프랙티스입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 캐시 삭제 </span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 삭제</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>삭제 방식의 장점</strong></p>\n<ul>\n<li>Race Condition 발생 확률 감소</li>\n<li>다음 조회 시 자연스럽게 최신 데이터 로드</li>\n<li>불필요한 캐시 갱신 방지</li>\n</ul>\n<p><strong>갱신 방식의 고려사항</strong></p>\n<ul>\n<li>캐시 갱신 시점에 또 다른 Race Condition 가능</li>\n</ul>\n<h3>전략 2: Double Delete 패턴</h3>\n<p>Race Condition을 줄이기 위해 <strong>캐시를 두 번 삭제</strong>하는 보조 전략입니다.</p>\n<!-- [다이어그램 6: Double Delete 패턴]\n1. 캐시 삭제 (1차)\n2. DB 업데이트\n3. 짧은 대기 (500ms)\n4. 캐시 삭제 (2차) - 그 사이 잘못 저장된 캐시 제거\n-->\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 1. 먼저 캐시 삭제</span>\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. DB 업데이트</span>\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. 지연 후 한 번 더 삭제 (비동기)</span>\n    <span class=\"token class-name\">CompletableFuture</span><span class=\"token punctuation\">.</span><span class=\"token function\">runAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// DB 복제 지연 + 진행 중인 읽기 완료 대기</span>\n            cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>동작 원리</strong></p>\n<ol>\n<li>첫 번째 삭제: 기존 캐시 제거</li>\n<li>DB 업데이트 실행</li>\n<li>두 번째 삭제: 그 사이 Race Condition으로 저장된 오래된 캐시 제거</li>\n</ol>\n<p><strong>주의사항</strong></p>\n<ul>\n<li>500ms 같은 고정 지연 시간은 <strong>DB 복제 지연</strong>, 시스템 부하에 따라 효과가 달라짐</li>\n<li>실제 환경에서는 <strong>모니터링 기반으로 적절한 지연 시간을 튜닝</strong>해야 함</li>\n<li>완벽한 해결책이 아닌 <strong>Race Condition 확률을 줄이는 보조 수단</strong>으로 활용</li>\n</ul>\n<h3>전략 3: 분산 락을 통한 동시성 제어</h3>\n<p>동시에 같은 데이터를 수정하지 못하도록 <strong>락을 걸어 직렬화</strong>합니다. <strong>Thundering Herd</strong> 방지와 동시 갱신 제어에 효과적입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/856fd141eb6c3ebcc60a028cb2fb4204/6b26f/lock.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVR42m2Qy27bMBBF/ROJRL1MvUyREiVXttw0cYIkiy5aFEW6yP//yclQRtEmyOKAL/DOnNno3S329IfS3BNdtajYkCiDitqVJOlQK4Y0dUJPlgWG//DkeWBkk5czencmLw8UdqToPJk86t2dFJH77Z66WNjpO7LUfwj7G3QJWwPjuCWOapRqab6dqE9Hiu1Md/yNXV7Q9UKvH5mbX+vHzwPHf4FR3HEVWSJlRbUTrGgJQVHIRDPJRDWz0vnwrqOiuHDZT2zFZrN3jh8PjsPguJbgWAKVcrL2KyqQ9DJL6SgdSOUc1PPQqRTLZKYhMBQLbNrKMlmHaRxd63CmXxndQG8uDNZjW09RTlTTwraZKJsbGvdM1d2j9YG+fsJU5zBDUb4W3cSyHwZmP3AYPQ8nz9e9Zx5HjtPI5Ca0mTGPZyo709gn+ptXui8/qaqFpXvBt995A31cyZmJZMWkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"분산락\"\n        title=\"\"\n        src=\"/static/856fd141eb6c3ebcc60a028cb2fb4204/f058b/lock.png\"\n        srcset=\"/static/856fd141eb6c3ebcc60a028cb2fb4204/c26ae/lock.png 158w,\n/static/856fd141eb6c3ebcc60a028cb2fb4204/6bdcf/lock.png 315w,\n/static/856fd141eb6c3ebcc60a028cb2fb4204/f058b/lock.png 630w,\n/static/856fd141eb6c3ebcc60a028cb2fb4204/40601/lock.png 945w,\n/static/856fd141eb6c3ebcc60a028cb2fb4204/78612/lock.png 1260w,\n/static/856fd141eb6c3ebcc60a028cb2fb4204/6b26f/lock.png 1658w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceWithLock</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RedissonClient</span> redisson<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> lockKey <span class=\"token operator\">=</span> <span class=\"token string\">\"lock:user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">RLock</span> lock <span class=\"token operator\">=</span> redisson<span class=\"token punctuation\">.</span><span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span>lockKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 락 획득 (최대 10초 대기, 락 유지 30초)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">tryLock</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentModificationException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 실패\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">isHeldByCurrentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                lock<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">User</span> cached <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> cached<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// Cache Miss 시에도 락 사용 (Thundering Herd 방지)</span>\n        <span class=\"token class-name\">String</span> lockKey <span class=\"token operator\">=</span> <span class=\"token string\">\"lock:user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">RLock</span> lock <span class=\"token operator\">=</span> redisson<span class=\"token punctuation\">.</span><span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span>lockKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">tryLock</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Double Check</span>\n                cached <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">return</span> cached<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofMinutes</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">isHeldByCurrentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                lock<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 락 획득 실패 시 DB 직접 조회</span>\n        <span class=\"token keyword\">return</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>적용 범위 고려</strong></p>\n<ul>\n<li>모든 읽기에 락을 걸면 성능이 크게 저하됨</li>\n<li>**\"쓰기 작업\"**이나 <strong>\"Cache Miss 시에만\"</strong> 락을 거는 것이 일반적</li>\n<li>특정 <strong>핫키</strong>(자주 접근되는 데이터)에만 선별적으로 적용하는 것을 권장</li>\n</ul>\n<h3>전략 4: Lease 기반 낙관적 동시성 제어</h3>\n<p>분산 락이 <strong>비관적</strong>(미리 잠금) 방식이라면, <strong>Lease</strong>는 <strong>낙관적</strong>(저장 시점에 검증) 방식입니다. Cache Miss 시 토큰을 발급받고, 저장 시 토큰이 유효한 경우에만 저장을 허용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[Lease 동작 원리]\n\nT1: Thread A가 캐시 조회 → Cache Miss → Lease Token #1 발급\nT2: Thread B가 DB 업데이트 (name: \"new\")\nT3: Thread B가 캐시 삭제 → Lease Token #1 무효화\nT4: Thread A가 캐시 저장 시도 (Token #1) → 토큰 무효 → 저장 거부\n\n결과: DB \"new\", 캐시 비어있음 → 다음 조회 시 최신 데이터 로드</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 1. 캐시 조회 시 lease token 함께 발급</span>\n    <span class=\"token class-name\">LeaseResult</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">getWithLease</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Cache Hit</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 2. Cache Miss - DB 조회</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. lease token과 함께 저장 시도</span>\n    <span class=\"token comment\">// 토큰이 무효화됐으면 저장 실패 (다른 쓰기가 있었다는 의미)</span>\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">putIfLeaseValid</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">getLeaseToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Lease는 Facebook이 Memcached에서 <strong>Stale Sets</strong>와 <strong>Thundering Herd</strong> 문제를 해결하기 위해 도입한 메커니즘입니다. 자세한 내용은 <a href=\"/cache-part1/#%EB%B6%80%ED%95%98-%EA%B0%90%EC%86%8C-leases-%EB%A9%94%EC%BB%A4%EB%8B%88%EC%A6%98\">Facebook의 대규모 Memcached 운영 전략</a>에서 확인할 수 있습니다.</p>\n<h3>전략 5: 트랜잭션 커밋 후 캐시 처리</h3>\n<p>DB 트랜잭션이 <strong>확실히 커밋된 후에 캐시를 처리</strong>합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TransactionAwareCacheService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 트랜잭션 커밋 후에 캐시 삭제 실행</span>\n        <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerSynchronization</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionSynchronization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterCommit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 또는 이벤트 기반으로</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserUpdateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 트랜잭션 커밋 후 이벤트 발행</span>\n        eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">UserUpdatedEvent</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CacheInvalidationListener</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@TransactionalEventListener</span><span class=\"token punctuation\">(</span>phase <span class=\"token operator\">=</span> <span class=\"token class-name\">TransactionPhase</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AFTER_COMMIT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleUserUpdate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserUpdatedEvent</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cache<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>전략 6: CDC 기반 캐시 동기화</h3>\n<p><strong>Change Data Capture</strong>를 통해 DB 변경을 감지하고 캐시를 동기화합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9c57795e85d7ff4bbf2b56f11c38ada/d698c/cdc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAv0lEQVR42h2OS1LDMBAFfQqIZVuWIv8lC9kugiG5AjvKxSIbFnD/GzRTWcxipl9Nv8zaSFEM5MWI6nZUu5PnA5UOuGZBVwGlJrx/Z5qEK09rAkvjiS4Ij5g6EdsNZ1eylC4Y7SnMQnU7KK9flGXg7BKTf8PK/XQauN//OI4fnp5HPsaZ79fAZ5KceaFzG7/9SGw2srZdpKG0UyO6jo9RxYTWM113oZb9ITivWCvSaqYW5uSJNUly0lCkfb9j7Mo/x29YxvInQ1UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cdc\"\n        title=\"\"\n        src=\"/static/b9c57795e85d7ff4bbf2b56f11c38ada/f058b/cdc.png\"\n        srcset=\"/static/b9c57795e85d7ff4bbf2b56f11c38ada/c26ae/cdc.png 158w,\n/static/b9c57795e85d7ff4bbf2b56f11c38ada/6bdcf/cdc.png 315w,\n/static/b9c57795e85d7ff4bbf2b56f11c38ada/f058b/cdc.png 630w,\n/static/b9c57795e85d7ff4bbf2b56f11c38ada/40601/cdc.png 945w,\n/static/b9c57795e85d7ff4bbf2b56f11c38ada/78612/cdc.png 1260w,\n/static/b9c57795e85d7ff4bbf2b56f11c38ada/d698c/cdc.png 1846w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[CDC 아키텍처]\nMySQL Binlog --> Debezium --> Kafka --> Consumer --> Redis Cache\n\n장점:\n- 애플리케이션 코드에서 캐시 로직 분리\n- DB 변경은 무조건 캐시에 반영됨\n- 여러 서비스가 같은 데이터를 캐싱해도 일관성 유지\n\n단점:\n- 인프라 복잡도 증가 (Debezium, Kafka 운영 필요)\n- 이벤트 처리 지연 발생 가능\n- 운영/모니터링 부담 증가</code></pre></div>\n<h3>전략 7: TTL 기반 최종 일관성</h3>\n<p>완벽한 즉시 일관성 대신 TTL을 통해 **\"일정 시간 내 수렴\"**하는 <strong>최종 일관성</strong>(Eventual Consistency)을 보장합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fc36ff38bd0da2e48bded7a117187e8/49ee2/ttl.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEUlEQVR42lXS7W6bMBQGYO5iSwkBmw/jALb5JgkEuq1JW1WTMm3a7v9G3h3cbut+PHqPhbDNOTiuJ5Hu9hi5whhqTKEhGvexwRwZypKyRO0XqCxlNUTQczYeodIaF9FCBBqOu5WQfoZFFFhShXsyrylp80RhEhpnYdBHCp2l0ccaA2WaGPB5hJEtHkWDdN2Q8xJZKvG0CFzPEp9PEpdpb53aDK3J0JUZ+iq3hnpV4EC1LAzCy4ymaHGjTffrhpuNgL/NIVgJ7u/B/JwyR7hmULxRRCNkGhEzf7GgAgsbqhskQUvvVnA+fIzAvZauO2OzkXDvcrhuAW+r6SAD36tIjYCwXUNa8F1HekT+gNg9IPVn6t+CODjB2dnb1NDsAVX4DMUvKKMnFOwTHTJBBmfsGeHzK7bmQrkgjDtE0wE8a5BnBzBu4Hg04YgNMOIFJn2BEs8o0682s/iCXFyRJxeqH6y1tuIrInFEsoxI1IBMHcFD+mR/7VV6Qnr4DtHdkA6U/Tda/8D++JP8QtreEOsreURi3ugnhGqEpKGIeUJ2+0I3bWkodyn1LMPWVdjeEVfD80rqoXmnxM77o/pnZ4h+tdV27XCaVpDQBLsWYU/NNtT8ogJX9X9C3bxprYisvYuHE6KKBjOfwehfdCL6biZLxPOR0MO+R1jSS1VnRfV7vRU3g8Xp/0vGCXF3gryfqXUtfgO7H08nX74wfQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ttl\"\n        title=\"\"\n        src=\"/static/2fc36ff38bd0da2e48bded7a117187e8/f058b/ttl.png\"\n        srcset=\"/static/2fc36ff38bd0da2e48bded7a117187e8/c26ae/ttl.png 158w,\n/static/2fc36ff38bd0da2e48bded7a117187e8/6bdcf/ttl.png 315w,\n/static/2fc36ff38bd0da2e48bded7a117187e8/f058b/ttl.png 630w,\n/static/2fc36ff38bd0da2e48bded7a117187e8/40601/ttl.png 945w,\n/static/2fc36ff38bd0da2e48bded7a117187e8/78612/ttl.png 1260w,\n/static/2fc36ff38bd0da2e48bded7a117187e8/49ee2/ttl.png 1618w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token string\">\"user:\"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">User</span> cached <span class=\"token operator\">=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> cached<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 짧은 TTL 설정 - 불일치가 있어도 금방 해소됨</span>\n    cache<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofMinutes</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","wordCount":{"words":482},"frontmatter":{"title":"DB와 Cache 사이의 일관성 관리 전략","date":"December 02, 2025","description":"Cache-Aside, Write-Through 등 캐시 전략별 일관성 문제와 해결 방법을 상세히 알아봅니다."}},"previous":{"fields":{"slug":"/mysql-extra/"},"frontmatter":{"title":"MySQL 실행 계획 - Extra 컬럼 (1편)"}},"next":{"fields":{"slug":"/db-replication-consistency/"},"frontmatter":{"title":"Master-Slave DB 복제 환경에서의 일관성 관리"}}},"pageContext":{"id":"27682fe2-7c54-51f4-ab5c-0d9651209b5f","previousPostId":"daaba5ec-b28c-5b48-a042-e7b21f6d1ab4","nextPostId":"95e30fc0-854e-58ee-8973-9a235ae408e8"}},"staticQueryHashes":["3257411868","3517523002"],"slicesMap":{}}