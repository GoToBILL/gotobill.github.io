<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[GoToBill's Dev Blog RSS Feed]]></title><description><![CDATA[개발 이야기를 다루는 기술 블로그]]></description><link>https://gotobill.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 07 Jan 2026 04:56:01 GMT</lastBuildDate><item><title><![CDATA[2025년 회고]]></title><description><![CDATA[올 한 해는 정말 바빴다. 소마 활동과 프로그라피 활동을 병행하면서 정신없이 지나간 한 해였다. 소마에서 좋은 멘토님들을 만나고, 프로그라피에서 좋은 팀원들을 만났다. "나의 주변 사람 운은 정말 좋다"는 신조가 이번에도 깨지지 않았다. CS…]]></description><link>https://gotobill.github.io/opensource/</link><guid isPermaLink="false">https://gotobill.github.io/opensource/</guid><pubDate>Thu, 18 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;올 한 해는 정말 바빴다.&lt;/p&gt;
&lt;p&gt;소마 활동과 프로그라피 활동을 병행하면서 정신없이 지나간 한 해였다. 소마에서 좋은 멘토님들을 만나고, 프로그라피에서 좋은 팀원들을 만났다.&lt;/p&gt;
&lt;p&gt;&quot;나의 주변 사람 운은 정말 좋다&quot;는 신조가 이번에도 깨지지 않았다.&lt;/p&gt;
&lt;h2&gt;CS 스터디&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Real MySQL, 가상 면접 사례로 배우는 대규모 시스템 설계 1권, 주니어 백엔드 개발자가 반드시 알아야 할 실무 지식&lt;/strong&gt;까지 총 3권의 책을 매일 오전 9시 소마 센터에서 스터디하면서 많이 배웠다.&lt;/p&gt;
&lt;p&gt;&quot;그동안의 나는 그냥 코더였구나&quot;라는 생각이 많이 들었다.&lt;/p&gt;
&lt;p&gt;특히 MySQL을 깊이 공부하면서 MySQL을 만든 사람들은 진짜 천재가 아닌가 싶었다.&lt;/p&gt;
&lt;p&gt;가상 면접 책은 생각의 폭을 넓혀준 책이다. 2회독을 하니 보이는 게 더 많아지고, 저자가 첨부한 페이스북 캐시 논문까지 읽어보니 캐시와 DB의 일관성, 캐시와 캐시 사이의 일관성 등 많이 배웠다.&lt;/p&gt;
&lt;p&gt;아직은 신입이지만 취직하고 3년 차가 되면 크게 도움이 될 것 같은 책이었다.&lt;/p&gt;
&lt;p&gt;같이 스터디한 사람들 모두 큰 도움이 됐다고 한다. 나는 바로 2편까지 질러버렸다.&lt;/p&gt;
&lt;h2&gt;소마 회고&lt;/h2&gt;
&lt;p&gt;처음에는 각자 아이디어가 정말 많았다.&lt;/p&gt;
&lt;p&gt;대충 잡아도 100개는 훌쩍 넘는 아이디어가 나왔고, 회의도 정말 많이 하고 의견도 정말 많이 나눴다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ed4feae1013fdd06a1e8536c2013d072/c1bea/idea.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 102.53164556962024%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZklEQVR42o1Uia6bMBDk//+wal9flHAFsA3mSjiyb2dhrZCkUi1ZAWc9zM6MHbWtJ2sNJUlCaZpSVVUyl2Whx+NBGKP1VPz6puV+J6ys6yr/HSevLRNFTVMzUBYAsyyj2+22FfFGDJPFZLNUngH2CoivjPNAl/4MwEaA8jyneZ4Ds+eJ9VXXd7DXsTLDcR4par0n5yyVZcmtW+r7PjDQcesqug+1PGO961qq65o879UJYvhPGAIIuqHozjrpRm25Kf9Sa+PQ8jAM1HYdA3cC1ratEAGGMLxer9I2mKLYOScFOrz5ps4lAXAcR5n6cR3QP/JsShzHdLlcBNgYI+BgrqMuTgyqgIt0gq7ATuXR3whMwAgA0zQFkOAgGNasLceLniLzWqegkT6su16HOOimdZGc7W8fa3Rv5H0jraJ/xOMAun/EXhNqTPHPHB4YwhSAYWqwFVhZ++qbWhcHDREx1IIIdESMRjZTGMJ6FCDY0FLb0OO0AZ4OLsMQgKF+YA+GoRcSW8tshoYaE8A426oXRmdO1O+A2ASXsaeu3da+SsD/S7ARyC2HWwHcfmboyoRbLgND5A/n/TUVoiEuBzDTHEITnOe9amNYWip+n2id5vcEvJnC+SqKgs7nc7hx8G5MJa07hDjPyMYJt/Y4hPizy3wONTbqXpIm4XziiFV5Qt5V/x8bPXKGtQQ7vANMW3NlTt5Wby1+al8AlZleENAUwCq6LbIAuH64Dw8MERtoh4nIIJfqh7psrixHntLMZqnL07TNeZ4OF0S4HMBOGT1rJLcNG/P19Ydrkj3YhqNWinHIot7yAPwBAjRe4qyPHr4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;아이디어&quot;
        title=&quot;&quot;
        src=&quot;/static/ed4feae1013fdd06a1e8536c2013d072/f058b/idea.png&quot;
        srcset=&quot;/static/ed4feae1013fdd06a1e8536c2013d072/c26ae/idea.png 158w,
/static/ed4feae1013fdd06a1e8536c2013d072/6bdcf/idea.png 315w,
/static/ed4feae1013fdd06a1e8536c2013d072/f058b/idea.png 630w,
/static/ed4feae1013fdd06a1e8536c2013d072/40601/idea.png 945w,
/static/ed4feae1013fdd06a1e8536c2013d072/78612/idea.png 1260w,
/static/ed4feae1013fdd06a1e8536c2013d072/c1bea/idea.png 1388w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;결국 선택의 시간이 왔다. 팀장 형이랑 지금 와서 &quot;그냥 우리가 관심 가는 경제 아이템 할 걸&quot;이라는 후회가 간혹 나오기도 하지만, 선택한 아이템을 기획하고 디자인하고 코딩하면서 많이 배웠기 때문에 큰 후회는 없다&lt;/p&gt;
&lt;p&gt;이 과정에서 많은 피칭 영상도 보고 스타트업을 분석하면서 어떻게 대중과 심사위원을 설득하고 PR하는지 많이 배웠다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dc9fd8e17840af06969740c644792400/0f882/peach.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACBUlEQVR42p1Uy5KbMBD01yfftKnKN+SQQ3YrXmOwDYuEAIF4PzozLAJsXDmsqlQyM1Kru2fkQ5IkyPMcPMZxxHYs37R2XUezRdN2FBjw8zXH9x8K314i+Lqz23Co6xpZpu/AqqoCx3nwypPzwzCgKAoUJocyLS5JBy9ukZmScv20/zD0PVQUQSmFnn7zQV6ZUVGWSKIQBV3Ig/dmsZxyWwL23ATYU1JKCd8P0DTNlLCTrVChT4DpfLCDVnKxY5jnFvzA6FEkwV5aWXbVWhNggDLPVoa+A3X+g8bMsXn/CkgMhRCLZwsgHc5NgUz4yMLrkvM+PKRaLSzH8QGQ/WCGbOo9Q2JDkrPwhpxALGAQ+HDdM64Xj4pXTvFICrRtu0oOw3Cq7CPDLDefDDeAHwR4ej/i7JxQluWTotCHIED26w5wZqifMHRO7xNLS2JXFPZwx3ALGD4BPDuoZoYcvytKRH3IrWOpW0BjDGIRLG3DMX1xkZyO6LnFnlWZi8JNzetXGe4kS6oSy7Zg//fwBsc5wtt4uJPMDOM4vnslz6o80iVJ8Abp/kLfruyk4LZpVskpvRLr306yWCWPwwhx07gcJSpTz5djUrj24dzYaZruPNST5CsxdDeSPfLwDRfXWRr7RoWrLcPPtxzB0N/SIyDHchXCEEsrWYu/iG+/MXSr5FhF6GaG/wDl2Se+pEeJhQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;피칭&quot;
        title=&quot;&quot;
        src=&quot;/static/dc9fd8e17840af06969740c644792400/f058b/peach.png&quot;
        srcset=&quot;/static/dc9fd8e17840af06969740c644792400/c26ae/peach.png 158w,
/static/dc9fd8e17840af06969740c644792400/6bdcf/peach.png 315w,
/static/dc9fd8e17840af06969740c644792400/f058b/peach.png 630w,
/static/dc9fd8e17840af06969740c644792400/40601/peach.png 945w,
/static/dc9fd8e17840af06969740c644792400/78612/peach.png 1260w,
/static/dc9fd8e17840af06969740c644792400/0f882/peach.png 1584w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;오히려 지금 실패해봐서 큰 깨달음을 얻었다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;타겟이 확실한 아이템을 선정해야 한다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;개발자 중심의 사고를 하면 안 된다.&lt;/strong&gt; &quot;우리가 막 이거 필요하고 저거 필요하고 하겠지?&quot;라는 생각은 쓰레기다. 소비자는 필요하면 API가 4초가 걸리든 5초가 걸리든 그게 진정 필요하면 쓴다. 그렇기에 일단 만드는 게 중요하다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;결국은 팀이 중심이 돼야 한다.&lt;/strong&gt; 우리 셋 모두 소마가 처음이다 보니 멘토님의 의견에 많이 휘둘린 느낌이 없지 않아 있다. 이 과정에서 팀이 중심이 돼야 흔들리지 않는다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;아이템이 안 되면 수면 밑에 보이지 않던 문제가 수면 위로 드러난다.&lt;/strong&gt; 인간관계, 소통 문제 등 감정적인 문제가 많이 발생한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;B2B 아이템은 정말 힘들다.&lt;/strong&gt; 타겟을 설정하기도 힘들고 유저를 모으기도 힘들고 메타 광고를 돌려도 큰 리텐션이 없다. 업자만 꼬인다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;그래도 좋은 사람들과 좋은 환경에서 많이 배웠다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;다시 돌아간다면 더 잘할 수 있을 것 같은데,&lt;/p&gt;
&lt;p&gt;어쩌겠나. 인생에 한 번밖에 못하는 건데 이 경험을 바탕으로 스스로 성장했다고 생각하면 그만이다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7c5505cc8562143167693972f72592cc/d9c39/soma.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAG1IkDTMgK//8QAHRAAAgIBBQAAAAAAAAAAAAAAAgQBAwAREiEiM//aAAgBAQABBQKxiMlnaYscMaVwHY2PT//EABcRAQADAAAAAAAAAAAAAAAAAAABAhH/2gAIAQMBAT8Bhln/xAAWEQEBAQAAAAAAAAAAAAAAAAABAGH/2gAIAQIBAT8B2Av/xAAcEAACAQUBAAAAAAAAAAAAAAAAASECERIiMUH/2gAIAQEABj8C1bPecNoHQlAspsRB/8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAMSFBUWH/2gAIAQEAAT8hbCS8uGBgn4bl9GreJYkOYYPDk5wAFQn/2gAMAwEAAgADAAAAEHTv/8QAGREAAgMBAAAAAAAAAAAAAAAAAAERIUFh/9oACAEDAQE/EGmtZyR//8QAGBEBAAMBAAAAAAAAAAAAAAAAAQARMZH/2gAIAQIBAT8QRG2EWWL2f//EAB0QAQACAgIDAAAAAAAAAAAAAAERIQAxQVFhgfH/2gAIAQEAAT8QdfpKELtnHlPEMAsITziodGpNuDXvDsg7Wz8zQmAOSIW+7DEVJmCo3o4z/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;소마&quot;
        title=&quot;&quot;
        src=&quot;/static/7c5505cc8562143167693972f72592cc/828fb/soma.jpg&quot;
        srcset=&quot;/static/7c5505cc8562143167693972f72592cc/ff44c/soma.jpg 158w,
/static/7c5505cc8562143167693972f72592cc/a6688/soma.jpg 315w,
/static/7c5505cc8562143167693972f72592cc/828fb/soma.jpg 630w,
/static/7c5505cc8562143167693972f72592cc/0ede0/soma.jpg 945w,
/static/7c5505cc8562143167693972f72592cc/3ac88/soma.jpg 1260w,
/static/7c5505cc8562143167693972f72592cc/d9c39/soma.jpg 1800w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Spring Data JPA 컨트리뷰터가 되다&lt;/h2&gt;
&lt;p&gt;소마 활동을 시작하면서 작은 목표가 하나 있었다. 스프링 컨트리뷰터가 되는 것. 내가 매일 쓰는 도구에 기여해보고 싶다는 생각이었다.&lt;/p&gt;
&lt;p&gt;바쁜 하반기를 보내면서 CS 스터디도 하고 프로젝트도 진행했다. 시간이 부족해서 미뤄뒀지만, 마음속에는 고이 간직해놨던 목표였다.&lt;/p&gt;
&lt;p&gt;12월이 돼서야 Spring Data JPA의 컨트리뷰터가 됐다. 사소한 문법 수정이었지만 정말 기쁜 하루였다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d7bd09b2fef8b38dd94bf58e0670a8d9/c6d67/commit.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVR42mWRSW8TURCE5///CE7cOEVckBAECRxiZxni4MQJcrzOePY3b5l9+Xg4iAsttbqq1V1qVTuBighNTFSm+DriIANUbajLhqIoUIUmKQVb4RGbjE18OPFUCgIV44sQaTR5odB23rlTz9zoB271I9dywVTeszJ7fBnzlGz4pXZ8PH7n7cMZX8MbznczZvEcN1nyxbvi7OUTy2zNSh3wqghnkrlcyB9c6Z9McpepnvMoXpgHz1x6dyyTNR8233jjvmOa3XMtFuxlyPvtOZPE5XM0Y6nWBEWG7uyFR3v2wQ74MsLTMdv8SF5phnGgGhvqvsW0BZ4KqboG1ZmTPaYp0bpgp4/c+guk1PwJR5va+lVT1S19qqmFpqxqmrahaWzf4tpm3/WnhfGU4yseR/phoOlaBlsHy519KBFZSmbNL+crsqc1cS6swQphn5CmgjhNUcb8FRwZ/kn+H78BdPfCKiKxh5kAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;스프링 오픈소스&quot;
        title=&quot;&quot;
        src=&quot;/static/d7bd09b2fef8b38dd94bf58e0670a8d9/f058b/commit.png&quot;
        srcset=&quot;/static/d7bd09b2fef8b38dd94bf58e0670a8d9/c26ae/commit.png 158w,
/static/d7bd09b2fef8b38dd94bf58e0670a8d9/6bdcf/commit.png 315w,
/static/d7bd09b2fef8b38dd94bf58e0670a8d9/f058b/commit.png 630w,
/static/d7bd09b2fef8b38dd94bf58e0670a8d9/c6d67/commit.png 734w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;추가로 save() 로직에 merge는 목 테스트가 2개나 있는데 persist는 목 테스트가 없어서 의아해서 이슈를 올렸더니 schauder 형님이 시원하게 PR 올리라고 해서 올렸더니 머지가 돼버렸다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 446px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ab04484148a7df928842cec017114749/6244b/test.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVR42pVS2W6DMBDMh5TDxja2IUC4c1VtpPal//89012HpFHaROrDYO2CZ2dmWbkiR9t5mNxAGQvrCuQEpQ18sQ61pn6SSkRJiihekAjE1LvHytsc+75C3kww7Svs8E44wfZvcOMJ5eELfv6E3hyhmj3M+IFyOML5EonIfhOm1FSZRiwNkixHnJEaQqwIS80n91LtCB5SWwip/1bID540jFsUZUX2B7LvsPEWXdOg7SeUVUMfk0WyHJPVR3YDIZMxpDJIpQpnRC+EzCBIuchMOKOF6B5MEoV8xY9CvjDOO3SbEV0xYFzPGEpS5mr00xbz7ohumFFvelRNS/WBvt8v6ltU3qOvK2S0vKtCofRZkVAEDUmZck5S5UE146z4jEudMsiNzBQScngl7IsRVdmim+YwmaEpy5flF3mKW8uX1QdFN5mF6TTxUfgPlxILGS42tN2e1E3dDnXVkcIx5MbnRHlZVz7d7pWQbTFhyIHz4nxusvqv2m9FvjyRuVaTrwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;test&quot;
        title=&quot;&quot;
        src=&quot;/static/ab04484148a7df928842cec017114749/6244b/test.png&quot;
        srcset=&quot;/static/ab04484148a7df928842cec017114749/c26ae/test.png 158w,
/static/ab04484148a7df928842cec017114749/6bdcf/test.png 315w,
/static/ab04484148a7df928842cec017114749/6244b/test.png 446w&quot;
        sizes=&quot;(max-width: 446px) 100vw, 446px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e0957aa97e8a7327a8b25f6f10a9cd05/e4374/scha.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZklEQVR42pXLSw6AIAwEUO5/MOPOK6g7gwqCH6S0IxL36iQvaSZT1dQV+rbDoOdsgp5tufVkcZz0ag8RY/4xy4oQCYooImbGGDjnYO0C7z2YBV/DIpCHugtKCdseSpGYy+CO/CWCC0II6sfWcR8DAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;sch 형님&quot;
        title=&quot;&quot;
        src=&quot;/static/e0957aa97e8a7327a8b25f6f10a9cd05/f058b/scha.png&quot;
        srcset=&quot;/static/e0957aa97e8a7327a8b25f6f10a9cd05/c26ae/scha.png 158w,
/static/e0957aa97e8a7327a8b25f6f10a9cd05/6bdcf/scha.png 315w,
/static/e0957aa97e8a7327a8b25f6f10a9cd05/f058b/scha.png 630w,
/static/e0957aa97e8a7327a8b25f6f10a9cd05/e4374/scha.png 927w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;취준 일기&lt;/h2&gt;
&lt;p&gt;마지막 남은 한 학기 동안 취준을 하려고 지원서도 쓰고 포트폴리오도 정리하고 있다. 스트레스를 많이 받는다. 탈락의 고배도 많이 마시고 있어서 자괴감이 드는 하루하루다.&lt;/p&gt;
&lt;p&gt;그래도 열심히 노력하면 언젠가는 이뤄진다는 신조는 바뀌지 않는다. 올해 안 되면 내년 상반기에 성공하면 된다.&lt;/p&gt;
&lt;p&gt;가끔은 그런 생각도 든다. 소마 프로젝트 할 때 나도 뭔가 기술적으로 화려하고 뛰어나 보이는 걸 했어야 했나?&lt;/p&gt;
&lt;p&gt;근데 다시 생각해봐도 의미 없는 것 같다.&lt;/p&gt;
&lt;p&gt;아무리 뛰어난 기술이어도 유저가 없으면 그건 쓰레기라고 생각한다. 그래도 기술적으로 최소한의 대비는 해야 한다고 생각한다. 그 선을 정하는 게 참 애매하다.&lt;/p&gt;
&lt;p&gt;예시로 소마의 다른 팀은 오픈채팅으로만 유저를 모아서 프로젝트를 진행했다. 그 팀이 보기에는 스프링, DB도 오버엔지니어링이다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Tomcat 성능 튜닝]]></title><description><![CDATA[Thread Pool 튜닝 Context Switching 이해하기 스레드 수를 무작정 늘리면 성능이 좋아질까요? 아닙니다. Context Switching…]]></description><link>https://gotobill.github.io/tomcat-tuning/</link><guid isPermaLink="false">https://gotobill.github.io/tomcat-tuning/</guid><pubDate>Sun, 14 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Thread Pool 튜닝&lt;/h2&gt;
&lt;h3&gt;Context Switching 이해하기&lt;/h3&gt;
&lt;p&gt;스레드 수를 무작정 늘리면 성능이 좋아질까요? 아닙니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Context Switching&lt;/strong&gt; 오버헤드 때문입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/83ce3a98fd4d79a3a488111e8a6fed2e/098d4/context.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/0lEQVR42kVQy3KDMBDjHwADfgC2ibEhpEk6k0477aX//0+qbA49aOzVerWyKiEspmnH7fYN5+8QwqHvFwxDwLZ/QumErgvkApy747j9wNo39iOxcuaB5/svZnJSbqja1vIScBwvjGMqgl13Cl73F3sr6wt6QquE5+MDxiT0FOv7lWau5L6g9X4K5uG2dWibmWKegwtE4RY0tUVHZ1ImSLVRJKLjm+x4GBIUBbLT7D7XxhyommZCXRtiOtGMGNUIO82EQ1giFr8hxR3hksh5+Nlj1LYYyT8SZYkrEVS5yN/+bzJDNrUKJQKtV2gTuZ2njiVvw1oOZ66nu7VEJOWOP6JniJ0Yg0EPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Context Switching 오버헤드&quot;
        title=&quot;&quot;
        src=&quot;/static/83ce3a98fd4d79a3a488111e8a6fed2e/f058b/context.png&quot;
        srcset=&quot;/static/83ce3a98fd4d79a3a488111e8a6fed2e/c26ae/context.png 158w,
/static/83ce3a98fd4d79a3a488111e8a6fed2e/6bdcf/context.png 315w,
/static/83ce3a98fd4d79a3a488111e8a6fed2e/f058b/context.png 630w,
/static/83ce3a98fd4d79a3a488111e8a6fed2e/40601/context.png 945w,
/static/83ce3a98fd4d79a3a488111e8a6fed2e/78612/context.png 1260w,
/static/83ce3a98fd4d79a3a488111e8a6fed2e/098d4/context.png 2142w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;위 수치는 일반적인 참고값입니다. 실제 비용은 환경마다 다르므로 상대적인 크기 비교로만 활용하세요.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Context Switching이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;CPU가 실행 중인 스레드를 다른 스레드로 전환할 때 발생하는 작업입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Thread A 실행 중
    ↓
[Context Switch 발생]
    1. Thread A의 레지스터 값을 메모리에 저장
    2. Thread A의 스택 포인터 저장
    3. Thread B의 레지스터 값 복원
    4. Thread B의 스택 포인터 복원
    ↓
Thread B 실행 시작&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;기본 원칙&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;CPU 집약적 작업&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;최적 스레드 수 = CPU 코어 수 + 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;I/O 집약적 작업&lt;/strong&gt; (웹 애플리케이션 대부분):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;최적 스레드 수 = CPU 코어 수 × (1 + 대기시간 / 처리시간)

예: 8코어, 처리시간 10ms, DB 대기 90ms
   = 8 × (1 + 90/10) = 8 × 10 = 80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;실전 공식&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;maxThreads = 목표 TPS × 평균 응답 시간(초)

예: 목표 1000 TPS, 평균 응답 시간 200ms
   = 1000 × 0.2 = 200&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;규모별 설정 예시&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;소규모 서비스&lt;/strong&gt; (트래픽 &amp;#x3C; 100 TPS):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;50&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;minSpareThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;10&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;2000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;acceptCount&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;100&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;중규모 서비스&lt;/strong&gt; (트래픽 100-1000 TPS):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;minSpareThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;25&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;10000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;acceptCount&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;500&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;대규모 서비스&lt;/strong&gt; (트래픽 1000+ TPS):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;500&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;minSpareThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;50&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;20000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;acceptCount&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

           &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;추가&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;최적화&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
           processorCache=&quot;500&quot;
           socket.directBuffer=&quot;true&quot;
           socket.appReadBufSize=&quot;8192&quot;
           socket.appWriteBufSize=&quot;8192&quot; /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;OS 레벨 튜닝&lt;/h2&gt;
&lt;h3&gt;파일 디스크립터 제한&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;왜 네트워크 연결이 파일 디스크립터(FD)인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Unix 철학 &lt;strong&gt;&quot;Everything is a file&quot;&lt;/strong&gt; 때문입니다. 소켓이든 파일이든 동일한 시스템 콜로 처리할 수 있도록 통일된 인터페이스를 제공합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 파일 읽기&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; fd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/tmp/file.txt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; O_RDONLY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 소켓 읽기 - 동일한 read/close 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; fd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AF_INET&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SOCK_STREAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 같은 함수&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;               &lt;span class=&quot;token comment&quot;&gt;// 같은 함수&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;커널 입장에서 소켓도 &quot;열린 자원&quot;이니까 FD 테이블에서 관리하는 게 자연스럽습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 기본값 확인&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 1024 (너무 작음!)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# maxConnections=10000인데 ulimit=1024이면 1024개만 연결 가능&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;해결&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 현재 세션만&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;65535&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 영구 설정 (/etc/security/limits.conf)&lt;/span&gt;
tomcat soft nofile &lt;span class=&quot;token number&quot;&gt;65535&lt;/span&gt;
tomcat hard nofile &lt;span class=&quot;token number&quot;&gt;65535&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 시스템 전체 (/etc/sysctl.conf)&lt;/span&gt;
fs.file-max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2097152&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;TCP Backlog vs TCP 버퍼&lt;/h3&gt;
&lt;p&gt;두 개념은 완전히 다릅니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;TCP Backlog&lt;/th&gt;
&lt;th&gt;TCP 버퍼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;용도&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;연결 대기열&lt;/td&gt;
&lt;td&gt;데이터 전송 버퍼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;언제&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;3-way handshake 완료 후, accept() 전&lt;/td&gt;
&lt;td&gt;데이터 송수신 중&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;내용물&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;연결 요청 (소켓 메타데이터)&lt;/td&gt;
&lt;td&gt;실제 패킷 데이터&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[TCP Backlog]
Client → SYN → Server
Client ← SYN+ACK ← Server
Client → ACK → Server
                ↓
         Backlog 큐에 대기  ← somaxconn, tcp_max_syn_backlog
                ↓
         accept() 호출 시 꺼냄

[TCP 버퍼]
연결 수립 후 데이터 전송 시:
Client → &quot;GET /api/users&quot; → [수신 버퍼] → Server 애플리케이션
                                ↑
                        tcp_rmem (receive buffer)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;somaxconn&lt;/strong&gt;: accept() 대기 중인 연결 개수 제한&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;tcp_rmem/wmem&lt;/strong&gt;: 한 연결당 송수신 데이터 버퍼 크기&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;SYN Queue vs Accept Queue&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;somaxconn&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;tcp_max_syn_backlog&lt;/code&gt; 둘 다 &quot;대기열&quot;인데, &lt;strong&gt;3-way handshake 완료 전/후&lt;/strong&gt;가 다릅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Client → SYN → Server
                ↓
         [SYN Queue]  ← tcp_max_syn_backlog (반쯤 연결된 상태)
                ↓
Client ← SYN+ACK ← Server
                ↓
Client → ACK → Server
                ↓
         [Accept Queue]  ← somaxconn (완전히 연결된 상태)
                ↓
         accept() 호출&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;설정&lt;/th&gt;
&lt;th&gt;큐 이름&lt;/th&gt;
&lt;th&gt;상태&lt;/th&gt;
&lt;th&gt;내용물&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;tcp_max_syn_backlog&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;SYN Queue&lt;/td&gt;
&lt;td&gt;반쯤 연결 (SYN 받음, ACK 대기)&lt;/td&gt;
&lt;td&gt;handshake 진행 중&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;somaxconn&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Accept Queue&lt;/td&gt;
&lt;td&gt;완전 연결 (handshake 완료)&lt;/td&gt;
&lt;td&gt;accept() 대기 중&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;SYN Flood 공격은 SYN만 보내고 ACK를 안 보내서 SYN Queue를 가득 채우는 공격입니다.&lt;/p&gt;
&lt;h3&gt;TIME_WAIT와 tcp_tw_reuse&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;TIME_WAIT 상태란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;연결 종료 후 소켓이 바로 사라지지 않고 2분(기본값) 동안 남아있는 상태입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Client: &quot;연결 끊자&quot; (FIN)
Server: &quot;ㅇㅋ&quot; (ACK)
Server: &quot;나도 끊는다&quot; (FIN)
Client: &quot;ㅇㅋ&quot; (ACK)
        ↓
   TIME_WAIT (2분간 대기)
        ↓
   소켓 완전 제거&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 2분이나 기다리나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;네트워크에서 지연된 패킷이 뒤늦게 도착할 수 있어서입니다. 바로 소켓을 재사용하면 이전 연결의 패킷과 섞일 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;고트래픽 서버에서 연결이 계속 생겼다 끊기면 TIME_WAIT 소켓이 수만 개 쌓입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;netstat&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-an&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; TIME_WAIT &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;45000&lt;/span&gt;   ← TIME_WAIT 상태 소켓 &lt;span class=&quot;token number&quot;&gt;45000&lt;/span&gt;개&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 소켓이 로컬 포트를 점유하니까 포트가 고갈될 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tcp_tw_reuse=1 효과:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;TIME_WAIT 상태인 소켓의 포트를 &lt;strong&gt;새 연결에 재사용&lt;/strong&gt;할 수 있게 해줍니다. 2분 기다릴 필요 없이 바로 재활용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;tcp_tw_reuse=0: TIME_WAIT 2분 대기 → 포트 고갈 위험
tcp_tw_reuse=1: TIME_WAIT 소켓 포트 즉시 재사용 → 포트 고갈 방지&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;TCP 파라미터&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# /etc/sysctl.conf&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# TCP backlog 크기 (연결 대기열)&lt;/span&gt;
net.core.somaxconn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt;
net.ipv4.tcp_max_syn_backlog &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8192&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# TIME_WAIT 소켓 재사용 (Keep-Alive 효율 향상)&lt;/span&gt;
net.ipv4.tcp_tw_reuse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# TIME_WAIT 타임아웃 (기본 60초 → 30초)&lt;/span&gt;
net.ipv4.tcp_fin_timeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# TCP 버퍼 크기 (데이터 송수신)&lt;/span&gt;
net.core.rmem_max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16777216&lt;/span&gt;
net.core.wmem_max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16777216&lt;/span&gt;
net.ipv4.tcp_rmem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;87380&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16777216&lt;/span&gt;
net.ipv4.tcp_wmem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;65536&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16777216&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 적용&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sysctl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Port Range&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 로컬 포트 범위 확대&lt;/span&gt;
net.ipv4.ip_local_port_range &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;65535&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 이유: 많은 외부 연결 시 (DB, Redis, 외부 API) 로컬 포트 고갈 방지&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;응답 압축&lt;/h2&gt;
&lt;p&gt;Tomcat에서 &lt;code class=&quot;language-text&quot;&gt;compression&lt;/code&gt; 설정은 &lt;strong&gt;응답&lt;/strong&gt;을 압축합니다. 요청이 아닙니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 브라우저 → 서버
   GET /api/users
   Accept-Encoding: gzip, deflate, br   ← &quot;나 이런 압축 풀 수 있어&quot;

2. 서버 → 브라우저
   HTTP/1.1 200 OK
   Content-Encoding: gzip               ← &quot;gzip으로 압축했어&quot;
   [압축된 데이터]

3. 브라우저
   Content-Encoding 헤더 보고 자동으로 gzip 해제
   → JavaScript에는 이미 압축 풀린 JSON이 전달됨&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;브라우저가 알아서 압축을 해제하므로 개발자가 별도로 압축 해제 코드를 작성할 필요 없습니다. &lt;code class=&quot;language-text&quot;&gt;fetch()&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;axios&lt;/code&gt;로 받으면 이미 풀려있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;브라우저 지원 압축&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gzip&lt;/strong&gt;: 가장 보편적&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;deflate&lt;/strong&gt;: 거의 안 씀&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;br&lt;/strong&gt; (Brotli): gzip보다 20-30% 더 작음, 최신 브라우저 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;설정&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;compression&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;on&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;           &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;기본값:&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;off&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;(CPU&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;사용하므로&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;명시적으로&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;켜야&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;함)&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
           compressionMinSize=&quot;2048&quot;  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 2KB 이상만 압축 (작은 응답은 압축 오버헤드가 더 큼) --&gt;&lt;/span&gt;
           compressibleMimeType=&quot;text/html,text/xml,application/json&quot; /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;고트래픽 Connector 설정&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- server.xml --&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;minSpareThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;100&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;50000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;acceptCount&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;2000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

           &lt;span class=&quot;token attr-name&quot;&gt;connectionTimeout&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;5000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;keepAliveTimeout&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;30000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxKeepAliveRequests&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

           &lt;span class=&quot;token attr-name&quot;&gt;compression&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;on&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;compressionMinSize&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;2048&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;compressibleMimeType&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/html,text/xml,application/json&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

           &lt;span class=&quot;token attr-name&quot;&gt;processorCache&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;socket.directBuffer&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;socket.appReadBufSize&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;16384&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;socket.appWriteBufSize&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;16384&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Tomcat 요청 처리 흐름과 Thread 모델]]></title><description><![CDATA[요청 처리 전체 흐름 클라이언트 요청이 Tomcat을 거쳐 Servlet까지 도달하는 과정을 알아봅니다.  처리 단계별 설명 단계 컴포넌트 역할 1 Connector 소켓 연결 수락, HTTP 파싱 2 Engine Host 헤더로 가상 호스트 결정…]]></description><link>https://gotobill.github.io/tomcat-request-flow/</link><guid isPermaLink="false">https://gotobill.github.io/tomcat-request-flow/</guid><pubDate>Sat, 13 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;요청 처리 전체 흐름&lt;/h2&gt;
&lt;p&gt;클라이언트 요청이 Tomcat을 거쳐 Servlet까지 도달하는 과정을 알아봅니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/7f2ab/tomcatRequest.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.822784810126581%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVR42hWPy06DQAAA+w0emljaLuyDsrDLw0KQQmO91apNvGliNJ70okevnox/4O+OeJ/MZCbLpcP5gVlguWtDPo8CryQu+6Crf5gvBmT3htp8MQ07Tm/eOdm/Es16nqpfjvabaZIQPg/M9w0TIXK87xHCUduY296RqBQlDxT+ESlbhL1CFw+YdCBYHwjqa5zdsbUv1PqeOG/Rlx3ibP0vdKTZOVpXBIsctdqgTT0GLDouSJKGKMwwqiAfT4wsiKOSstqNbImQHu8uSOMeEzX8AY1XXpMKleVMAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;톰캣 리퀘스트 과정&quot;
        title=&quot;&quot;
        src=&quot;/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/f058b/tomcatRequest.png&quot;
        srcset=&quot;/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/c26ae/tomcatRequest.png 158w,
/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/6bdcf/tomcatRequest.png 315w,
/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/f058b/tomcatRequest.png 630w,
/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/40601/tomcatRequest.png 945w,
/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/78612/tomcatRequest.png 1260w,
/static/5c0e4cfed79f21b9c42dc16c4fc1fd45/7f2ab/tomcatRequest.png 2236w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;처리 단계별 설명&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;단계&lt;/th&gt;
&lt;th&gt;컴포넌트&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Connector&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;소켓 연결 수락, HTTP 파싱&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Engine&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Host 헤더로 가상 호스트 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Host&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;URL 경로로 Context 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Context&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;web.xml 기반 Wrapper 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Wrapper&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Filter 체인 실행 후 Servlet 호출&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Servlet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;비즈니스 로직 처리, 응답 생성&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Connector 내부 구조 (Coyote)&lt;/h2&gt;
&lt;p&gt;Connector는 단순히 요청을 받는 게 아닙니다. 내부적으로 세 가지 컴포넌트가 계층적으로 동작합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c131bf0fee83d3cafa8e3b12a009a0ce/c1bea/connectorStructure.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 112.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAE7klEQVR42k2V2W9UdRTHJ1GBthAxnelsd+7sc2ft3Jm5s3empdiWLrS0RQi0FFlqsUBTEAVENgGpIELCEiXRSNIoBqMPxJi4PWnii6/+Ox/PvdMGHj7zO+feM9/f+Z3fmTM2lytKixhu9zqahccTJ5Np0NMYo7dvgly+H58vLe/ieL0JIfkSKQvbupjTGcG9Jt4SjFuByVTdEiqWhtBz/ahqt2z0QqBFGsVESbcEzUx8qvkgKWsGjzeOyy0beKI4XSG8iibExQ7LO4n3xl5aW3i9GopkbzN386v9hMM7CQVHiUZ2EYmMiT0k7CAcGiYSGhHGLKLhcWFC2EU4KLGhKWKRactX1Tw2n2JQK9+kr+ce23sfyPoII/uAcu4xldxXVPPfUCusCt9RN57RY/xEo/icZulnBpq/MdD4g5G+vxnu+52Av4HN6zUY3P6I2f3fs2f6qfBMhFepFJ5QM1ZF5Cn1oggVf6RREqHyL/SWf2Vb7U+G+/9i3+S/zB/4j6nhf+SkvdgURScefptkdIFE+Jisx8nEl8hoy8JpurUz6Ilz5JIXyMYviH2RXOIy+eRV9Pg1qvpNmsU7lLPX8fsrZoZJutQgdn8QV1AuIiQ3vU64tXq1BEo8Kb60VETaKSoXEdMsnJEYXYJLUP1ZbO5ACmVvicihJs79BTr36Thm8zgOFnAcMnAcNbDPF7EvlHAslnGcEJYqOE5VcZyu4Xm/SfjSIKGz21FiOWmbYILM4iADl+dILQ0RPt6H51iFzvk89ndF7ISILZWxLwuny3SeqWA/W8V+robzQpPsrUl6Hs6SWRnHo+ly5EAa+1AK+2ga17iOezKHc1Kna1p4K0fX3jyu/QbOGYOu2QLOA2IfNCmizteJLm4jutRPYL6BLyIZmh3u8qRwCi6xPb7ul8jiUbpRgwXUkGH5XlUXcij+vLW6fDpOuVi3kpVLkT50y4d9aAH3xDJvjJ6kffA47cNLbB49xeaxM3SMf0DHxDk6dn1I+9RHtE9fom33Fdr2fMzGvdfomLmJ/fBdHAdW8EZq2JwBg+DcFcqn76Mt3MY19wmOuRU27b3Oxn032TjzKRtnb7Nh7g4bDt7jtUP3efXIQ16Z/wL7qSekr/xA7sZzAme/xR3tkRoGDTqGFmkfWWbL+Hu8MXWOrVPnaZ88T8fUBTqmL9K+W7Lac5U2yWjTvhtsmlmRTW7RNvc5ne/cp2vxS7YeuotiCipKRn7UWRSzNj59rUY6HrWA28RXwOMv4Q2UxDeEkvhFfHIyX6CIIngDRcv2+wutxl4fQ4rgU0zSxAMyC6WR06EYupakkEiTlebNaxqZaAJVLs2vZtfQLVRVXxNUWrNM8bVmW0BNstzvYGXSzoMjKR4vpPj6eJonJ5OsHt3CZ3tel0nTLaOuJbKO36+3xpfLFZfhqlmD02wjVbIcK4aZaUaY7Y1weCDJ/FCcheEEJ0ejzPQGJE5izZYSIZ+UrCUofRjTSpQrA9TqI6TSdZmLeaFg1bM7t51s7k2pT8GqmRqUekldA+EK1doI2WwvkWiRWKxiEQ4b2JIi0ty2i57mTqr1Ucq1URn124iIaKU6LM/HqciXq2uYIslkjUbvBLWeMflr2EGlvpN6YwItLn1o7mBmFgrlZVIbRGOG7FYSvyABFSuDaLSEplWEsvXO9GOW/QJNq0qGJf4H1NLPxwY9/cgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;톰캣 커넥터&quot;
        title=&quot;&quot;
        src=&quot;/static/c131bf0fee83d3cafa8e3b12a009a0ce/f058b/connectorStructure.png&quot;
        srcset=&quot;/static/c131bf0fee83d3cafa8e3b12a009a0ce/c26ae/connectorStructure.png 158w,
/static/c131bf0fee83d3cafa8e3b12a009a0ce/6bdcf/connectorStructure.png 315w,
/static/c131bf0fee83d3cafa8e3b12a009a0ce/f058b/connectorStructure.png 630w,
/static/c131bf0fee83d3cafa8e3b12a009a0ce/40601/connectorStructure.png 945w,
/static/c131bf0fee83d3cafa8e3b12a009a0ce/78612/connectorStructure.png 1260w,
/static/c131bf0fee83d3cafa8e3b12a009a0ce/c1bea/connectorStructure.png 1388w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;ProtocolHandler&lt;/h3&gt;
&lt;p&gt;프로토콜별로 요청을 처리하는 최상위 컴포넌트입니다. &lt;code class=&quot;language-text&quot;&gt;server.xml&lt;/code&gt;에서 &lt;code class=&quot;language-text&quot;&gt;protocol&lt;/code&gt; 속성으로 지정합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;org.apache.coyote.http11.Http11NioProtocol&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Endpoint&lt;/h3&gt;
&lt;p&gt;Acceptor, Poller, Worker 스레드를 관리하는 주체입니다.&lt;/p&gt;
&lt;p&gt;소켓 레벨 I/O를 담당하며, &lt;strong&gt;NIO/NIO2/APR&lt;/strong&gt; 중 어떤 방식으로 I/O를 처리할지 결정합니다.&lt;/p&gt;
&lt;h3&gt;Processor&lt;/h3&gt;
&lt;p&gt;HTTP 바이트 스트림을 파싱해서 Request/Response 객체를 생성합니다. 요청 처리 후 Keep-Alive 여부에 따라 소켓을 재사용할지 결정합니다.&lt;/p&gt;
&lt;h2&gt;NIO Thread 모델&lt;/h2&gt;
&lt;p&gt;Tomcat NIO는 세 종류의 스레드가 협력하여 요청을 처리합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c772de913e70350ba6b2cd259cc3983f/5fada/tomcatNio.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgUlEQVR42mWUy27TQBSG8wYs2hJ7xvbYnnh8q++5uGnatBWhVLRICETFqntYsELiARB7FizgHRAvwXv9nLGdlKqLXxmPz/nmP+eMMzKMAFuZphoUoSjWKKs1bPsQRblGXV/QOkNJ66ahtZOBsQSWlQ467DTawQz1AOi6OTyvBOcxXC+HnJSUENNeBd+vu2TOH8L0gSPGIzjOYSfLSggWDurhjOl3LVyxpPc5PUek+JEzDeuAOpmxsAvcwrZJpinhuzd4dfUbb67/IvDf0Z5HgOwBTD/fA6lUQ5c7aAu3qFTOFDk7RVN+waL5Bs/dgFshLDt/5KxXrkumRCpVy7JT2kzBqDf74wR7JINpcABm+GBPJbgRkhTsAeY4+aCiUwe0O9DQRzpFigiXlY/XrUQxkRg7Dbz6En5zBX/2Es70Gtytd1DtTKsD3g+BSiUdGAmqiYsfdx7+fFZ4OzfwJH0BfvcV0YfvUJ9+Yv/jL4zTCzjk3ibIFtY77AbQD2Erz4mwTCXOC4lE0kFOBTNYYixbjINjjNUKtqj+K7kYVGKky3WcbCchyD4FHZgZ9oyMekitoESh20KHCZ7AIfWucoovOmmYQweP9Ph1/2x9FwVdBwJ46zkmtyuIzRTB7SmsZ1Oo9+fgz2dgZzXtnUFcLGBzgop7d0KQQ0ZfBevu3lCySVN16Y6pDNynISlyEFYQKQ0hKGBJ6llYwp4Uw0AIZvdQQW0YFeUKi3YDpaYIowVpjjAkh36D2WyDOGwRaakF4ngJ6U+RREc4OblBu7xCmq4QJ8vuV1HMKIpblPU5BR9BhT1Mg6VskNMfRFGdQcdEBNGJQTBHoOZI0uNeyTHt67UGtvgHFlyZGKv/OL8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tomcat nio&quot;
        title=&quot;&quot;
        src=&quot;/static/c772de913e70350ba6b2cd259cc3983f/f058b/tomcatNio.png&quot;
        srcset=&quot;/static/c772de913e70350ba6b2cd259cc3983f/c26ae/tomcatNio.png 158w,
/static/c772de913e70350ba6b2cd259cc3983f/6bdcf/tomcatNio.png 315w,
/static/c772de913e70350ba6b2cd259cc3983f/f058b/tomcatNio.png 630w,
/static/c772de913e70350ba6b2cd259cc3983f/40601/tomcatNio.png 945w,
/static/c772de913e70350ba6b2cd259cc3983f/78612/tomcatNio.png 1260w,
/static/c772de913e70350ba6b2cd259cc3983f/5fada/tomcatNio.png 1706w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Acceptor Thread&lt;/h3&gt;
&lt;p&gt;새로운 TCP 연결을 수락합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 의사 코드&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Acceptor&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt; serverSocket&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;running&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 1. 새 연결 대기 (블로킹)&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; socket &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serverSocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 2. Non-blocking 모드로 전환&lt;/span&gt;
            socket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureBlocking&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 3. Poller에 등록 요청&lt;/span&gt;
            poller&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;socket&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;보통 1개로 충분 (accept()는 매우 빠름)&lt;/li&gt;
&lt;li&gt;병목 가능성 거의 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Poller Thread&lt;/h3&gt;
&lt;p&gt;I/O 이벤트를 감지하고 Worker에 작업을 할당합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 의사 코드&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Poller&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; registerQueue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;running&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 1. 대기 중인 소켓 등록&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;registerPending&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 2. I/O 이벤트 대기 (타임아웃: 1초)&lt;/span&gt;
            selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 3. 준비된 이벤트 처리&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; keys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isReadable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token comment&quot;&gt;// READ 이벤트: Worker Thread에 작업 위임&lt;/span&gt;
                    &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; socket &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Selector에서 등록 해제 (Worker 처리 중 중복 감지 방지)&lt;/span&gt;
                    executor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SocketProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;socket&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU 코어 수에 따라 1-2개&lt;/li&gt;
&lt;li&gt;보통 1개로 수만 개 연결 처리 가능&lt;/li&gt;
&lt;li&gt;연결 수가 10만 이상이면 Poller 개수 증가 고려&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Worker Thread&lt;/h3&gt;
&lt;p&gt;실제 요청을 처리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 의사 코드&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SocketProcessor&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; socket&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 1. HTTP 파싱&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;HttpRequest&lt;/span&gt; request &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parseHttpRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;socket&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;HttpResponse&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;socket&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 2. Container Pipeline 실행&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// Engine → Host → Context → Wrapper&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;getContainer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 3. 응답 전송&lt;/span&gt;
            response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;finishResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 4. Keep-Alive 처리&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isKeepAlive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                poller&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;socket&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 다음 요청 대기&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                socket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;handleError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Thread Pool 구조&lt;/h2&gt;
&lt;h3&gt;Thread Pool 설정&lt;/h3&gt;
&lt;p&gt;Tomcat의 기본값은 &lt;code class=&quot;language-text&quot;&gt;maxThreads=200&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;minSpareThreads=10&lt;/code&gt;입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Executor&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;tomcatThreadPool&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token attr-name&quot;&gt;namePrefix&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;catalina-exec-&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;          &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;최대&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;스레드&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;수&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
          minSpareThreads=&quot;10&quot;      &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 최소 유휴 스레드 --&gt;&lt;/span&gt;
          maxIdleTime=&quot;60000&quot;       &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 유휴 스레드 제거 시간 (ms) --&gt;&lt;/span&gt;
          prestartminSpareThreads=&quot;true&quot;  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 시작 시 minSpareThreads 생성 --&gt;&lt;/span&gt;
          maxQueueSize=&quot;100&quot;        &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 작업 큐 크기 --&gt;&lt;/span&gt;
          /&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;tomcatThreadPool&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Thread 생성 순서 (Tomcat TaskQueue)&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4c18f14de2dacc385dc7e66834802cb/7b67d/taskQueue.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABsElEQVR42j1Sy47TQBD0b7DxeMbvscfzsJ04D2eXlYiyEgsIoQgkxIEDJ76Avy/KDuJQmu6Wu7pc3VFZTzDdEa05IPgnOHdmfkLXzdD1DiI2iOOOb4ckIcQSW74WMnGseah/kEQUb1okbwhlocwOsTBro1gapUcsBzTNghEPYmBthEoHyGILmW/RNUcoxjFjRURpN6C8zBDKQCSEaJGmDlnWY/Ye73qNy6jxfqrwcZ/j5WBgigGvesSHwuFL1eOWO/xk/lTtEEkmiXacrhEnDRU2VGEg0zvZ7ZTjNqewlSZRA6MtXB7wrbT4kbX4pXv8Liz+VB4v5UjC2qPYjSjnA6rrW5SnCcV+QlZT4eBwnT1uF4vXZ4/Hqcc29DD5gCv9/dwd8D2c8dWe8KmZsOWvRyKxVESVkoYrB6k8c8tFLBbQePqoWMszjywNqxVC8DsZWO9pz7B6qtJxRVRkHcrcYLMxeOBylApcwBF1vUexmM2NxmKBw4ZxWR1gzJnE47phkQQK6DngDhK2aOv7aSyqFFUYnkxrZuTcmiDZ0rg2k7TWR4TwzLN65MCJ9UXp8B9/ARRz72+ZpgLfAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;톰캣 스레드풀&quot;
        title=&quot;&quot;
        src=&quot;/static/f4c18f14de2dacc385dc7e66834802cb/f058b/taskQueue.png&quot;
        srcset=&quot;/static/f4c18f14de2dacc385dc7e66834802cb/c26ae/taskQueue.png 158w,
/static/f4c18f14de2dacc385dc7e66834802cb/6bdcf/taskQueue.png 315w,
/static/f4c18f14de2dacc385dc7e66834802cb/f058b/taskQueue.png 630w,
/static/f4c18f14de2dacc385dc7e66834802cb/40601/taskQueue.png 945w,
/static/f4c18f14de2dacc385dc7e66834802cb/78612/taskQueue.png 1260w,
/static/f4c18f14de2dacc385dc7e66834802cb/7b67d/taskQueue.png 2240w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;요청 도착&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;현재 스레드 수 &amp;#x3C; corePoolSize&lt;/strong&gt;: 새 스레드 생성&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;corePoolSize &amp;#x3C;= 현재 스레드 수 &amp;#x3C; maxPoolSize&lt;/strong&gt;: 새 스레드 생성 (큐보다 스레드 우선)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maxPoolSize 도달&lt;/strong&gt;: 큐에 추가&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;큐도 가득참&lt;/strong&gt;: RejectedExecutionException&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;예: corePoolSize=10, maxPoolSize=200, queueSize=100

요청 1-10:    즉시 새 스레드 생성 (10개)
요청 11-200:  새 스레드 생성 (190개 추가, 총 200개)
요청 201-300: 큐에 대기 (100개)
요청 301+:    거부 (RejectedExecutionException)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Tomcat은 일반 ThreadPoolExecutor와 달리 &lt;strong&gt;큐보다 스레드 생성을 우선&lt;/strong&gt;합니다. 큐에서 대기하는 시간을 줄여 응답 지연을 최소화하기 위한 설계입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tomcat TaskQueue 소스코드&lt;/strong&gt; (&lt;a href=&quot;https://github.com/apache/tomcat/blob/main/java/org/apache/tomcat/util/threads/TaskQueue.java#L67&quot;&gt;GitHub 링크&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 스레드가 maxPoolSize보다 적으면 false 반환 → 새 스레드 생성 유도&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPoolSizeNoLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMaximumPoolSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;o&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;offer()&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;를 반환하면 ThreadPoolExecutor는 새 스레드를 생성합니다. Tomcat은 이 특성을 활용해서 큐보다 스레드 생성을 우선합니다.&lt;/p&gt;
&lt;h2&gt;Filter Chain 실행&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Request
  ↓
ApplicationFilterChain
  ├── Filter 1: CharacterEncodingFilter
  ├── Filter 2: LoggingFilter
  ├── Filter 3: AuthenticationFilter
  └── Servlet: DispatcherServlet (Spring MVC)
       ↓
    Spring Interceptor Chain
       ├── Interceptor 1
       ├── Interceptor 2
       └── Controller
  ↓
Response&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Filter vs Interceptor&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;Filter&lt;/th&gt;
&lt;th&gt;Interceptor&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;레벨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Servlet 레벨&lt;/td&gt;
&lt;td&gt;Spring MVC 레벨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;실행 시점&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;DispatcherServlet 이전&lt;/td&gt;
&lt;td&gt;DispatcherServlet 이후&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;용도&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;인코딩, 인증, 로깅&lt;/td&gt;
&lt;td&gt;권한 체크, 공통 로직&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;예외 처리&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;web.xml error-page&lt;/td&gt;
&lt;td&gt;@ExceptionHandler&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Connection 관리&lt;/h2&gt;
&lt;h3&gt;Keep-Alive 동작 원리&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/518f47b646a0c444395ca29497dbdb2f/08b4d/HTTPKeep.webp&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRr4BAABXRUJQVlA4WAoAAAAQAAAAEwAADwAAQUxQSNUAAAABgFvbtmplfX/2/Z83zndX3N3dISenACrRzKEDckIqu6+IiJgAIGwlkxamlU7l0pidi92r1TQQXby5PDxJGqOZ+dbYEPA6C7Ot6Yrx6cPDPdB8Af6OgKVfH17vgNsf4H8TSE/FiY0LUB5CaiwJ7W4/CwpWpzqWBAVCaFR6Z0AItfzhLtDpTjQkqpi7o3JIA/oimXKAUhvtAlai7EvpKGB3VIoq0BuOHFAIRSgnpbcLlMp9EVmDRK21bIMCne5EQ2TQBVBAuwBdoJ43ukA3aTiAHTIcwAEAVlA4IMIAAAAQBQCdASoUABAAPtFUo0uoJKMhsAgBABoJbACdMoRwIsBxY+mV7zcRGQnxTbap2vgAAP6fB/4VdGAlifdub/6iXKgxTLNzEKEBiVGa+hli1YLX0N5PZ73d7jrAnKzEbKKy9VKBQl7dCAMujnmUffPN4kG4JQHgE/kqLrA4Dnt5/UMxBFmPKoWUkrt0p/kRF80Ml+iZym+8GQX5UW3tWBtSBf0XAXC2aM6jnaj5udL72k20pBQck+ulw8VSj5NOUwAAAA==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Keep-Alive 동작 원리&quot;
        title=&quot;&quot;
        src=&quot;/static/518f47b646a0c444395ca29497dbdb2f/8aab1/HTTPKeep.webp&quot;
        srcset=&quot;/static/518f47b646a0c444395ca29497dbdb2f/81b7c/HTTPKeep.webp 158w,
/static/518f47b646a0c444395ca29497dbdb2f/6ea66/HTTPKeep.webp 315w,
/static/518f47b646a0c444395ca29497dbdb2f/8aab1/HTTPKeep.webp 630w,
/static/518f47b646a0c444395ca29497dbdb2f/08b4d/HTTPKeep.webp 750w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/1.0 (Keep-Alive 없음)&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Client → Server: GET /page1
Client ← Server: 200 OK (연결 종료)

Client → Server: GET /page2 (새 연결)
Client ← Server: 200 OK (연결 종료)

→ 요청마다 TCP 3-way handshake 반복 (비효율)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;HTTP/1.1 (Keep-Alive 기본)&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Client → Server: GET /page1
Client ← Server: 200 OK (Connection: keep-alive)

Client → Server: GET /page2 (같은 연결)
Client ← Server: 200 OK (Connection: keep-alive)

→ 하나의 TCP 연결로 여러 요청 처리&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Keep-Alive 설정&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxKeepAliveRequests&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;100&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;   &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;하나의&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;연결에서&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;최대&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;요청&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;수&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
           keepAliveTimeout=&quot;60000&quot;     &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Keep-Alive 타임아웃 (ms) --&gt;&lt;/span&gt;
           /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Connection Timeout&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;connectionTimeout&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;20000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;  &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;20초&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
           /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;클라이언트 연결 수립&lt;/li&gt;
&lt;li&gt;HTTP 요청 헤더 대기 (connectionTimeout 시작)&lt;/li&gt;
&lt;li&gt;20초 내에 요청 헤더 도착 안 하면 연결 종료&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;주의&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;connectionTimeout&lt;/code&gt;은 &lt;strong&gt;요청 헤더 읽기 타임아웃&lt;/strong&gt;입니다. Servlet 실행 시간과는 무관합니다.&lt;/p&gt;
&lt;h3&gt;maxConnections vs acceptCount&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/35ac48e612d380d19c8fff24b4d3abcc/de0bd/tcpPoller.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABo0lEQVR42i2S2U7kMBBF8xkktmMncRbHjrPQpBtCS2jUjcSg0SChGQnxyAs/wPdfym4ejspb3bp2OdHNNYy5QdvukF01SNMGWSBrI4xRZIaiAWcdEcY9RIDbHxyksMiFQ8IoKRziuUU5rpDSQqkBguY8H8AI23v0ZkQmJgg5QSoPXkzgaoTrKKdawAhBa4lsPVRJiVkDJi6OgqCUDpu3+DVqnBeNp53G39sKj4ceHQn9aSb8Vj1ea4//pcNHt+BeL0i4JOu0wQRdkwQDQVgqh9Pc4N9W4eUgMTQ1rK7RNhaWCr5ph/fC4KMd8VlafOkBJz0Hhw7VfoY+7lGfj9Dbimq9hqoHHEaHx23A68ni+WHAcfWYvY8Oz8Gh2eFtvMOL3eOp22GpSJCJHhknhzy8Yw9O85yuG5qQZtQE2gvXD45jzEP0yOltubiMpRyRU5GcxkmpDOry8nZp2hEtHXbozJ5YUZYzrRnqNBVlNnZYqQnWbdD1DRlxEIKaKHyEBFu0VRcdBbLMxOp9f4Bztyioc0GEx0QXY1HMcMM9fbc7Out/GCPf9sTqh7KxKx8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tcp 백로그&quot;
        title=&quot;&quot;
        src=&quot;/static/35ac48e612d380d19c8fff24b4d3abcc/f058b/tcpPoller.png&quot;
        srcset=&quot;/static/35ac48e612d380d19c8fff24b4d3abcc/c26ae/tcpPoller.png 158w,
/static/35ac48e612d380d19c8fff24b4d3abcc/6bdcf/tcpPoller.png 315w,
/static/35ac48e612d380d19c8fff24b4d3abcc/f058b/tcpPoller.png 630w,
/static/35ac48e612d380d19c8fff24b4d3abcc/40601/tcpPoller.png 945w,
/static/35ac48e612d380d19c8fff24b4d3abcc/78612/tcpPoller.png 1260w,
/static/35ac48e612d380d19c8fff24b4d3abcc/de0bd/tcpPoller.png 2238w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;10000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;acceptCount&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;100&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;요청 처리 과정&lt;/strong&gt;:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;동시 연결 수&lt;/th&gt;
&lt;th&gt;상태&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1 ~ 10000&lt;/td&gt;
&lt;td&gt;정상 처리 (Poller가 관리)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10001 ~ 10100&lt;/td&gt;
&lt;td&gt;OS 큐 대기 (TCP backlog)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10101+&lt;/td&gt;
&lt;td&gt;Connection Refused&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</content:encoded></item><item><title><![CDATA[Tomcat 아키텍처]]></title><description><![CDATA[Tomcat 아키텍처 개요 Tomcat은 단순한 웹 서버가 아닙니다. 여러 계층의 컴포넌트가 유기적으로 연결된 Servlet Container입니다.  핵심 컴포넌트 컴포넌트 역할 설명 Server 최상위 컨테이너 Tomcat…]]></description><link>https://gotobill.github.io/tomcat-architecture/</link><guid isPermaLink="false">https://gotobill.github.io/tomcat-architecture/</guid><pubDate>Fri, 12 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Tomcat 아키텍처 개요&lt;/h2&gt;
&lt;p&gt;Tomcat은 단순한 웹 서버가 아닙니다. 여러 계층의 컴포넌트가 유기적으로 연결된 &lt;strong&gt;Servlet Container&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7d6d72b160ccb1bcd4588f3224590655/0a47e/Tomcat.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvUlEQVR42nWSR2/CQBCF/f//BAcuiGaKhEQ40DEEBJgWejPCopgiEHAAnM9eQ5JD5rDa8ubNmzcrDYfD8XhcKBQikUg0GpVlORaLJRKJj/+D13g8XqvVpG632+/3uQoGg4qiVCqVZrPJTa/XE+vv6HQ6X3bU6/V8Pi8JUDqdXiwW1+vVNM3dbgd3KpVKJpPFYrFcLn++YjAYAEaspmkcncrZbJYc0w5Y3G63y+XyeDx+v59GwuGwbAdE1WoVdaPRiL3ELpfLqaqKhOVyeTweIaYl0jKZDERQNxoNXimDbFbSsMlKJu1NttlsTqfTfD4X5mHJZDKBiyan0yn3UOAIeCeZ1lEPN6DVanW5XMAFAgGfzweIytBxSbetVktI+EkWZQnodV1fr9c8hEIhktGCBcihGrxUns1mAEhBkZXcbrdVO8jhYbvd8sDYvF4v3T6fT4w8HA7n8/l2u93v9/1+TztOZWE9U3m7TX3+Cd6C4Ph4PFhhYQMY8Qhx3BZzZqqGYYhk6osRgKMmWoxX0DMaS6USydac359EeMaeefDVQPBDlL8hPgwreL6G1TNoPACKpVM7tH9ibgcbMLqufwNeM4idxYaezgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Tomcat 전체 컴포넌트 계층도&quot;
        title=&quot;&quot;
        src=&quot;/static/7d6d72b160ccb1bcd4588f3224590655/0a47e/Tomcat.png&quot;
        srcset=&quot;/static/7d6d72b160ccb1bcd4588f3224590655/c26ae/Tomcat.png 158w,
/static/7d6d72b160ccb1bcd4588f3224590655/6bdcf/Tomcat.png 315w,
/static/7d6d72b160ccb1bcd4588f3224590655/0a47e/Tomcat.png 600w&quot;
        sizes=&quot;(max-width: 600px) 100vw, 600px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;핵심 컴포넌트&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;컴포넌트&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Server&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;최상위 컨테이너&lt;/td&gt;
&lt;td&gt;Tomcat 인스턴스 전체, 포트 8005로 shutdown 명령 수신&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Connector와 Engine 묶음&lt;/td&gt;
&lt;td&gt;하나의 Engine에 여러 Connector 연결 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Connector&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;요청 수신&lt;/td&gt;
&lt;td&gt;HTTP, AJP 프로토콜 처리, Socket 연결 관리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Engine&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;요청 라우팅&lt;/td&gt;
&lt;td&gt;가상 호스트로 요청 전달&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Host&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;가상 호스트&lt;/td&gt;
&lt;td&gt;도메인별 애플리케이션 격리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Context&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;웹 애플리케이션&lt;/td&gt;
&lt;td&gt;WAR 파일 하나당 하나의 Context&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Wrapper&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Servlet&lt;/td&gt;
&lt;td&gt;Servlet 인스턴스를 감싸는 컨테이너&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Connector와 Container&lt;/h2&gt;
&lt;p&gt;Tomcat 내부는 크게 두 부분으로 나뉩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a7662d5840f80e8a646dc5525121ab58/19bb3/tomcatConnec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChUlEQVR42m2TzU/UQBjG+y+YCG2nM2233X53u9vugpEFVIghLiGwBGRN8CO7BEI8cJB4MzHolauJV716wKOJetd/6vHtbFd2lcOTzkxmfn2e951RdD2AwSNwkZBi6LqPcm0iTXehao6UrjswjIgUg/OkUiolRENK0TRvDGEVQKuANGdGiigYop2fYyF/gyx+TT9tkYGYoInUBMj5FPBaFUwj8JwNNh/jbusSu5tXONj6jgeLVxB6QesOuHQ5CxMig1K6G4MmMJrTJtZYg2j3IIp9iGgb7p0RzGQHRroGo+iB2TlBk/+BmjYVUw/BVA+quwjWP4f19B3m+q9we3kf/Nlb3Fp5ArZ1Bv3wPdRwldxGEjItZeKMsXBGZWxVC0nUKCODajRpXyrrxlgCUTXCNDNS86+U645OAyMpTsUP7DpSt46W79PXgykIRBGnY5b6BzgLMkg6uXBNHxc7Bj6eZPh01sSH5ypix6fuE+AGmGm2SuAsTAKpg2UsS0QYdG0cbwR42QswWrfg2mV3sxthEsjK+yZrSDACGTyRQHnPKJaqN6CRI8ZbmNczcDokRLOCEcTK6VvIsUVjpawTp7pwI4She6T6+MKWL4IaJlidnJJbKr6gn8s1OiNh5UshIybNbbuQUsrnI8wG7GwLycoxrPyInJETbxXewiFqC6fgzj1wu416Z4Bw6RRmtEtnmnBafSTLJ6jlQ3LaHjs0ZNQU9v0LdIff4G3/gKgtgRcj5IMviAe/wdMXEME6ioPPWDr6BbN7CcvpwNu4RHf0E07vK0w6Y48jV7fdewjm98HDvXHB3RUa70DEA9rchWl3IMJt8OgAlv9IujGDTZo/Jsd7FLeDWq2NP+U2oQDEr/EWAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;톰캣 커넥터&quot;
        title=&quot;&quot;
        src=&quot;/static/a7662d5840f80e8a646dc5525121ab58/f058b/tomcatConnec.png&quot;
        srcset=&quot;/static/a7662d5840f80e8a646dc5525121ab58/c26ae/tomcatConnec.png 158w,
/static/a7662d5840f80e8a646dc5525121ab58/6bdcf/tomcatConnec.png 315w,
/static/a7662d5840f80e8a646dc5525121ab58/f058b/tomcatConnec.png 630w,
/static/a7662d5840f80e8a646dc5525121ab58/40601/tomcatConnec.png 945w,
/static/a7662d5840f80e8a646dc5525121ab58/78612/tomcatConnec.png 1260w,
/static/a7662d5840f80e8a646dc5525121ab58/19bb3/tomcatConnec.png 2066w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Coyote (Connector)&lt;/h3&gt;
&lt;p&gt;네트워크 레벨을 담당합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ProtocolHandler&lt;/strong&gt;: HTTP/1.1, HTTP/2, AJP 등 프로토콜별 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Endpoint&lt;/strong&gt;: 소켓 연결 관리, I/O 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Processor&lt;/strong&gt;: HTTP 요청 파싱, 응답 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Catalina (Container)&lt;/h3&gt;
&lt;p&gt;비즈니스 로직 실행을 담당합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Engine&lt;/strong&gt;: Host 헤더 기반 라우팅&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Host&lt;/strong&gt;: 도메인별 애플리케이션 관리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Context&lt;/strong&gt;: 웹 애플리케이션 단위&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Wrapper&lt;/strong&gt;: Servlet 인스턴스 관리&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;server.xml 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/73e89d0952b2ee7004d75471776b5d87/9c1e6/tomcatServer.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEUlEQVR42mWTy5KTQBiF8xIzQqChG5o7NJBAMsFc5qJV6lgpx42XWVk1VS4sl25dmAdw4dKFz+HTHf/ujKXJLE5VA83Hf85pRjxQiLMeoWxhPYpgWRFsOyYlRuOxVmpk2ym4UMiKAUk+gHkl3c/gODlctyCVGDFWIA6m8MUUXtzCoxf0Q8bKIyk4boqAP8Fm2OFq+IFE3kCEJaJ4Ds4bAhcYuW6OJhrQpCuk6hyinENEBPfUkWowNwMLrlAtv0Gd/wJP38D39dQTCNHSusZIj8tpofILZO0aLNo/8I+BvgaSNfkYk6efMHmxgyi2CMhREHaIacqAnI4c2iT8BlVxiXT6DOFsjaBe0EeaA6DvK1iOwjIL8HUr8P2ti+sJh+11iKIOMuopqmpv2Sc7Ktsgb64R9RcQwwpckm1W/TehAiOgW6SY3C7QfVxB9FRoeAYZ95RxbXIe7QuoIMMZ2pomVDQdte6xY8skp8Rp1WH87jXsu1tY/RLSb8lybzLW+/ZAY6lBQUA53VA2M3D2MEOP8j7JLmE9/4KTmx1O65eQvCa7uuXWQA1QlzBNlsjlGZguJGhNDAcZ0vWYpWi8LT50P/F59RuL5A4irqmQxT+gPmNKLgxQ6Ca96qHde+m9IZuji19hlr5HxNfgQWPa9U2JGkinO9bniC5cypLdy/P+6hDq0o9guwk1Hpu1LoKZARoD/QMk10a2q964wwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;톰캣 서버 xml&quot;
        title=&quot;&quot;
        src=&quot;/static/73e89d0952b2ee7004d75471776b5d87/f058b/tomcatServer.png&quot;
        srcset=&quot;/static/73e89d0952b2ee7004d75471776b5d87/c26ae/tomcatServer.png 158w,
/static/73e89d0952b2ee7004d75471776b5d87/6bdcf/tomcatServer.png 315w,
/static/73e89d0952b2ee7004d75471776b5d87/f058b/tomcatServer.png 630w,
/static/73e89d0952b2ee7004d75471776b5d87/40601/tomcatServer.png 945w,
/static/73e89d0952b2ee7004d75471776b5d87/78612/tomcatServer.png 1260w,
/static/73e89d0952b2ee7004d75471776b5d87/9c1e6/tomcatServer.png 1734w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Connector 종류&lt;/h2&gt;
&lt;h3&gt;NIO (Non-blocking I/O)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;org.apache.coyote.http11.Http11NioProtocol&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;10000&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Java NIO 사용&lt;/li&gt;
&lt;li&gt;Selector 기반 I/O 멀티플렉싱&lt;/li&gt;
&lt;li&gt;메모리 효율적 (연결당 Thread 불필요)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot 기본값&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;NIO2 (Async I/O)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;org.apache.coyote.http11.Http11Nio2Protocol&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Java 7+ AsynchronousSocketChannel 사용&lt;/li&gt;
&lt;li&gt;완전한 비동기 I/O&lt;/li&gt;
&lt;li&gt;NIO보다 약간 높은 성능 (벤치마크 환경 의존적)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7ee500f526894fee1f5fbb03bcc84074/5d942/niovsnio2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADKElEQVR42k1U2ZLTMBDcv2ATH/ItW7YsX7GTdY6FBUIBVbzw/7/StOQs8DBlHaOZ7pkeP+32Er5f0iSiYkFSvyKuLojzGQHPg1DBo8+e6zBqIIIakRoQDUfENFEOCAOeRy1jNHjaBR3a/ob1/BmtOaEoOmSpRpZp5HnHfc8HCs9CojtccT5/wzBcUcoJRTagyGnFiLI8IIoMA/rMGGskaYs0HZDSKY6bf5Zo+F6FvSiRMHjuApyQ05Kk47uO73oCINJQbwi1WXG+vGGe7xiHO6Q0dLYJWjp2dKyxY8B2WLGubzivvzH03xncMPiGUBKxQ/j8nEGEElmcIRIpZM51WsHzbF0rBlMIAiLcV7xX9JMo0wJJXEGIhveNSyiE3hDuxQGqWTEdPmI5fUVVzURnkGeWXu8QhGzELqnQjjdMlzvU8QrJBhbFTDu4b1kuLFHHgLucBy2M7tCbAapmM1KbXZGColO9Ud5V0PqE0/qKw3JB2x7R1INLausq5UggPZ68sGcjeh70KHk5ZFv9YjYqjlu3DojQ85mAwdOoJG2FlM0qMvpF+uFrCII19AKDbrjh+vqTxb7jphfSIVVpsw6kMrHGGvtEwUxXNuUH5UXK5RFKrVDV4sqkFHUZ95aybUaJIpXUVIk0r0nZ0twaIsRG2aOl+bjVTc4uYKUon3yiEib3jSLW0IsOkNUJpltd6/OHpqy2/uor0PCSBi0RXs4/cFy/Ql8vfDdR4LYhM1FyypLBUtYouem6MzMuyLlWzQszjk6DVmNCtPB2lAy7X5cta11DpgpVwYmiVkVknMgdZf+BsDUXdO0ZV9YjTYYHutFRcQg5jsq8UNCvGKeP6CnsijNv76V8lw0R2oGu1QHzdMQyLVhqAyUbBjMMahxK2z2PnbbNeyHlaX7DNN3R6JujqljLun6h/8iAoeG8WiFzzKgjK86UUomizezeTkDAP0okNmmEobXWNcHStMisCfGgbPpPuFy/Y1l+UbBf2MXJUbBm5WDrYwPYov8fYNu/28gEpPz8IeMUSFrJeZWcYTvH/Ad6tTOff6P9XvHe7htnvq8fZkX/bsbt/wAm5/dlxwxz+gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;nio vs nio2&quot;
        title=&quot;&quot;
        src=&quot;/static/7ee500f526894fee1f5fbb03bcc84074/f058b/niovsnio2.png&quot;
        srcset=&quot;/static/7ee500f526894fee1f5fbb03bcc84074/c26ae/niovsnio2.png 158w,
/static/7ee500f526894fee1f5fbb03bcc84074/6bdcf/niovsnio2.png 315w,
/static/7ee500f526894fee1f5fbb03bcc84074/f058b/niovsnio2.png 630w,
/static/7ee500f526894fee1f5fbb03bcc84074/40601/niovsnio2.png 945w,
/static/7ee500f526894fee1f5fbb03bcc84074/78612/niovsnio2.png 1260w,
/static/7ee500f526894fee1f5fbb03bcc84074/5d942/niovsnio2.png 1343w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;핵심 차이점&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/beeb00a6f218fc44180919bdb14b5b36/8c381/niodiffrence.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVR42lWRW5KCMBBFWYhCkiaACjGEhyOIr/Fn9r+gO21ntJyPW9WVVE6f7iRKeaxWNdLUYb1uQBRgbY+Ua5U5ZNkeSrWSLPOoyiPK4gsq9dBZC627d4zpkPTDg4sgsCcgtwPK5g67u3JusNXCsAClAzQ3t/UE2y2gdgaFE4zu+X0vMKIeidufsd1NMPQ0cNB8mW/OAizqbxjLNgzSAgww5QDjJ5CfuR7fZhHKQO+vcG6RUZ/jGe5SsBmVs8D0n9kLqIshwrbH2OADJsAQbqg2LwsPsgdU/geWLWWMfOQc4kOG0uaAfLyAdkdpTjT8SxI/wAkwQjvZXdE8eOS7xG6vfN5GI96xaSbk7UngRn8ajvgFPCGyltlGrAAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;nio vs nio2 핵심 차이점&quot;
        title=&quot;&quot;
        src=&quot;/static/beeb00a6f218fc44180919bdb14b5b36/f058b/niodiffrence.png&quot;
        srcset=&quot;/static/beeb00a6f218fc44180919bdb14b5b36/c26ae/niodiffrence.png 158w,
/static/beeb00a6f218fc44180919bdb14b5b36/6bdcf/niodiffrence.png 315w,
/static/beeb00a6f218fc44180919bdb14b5b36/f058b/niodiffrence.png 630w,
/static/beeb00a6f218fc44180919bdb14b5b36/40601/niodiffrence.png 945w,
/static/beeb00a6f218fc44180919bdb14b5b36/78612/niodiffrence.png 1260w,
/static/beeb00a6f218fc44180919bdb14b5b36/8c381/niodiffrence.png 1267w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;OS 커널 레벨에서의 차이&lt;/h3&gt;
&lt;p&gt;BIO, NIO, NIO2는 OS 커널과 상호작용하는 방식이 다릅니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4d2599beaaebf4604b76ccca2fc45f4/f1c64/bionio.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.17721518987341%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAD60lEQVR42j2Ua2scZRTHF6EWbWtCk8zO7szOfee6szM7m71kd3NtmiZtGkqNUYtWaWsKtaJ4KSi0VoLQ2EotCL7wjVBBX/gd/Gg/z06DL/4cnnOe5zzn9j+VuTkTVbGxak1MgaE2URSXhQWbquJQ1yI0o03dSKnrLarVZolaLaBuJWh2imaJTYupqRGVet3HEUXuZnS8jLbIRiNiqjeMGNsf4iUbeOEKjtsTW4zeSLDMDnYywCpGWNkQ2+mILaViyOMkykmCnM2wh+ctEgR9NInMc1OSsE3kp/jDIWF/JLouWj0m7ObEhdichKiZ4fsDbDun4jgZk8klxqMtuumYMOwTx0OJMCSV8/LyNssrV2gXK8TpiMDvo0t6g/VtxhevSDBLcn8kd1dx3UVJWQsxzEJC7mJYuaSZYppZ6dAQadk9TNFbZrvUG2ZKQ4+JJJs47otdyuJEuF4stoSK7+2xMTminz9m0HnBsPsnS8VLeTSi373D6tL3jAfPGRS/MVr8myI9khpmdDt3yFqHdNpfivyGTvqYprtHxWp0CewNmuYGob1LZO8TO29LWhlZeJ1h+zaT3iN6rSOG6S9kweeSxRIXl39iZ/1XLkz+YqX3D+v9f2kFd6lo2TrR/n0aVz5hZus2Z7YPObtzF9WWrkVjGvkWamuVansNJdugKjpDumk2RbpjLHeC5U1wmquYttRQXdzFu3WM9fExMzee8Np7zzj1/jPmnT7Nd76iePA7tcMXvH7zOafu/cHZ6w/RpN7Z3R/pffYzjVtPOP3uEadvvWB+6UC6bEg3mzGx7dFym6SuV6IhzVKjdc4nW8y2dphNr/JWdo35aFOGeRFt8w76pXvMXrjHm+uf8sbW1yykl6ls5i7HN3Me7an8cPUcT/fPcbw/QyxOD8YRD/Zi7q/O8cXaDA+3z/DRRMGSSbi8GLHTcdjtNLjW1Tnoa3SDgIprBmT+FD554FOEPt0owNAjLnUDPrzQ4saKwwcrOoebOlcHDqET8+31lEcHCd/tKhLMeZ4ezLLd86goVR9FDU8QCeISqpwX1IQ5JWau2hK0mVczlFpbWNSipqWCjJreESnQC+F6Jl2uC/ll8jUZVkM4+j+mA260Sn52OmslTBlu285ECgGEy1NpWcJpuyhhiq4yddTJBzKog9KpongSXVOYImXIxuTtRfkgLrk9ZU9dAkiEIXFUlKwxrfargASGIRFON0cm2yLP+qVRkZWlqm7pMJZt0i2WSFojdPmsVvNRaxFZFDLuZaT5mmyg4uQjoaohy2G612qyPWr15OSnqISuJ2WtNKnVVOr6q/QbjbY8FEj6DSM7OQvHjU6J/wCjCQ9yczb83wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;BIO vs NIO vs NIO2 커널 레벨 비교&quot;
        title=&quot;&quot;
        src=&quot;/static/f4d2599beaaebf4604b76ccca2fc45f4/f058b/bionio.png&quot;
        srcset=&quot;/static/f4d2599beaaebf4604b76ccca2fc45f4/c26ae/bionio.png 158w,
/static/f4d2599beaaebf4604b76ccca2fc45f4/6bdcf/bionio.png 315w,
/static/f4d2599beaaebf4604b76ccca2fc45f4/f058b/bionio.png 630w,
/static/f4d2599beaaebf4604b76ccca2fc45f4/40601/bionio.png 945w,
/static/f4d2599beaaebf4604b76ccca2fc45f4/78612/bionio.png 1260w,
/static/f4d2599beaaebf4604b76ccca2fc45f4/f1c64/bionio.png 1390w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;BIO (Blocking I/O)&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;read()&lt;/code&gt; 시스템콜 호출 시 데이터가 올 때까지 스레드가 sleep&lt;/li&gt;
&lt;li&gt;연결당 1개 스레드 필요 (1000 연결 = 1000 스레드)&lt;/li&gt;
&lt;li&gt;스레드 생성/관리 오버헤드 큼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;NIO (Selector 기반)&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linux의 &lt;code class=&quot;language-text&quot;&gt;epoll&lt;/code&gt;, macOS의 &lt;code class=&quot;language-text&quot;&gt;kqueue&lt;/code&gt; 활용&lt;/li&gt;
&lt;li&gt;1개 Poller 스레드가 수천 개 연결의 이벤트를 감지&lt;/li&gt;
&lt;li&gt;이벤트 발생 시에만 Worker 스레드 할당&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;NIO2 (Async I/O)&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;커널이 I/O 완료까지 전부 처리&lt;/li&gt;
&lt;li&gt;버퍼 복사까지 커널이 수행 후 콜백 호출&lt;/li&gt;
&lt;li&gt;애플리케이션은 요청만 하고 즉시 다른 일 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;epoll이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Linux에서 대량의 연결을 효율적으로 처리하기 위한 I/O 이벤트 알림 메커니즘입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 기존 select: 모든 FD 검사 - O(n)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FD_ISSET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;readfds&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// epoll: 준비된 FD만 반환 - O(1)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;epoll_wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;epfd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MAX_EVENTS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// events[i]는 이미 준비된 FD만 포함&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;방식&lt;/th&gt;
&lt;th&gt;시간복잡도&lt;/th&gt;
&lt;th&gt;10000 연결 중 10개 이벤트&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;select/poll&lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;10000번 검사&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;epoll&lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;td&gt;10개만 반환&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;APR (Apache Portable Runtime)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;org.apache.coyote.http11.Http11AprProtocol&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;maxThreads&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;200&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Native C 라이브러리 사용&lt;/li&gt;
&lt;li&gt;OpenSSL 직접 연동 (SSL/TLS 성능 우수)&lt;/li&gt;
&lt;li&gt;리눅스 epoll, BSD kqueue 활용&lt;/li&gt;
&lt;li&gt;설치 복잡함 (별도 라이브러리 필요)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Native C 라이브러리란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;NIO/NIO2는 Java 코드가 JVM을 통해 OS 시스템콜을 호출합니다. APR은 Tomcat이 직접 만든 C 라이브러리(libtcnative)를 통해 OS를 호출합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;NIO:  Java 코드 → JVM (JNI) → OS 시스템콜
APR:  Java 코드 → libtcnative.so (C) → OS 시스템콜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;JVM을 거치지 않고 C 코드가 직접 OS와 통신하므로 오버헤드가 줄어듭니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 OpenSSL이 빠른가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Java SSL(JSSE)과 OpenSSL의 차이:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;Java SSL&lt;/th&gt;
&lt;th&gt;OpenSSL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;구현 언어&lt;/td&gt;
&lt;td&gt;Java (JVM 위에서 실행)&lt;/td&gt;
&lt;td&gt;C (네이티브 코드)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;최적화&lt;/td&gt;
&lt;td&gt;범용적&lt;/td&gt;
&lt;td&gt;CPU 명령어 최적화 (AES-NI 등)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;성능&lt;/td&gt;
&lt;td&gt;기준&lt;/td&gt;
&lt;td&gt;2-3배 빠름&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;OpenSSL은 CPU의 하드웨어 암호화 명령어(AES-NI)를 직접 활용합니다. Java SSL은 JVM 바이트코드로 실행되어 이런 최적화가 제한적입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;현재는 APR을 권장하지 않습니다&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Tomcat 8.5+부터 NIO/NIO2도 OpenSSL을 사용할 수 있게 되어 APR의 가장 큰 장점이 사라졌습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;버전&lt;/th&gt;
&lt;th&gt;SSL 옵션&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Tomcat 8.0 이전&lt;/td&gt;
&lt;td&gt;APR만 OpenSSL 사용 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tomcat 8.5+&lt;/td&gt;
&lt;td&gt;NIO/NIO2도 OpenSSL 사용 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tomcat 10+ / Java 17+&lt;/td&gt;
&lt;td&gt;JSSE 성능 대폭 개선&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;JSSE&lt;/strong&gt;(Java Secure Socket Extension)는 Java 표준 SSL/TLS 라이브러리입니다.&lt;/p&gt;
&lt;p&gt;과거에는 OpenSSL보다 2-3배 느렸지만, Java 8u161+에서 AES-NI 지원이 개선되고 Java 17+에서 암호화 성능이 대폭 향상되어 현재는 대부분의 경우 JSSE만으로 충분합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e14a5fd6af5407e0757afdaeaead021c/11a8f/tomcatConnector.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADSElEQVR42j1Ty47bRhDkT8SOZJLim0Ny+Bi+JK1kSqvVrpMAXiMBckiAAEaQXHwxcs4ll/xBPiH/WakerXNozIPT1VXVTWe1SrBeZVivb+F5GrnawZgLqmJGMPyE5PIXym//gf/wL159eET4cYvo0xXubyN+f/wafz6H+PtHF3+8+wpOFLfYbCqsCPrmjYLvl6irHpMZUaoem/Id9P5nmOVXRONnuIc76O9a6A9bBE8G38wRfrkk+HiN8X4O4YRRgyTtyS6H6yobnpcjyxre8bxOEXkxVFLAW/nwXiskXgMVdNxXeL1uEMQj/HDCq3UrDDuoYkcQ9T/ghiyTsOVddYuAKljUI5Dn1fDj29nf1HyrESYGcWoQBg2cgIlJJo+LF0BZS/vQ80oLKEXTbKA1DS3RVDTwPPJNw7sWqZoY9JusnZRgqpwtoAUlSMAkRRBJ9qVJ9R7lsFjggKyK7ohqOCEIySrsMDRvYeq33PdwElItyq1thjByySgONAzvbyw1pHF5fpPo+zVSSsyEMSUGtKNOBpQxGygMBbDUe8RJf5NI4IiJLe+FoSsMaYthgoB5jCoyaBMBaAnIfTpCJxPPRgBF8s4mf2FoJYeNlWsj7bDhCPmBeEhWakBYjBZMfAuLCSF9DGkBu2wQsaI0QxrgugRkYpHPlFzfJJNNJrZspAmUnE/Iy72VKKB5dYes2tu9I90qyFDM9f3KAsSU2FW7l67WiNUI1R4gExFSZkaL7FkYkpUhYK0E0DZl4K+2hUdm63VhGSoy6OsDEpotBZS+Q2XYRSrxOYtlc4Tuz1Q2II4HmPaErln4fYCTU3stY0FJJVlFUctHhrM2WiuEeUrgtj6ibRc0HBFdHZBnsy0o7zISyvId0nSGM2+vON0/Yzk/23W7e0LbnVjkwOSF+8WO1cz7y/UHnC/f47i8t+d+uKAzZ8Y9uu5MUgc4qthCccplrnJKFT9LGl7Sl4pSNYEVGeR8I3fym8qq9dFGpQ8svthQ9NHp6cWZzKbpARU7JeACoGiFRMGCGRs3zY94IMNpvqKh9NbGybLT/EuKgsXUHZySIB1Bu/7eStX0qqbpxQtzVQj7ySYN0xXDeMU4PfHNYu9krfQXwD3+A+OzAf3DPX+dAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;BIO vs NIO vs APR 비교&quot;
        title=&quot;&quot;
        src=&quot;/static/e14a5fd6af5407e0757afdaeaead021c/f058b/tomcatConnector.png&quot;
        srcset=&quot;/static/e14a5fd6af5407e0757afdaeaead021c/c26ae/tomcatConnector.png 158w,
/static/e14a5fd6af5407e0757afdaeaead021c/6bdcf/tomcatConnector.png 315w,
/static/e14a5fd6af5407e0757afdaeaead021c/f058b/tomcatConnector.png 630w,
/static/e14a5fd6af5407e0757afdaeaead021c/40601/tomcatConnector.png 945w,
/static/e14a5fd6af5407e0757afdaeaead021c/78612/tomcatConnector.png 1260w,
/static/e14a5fd6af5407e0757afdaeaead021c/11a8f/tomcatConnector.png 1272w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;I/O 레이어 구분&lt;/h3&gt;
&lt;p&gt;요청 처리는 &lt;strong&gt;Connector 레이어&lt;/strong&gt;와 &lt;strong&gt;Servlet API 레이어&lt;/strong&gt;로 나뉩니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;단계&lt;/th&gt;
&lt;th&gt;레이어&lt;/th&gt;
&lt;th&gt;NIO/NIO2&lt;/th&gt;
&lt;th&gt;APR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;헤더 읽기&lt;/td&gt;
&lt;td&gt;Connector&lt;/td&gt;
&lt;td&gt;논블로킹&lt;/td&gt;
&lt;td&gt;블로킹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;바디 읽기&lt;/td&gt;
&lt;td&gt;Servlet API&lt;/td&gt;
&lt;td&gt;블로킹&lt;/td&gt;
&lt;td&gt;블로킹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;응답 쓰기&lt;/td&gt;
&lt;td&gt;Servlet API&lt;/td&gt;
&lt;td&gt;블로킹&lt;/td&gt;
&lt;td&gt;블로킹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;헤더 읽기가 Connector 레이어인 이유&lt;/strong&gt;: Tomcat은 HTTP 헤더를 파싱해야 어떤 Servlet으로 라우팅할지 결정할 수 있습니다. 즉, Servlet 호출 전에 헤더 파싱이 완료되어야 합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. Connector가 헤더 읽기 (NIO: 논블로킹 / APR: 블로킹)
2. Host, URL 경로 파싱 → Servlet 라우팅 결정
3. Servlet 호출
4. Servlet이 바디 읽기/응답 쓰기 (블로킹)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Servlet API 블로킹 동작&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트 → [NIC] → [Kernel Buffer] → [ByteBuffer] → [Servlet]
                            ↑                 ↑
                       NIO/NIO2 영역      Servlet API 영역&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;request.getInputStream().read()&lt;/code&gt;: ByteBuffer에 데이터가 준비될 때까지 대기&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;response.getOutputStream().write()&lt;/code&gt;: Kernel Buffer에 공간이 생길 때까지 대기 (클라이언트가 느리면 블로킹)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Connector 주요 파라미터&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Connector&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;8080&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
           &lt;span class=&quot;token attr-name&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;HTTP/1.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

           &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;Pool&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
           maxThreads=&quot;200&quot;           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 최대 Worker Thread 수 (기본값: 200) --&gt;&lt;/span&gt;
           minSpareThreads=&quot;10&quot;       &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 최소 유휴 Thread 수 (기본값: 10) --&gt;&lt;/span&gt;

           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Connection Pool --&gt;&lt;/span&gt;
           maxConnections=&quot;10000&quot;     &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 최대 동시 연결 수 (기본값: NIO 10000) --&gt;&lt;/span&gt;
           acceptCount=&quot;100&quot;          &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 대기열 크기, OS backlog (기본값: 100) --&gt;&lt;/span&gt;

           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Timeout --&gt;&lt;/span&gt;
           connectionTimeout=&quot;20000&quot;  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 요청 헤더 읽기 타임아웃 (기본값: 20000ms) --&gt;&lt;/span&gt;
           keepAliveTimeout=&quot;60000&quot;   &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Keep-Alive 타임아웃 (기본값: connectionTimeout) --&gt;&lt;/span&gt;

           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Keep-Alive --&gt;&lt;/span&gt;
           maxKeepAliveRequests=&quot;100&quot; &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 하나의 연결에서 최대 요청 수 (기본값: 100) --&gt;&lt;/span&gt;

           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- I/O --&gt;&lt;/span&gt;
           compression=&quot;on&quot;           &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 응답 압축 (기본값: off) --&gt;&lt;/span&gt;
           compressionMinSize=&quot;2048&quot;  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 압축 최소 크기 (기본값: 2048) --&gt;&lt;/span&gt;
           /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Connector에서 &lt;code class=&quot;language-text&quot;&gt;maxThreads&lt;/code&gt;를 직접 설정하면 내장 ThreadPool을 사용하며, 이 경우 &lt;code class=&quot;language-text&quot;&gt;maxQueueSize&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;Integer.MAX_VALUE&lt;/code&gt;(사실상 무제한)입니다. &lt;code class=&quot;language-text&quot;&gt;maxQueueSize&lt;/code&gt;를 제어하려면 별도 Executor를 정의해야 합니다.&lt;/p&gt;
&lt;p&gt;각 파라미터의 상세 동작 원리는 &lt;a href=&quot;/tomcat-request-flow/&quot;&gt;Tomcat 요청 처리 흐름과 Thread 모델&lt;/a&gt;에서 다룹니다.&lt;/p&gt;
&lt;h2&gt;Container 계층 구조&lt;/h2&gt;
&lt;h3&gt;Engine&lt;/h3&gt;
&lt;p&gt;가상 호스트로 요청을 라우팅합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Engine&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;Catalina&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;defaultHost&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;localhost&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Host&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;localhost&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;appBase&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;webapps&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Host&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;www.example.com&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;appBase&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;webapps-example&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;Engine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;요청 처리 흐름&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HTTP Host 헤더 확인: &lt;code class=&quot;language-text&quot;&gt;Host: www.example.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;매칭되는 Host 컴포넌트 선택&lt;/li&gt;
&lt;li&gt;매칭 실패 시 defaultHost 사용&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Host&lt;/h3&gt;
&lt;p&gt;도메인별 웹 애플리케이션을 격리합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;요즘은 Engine/Host 설정을 직접 건드릴 일이 거의 없습니다.&lt;/strong&gt; Nginx/LB가 앞단에서 도메인별로 다른 서버로 라우팅하고, 컨테이너 환경에서는 서버(또는 Pod) 하나당 Tomcat 하나를 띄우기 때문입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Host&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;localhost&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;appBase&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;webapps&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;unpackWARs&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;      &lt;span class=&quot;token attr-name&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;WAR&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;압축&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;해제&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      autoDeploy=&quot;true&quot;      &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 자동 배포 --&gt;&lt;/span&gt;
      deployOnStartup=&quot;true&quot; &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- 시작 시 배포 --&gt;&lt;/span&gt;
      &gt;

  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Valve: Host 레벨 필터 --&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Valve&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;org.apache.catalina.valves.AccessLogValve&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;directory&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;logs&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;localhost_access_log&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;suffix&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;.txt&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;%h %l %u %t &lt;span class=&quot;token entity named-entity&quot; title=&quot;&amp;quot;&quot;&gt;&amp;amp;quot;&lt;/span&gt;%r&lt;span class=&quot;token entity named-entity&quot; title=&quot;&amp;quot;&quot;&gt;&amp;amp;quot;&lt;/span&gt; %s %b&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;Host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Context&lt;/h3&gt;
&lt;p&gt;웹 애플리케이션 단위입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- conf/Catalina/localhost/myapp.xml --&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Context&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/myapp&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;docBase&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/var/webapps/myapp&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token attr-name&quot;&gt;reloadable&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
         &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Context별 DataSource --&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Resource&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;jdbc/mydb&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;Container&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;javax.sql.DataSource&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;maxTotal&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;20&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;maxIdle&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;10&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;driverClassName&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;com.mysql.cj.jdbc.Driver&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;jdbc:mysql://localhost:3306/mydb&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Spring Boot에서는&lt;/strong&gt; embedded Tomcat을 사용하고 Context Path가 기본적으로 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;(루트)입니다. 그래서 Controller에서 &lt;code class=&quot;language-text&quot;&gt;/api/users&lt;/code&gt;만 매핑하면 바로 &lt;code class=&quot;language-text&quot;&gt;http://localhost:8080/api/users&lt;/code&gt;가 됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 변경하고 싶다면&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;servlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;context-path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /myapp  &lt;span class=&quot;token comment&quot;&gt;# http://localhost:8080/myapp/api/users&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Wrapper&lt;/h3&gt;
&lt;p&gt;Servlet 인스턴스를 관리합니다. URL 패턴과 Servlet 클래스를 매핑합니다.&lt;/p&gt;
&lt;h4&gt;전통적인 Servlet 방식 (과거)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Context: /myapp
├── Wrapper: /hello  → HelloServlet
├── Wrapper: /user   → UserServlet
├── Wrapper: /order  → OrderServlet
└── Wrapper: *.jsp   → JspServlet&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;web.xml&lt;/code&gt;에서 URL마다 Servlet을 직접 매핑했습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- web.xml --&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;helloServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;com.example.HelloServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-mapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;helloServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;url-pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/hello&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;url-pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-mapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;userServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;com.example.UserServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-mapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;userServlet&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;url-pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/user&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;url-pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;servlet-mapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Spring MVC 방식 (현재)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Context: /
└── Wrapper: /  → DispatcherServlet (단 하나)
                    ├── /hello  → HelloController
                    ├── /user   → UserController
                    └── /order  → OrderController&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Servlet은 DispatcherServlet 하나만 존재&lt;/strong&gt;합니다. URL → Controller 매핑은 Tomcat이 아닌 Spring이 처리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Spring이 내부적으로 URL 매핑 관리&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HelloController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Spring의 HandlerMapping이 처리&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/user/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Spring의 HandlerMapping이 처리&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@PathVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;비교&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;전통 Servlet&lt;/th&gt;
&lt;th&gt;Spring MVC&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Servlet 수&lt;/td&gt;
&lt;td&gt;URL당 1개&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;전체 1개&lt;/strong&gt; (DispatcherServlet)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;URL 매핑&lt;/td&gt;
&lt;td&gt;Tomcat(Wrapper)이 처리&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Spring&lt;/strong&gt;(HandlerMapping)이 처리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;설정 방식&lt;/td&gt;
&lt;td&gt;web.xml&lt;/td&gt;
&lt;td&gt;@Controller + @RequestMapping&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;요청 흐름&lt;/td&gt;
&lt;td&gt;Tomcat → Servlet&lt;/td&gt;
&lt;td&gt;Tomcat → DispatcherServlet → Controller&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;왜 바뀌었는가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;전통 방식은 Servlet마다 공통 로직(인증, 로깅, 예외처리)을 중복 구현해야 했습니다. Spring MVC는 DispatcherServlet이 모든 요청을 받아서 공통 처리 후 적절한 Controller로 위임합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Servlet 생명주기&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyServlet&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServlet&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServletConfig&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 1. 초기화 (서버 시작 시 또는 첫 요청 시)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doGet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 2. 서비스 (요청마다 호출)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 3. 소멸 (서버 종료 시)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;주의&lt;/strong&gt;: Servlet은 기본적으로 &lt;strong&gt;싱글톤&lt;/strong&gt;입니다. 멀티 스레드 환경에서 동일 인스턴스를 공유하므로 Thread-Safe하게 작성해야 합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 잘못된 예: 인스턴스 변수 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BadServlet&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServlet&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 여러 스레드가 공유 - Race Condition&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doGet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 동시성 이슈&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 올바른 예: 로컬 변수 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GoodServlet&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServlet&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doGet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 각 스레드마다 독립적&lt;/span&gt;
        count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;ClassLoader 계층 구조&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Bootstrap ClassLoader (JRE)
    ↓
System ClassLoader (CLASSPATH)
    ↓
Common ClassLoader (tomcat/lib/*.jar)
    ↓
WebApp ClassLoader (/WEB-INF/lib/*.jar, /WEB-INF/classes)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;과거: 하나의 Tomcat에 여러 앱&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;webapps/app1
├── WEB-INF/lib/jackson-2.13.jar   ← App1은 2.13 사용

webapps/app2
├── WEB-INF/lib/jackson-2.15.jar   ← App2는 2.15 사용

→ 같은 Tomcat에서 버전 충돌 없이 동작&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ClassLoader 격리 덕분에 하나의 Tomcat에서 여러 앱이 서로 다른 라이브러리 버전을 사용할 수 있었습니다.&lt;/p&gt;
&lt;h4&gt;현재: 컨테이너당 앱 하나&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Pod1 (Tomcat + App1)
├── jackson-2.13.jar

Pod2 (Tomcat + App2)
├── jackson-2.15.jar

→ 애초에 프로세스가 분리되어 ClassLoader 격리 불필요&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;컨테이너/Pod 환경에서는 앱마다 별도 Tomcat을 띄우므로 ClassLoader 격리 기능이 의미가 없어졌습니다. Spring Boot의 embedded Tomcat도 앱 하나만 실행하므로 마찬가지입니다.&lt;/p&gt;
&lt;h2&gt;요약&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Tomcat은 &lt;strong&gt;Coyote&lt;/strong&gt;(Connector)와 &lt;strong&gt;Catalina&lt;/strong&gt;(Container) 두 부분으로 구성됩니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NIO Connector&lt;/strong&gt;가 Spring Boot 기본값이며 대부분의 경우 충분합니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maxConnections&lt;/strong&gt;는 연결 수, &lt;strong&gt;maxThreads&lt;/strong&gt;는 동시 처리 수를 의미합니다.&lt;/li&gt;
&lt;li&gt;Container 계층은 &lt;strong&gt;Engine → Host → Context → Wrapper&lt;/strong&gt; 순서로 요청을 처리합니다.&lt;/li&gt;
&lt;li&gt;Servlet은 싱글톤이므로 &lt;strong&gt;Thread-Safe&lt;/strong&gt;하게 작성해야 합니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;다음 포스트에서는 Tomcat의 요청 처리 흐름과 Thread 모델을 상세히 알아보겠습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[DB와 Cache 사이의 일관성 관리 전략]]></title><description><![CDATA[들어가며 캐시는 DB 부하를 줄이고 응답 속도를 높이는 핵심 기술입니다. 하지만 같은 데이터가 두 곳(DB, Cache…]]></description><link>https://gotobill.github.io/db-cache-consistency/</link><guid isPermaLink="false">https://gotobill.github.io/db-cache-consistency/</guid><pubDate>Tue, 02 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;들어가며&lt;/h2&gt;
&lt;p&gt;캐시는 DB 부하를 줄이고 응답 속도를 높이는 핵심 기술입니다. 하지만 &lt;strong&gt;같은 데이터가 두 곳(DB, Cache)에 존재&lt;/strong&gt;하기 때문에 일관성 문제가 발생합니다.&lt;/p&gt;
&lt;p&gt;이 글에서는 캐시 전략별 특징과 일관성 문제, 그리고 해결 방법을 알아봅니다.&lt;/p&gt;
&lt;h2&gt;캐시 전략 개요&lt;/h2&gt;
&lt;h3&gt;1. Cache-Aside (Lazy Loading)&lt;/h3&gt;
&lt;p&gt;가장 널리 사용되는 패턴입니다. &lt;strong&gt;애플리케이션이 캐시와 DB를 직접 관리&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/711e5dcb9d50a91fd25e204faee20601/0486e/cache.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACLElEQVR42nWTS47UMBiE5xjQmthO4nTiJM6r00m7m2nQ9AhpxGZYzAo2XAFOwRkQ9+B2Rdmeh4TEomTH+v25/keuRNZA6DaqtFB1D1l0QarsIVSLzcYgFRYmG4JqqtMTLFXnY5DJJ0jZ4ypfZmhHrTPKWwfz6QbFaUHhFmzPDlk74e0bg74YcTE7fCh3uKsXPI4nPHRH3JoFl3rFpTkgS0dcJaJBIunyWfyWdCWVpehUWlxfN2Et6KLQM1LFLNTA+BFKjcjpUGcT9wOBSQ2ZGIJqCF4MEl7x7BkomHJtjxgHh65hqizHOlgcpoHACRmBqXcoeWlDJ0K0ULpDagaojKtySDPHVz2QjmWHstqjtSeY7hazu8dh71BXI0F9gAZgmvX4Uhq0uke2rqjuTtD7I94ff+HsfvOhLgD9JZ9qXjqU9g7blqpPqOoz8vQMrdcI9A5OFWuT90joUiRtqMtgf2BovwdnSTgbeGGI9WMZ4tqgNl9xf/kDW39jTMOUZYskZcoM8oGK6SvZhWAv7yxJ7Aswpwuz3dPAzH2PpnrAfvwJU35miboIlKJ9gj0B+fqLI8oDA6zgaJULnDng0DjY3oW6+ke13rExswfaf2ARGGpGiAdLX8d0wkcz4rHqUHH+2vmI6t0Z5eEGulgI3L8C/weLGkNjFNe2WjHQmeYwZ/mOnZ1RbCNM6yUC/bj4GYvqQhP8L+Tl3XkJ0YdGeaii05T7LPUpxjS98jw6/AtU+2TdGgrSiAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;캐시어사이드 전략&quot;
        title=&quot;&quot;
        src=&quot;/static/711e5dcb9d50a91fd25e204faee20601/f058b/cache.png&quot;
        srcset=&quot;/static/711e5dcb9d50a91fd25e204faee20601/c26ae/cache.png 158w,
/static/711e5dcb9d50a91fd25e204faee20601/6bdcf/cache.png 315w,
/static/711e5dcb9d50a91fd25e204faee20601/f058b/cache.png 630w,
/static/711e5dcb9d50a91fd25e204faee20601/40601/cache.png 945w,
/static/711e5dcb9d50a91fd25e204faee20601/78612/cache.png 1260w,
/static/711e5dcb9d50a91fd25e204faee20601/0486e/cache.png 2008w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CacheAsideService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 1. 캐시 조회&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; cached &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cached &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cached&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Cache Hit&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 2. Cache Miss - DB 조회&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 3. 캐시에 저장&lt;/span&gt;
        cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofMinutes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 1. DB 업데이트&lt;/span&gt;
        userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 2. 캐시 삭제 (무효화)&lt;/span&gt;
        cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;구현이 단순함&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;읽기가 많은 워크로드에 효과적&lt;/li&gt;
&lt;li&gt;필요한 데이터만 캐싱 (Lazy)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;단점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;첫 조회 시 &lt;strong&gt;Cache Miss로 지연 발생&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;캐시 삭제와 DB 업데이트 사이에 불일치 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. Write-Through&lt;/h3&gt;
&lt;p&gt;쓰기 시 &lt;strong&gt;캐시와 DB를 동시에 업데이트&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b687a776caf9760d9d8156e8811d01d/393aa/write-through.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKUlEQVR42o2UzW4TMRSF8x4hHtvz0/n3/E+TAKERUrspYkmfAgkJdcuODRJIrHkH1rDmuQ732jNp1AHE4sgZJ/7m3Huus/K8HEqV0CRe+fkkWdDqJGUJqSbxZ2mslJpVWa20XyGNe0TpFnE6QllIbiHiCa0id4AN7a/peU1wbwk6AX0CXjRXOOy3MOVoD1tXokDQj/Czxu6FwyWS6wPi43PoqKYXlwuYUjVWAQHj8imGukeZ9VSmcSWSVFghqHqE3YigGaDTll7QQQd0WC5hWhOQy0uo5IKg2q+nfk09Y6dUqiKAbwYLV5rKlMtSGXYCMoQDEbZfE2wW9Yl7JkUJP25I7Zk7Kl2Ra78ntTPQpShEsYRNSdo02RmHcYIZglDf83cw6Qe05ScK9+4B+E/YIs3a7oXBFfrqC17ffsfN8QeK5K0D/g9Mk6R00rohMfCIy+Ybbm9+4vrwCyZ774A8Alr+eWD15Ep4FSJKPeaRsYnSBPg71Pk96uwj+vIzsvgNj02NkIZaZztcJKM9fO6MQT4drjKDzjCkpqDqyaWTC6UjNViJsMNdWuBrvMazpIPgHyk3tBaUG+w6UmvQlBU1n5029P0MbG3CDthiJaMer6IC92KDPh2gfNdw7tWeQFXuXI1NhePW4OWeryrdHjW7a8/U0dUjF1G2R1i9QBQPtjdzmgz1JJVHJUpahddg4z24ewyzQM8rrQP+g3h8AxjkTzfAAizk7zAG/gb5Vr86t6oKlgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;wirte-through&quot;
        title=&quot;&quot;
        src=&quot;/static/0b687a776caf9760d9d8156e8811d01d/f058b/write-through.png&quot;
        srcset=&quot;/static/0b687a776caf9760d9d8156e8811d01d/c26ae/write-through.png 158w,
/static/0b687a776caf9760d9d8156e8811d01d/6bdcf/write-through.png 315w,
/static/0b687a776caf9760d9d8156e8811d01d/f058b/write-through.png 630w,
/static/0b687a776caf9760d9d8156e8811d01d/40601/write-through.png 945w,
/static/0b687a776caf9760d9d8156e8811d01d/393aa/write-through.png 1190w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WriteThroughService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 캐시와 DB 동시 업데이트 (트랜잭션 내에서)&lt;/span&gt;
        cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;캐시가 항상 최신 상태&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;읽기 시 Cache Miss 감소&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;단점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;쓰기 지연 증가&lt;/strong&gt; (캐시 + DB 둘 다 기다림)&lt;/li&gt;
&lt;li&gt;사용되지 않는 데이터도 캐싱될 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. Write-Behind (Write-Back)&lt;/h3&gt;
&lt;p&gt;쓰기를 &lt;strong&gt;캐시에만 먼저&lt;/strong&gt; 하고, &lt;strong&gt;DB 반영은 비동기로&lt;/strong&gt; 처리합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/750774d33a354b3673692a2baed7e66a/bb051/write-behind.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACBElEQVR42p2TTY7TQBSEfQ2kxG7/xT9tu9sdx07GEyCMRggOABILpFkhwYYzsOECiCUrdiyQWMPZinLbCZNEiIhFKUrL/lz16rUj/ApBoBAGFYQo4XnFpPKg4VyI6kQKvr+XPsjJ0gZJ2iGVPeKohuvKE9g56A9Mn6iGExZbtP1DbNsOfmjgucV/w4KAwIXcQOk1WtUgjAwdFhfA1BHI9w1hZgRGoSbw2sa+zNl9GM/ZgT/JAr25RFy3COLaxr0cpglYYxHfIlk85fx3/L+E484kREZYVBFYXjiz2jqT2R1W+hM6/QVd/RlRtIUzb/nA4wZebyC6JbwZXfrqHwVwXjyX6Vs8v/2GVy9/4mr5lS5vCOSa+LkeHR727RgmKNebYto2B2AJJd/j0foHbvpf2K6+E/gEjmDMKOcDEV90z2F7kCkV4w0XYFyPINBI4mcosjcos3f8vUMYdnDitIWQV4RuOAPuoVdZmCcGaVRScT6KLzCFx8WnRqixUNtwMN22kKWsswYfc4HXWQE3Zts2skaWaFw3CjWdKamxWWrs1hp9M7g2fNnYVsOwuScC22yFD/MHeLFg20l3BEwXGjO3Rp7WdEmo0VgqboQYF3kAHKvhTeFCJ3qHpOgR8atianKAemKcl/DHqHPXWHdj3HOYBQ4FyLxjQ2Yq4/hu7hUG+5h/hw3A33wWvvFU4KVdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;롸이트 비하인드&quot;
        title=&quot;&quot;
        src=&quot;/static/750774d33a354b3673692a2baed7e66a/f058b/write-behind.png&quot;
        srcset=&quot;/static/750774d33a354b3673692a2baed7e66a/c26ae/write-behind.png 158w,
/static/750774d33a354b3673692a2baed7e66a/6bdcf/write-behind.png 315w,
/static/750774d33a354b3673692a2baed7e66a/f058b/write-behind.png 630w,
/static/750774d33a354b3673692a2baed7e66a/40601/write-behind.png 945w,
/static/750774d33a354b3673692a2baed7e66a/bb051/write-behind.png 1212w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WriteBehindService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WriteEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; writeQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConcurrentLinkedQueue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 1. 캐시에만 즉시 저장&lt;/span&gt;
        cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 2. 쓰기 큐에 추가 (비동기 처리)&lt;/span&gt;
        writeQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WriteEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Scheduled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fixedRate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;flushToDatabase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WriteEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; batch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;drainQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;batch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;batchUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;batch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;쓰기 응답 속도 매우 빠름&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;DB 부하 감소 (배치 처리)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;단점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;캐시 장애 시 데이터 유실 위험&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;복잡한 구현&lt;/li&gt;
&lt;li&gt;일관성 보장 어려움&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4. Read-Through&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;캐시가 DB 조회까지 담당&lt;/strong&gt;합니다. 애플리케이션은 캐시만 바라봅니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ef06a772239b44dafec0a49fbd5e9449/e72de/read-through.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVR42pWTu44TMRiF8wrUkLnYc8/MeMZzSzaz2bBEIBEpoqCAgpqOkooXoKbaHvqV6BFvdjj2JtksWiRSHNlj2Z99/v/MxPdLRFGDMGzt6HkFXDeniqPMmueVJ1JWvm9UPdBEyApZvoCql5jl8z3wf2F/A2tMJIFxe43rZY+67AlRJ7DyLJgQBBrLWTYgn81pubUHz4PVlCZM3wGdaYYw7pFXz+E4+dkv8/gthFkrOFYGmMIjOcguMX0accMjsEctKgTBJYrsE2bxZ1T5F0ThSwLdEiJbI6xfQyTjPYjr7pSvnXLuFPB5u+9RrrI2zZ443GLR3mC3vcX64ifS+P0emL8gcAs/vjgC/UgjKDsEqqV6XkBrXJNJQzDrJgxwh7H/gbdvfmEz/kYWf7irobk9ShZwrGVlD4ftgHSzQnI1Inu1hqwGBN0CMm0hbEcVLW7QlF+hZ98w1DdI4h1zyJrJeICbjpCB5u37BvDlRsIACMvqDkPFzEb3ERGigZQ9azm3o5QNgfxDVnmHd0WJOmOwbQyUBftqQNL0aAnSuWlCjal7gOmjDOigybOox8cownf3CZasj2M2GdtsQKsUBlWykxUtVRi7ClcDyxPqY/ZOYVK2mARhg1k6h2IWk2xhs3SIRkmQywZIvqhTFeaaYF0jNKV5BGaBLusUE1ZWqwcwI+dor+Zc065m+P8NM8A/Vhyjof7wMeEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;리드 쓰로우&quot;
        title=&quot;&quot;
        src=&quot;/static/ef06a772239b44dafec0a49fbd5e9449/f058b/read-through.png&quot;
        srcset=&quot;/static/ef06a772239b44dafec0a49fbd5e9449/c26ae/read-through.png 158w,
/static/ef06a772239b44dafec0a49fbd5e9449/6bdcf/read-through.png 315w,
/static/ef06a772239b44dafec0a49fbd5e9449/f058b/read-through.png 630w,
/static/ef06a772239b44dafec0a49fbd5e9449/40601/read-through.png 945w,
/static/ef06a772239b44dafec0a49fbd5e9449/e72de/read-through.png 1198w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Spring Cache 추상화가 Read-Through 패턴&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Cacheable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;#userId&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Cache Miss 시에만 실행됨&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;일관성 문제 시나리오&lt;/h2&gt;
&lt;h3&gt;문제 1: Race Condition - 동시 읽기/쓰기&lt;/h3&gt;
&lt;p&gt;두 요청이 거의 동시에 발생할 때 &lt;strong&gt;캐시에 오래된 데이터가 남을 수 있습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0787c65d09c75880907d6e3f7e11d98b/10d53/race-condition.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABq0lEQVR42k2SyZLbIBRF/RueJARqDUgIEGiyM1QllaS9SmfnLPL/n3FzJac7vTgF6BVHlwe7w77AKbV46n9CmRuSbIDwHmoeocYRclzHCZmJEFUPoR9kOiCrA5JzB8laHieckw67w77kxEB3H1E2VwjpIYyDjAMyHwlHGzdJWrOm/ZtU1D3OFGacq254CPeHGkqU+DYX+DyUqPMKCQXyskBOMxMynR8po6AJJP5Hxy2hsPzpMFNoH0IpKnwaNBbfoMw1bKMx2ga6bN9o6hXzjm4jocRkHkHxBKvwsAlrLH2LoTMoVIvIDdeuQ189CLV9h9sYtINnCxIes6HQvQqPxwpHEZCPd0j/AlFc8UsP+NNdcG9n3M2Cl3rCj6eAWzHgmdzKf1QT0tTByoD5iS1IHHbqpKFODQrhUPC283MLy0sKnAflNnzm4IglvXocb8WTdV8tPDRJV+GYGkQSKBmExaWIWL58wHRdMHE9SYepHPGVyX43Ey6yxzMTf2e6mPWsr4SNgtKdSVq0G2ajo8TyGVi+OZt2sFw79ihSfMn7La3nuqdo/W4pfUUJj7/WXBBh7R4p1gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;캐시-레이스-컨디션&quot;
        title=&quot;&quot;
        src=&quot;/static/0787c65d09c75880907d6e3f7e11d98b/f058b/race-condition.png&quot;
        srcset=&quot;/static/0787c65d09c75880907d6e3f7e11d98b/c26ae/race-condition.png 158w,
/static/0787c65d09c75880907d6e3f7e11d98b/6bdcf/race-condition.png 315w,
/static/0787c65d09c75880907d6e3f7e11d98b/f058b/race-condition.png 630w,
/static/0787c65d09c75880907d6e3f7e11d98b/40601/race-condition.png 945w,
/static/0787c65d09c75880907d6e3f7e11d98b/78612/race-condition.png 1260w,
/static/0787c65d09c75880907d6e3f7e11d98b/10d53/race-condition.png 1724w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[시간 순서]
T1: Thread A가 DB 조회 시작 (name: &quot;old&quot; 읽음)
T2: Thread B가 DB 업데이트 (name: &quot;new&quot;)
T3: Thread B가 캐시 삭제
T4: Thread A가 캐시에 저장 (name: &quot;old&quot;)  &amp;lt;-- 문제!

결과: DB는 &quot;new&quot;, 캐시는 &quot;old&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;문제 2: 캐시 삭제 실패&lt;/h3&gt;
&lt;p&gt;DB는 업데이트됐는데 &lt;strong&gt;캐시 삭제가 실패하면 불일치가 발생&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 성공&lt;/span&gt;

    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 실패! (네트워크 오류 등)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// DB는 변경됐는데 캐시에는 이전 데이터가 남아있음&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;문제 3: DB 트랜잭션 롤백&lt;/h3&gt;
&lt;p&gt;캐시는 업데이트됐는데 &lt;strong&gt;DB 트랜잭션이 롤백&lt;/strong&gt;되는 경우입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newUser&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 캐시 먼저 업데이트&lt;/span&gt;

    userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// DB 업데이트&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 이후 로직에서 예외 발생 -&gt; 롤백&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// DB는 롤백되지만 캐시는 이미 변경됨&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;someRiskyOperation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;해결 전략&lt;/h2&gt;
&lt;h3&gt;전략 1: Cache Invalidation (삭제)&lt;/h3&gt;
&lt;p&gt;Cache-Aside 패턴에서 **&quot;DB 업데이트 후 캐시 삭제&quot;**는 표준적인 베스트 프랙티스입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 캐시 삭제 &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 삭제&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;삭제 방식의 장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Race Condition 발생 확률 감소&lt;/li&gt;
&lt;li&gt;다음 조회 시 자연스럽게 최신 데이터 로드&lt;/li&gt;
&lt;li&gt;불필요한 캐시 갱신 방지&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;갱신 방식의 고려사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;캐시 갱신 시점에 또 다른 Race Condition 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;전략 2: Double Delete 패턴&lt;/h3&gt;
&lt;p&gt;Race Condition을 줄이기 위해 &lt;strong&gt;캐시를 두 번 삭제&lt;/strong&gt;하는 보조 전략입니다.&lt;/p&gt;
&lt;!-- [다이어그램 6: Double Delete 패턴]
1. 캐시 삭제 (1차)
2. DB 업데이트
3. 짧은 대기 (500ms)
4. 캐시 삭제 (2차) - 그 사이 잘못 저장된 캐시 제거
--&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 1. 먼저 캐시 삭제&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 2. DB 업데이트&lt;/span&gt;
    userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 3. 지연 후 한 번 더 삭제 (비동기)&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;CompletableFuture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;runAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// DB 복제 지연 + 진행 중인 읽기 완료 대기&lt;/span&gt;
            cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interrupt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작 원리&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;첫 번째 삭제: 기존 캐시 제거&lt;/li&gt;
&lt;li&gt;DB 업데이트 실행&lt;/li&gt;
&lt;li&gt;두 번째 삭제: 그 사이 Race Condition으로 저장된 오래된 캐시 제거&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;500ms 같은 고정 지연 시간은 &lt;strong&gt;DB 복제 지연&lt;/strong&gt;, 시스템 부하에 따라 효과가 달라짐&lt;/li&gt;
&lt;li&gt;실제 환경에서는 &lt;strong&gt;모니터링 기반으로 적절한 지연 시간을 튜닝&lt;/strong&gt;해야 함&lt;/li&gt;
&lt;li&gt;완벽한 해결책이 아닌 &lt;strong&gt;Race Condition 확률을 줄이는 보조 수단&lt;/strong&gt;으로 활용&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;전략 3: 분산 락을 통한 동시성 제어&lt;/h3&gt;
&lt;p&gt;동시에 같은 데이터를 수정하지 못하도록 &lt;strong&gt;락을 걸어 직렬화&lt;/strong&gt;합니다. &lt;strong&gt;Thundering Herd&lt;/strong&gt; 방지와 동시 갱신 제어에 효과적입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/856fd141eb6c3ebcc60a028cb2fb4204/6b26f/lock.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVR42m2Qy27bMBBF/ROJRL1MvUyREiVXttw0cYIkiy5aFEW6yP//yclQRtEmyOKAL/DOnNno3S329IfS3BNdtajYkCiDitqVJOlQK4Y0dUJPlgWG//DkeWBkk5czencmLw8UdqToPJk86t2dFJH77Z66WNjpO7LUfwj7G3QJWwPjuCWOapRqab6dqE9Hiu1Md/yNXV7Q9UKvH5mbX+vHzwPHf4FR3HEVWSJlRbUTrGgJQVHIRDPJRDWz0vnwrqOiuHDZT2zFZrN3jh8PjsPguJbgWAKVcrL2KyqQ9DJL6SgdSOUc1PPQqRTLZKYhMBQLbNrKMlmHaRxd63CmXxndQG8uDNZjW09RTlTTwraZKJsbGvdM1d2j9YG+fsJU5zBDUb4W3cSyHwZmP3AYPQ8nz9e9Zx5HjtPI5Ca0mTGPZyo709gn+ptXui8/qaqFpXvBt995A31cyZmJZMWkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;분산락&quot;
        title=&quot;&quot;
        src=&quot;/static/856fd141eb6c3ebcc60a028cb2fb4204/f058b/lock.png&quot;
        srcset=&quot;/static/856fd141eb6c3ebcc60a028cb2fb4204/c26ae/lock.png 158w,
/static/856fd141eb6c3ebcc60a028cb2fb4204/6bdcf/lock.png 315w,
/static/856fd141eb6c3ebcc60a028cb2fb4204/f058b/lock.png 630w,
/static/856fd141eb6c3ebcc60a028cb2fb4204/40601/lock.png 945w,
/static/856fd141eb6c3ebcc60a028cb2fb4204/78612/lock.png 1260w,
/static/856fd141eb6c3ebcc60a028cb2fb4204/6b26f/lock.png 1658w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserServiceWithLock&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RedissonClient&lt;/span&gt; redisson&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; lockKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lock:user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;RLock&lt;/span&gt; lock &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; redisson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lockKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 락 획득 (최대 10초 대기, 락 유지 30초)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tryLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConcurrentModificationException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;락 획득 실패&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isHeldByCurrentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; cached &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cached &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cached&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Cache Miss 시에도 락 사용 (Thundering Herd 방지)&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; lockKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lock:user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;RLock&lt;/span&gt; lock &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; redisson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lockKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tryLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// Double Check&lt;/span&gt;
                cached &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cached &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cached&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofMinutes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isHeldByCurrentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                lock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 락 획득 실패 시 DB 직접 조회&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;적용 범위 고려&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;모든 읽기에 락을 걸면 성능이 크게 저하됨&lt;/li&gt;
&lt;li&gt;**&quot;쓰기 작업&quot;**이나 &lt;strong&gt;&quot;Cache Miss 시에만&quot;&lt;/strong&gt; 락을 거는 것이 일반적&lt;/li&gt;
&lt;li&gt;특정 &lt;strong&gt;핫키&lt;/strong&gt;(자주 접근되는 데이터)에만 선별적으로 적용하는 것을 권장&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;전략 4: Lease 기반 낙관적 동시성 제어&lt;/h3&gt;
&lt;p&gt;분산 락이 &lt;strong&gt;비관적&lt;/strong&gt;(미리 잠금) 방식이라면, &lt;strong&gt;Lease&lt;/strong&gt;는 &lt;strong&gt;낙관적&lt;/strong&gt;(저장 시점에 검증) 방식입니다. Cache Miss 시 토큰을 발급받고, 저장 시 토큰이 유효한 경우에만 저장을 허용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Lease 동작 원리]

T1: Thread A가 캐시 조회 → Cache Miss → Lease Token #1 발급
T2: Thread B가 DB 업데이트 (name: &quot;new&quot;)
T3: Thread B가 캐시 삭제 → Lease Token #1 무효화
T4: Thread A가 캐시 저장 시도 (Token #1) → 토큰 무효 → 저장 거부

결과: DB &quot;new&quot;, 캐시 비어있음 → 다음 조회 시 최신 데이터 로드&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 1. 캐시 조회 시 lease token 함께 발급&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;LeaseResult&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWithLease&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Cache Hit&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 2. Cache Miss - DB 조회&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 3. lease token과 함께 저장 시도&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 토큰이 무효화됐으면 저장 실패 (다른 쓰기가 있었다는 의미)&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;putIfLeaseValid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLeaseToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lease는 Facebook이 Memcached에서 &lt;strong&gt;Stale Sets&lt;/strong&gt;와 &lt;strong&gt;Thundering Herd&lt;/strong&gt; 문제를 해결하기 위해 도입한 메커니즘입니다. 자세한 내용은 &lt;a href=&quot;/cache-part1/#%EB%B6%80%ED%95%98-%EA%B0%90%EC%86%8C-leases-%EB%A9%94%EC%BB%A4%EB%8B%88%EC%A6%98&quot;&gt;Facebook의 대규모 Memcached 운영 전략&lt;/a&gt;에서 확인할 수 있습니다.&lt;/p&gt;
&lt;h3&gt;전략 5: 트랜잭션 커밋 후 캐시 처리&lt;/h3&gt;
&lt;p&gt;DB 트랜잭션이 &lt;strong&gt;확실히 커밋된 후에 캐시를 처리&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TransactionAwareCacheService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 트랜잭션 커밋 후에 캐시 삭제 실행&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;TransactionSynchronizationManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerSynchronization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TransactionSynchronization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;afterCommit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 또는 이벤트 기반으로&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApplicationEventPublisher&lt;/span&gt; eventPublisher&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 트랜잭션 커밋 후 이벤트 발행&lt;/span&gt;
        eventPublisher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;publishEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserUpdatedEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CacheInvalidationListener&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@TransactionalEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;phase &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TransactionPhase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;AFTER_COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleUserUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UserUpdatedEvent&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;전략 6: CDC 기반 캐시 동기화&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Change Data Capture&lt;/strong&gt;를 통해 DB 변경을 감지하고 캐시를 동기화합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b9c57795e85d7ff4bbf2b56f11c38ada/d698c/cdc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAv0lEQVR42h2OS1LDMBAFfQqIZVuWIv8lC9kugiG5AjvKxSIbFnD/GzRTWcxipl9Nv8zaSFEM5MWI6nZUu5PnA5UOuGZBVwGlJrx/Z5qEK09rAkvjiS4Ij5g6EdsNZ1eylC4Y7SnMQnU7KK9flGXg7BKTf8PK/XQauN//OI4fnp5HPsaZ79fAZ5KceaFzG7/9SGw2srZdpKG0UyO6jo9RxYTWM113oZb9ITivWCvSaqYW5uSJNUly0lCkfb9j7Mo/x29YxvInQ1UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cdc&quot;
        title=&quot;&quot;
        src=&quot;/static/b9c57795e85d7ff4bbf2b56f11c38ada/f058b/cdc.png&quot;
        srcset=&quot;/static/b9c57795e85d7ff4bbf2b56f11c38ada/c26ae/cdc.png 158w,
/static/b9c57795e85d7ff4bbf2b56f11c38ada/6bdcf/cdc.png 315w,
/static/b9c57795e85d7ff4bbf2b56f11c38ada/f058b/cdc.png 630w,
/static/b9c57795e85d7ff4bbf2b56f11c38ada/40601/cdc.png 945w,
/static/b9c57795e85d7ff4bbf2b56f11c38ada/78612/cdc.png 1260w,
/static/b9c57795e85d7ff4bbf2b56f11c38ada/d698c/cdc.png 1846w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[CDC 아키텍처]
MySQL Binlog --&gt; Debezium --&gt; Kafka --&gt; Consumer --&gt; Redis Cache

장점:
- 애플리케이션 코드에서 캐시 로직 분리
- DB 변경은 무조건 캐시에 반영됨
- 여러 서비스가 같은 데이터를 캐싱해도 일관성 유지

단점:
- 인프라 복잡도 증가 (Debezium, Kafka 운영 필요)
- 이벤트 처리 지연 발생 가능
- 운영/모니터링 부담 증가&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;전략 7: TTL 기반 최종 일관성&lt;/h3&gt;
&lt;p&gt;완벽한 즉시 일관성 대신 TTL을 통해 **&quot;일정 시간 내 수렴&quot;**하는 &lt;strong&gt;최종 일관성&lt;/strong&gt;(Eventual Consistency)을 보장합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2fc36ff38bd0da2e48bded7a117187e8/49ee2/ttl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEUlEQVR42lXS7W6bMBQGYO5iSwkBmw/jALb5JgkEuq1JW1WTMm3a7v9G3h3cbut+PHqPhbDNOTiuJ5Hu9hi5whhqTKEhGvexwRwZypKyRO0XqCxlNUTQczYeodIaF9FCBBqOu5WQfoZFFFhShXsyrylp80RhEhpnYdBHCp2l0ccaA2WaGPB5hJEtHkWDdN2Q8xJZKvG0CFzPEp9PEpdpb53aDK3J0JUZ+iq3hnpV4EC1LAzCy4ymaHGjTffrhpuNgL/NIVgJ7u/B/JwyR7hmULxRRCNkGhEzf7GgAgsbqhskQUvvVnA+fIzAvZauO2OzkXDvcrhuAW+r6SAD36tIjYCwXUNa8F1HekT+gNg9IPVn6t+CODjB2dnb1NDsAVX4DMUvKKMnFOwTHTJBBmfsGeHzK7bmQrkgjDtE0wE8a5BnBzBu4Hg04YgNMOIFJn2BEs8o0682s/iCXFyRJxeqH6y1tuIrInFEsoxI1IBMHcFD+mR/7VV6Qnr4DtHdkA6U/Tda/8D++JP8QtreEOsreURi3ugnhGqEpKGIeUJ2+0I3bWkodyn1LMPWVdjeEVfD80rqoXmnxM77o/pnZ4h+tdV27XCaVpDQBLsWYU/NNtT8ogJX9X9C3bxprYisvYuHE6KKBjOfwehfdCL6biZLxPOR0MO+R1jSS1VnRfV7vRU3g8Xp/0vGCXF3gryfqXUtfgO7H08nX74wfQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ttl&quot;
        title=&quot;&quot;
        src=&quot;/static/2fc36ff38bd0da2e48bded7a117187e8/f058b/ttl.png&quot;
        srcset=&quot;/static/2fc36ff38bd0da2e48bded7a117187e8/c26ae/ttl.png 158w,
/static/2fc36ff38bd0da2e48bded7a117187e8/6bdcf/ttl.png 315w,
/static/2fc36ff38bd0da2e48bded7a117187e8/f058b/ttl.png 630w,
/static/2fc36ff38bd0da2e48bded7a117187e8/40601/ttl.png 945w,
/static/2fc36ff38bd0da2e48bded7a117187e8/78612/ttl.png 1260w,
/static/2fc36ff38bd0da2e48bded7a117187e8/49ee2/ttl.png 1618w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; cacheKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; cached &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cached &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cached&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 짧은 TTL 설정 - 불일치가 있어도 금방 해소됨&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cacheKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofMinutes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Master-Slave DB 복제 환경에서의 일관성 관리]]></title><description><![CDATA[들어가며 대규모 서비스에서는 읽기 부하 분산을 위해 Master-Slave(Primary-Replica…]]></description><link>https://gotobill.github.io/db-replication-consistency/</link><guid isPermaLink="false">https://gotobill.github.io/db-replication-consistency/</guid><pubDate>Tue, 02 Dec 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;들어가며&lt;/h2&gt;
&lt;p&gt;대규모 서비스에서는 읽기 부하 분산을 위해 Master-Slave(Primary-Replica) 복제 구조를 사용합니다. 하지만 복제는 즉시 이루어지지 않기 때문에 &lt;strong&gt;데이터 일관성 문제&lt;/strong&gt;가 발생할 수 있습니다.&lt;/p&gt;
&lt;p&gt;이 글에서는 복제 지연이 왜 발생하는지, 어떤 문제를 일으키는지, 그리고 어떻게 해결하는지 알아봅니다.&lt;/p&gt;
&lt;h2&gt;Master-Slave 복제 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a5c13a15209167b8c8194ae9bb7fe972/2e367/master-slave-structure.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVR42pWSjW6bMBSF8/5v1TeotG6l0VbShFECxIAB47/rs2uTJpnWrqoly+jKPnzn3LvBJ0trDaVUOud5hvf+v/c3nwmO44iyLLHf75HneRKOK4TwBcF4+fxgkhJ1XaOqqiSstblc+TJhMAZummCshXMOxlhMi/tQ7F3BKGKyDMv9PXzbXlDeRHbtgsdyQtEtILoqh38Ezy8c2zLbLVxRwL2+pno47/g9G492tDgI/S7p5k0sktEwwDfNRwGsXbcEx2RVr9FKjcV6zNrDeroKBh4FL0Ta1HUgzu3SmAtGAKkagxwRB6c5CXzPtvwDD+0II2d7JSRKedndLlkOPHer0FmMPDuQfDr0yiXLZafwUktUg0EjLZPeErIgzYofzQg8Z9H+Wreg8QDqf3G9R5iPkDyXcZ1Eh+yJs/bR7prtTYY+EdHwm7uiE0kqzzXo9Mj1HduNHScMTHiUBvuTwvNRohALaqZUfxHaCb7P4Q53IJGxUMMRsFD3k8VyJnxmwoFdrITxad0KPPx44vx4PjnDSfvbpmi2VnCHvyV7tIhUi0Rg2/BmpSbDTXBQhiCVZVqTrCqz2o6CfwAaGfjIAx7kxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;마스터-슬레이브 복제 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/a5c13a15209167b8c8194ae9bb7fe972/f058b/master-slave-structure.png&quot;
        srcset=&quot;/static/a5c13a15209167b8c8194ae9bb7fe972/c26ae/master-slave-structure.png 158w,
/static/a5c13a15209167b8c8194ae9bb7fe972/6bdcf/master-slave-structure.png 315w,
/static/a5c13a15209167b8c8194ae9bb7fe972/f058b/master-slave-structure.png 630w,
/static/a5c13a15209167b8c8194ae9bb7fe972/40601/master-slave-structure.png 945w,
/static/a5c13a15209167b8c8194ae9bb7fe972/2e367/master-slave-structure.png 1066w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;비동기 복제의 동작 방식&lt;/h3&gt;
&lt;p&gt;MySQL의 기본 복제는 &lt;strong&gt;비동기(Asynchronous)&lt;/strong&gt; 방식입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[비동기 복제 흐름]
1. Client가 Master에 INSERT 실행
2. Master가 Binlog에 기록
3. Master가 Client에 즉시 응답 (커밋 완료)
4. Slave가 Binlog를 가져와서 Relay Log에 저장
5. Slave가 Relay Log를 실행하여 데이터 반영&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3번과 5번 사이에 시간 차이가 발생하는데, 이것이 &lt;strong&gt;Replication Lag&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h2&gt;복제 지연이 일으키는 문제&lt;/h2&gt;
&lt;h3&gt;1. Read-Your-Writes 불일치&lt;/h3&gt;
&lt;p&gt;가장 흔한 문제입니다. 사용자가 데이터를 저장한 직후 조회했는데 반영이 안 된 것처럼 보입니다.&lt;/p&gt;
&lt;!-- [다이어그램 2: Read-Your-Writes 문제]
시간순으로:
1. 사용자 -&gt; Master: 닉네임 변경 (user123 -&gt; newName)
2. Master -&gt; 사용자: 변경 완료!
3. 사용자 -&gt; Slave: 내 프로필 조회
4. Slave -&gt; 사용자: 닉네임: user123 (아직 복제 안됨)
5. 사용자: &quot;???&quot;
--&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 문제 상황 예시&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateAndShow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; newNickname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 1. Master에 쓰기&lt;/span&gt;
    userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateNickname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newNickname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 2. Slave에서 읽기 (복제 지연으로 이전 값이 조회될 수 있음)&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// user.getNickname()이 여전히 이전 값일 수 있음&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;실제 사례&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;회원가입 직후 로그인 시도 시 &quot;존재하지 않는 회원&quot; 오류&lt;/li&gt;
&lt;li&gt;게시글 작성 후 목록에서 안 보임&lt;/li&gt;
&lt;li&gt;결제 완료 후 주문 내역에서 조회 안 됨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. Monotonic Read 불일치&lt;/h3&gt;
&lt;p&gt;같은 데이터를 연속으로 읽었는데 값이 왔다 갔다 하는 현상입니다.&lt;/p&gt;
&lt;!-- [다이어그램 3: Monotonic Read 문제]
Slave1: 복제 완료 (최신 데이터)
Slave2: 복제 지연 (이전 데이터)

1번째 조회 -&gt; Slave1 -&gt; 주문상태: 배송중
2번째 조회 -&gt; Slave2 -&gt; 주문상태: 결제완료 (과거 상태)
3번째 조회 -&gt; Slave1 -&gt; 주문상태: 배송중

사용자 입장에서 상태가 왔다갔다 하는 것처럼 보임
--&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[시나리오]
사용자의 연속 조회:
1번째 조회 --&gt; Slave1 --&gt; 주문상태: &quot;배송중&quot;
2번째 조회 --&gt; Slave2 --&gt; 주문상태: &quot;결제완료&quot; (?)
3번째 조회 --&gt; Slave1 --&gt; 주문상태: &quot;배송중&quot;

Slave 간 복제 진행도가 달라서 발생&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3. 팬텀 데이터&lt;/h3&gt;
&lt;p&gt;트랜잭션 내에서 여러 테이블을 조회할 때, 일부는 최신 데이터고 일부는 과거 데이터인 상황입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 주문과 결제가 동시에 생성되었는데&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt; order &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; orderRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Slave1에서 조회 - 있음&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Payment&lt;/span&gt; payment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; paymentRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findByOrderId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Slave2에서 조회 - 없음&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 주문은 있는데 결제 정보가 없는 비정상 상태로 보임&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;복제 지연 측정&lt;/h2&gt;
&lt;p&gt;문제를 해결하기 전에 현재 지연 상태를 파악해야 합니다.&lt;/p&gt;
&lt;h3&gt;MySQL에서 복제 지연 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Slave에서 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; SLAVE &lt;span class=&quot;token keyword&quot;&gt;STATUS&lt;/span&gt;\G

&lt;span class=&quot;token comment&quot;&gt;-- 주요 확인 항목&lt;/span&gt;
Seconds_Behind_Master: &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- Master 대비 5초 지연&lt;/span&gt;
Slave_IO_Running: Yes
Slave_SQL_Running: Yes&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;해결 전략&lt;/h2&gt;
&lt;h3&gt;1. Read-Your-Writes 보장: 쓰기 후 Master 읽기&lt;/h3&gt;
&lt;p&gt;가장 단순한 방법입니다. &lt;strong&gt;쓰기 직후에는 Master에서 읽습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;!-- [다이어그램 4: 쓰기 후 Master 읽기 전략]
1. Client -&gt; Master: 데이터 쓰기
2. Master -&gt; Client: 완료
3. Client -&gt; Master: 같은 데이터 읽기 (Slave 대신 Master로)
4. Master -&gt; Client: 최신 데이터 반환

일정 시간(예: 3초) 이후에는 다시 Slave에서 읽기
--&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProductService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MasterSlaveRoutingDataSource&lt;/span&gt; dataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringRedisTemplate&lt;/span&gt; redisTemplate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;WRITE_TIME_PREFIX&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;write:product:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;MASTER_READ_DURATION_MS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updatePrice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BigDecimal&lt;/span&gt; newPrice&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Master에 가격 수정&lt;/span&gt;
        productRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updatePrice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;productId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newPrice&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Redis에 최근 쓰기 기록 (모든 인스턴스가 공유)&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;WRITE_TIME_PREFIX&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        redisTemplate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;opsForValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;valueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MASTER_READ_DURATION_MS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readOnly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Product&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getProduct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 최근에 수정된 상품이면 Master에서 읽기&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;shouldReadFromMaster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            dataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setRoutingKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RoutingKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MASTER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; productRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shouldReadFromMaster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;WRITE_TIME_PREFIX&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; redisTemplate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. 세션 기반 Slave 고정&lt;/h3&gt;
&lt;p&gt;같은 세션(사용자)은 항상 같은 Slave에서 읽도록 고정합니다. Monotonic Read 문제를 해결합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;사용자 A의 세션 --&gt; 항상 Slave1
사용자 B의 세션 --&gt; 항상 Slave2
사용자 C의 세션 --&gt; 항상 Slave3

세션 ID를 해싱하여 특정 Slave에 고정&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SessionBasedSlaveRouter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; slaves&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DataSource&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getSlaveForSession&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; sessionId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 세션 ID를 해싱하여 항상 같은 Slave 선택&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sessionId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hashCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; slaves&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; slaves&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3. GTID 기반 동기화 대기&lt;/h3&gt;
&lt;p&gt;MySQL 5.6+에서 지원하는 GTID(Global Transaction ID)를 활용합니다. 특정 트랜잭션까지 복제가 완료될 때까지 대기합니다.&lt;/p&gt;
&lt;!-- [다이어그램 6: GTID 기반 동기화]
1. Client -&gt; Master: INSERT (GTID: uuid:100 발급)
2. Master -&gt; Client: 완료, GTID=uuid:100
3. Client -&gt; Slave: &quot;uuid:100까지 복제됐나요?&quot; (WAIT_FOR_EXECUTED_GTID_SET)
4. Slave: 복제 완료될 때까지 대기...
5. Slave -&gt; Client: 준비됨
6. Client -&gt; Slave: SELECT 실행
--&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GtidAwareService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JdbcTemplate&lt;/span&gt; masterJdbc&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JdbcTemplate&lt;/span&gt; slaveJdbc&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;writeAndReadConsistently&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 1. Master에 쓰기&lt;/span&gt;
        masterJdbc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;INSERT INTO ...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 2. 현재 GTID 위치 확인&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; gtid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; masterJdbc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryForObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;SELECT @@GLOBAL.gtid_executed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 3. Slave가 해당 GTID까지 복제 완료할 때까지 대기&lt;/span&gt;
        slaveJdbc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryForObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;SELECT WAIT_FOR_EXECUTED_GTID_SET(?, ?)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            gtid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 최대 5초 대기&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 4. 이제 Slave에서 읽어도 일관성 보장&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; slaveJdbc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryForObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;SELECT ...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;대기 시간이 길어지면 응답 지연 발생&lt;/li&gt;
&lt;li&gt;타임아웃 설정 필수&lt;/li&gt;
&lt;li&gt;모든 쿼리에 적용하면 성능 저하&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4. Semi-Synchronous Replication&lt;/h3&gt;
&lt;p&gt;MySQL 설정 레벨에서 최소 1개 Slave에 복제가 완료된 후에 커밋을 확정합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Master 설정&lt;/span&gt;
INSTALL PLUGIN rpl_semi_sync_master &lt;span class=&quot;token keyword&quot;&gt;SONAME&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;semisync_master.so&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; rpl_semi_sync_master_enabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; rpl_semi_sync_master_timeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 1초&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Slave 설정&lt;/span&gt;
INSTALL PLUGIN rpl_semi_sync_slave &lt;span class=&quot;token keyword&quot;&gt;SONAME&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;semisync_slave.so&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; rpl_semi_sync_slave_enabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;semi-sync replication&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7e8165df5b7ea09736c2f1ee9660104e/75609/semi-sync2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.645569620253163%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbklEQVR42m2QzWoTURiG5xJEWk3MzPmbH5PMzDkT26QxLcGWuIhYKSJtRF2I4EK66KaIKCJVhIIrXXsZbrwO197K4zctdOXi4f04nPNyni8qwoisHtGmGXrivLwgKSpUm+nwAuUGQkXs5I6tiY0nsR4ts9I1SVKjdSCq/Cvuzb8zHX/DDmbYIlBW22SFpzvaZe3xKTeOPnB99YlutcP+ZsK7gy5nh+s8GDtuevnIi7ukx3v0Ho6JhtVr7u/9ZDr5gbk9I+3fofRzcslbGwvWD9/Tef6Za0/P6Mn5wZbi45MOX4/W2J+kdJoN9MsZ7mSX+NGEKC8DWb+iKGtyUY+do2eMKFmUqMZpTU9UVVqh0zY9qtU0bbbKQZBZe4xpiEyzJNs5xm4+w5YT3PYp5fKcwfILejCVvZXoTB5msiMpu8K1BIxrBNG2l0Rq6w316hd6fo4Kc8LqN4u3f5md/EHXCynso/NwWfrfsuaqzNiGf3Zyvl8/3XRcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;세미싱크 레플리케이션&quot;
        title=&quot;&quot;
        src=&quot;/static/7e8165df5b7ea09736c2f1ee9660104e/f058b/semi-sync2.png&quot;
        srcset=&quot;/static/7e8165df5b7ea09736c2f1ee9660104e/c26ae/semi-sync2.png 158w,
/static/7e8165df5b7ea09736c2f1ee9660104e/6bdcf/semi-sync2.png 315w,
/static/7e8165df5b7ea09736c2f1ee9660104e/f058b/semi-sync2.png 630w,
/static/7e8165df5b7ea09736c2f1ee9660104e/40601/semi-sync2.png 945w,
/static/7e8165df5b7ea09736c2f1ee9660104e/75609/semi-sync2.png 994w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Semi-Sync 흐름]
1. Client -&gt; Master: INSERT
2. Master: Binlog 기록
3. Master -&gt; Slave: Binlog 전송
4. Slave: 수신 확인 (ACK)
5. Master &amp;lt;- Slave: ACK
6. Master -&gt; Client: 커밋 완료

장점: 최소 1개 Slave에는 데이터가 있음을 보장
단점: 쓰기 지연 증가 (네트워크 RTT만큼)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;5. 쿼리 라우터 활용 (ProxySQL)&lt;/h3&gt;
&lt;p&gt;애플리케이션 코드 수정 없이 프록시 레벨에서 라우팅을 처리합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/2e237/proxySql.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.69620253164558%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVR42p2V647TMBCF9/0fCv6wwEqsuqBKRah7641s21xsx3F8Pcw4bbUsFKJGOnI87nwez0zcK5x5Ukroug5N02TxO9v+91ydWzDGQCkFa21WXdd5vBjY9z3m8zmm0ykmkwlmsxlCCJcD+YhVVeUohRAoyxLe+8uBMcZ8bCllFr9fnMOjY6tbfPp8jeuPH3LEr9dGA4MDvGElhB4Qe422Nghsoznb+DejgClSVMUguQJ2s4SHG4Xv72vM3pVolglyDaiCIx0DpCKKymG/6LCdaxQ/FPQ+wNQpyzWAE1Swcth8FFA2Hj9XLXaFwbbgXuTiAJpSWEmgVgQUw2/HHbny2G4kOu2oF0MeNalVFotnhSeSKokWRwK7vUP9VMFWGl70CMIgShprDfe4gieZvR2Xw1OVqZKevjJLQNs4SEH564Y1d1gb34fBI3mH1FGE6yV5e9iY0BhKgQ+I56rxB/BwhrDbwdzewt0/oL+7Q6RPLze58fjyKPEihvDS6Mam79dvNsMGBx2dedQ2oGgsfEz/BkatkeiGCXQJRLoMeM4PO3YEMS6iJ/F8Jx2UGWzGDvbexzdAugB8UcAvl/AvL1Rdke0uRLTUPqLzkKSaWsiSM8+30qJqHUpSZ98CCcAg//w8AOmWPgLZeV33uLkXOTreoNEeXxcK31Yqv/Mpfge2bT5yoqom507FYCDvLqko7MjRuJAytG6HqAWtdS7+pbEJGPm/g8GHqg85jEO+Drk66mQj8cYM/AUhu26WGPmpNQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;프록시 sql&quot;
        title=&quot;&quot;
        src=&quot;/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/f058b/proxySql.png&quot;
        srcset=&quot;/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/c26ae/proxySql.png 158w,
/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/6bdcf/proxySql.png 315w,
/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/f058b/proxySql.png 630w,
/static/d9f1ad65b51fbe8af996abbf6dcd7bf6/2e237/proxySql.png 790w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ProxySQL이 쿼리를 분석하여 자동 라우팅&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SELECT -&gt; Slave&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;INSERT/UPDATE/DELETE -&gt; Master&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;복제 지연 감지 시 &lt;strong&gt;해당 Slave 제외&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- ProxySQL 설정 예시&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 서버 등록&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; mysql_servers&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostgroup_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; hostname&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;master.db.local&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3306&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;-- Writer 그룹&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;slave1.db.local&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3306&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;-- Reader 그룹&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;slave2.db.local&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3306&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 쿼리 라우팅 규칙&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; mysql_query_rules&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rule_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; match_pattern&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; destination_hostgroup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;^SELECT.*FOR UPDATE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;-- SELECT FOR UPDATE는 Master로&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;^SELECT&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;               &lt;span class=&quot;token comment&quot;&gt;-- 일반 SELECT는 Slave로&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.*&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                    &lt;span class=&quot;token comment&quot;&gt;-- 나머지는 Master로&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 복제 지연 임계치 설정 (3초 초과 시 해당 Slave 제외)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; mysql_servers &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; max_replication_lag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; hostgroup_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ProxySQL이 주기적으로 각 Slave의 &lt;code class=&quot;language-text&quot;&gt;Seconds_Behind_Master&lt;/code&gt;를 체크해서 자동으로 관리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[동적 Slave 관리]
T1: Slave2 복제 지연 5초 -&gt; 임계치(3초) 초과 -&gt; 라우팅 제외
T2: Slave2가 복제 따라잡는 중...
T3: Slave2 복제 지연 1초 -&gt; 임계치 이하 -&gt; 다시 라우팅에 포함&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;상태에 따라 동적으로&lt;/strong&gt; 포함/제외됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 애플리케이션은 ProxySQL만 바라봄&lt;/span&gt;
spring&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
  datasource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jdbc&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;mysql&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;proxysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;local&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6033&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;mydb
    username&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; app_user
    password&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; xxx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - Extra 컬럼 (2편)]]></title><description><![CDATA[이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다. 22. Using join buffer 의미: 조인 시 조인 버퍼 사용 조인 대상 테이블(드리븐 테이블)에 적절한 인덱스가 없을 때 조인 버퍼를 사용합니다. id select…]]></description><link>https://gotobill.github.io/mysql-extra-part2/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-extra-part2/</guid><pubDate>Mon, 27 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2&gt;22. Using join buffer&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 조인 시 조인 버퍼 사용&lt;/p&gt;
&lt;p&gt;조인 대상 테이블(드리븐 테이블)에 적절한 인덱스가 없을 때 조인 버퍼를 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2005-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10904&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_fromdate&lt;/td&gt;
&lt;td&gt;Using index condition&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;Using where; Using join buffer (hash join)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;조인 버퍼 종류&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Block Nested Loop (BNL)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Using join buffer (Block Nested Loop)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;언제 사용되나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;드리븐 테이블에 조인 조건에 맞는 인덱스가 없을 때 사용됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- dept_emp: 30만 건, employees: 10만 건&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- employees에 dept_no 인덱스 없음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; employees e &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2005-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;dept_emp에서 조건에 맞는 1만 건을 조인 버퍼에 저장&lt;/li&gt;
&lt;li&gt;employees 테이블을 처음부터 끝까지 스캔하면서 버퍼의 1만 건과 비교&lt;/li&gt;
&lt;li&gt;인덱스가 없어서 매번 풀 스캔 필요&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;: 드리븐 테이블을 반복 풀 스캔하여 비효율적&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;Batched Key Access (BKA)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Using join buffer (Batched Key Access)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;언제 사용되나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;드리븐 테이블에 인덱스가 있고, MRR 최적화를 사용할 때입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- dept_emp: 30만 건, employees: 10만 건&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- employees에 dept_no 인덱스 있음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; optimizer_switch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mrr=on,mrr_cost_based=off,batched_key_access=on&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; employees e &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2005-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;dept_emp에서 조건에 맞는 레코드들의 dept_no를 버퍼에 모음
&lt;ul&gt;
&lt;li&gt;예: [d001, d003, d001, d005, d003, ...]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;dept_no를 정렬하여 중복 제거
&lt;ul&gt;
&lt;li&gt;정렬 후: [d001, d003, d005, ...]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;정렬된 순서대로 employees의 인덱스를 한 번에 조회 (MRR)&lt;/li&gt;
&lt;li&gt;디스크 랜덤 I/O를 순차 I/O로 변환&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;: 인덱스를 사용하면서도 디스크 접근을 최적화&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;hash join (MySQL 8.0.18+)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Using join buffer (hash join)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;언제 사용되나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;등호(=) 조인이고 인덱스가 없을 때 자동으로 사용됩니다. BNL보다 훨씬 빠릅니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- dept_emp: 30만 건, employees: 10만 건&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- employees에 dept_no 인덱스 없음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; employees e &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2005-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Build Phase&lt;/strong&gt;: dept_emp에서 1만 건을 읽어 해시 테이블 생성&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;해시 테이블:
hash(d001) → [레코드1, 레코드5, ...]
hash(d003) → [레코드2, 레코드7, ...]
hash(d005) → [레코드3, ...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Probe Phase&lt;/strong&gt;: employees를 스캔하면서 해시 테이블 조회&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;employees의 dept_no = &apos;d001&apos; → 해시 테이블에서 hash(d001) 조회 (O(1))&lt;/li&gt;
&lt;li&gt;일치하는 레코드들과 조인&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;성능 개선&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;조인 조건에 인덱스가 없어서 비효율적입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;해결 방법&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;드리븐 테이블의 조인 컬럼에 인덱스 추가&lt;/li&gt;
&lt;li&gt;조인 순서 변경 (힌트 사용)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;join_buffer_size&lt;/code&gt; 설정 (기본 1MB, 데이터 웨어하우스는 더 크게)&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;23. Using MRR&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: MRR(Multi Range Read) 최적화 사용&lt;/p&gt;
&lt;p&gt;MySQL 엔진이 여러 개의 키 값을 스토리지 엔진으로 한 번에 전달하고, 스토리지 엔진은 이를 정렬하여 최소한의 페이지 접근으로 레코드를 읽습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ JOIN_ORDER(s, e) */&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     salaries s
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hire_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1991-01-01&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1991-01-01&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50000&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_salary&lt;/td&gt;
&lt;td&gt;Using index condition; Using MRR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;디스크 접근 최소화&lt;/li&gt;
&lt;li&gt;대량 레코드 읽기 시 효율적&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;24. Using sort_union / Using union / Using intersect&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: index_merge 접근 방법 사용 시 인덱스 병합 방식&lt;/p&gt;
&lt;h3&gt;Using intersect&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: AND로 연결된 조건의 교집합&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11000&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Smith&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Using union&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: OR로 연결된 조건의 합집합 (동등 비교)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Smith&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Using sort_union&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: OR로 연결된 범위 조건의 합집합 (정렬 후 병합)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11000&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Smith&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;차이점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Using union&lt;/strong&gt;: 동등 비교, 중복 적음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using sort_union&lt;/strong&gt;: 범위 비교, 프라이머리 키를 먼저 읽어 정렬 후 병합&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;25. Using temporary&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 중간 결과를 담기 위해 임시 테이블 사용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; gender
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;Using temporary; Using filesort&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;임시 테이블 사용 케이스&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Extra에 표시되는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GROUP BY와 ORDER BY 컬럼이 다를 때&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Extra에 표시되지 않지만 사용하는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;FROM 절의 서브쿼리&lt;/strong&gt;: 파생 테이블(Derived table)은 항상 임시 테이블&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;COUNT(DISTINCT column1)&lt;/strong&gt;: 인덱스를 사용할 수 없으면 임시 테이블&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;UNION / UNION DISTINCT&lt;/strong&gt;: 결과 병합 시 임시 테이블 (MySQL 8.0에서 UNION ALL은 제외)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인덱스 없는 정렬&lt;/strong&gt;: 정렬 버퍼도 임시 테이블과 동일&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;메모리 vs 디스크&lt;/h3&gt;
&lt;p&gt;실행 계획만으로는 임시 테이블이 메모리에 생성됐는지 디스크에 생성됐는지 알 수 없습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;상태 변수로 확인&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;STATUS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Created_tmp%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Created_tmp_tables&lt;/code&gt;: 생성된 임시 테이블 수&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Created_tmp_disk_tables&lt;/code&gt;: 디스크에 생성된 임시 테이블 수&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;성능 영향&lt;/h3&gt;
&lt;p&gt;임시 테이블 생성은 부하가 크므로 다음과 같이 개선하세요:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;GROUP BY와 ORDER BY 컬럼을 동일하게&lt;/li&gt;
&lt;li&gt;인덱스 활용으로 GROUP BY/ORDER BY 처리&lt;/li&gt;
&lt;li&gt;서브쿼리를 조인으로 변경&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;26. Using where&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: MySQL 엔진에서 WHERE 조건 필터링 수행&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10010&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td&gt;50.00&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;두 가지 의미&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;스토리지 엔진에서 읽은 레코드를 MySQL 엔진에서 필터링&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;일부 조건은 인덱스를 사용하지 못했음&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;처리 과정&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[스토리지 엔진]
emp_no BETWEEN 10001 AND 10100
→ 100건 읽음

[MySQL 엔진]
gender=&apos;F&apos; 조건 필터링
→ 37건만 반환 (63건 버림)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;성능 판단&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;filtered 컬럼 확인&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;filtered = 50%: 읽은 레코드 중 50%만 반환&lt;/li&gt;
&lt;li&gt;filtered 값이 낮을수록 비효율적&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;개선 방법&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 기존: emp_no만 인덱스 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; gender&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;F&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 개선: 복합 인덱스 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INDEX&lt;/span&gt; idx_emp_gender &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gender&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;복합 인덱스를 사용하면 두 조건 모두 작업 범위 결정 조건이 되어 필요한 37건만 정확하게 읽습니다.&lt;/p&gt;
&lt;h3&gt;주의사항&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Using where + type: ALL&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;이 조합은 풀 테이블 스캔이므로 반드시 개선이 필요합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 인덱스 없음&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;개선&lt;/strong&gt;: first_name에 인덱스 추가&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;27. Zero limit&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 메타데이터만 필요한 경우 (LIMIT 0)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;Zero limit&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;사용 목적&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;쿼리 결과값의 메타데이터만 필요한 경우:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;컬럼 개수&lt;/li&gt;
&lt;li&gt;각 컬럼의 타입&lt;/li&gt;
&lt;li&gt;컬럼 이름&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;실제 테이블 레코드는 전혀 읽지 않고 메타정보만 반환합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;전체 Extra 메시지 요약&lt;/h2&gt;
&lt;h3&gt;최상 (매우 좋음)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;td&gt;커버링 인덱스, 데이터 파일 안 읽음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Select tables optimized away&lt;/td&gt;
&lt;td&gt;MIN/MAX 최적화, 1~2건만 읽음&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;양호 (좋음)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Using index condition&lt;/td&gt;
&lt;td&gt;인덱스 컨디션 푸시다운&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using index for group-by&lt;/td&gt;
&lt;td&gt;루스 인덱스 스캔&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using index for skip scan&lt;/td&gt;
&lt;td&gt;인덱스 스킵 스캔&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using MRR&lt;/td&gt;
&lt;td&gt;디스크 접근 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FirstMatch / LooseScan&lt;/td&gt;
&lt;td&gt;세미 조인 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Distinct&lt;/td&gt;
&lt;td&gt;중복 제거 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Not exists&lt;/td&gt;
&lt;td&gt;안티 조인 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;보통 (확인 필요)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;td&gt;필터링 수행 (filtered 값 확인)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Range checked for each record&lt;/td&gt;
&lt;td&gt;레코드마다 인덱스 선택&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;나쁨 (개선 필요)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Using filesort&lt;/td&gt;
&lt;td&gt;정렬에 인덱스 미사용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using temporary&lt;/td&gt;
&lt;td&gt;임시 테이블 생성&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using join buffer&lt;/td&gt;
&lt;td&gt;조인에 인덱스 미사용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Full scan on NULL key&lt;/td&gt;
&lt;td&gt;NULL 처리로 풀 스캔&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;정보성 (문제 아님)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;const row not found&lt;/td&gt;
&lt;td&gt;const 테이블에 레코드 없음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Impossible WHERE/HAVING&lt;/td&gt;
&lt;td&gt;조건이 항상 FALSE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;No tables used&lt;/td&gt;
&lt;td&gt;FROM 절 없음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Plan isn&apos;t ready yet&lt;/td&gt;
&lt;td&gt;실행 계획 수립 중&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Zero limit&lt;/td&gt;
&lt;td&gt;LIMIT 0 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;실전 튜닝 가이드&lt;/h2&gt;
&lt;h3&gt;1단계: 즉시 개선 필요 항목 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
    &lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; salaries s &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;birth_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;체크 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Using filesort&lt;/strong&gt;: birth_date에 인덱스 필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using temporary&lt;/strong&gt;: GROUP BY/ORDER BY 조정&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using join buffer&lt;/strong&gt;: 조인 컬럼에 인덱스 필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;type: ALL&lt;/strong&gt;: 테이블 풀 스캔 확인&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;2단계: 커버링 인덱스 적용 검토&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 현재&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; birth_date
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 개선: first_name, birth_date 복합 인덱스 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INDEX&lt;/span&gt; idx_name_birth &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; birth_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과&lt;/strong&gt;: Using index 표시 (커버링 인덱스)&lt;/p&gt;
&lt;h3&gt;3단계: filtered 값 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; gender&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;F&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;th&gt;실제 조인 대상&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td&gt;50.00&lt;/td&gt;
&lt;td&gt;50건&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td&gt;10.00&lt;/td&gt;
&lt;td&gt;10건&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;filtered 값이 낮으면 복합 인덱스 추가를 검토하세요.&lt;/p&gt;
&lt;h3&gt;4단계: 조인 순서 최적화&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- JOIN_ORDER 힌트로 조인 순서 조정&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ JOIN_ORDER(e, s) */&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; salaries s
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;최종 체크리스트&lt;/h2&gt;
&lt;p&gt;쿼리 튜닝 시 Extra 컬럼에서 확인할 항목:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;필수 확인&lt;/strong&gt;&lt;/p&gt;
&lt;ul class=&quot;contains-task-list&quot;&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using filesort 있는가? → 인덱스로 정렬 가능한가?&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using temporary 있는가? → GROUP BY/ORDER BY 최적화 가능한가?&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using index 표시되는가? → 커버링 인덱스 적용 가능한가?&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; type: ALL + Using where인가? → 인덱스 추가 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;추가 확인&lt;/strong&gt;&lt;/p&gt;
&lt;ul class=&quot;contains-task-list&quot;&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using join buffer 있는가? → 조인 컬럼에 인덱스 필요&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; filtered 값이 낮은가? → 복합 인덱스 검토&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Range checked for each record 있는가? → 조인 조건 개선&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using MRR/ICP 사용 중인가? → 최적화 적용됨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;참고 확인&lt;/strong&gt;&lt;/p&gt;
&lt;ul class=&quot;contains-task-list&quot;&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Using index for group-by → 루스 인덱스 스캔 (양호)&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; Select tables optimized away → MIN/MAX 최적화 (최상)&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; FirstMatch/LooseScan → 세미 조인 최적화 (양호)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;실행 계획을 완벽하게 이해했다면 이제 실전 쿼리 최적화를 시작하세요!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - Extra 컬럼 (1편)]]></title><description><![CDATA[이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다. Extra 컬럼이란? Extra…]]></description><link>https://gotobill.github.io/mysql-extra/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-extra/</guid><pubDate>Mon, 27 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Extra 컬럼이란?&lt;/h2&gt;
&lt;p&gt;Extra 컬럼은 실행 계획에서 &lt;strong&gt;추가 정보를 제공&lt;/strong&gt;하는 매우 중요한 컬럼입니다. 쿼리 최적화와 성능 개선에 핵심적인 정보를 담고 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;성능 관련 중요 메시지 요약&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메시지&lt;/th&gt;
&lt;th&gt;의미&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;td&gt;커버링 인덱스 사용&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using index condition&lt;/td&gt;
&lt;td&gt;인덱스 컨디션 푸시다운&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using filesort&lt;/td&gt;
&lt;td&gt;인덱스 없이 정렬&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using temporary&lt;/td&gt;
&lt;td&gt;임시 테이블 사용&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;td&gt;WHERE 필터링&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Using join buffer&lt;/td&gt;
&lt;td&gt;조인 버퍼 사용&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;1. const row not found&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: const 접근 방법으로 테이블을 읽었지만 레코드가 1건도 없음&lt;/p&gt;
&lt;p&gt;테이블에 테스트 데이터를 저장하고 다시 실행 계획을 확인해 봐야함.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;2. Deleting all rows&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: WHERE 조건 없이 테이블의 모든 레코드를 삭제&lt;/p&gt;
&lt;p&gt;MySQL 8.0에서는 더 이상 표시되지 않습니다. 전체 삭제는 &lt;strong&gt;TRUNCATE TABLE&lt;/strong&gt; 사용을 권장합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;3. Distinct&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: DISTINCT 처리 시 조인하지 않아도 되는 항목은 무시&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;DISTINCT&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; departments d&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;Using index; Using temporary&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;Using index; Distinct&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;필요한 것만 조인하여 효율적으로 처리합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ea8b56c4061b13a4beddaa286540d94a/fcbaf/10.6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVR42l1RXauCUBD0//+HXsQ+LHrKHoQC9cHU1IRIgqK0MvRBMDUJwuayGzfubWHYc87uzgx7hLIskSQJTqcT4jhGnue43+94vV5omgZFUTAulwsOhwOu1yvqukZVVXg+n/gOQRRF9Pt9UJZlGZPJBIqiYL/fYz6fc208HmMwGECSJHS7XUynU4bv+8iyDOfzmXG73SB0Oh30er1P82g0wnA4xGw2g6qqsG0bpmkydF2HYRhYrVawLIsFwzBkYnpL0xTCYrHAcrnkBspUCIKA70TwS2boBotomob1es1CRBhFEa/s4/B7B7Q7it1ux4ObzYZBZ997Ozkej9hutyxE4o7jsBnar0AEf9G2LRPS57iuy40EGiLX5IxIPc/j/Hg8/hn5AeHqo2/lHplmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.6&quot;
        title=&quot;&quot;
        src=&quot;/static/ea8b56c4061b13a4beddaa286540d94a/f058b/10.6.png&quot;
        srcset=&quot;/static/ea8b56c4061b13a4beddaa286540d94a/c26ae/10.6.png 158w,
/static/ea8b56c4061b13a4beddaa286540d94a/6bdcf/10.6.png 315w,
/static/ea8b56c4061b13a4beddaa286540d94a/f058b/10.6.png 630w,
/static/ea8b56c4061b13a4beddaa286540d94a/fcbaf/10.6.png 895w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;4. FirstMatch / LooseScan / Start temporary, End temporary&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 세미 조인 최적화 전략 사용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- FirstMatch&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; titles t &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1995-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1995-01-30&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;t&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;Using where; Using index; FirstMatch(e)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;세미 조인 최적화 종류&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;FirstMatch&lt;/strong&gt;: 첫 번째로 일치하는 한 건만 검색&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LooseScan&lt;/strong&gt;: 인덱스를 듬성듬성 읽어서 중복 제거&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Duplicate Weed-out&lt;/strong&gt;: 임시 테이블로 중복 제거 (Start temporary ~ End temporary)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;5. Full scan on NULL key&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;col1 IN (SELECT col2 FROM ...)&lt;/code&gt; 형태에서 col1이 NULL일 때 서브쿼리를 풀 스캔&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;해결 방법&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; tb_test1
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; col1 &lt;span class=&quot;token operator&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; col1 &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; col2 &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; tb_test2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;6. Impossible HAVING / Impossible WHERE&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 조건이 항상 FALSE&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- emp_no는 NOT NULL이므로 항상 FALSE&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;쿼리가 잘못 작성된 경우이므로 점검이 필요합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;7. No matching min/max row / no matching row in const table&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 조건에 일치하는 레코드가 없음&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dept_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dept_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 일치하는 레코드 없음&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;8. No matching rows after partition pruning&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 파티션 프루닝 후 대상 파티션이 없음&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 최대 hire_date가 2000-01-28인 경우&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees_parted &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; hire_date&lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2020-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2020년 이상의 파티션이 없으므로 삭제할 대상이 없습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;9. No tables used&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: FROM 절이 없거나 FROM DUAL 형태&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dual&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;10. Not exists&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 안티 조인(Anti-JOIN)을 아우터 조인으로 최적화&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
    &lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; departments d &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;Using where; Not exists&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;조건에 일치하는 레코드 1건만 있어도 즉시 처리를 완료합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;11. Plan isn&apos;t ready yet&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;EXPLAIN FOR CONNECTION&lt;/code&gt; 실행 시 대상 커넥션이 아직 실행 계획을 수립하지 못한 상태&lt;/p&gt;
&lt;p&gt;시간을 두고 다시 실행하면 됩니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;12. Range checked for each record&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 레코드마다 인덱스 레인지 스캔을 체크&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; employees e2
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e1&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e2&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;Range checked for each record (index map: 0x1)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/42d731c337adeb2d2fb0e413cc715be2/41be6/10.7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5UlEQVR42oVT16piQRD0/39AH0wo5ogBEXM4ZhHEHEAEE4iKD2ate6vleO8uCzvQ9Dk9NR2qZjT4Xs/nE/f7XezxeOB2u+H1ev1h6lL3iaWn/V4aBkajEcrlMqrVKlqtFpSigvF4/AGx4Hq9xmw2Q7PZRK1WE098vV6X+Gq1ksKa6XQKp9MJh8MBl8sl3mKxwGazYTKZYDgcotPpIBKJyD7joVAIbrcbfr9fsEajEe12W7rXNBoNSRIIBMTb7XYB8TsajSIcDstBFg0Gg/D5fGLcZ3KPxyPxXq/3HrlSqcBkMkkis9kMg8EAvV4vxkPshMlYhBir1SqeuEQiIV1ns1mZQhKSG3LI0QeDgbROPgng3na7xWKxEE7n87lQsFwukUqlBMfuMpkM+v3+O+HxeMThcMDpdMJms8F+vwdj/CYnXNfrFbvdDufzWbAkn2JwulKpJOJ0u913QqpFLlQjJxyDlkwmEYvFpAuv1ysxjsyYoigoFovCcy6X++GQ2bVarZhOpxMeyR+Vo7IUgIXII7mjxeNxpNNpGZmYfD7/0yF5o4o8SM+K7IhA9a4VCgURiNeFYhDHfSamaIzz/kpC/Gepr4TjUQh2RiqoLP8pCBNTrE/Cv5/Zv57d5XIRUX579ZumPsEvuG82ol8LiRUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.7&quot;
        title=&quot;&quot;
        src=&quot;/static/42d731c337adeb2d2fb0e413cc715be2/f058b/10.7.png&quot;
        srcset=&quot;/static/42d731c337adeb2d2fb0e413cc715be2/c26ae/10.7.png 158w,
/static/42d731c337adeb2d2fb0e413cc715be2/6bdcf/10.7.png 315w,
/static/42d731c337adeb2d2fb0e413cc715be2/f058b/10.7.png 630w,
/static/42d731c337adeb2d2fb0e413cc715be2/41be6/10.7.png 638w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;index map 해석&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;0x1&lt;/code&gt; = 16진수 0x1 = 이진수 &lt;code class=&quot;language-text&quot;&gt;00001&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;첫 번째 인덱스(PRIMARY KEY)를 후보로 고려&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;index map 0x19 예시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;0x19&lt;/code&gt; = 16진수 0x19 = 이진수 &lt;code class=&quot;language-text&quot;&gt;11001&lt;/code&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;비트 위치&lt;/th&gt;
&lt;th&gt;5&lt;/th&gt;
&lt;th&gt;4&lt;/th&gt;
&lt;th&gt;3&lt;/th&gt;
&lt;th&gt;2&lt;/th&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;비트 값&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;인덱스&lt;/td&gt;
&lt;td&gt;5번째&lt;/td&gt;
&lt;td&gt;4번째&lt;/td&gt;
&lt;td&gt;3번째&lt;/td&gt;
&lt;td&gt;2번째&lt;/td&gt;
&lt;td&gt;PRIMARY KEY&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;비트 값이 1인 인덱스가 후보입니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;13. Recursive&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: CTE(Common Table Expression)를 이용한 재귀 쿼리&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WITH&lt;/span&gt; RECURSIVE cte &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; cte &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; cte&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived2&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DERIVED&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;No tables used&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;UNION&lt;/td&gt;
&lt;td&gt;cte&lt;/td&gt;
&lt;td&gt;Recursive; Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;14. Rematerialize&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 래터럴 조인(LATERAL JOIN)에서 선행 테이블의 레코드별로 임시 테이블 재생성&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
    &lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; LATERAL &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries s
        &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
        &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s2 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; s2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;employees 테이블의 레코드마다 임시 테이블이 새로 생성됩니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;15. Select tables optimized away&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: MIN() / MAX() 또는 COUNT(*)를 인덱스로 최적화&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 408px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/59ba52b10036a0a1e0c5dfe9ee539db9/e7c18/10.8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVR42q1U2U5iQRTk9yU+ABGUJUFAfRjjIxBIgChLQkDZd2SXRcANiVGWmtSZtAOROD7MTU66b98+darOcjXYeN7f3/H29oaPjw8sFgux5XIptlqtZF2v1/ju0agNnQuFAiKRiKzVahX1eh25XA43NzcoFotIpVJ4eXmR+wqY62YQjXrJ5/O4vLyEx+OB3+9HOBz+XGlXV1eIRqMS8Pn5eSfYFmA8Hofb7cbZ2RnOf53D6/Xi4uICgUAAwWAQPp8PoVBIgozH40+AwWCAh4eHbcn9fh+Hh4ewWqzQ6/XY39+XvU6ng9VqFTObzbDZbLKaTCYcHR3J+8HBAbRaLRqNxl9AJjydTkueKImMuI/FYiiXy6hUKpLXWq0m95rNJh4fHzGZTJDNZuUOa7AlmSxZZTqxEKx2t9uVM9psNpPAlPf09PTvHLbbbYlKsEQigel0KuB0ppHN6+urBFY5YwD6c/0C2Gq1xInSrq+vJfGUSmfa/f29tEyv15PAm62zk2Gn05GLyWRS2ocA7EPFkAEUwx8BUjJlssdoZEOGdKYRkHm8u7v7GSAlj0YjcSBbymelCURTzNqd9s8lE5ANzomgZBZFMeS7YqiKoqq8c/TYIooVi0KA29vbzxTw23w+l8n4niH+HLLTu70ukomkzC2bt1QuCWsaAzLHTA1TsNm/PP8yehaLBQ6HQ8bKYDDg+PhY9i6XCycnJ3A6nTg9PYXdbofRaJRxVKO3t7e3PXr8zzFf7EE2diaTEekcs1KpJKOlVp4Ph0ORzVzyL0VfYmz9D//X8xt1Wyy0SjQadQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.8&quot;
        title=&quot;&quot;
        src=&quot;/static/59ba52b10036a0a1e0c5dfe9ee539db9/e7c18/10.8.png&quot;
        srcset=&quot;/static/59ba52b10036a0a1e0c5dfe9ee539db9/c26ae/10.8.png 158w,
/static/59ba52b10036a0a1e0c5dfe9ee539db9/6bdcf/10.8.png 315w,
/static/59ba52b10036a0a1e0c5dfe9ee539db9/e7c18/10.8.png 408w&quot;
        sizes=&quot;(max-width: 408px) 100vw, 408px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10002&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/67fe17db9cc72898ad2e974aa184d7c0/5c6e9/10.9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 85.44303797468356%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVR42o2UWU8qURCE/f+/Ah4IBohsAgFBeCAggkBYlFXZQUTWBJStb75OBq/mGu4knXNgTld3VdeZC/nxbLdb2Ww2uhL7/f4Uh8NBzj0Xxma322lSv9+X+/t7qVQq0m63pdvtSrPZlGq1Kq+vr/L5+annfgU8Ho+6abVaYjabxWKxiMPh0GBvMpnEarXq7+vra7m6utKiPEbuPwGHw6FkH7ISi8WkUChIKpWSu7s7XTOZjORyOe308fFRxuPxecD393ell06nZTQaKcWnpyel3mw09d1qtdJz0+n0POXJZKJUyuWyAjYaDZWBAIxYLpd67r8AEbxUKsnt7a12R6fRaFQpZ7NZpdrpdJT229ub5hiTB8NYT4BUBZREaD0/PyswIHRO1x8fH9rlbDY7b5tisagD8bg9Eo/HJRgMSiAQkFAoJJFIRN8xnGQyqd2jLYE02IxYr9dfgCTYbLaTRXS1OzTsdrtcXl6K1+sVp9MpHo9Hbm5uJBwOazGshKXo/kQZSlT2+XxqEbrkMCvV6a5WqymTn7Yx9Ps2FA6RQDLC5/N5BcY66Ao9inJ70PhXHxobpulyufR2QM2gCX0oQRU9/X6/Tp+OCQojF2wWi8UXIGJDl2SSAHe73QqOPqwAoR2RSCQ0yKMQen7TEBovLy96oNfrKVX0gip73s3nc7WWYWwj92/qJ0DMym3AxPgOPQGq1+sKhnZ0wDluizEMYyBGnCjjIaoPBgMdEAPgg0Gw5z9YAIjBfzP2HzL51hUEYsgwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.9&quot;
        title=&quot;&quot;
        src=&quot;/static/67fe17db9cc72898ad2e974aa184d7c0/5c6e9/10.9.png&quot;
        srcset=&quot;/static/67fe17db9cc72898ad2e974aa184d7c0/c26ae/10.9.png 158w,
/static/67fe17db9cc72898ad2e974aa184d7c0/6bdcf/10.9.png 315w,
/static/67fe17db9cc72898ad2e974aa184d7c0/5c6e9/10.9.png 492w&quot;
        sizes=&quot;(max-width: 492px) 100vw, 492px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;Select tables optimized away&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;인덱스의 첫 번째와 마지막 레코드만 읽어서 처리합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;16. unique row not found&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 아우터 조인에서 아우터 테이블에 일치하는 레코드가 없음&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; tb_test1 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fdpk &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fdpk&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; tb_test2 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fdpk &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fdpk&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; tb_test1 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; tb_test2 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; t1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fdpk
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; tb_test1 t1
    &lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; tb_test2 t2 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; t2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fdpk&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;t1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fdpk
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; t1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fdpk&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;tb_test2 테이블에 fdpk=2인 레코드가 없습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;17. Using filesort&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: ORDER BY를 인덱스로 처리하지 못하고 정렬 수행&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; last_name &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;300363&lt;/td&gt;
&lt;td&gt;Using filesort&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;성능 영향&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;정렬용 메모리 버퍼 사용 (Sort buffer)&lt;/li&gt;
&lt;li&gt;퀵 소트 또는 힙 소트 알고리즘 수행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;많은 부하를 일으키므로 튜닝이 필수&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;개선 방법&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ORDER BY에 사용되는 컬럼에 인덱스 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;18. Using index (커버링 인덱스)&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 데이터 파일을 읽지 않고 인덱스만으로 쿼리 처리&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 비효율적: 데이터 파일까지 읽어야 함&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; birth_date
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Babette&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Gad&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;300473&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 효율적: 인덱스만으로 처리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; first_name
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Babette&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Gad&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;Using where; Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;데이터 파일 I/O 없음&lt;/li&gt;
&lt;li&gt;매우 빠른 처리 속도&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;가장 이상적인 상태&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;InnoDB의 커버링 인덱스 특징&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB의 세컨더리 인덱스는 프라이머리 키를 포함하므로 커버링 인덱스 활용 가능성이 높습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- first_name 인덱스에 emp_no(PK)도 포함됨&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; first_name
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Babette&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Gad&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;Using where; Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;무조건 커버링 인덱스로 만들려고 인덱스에 많은 컬럼을 추가하면 위험합니다&lt;/li&gt;
&lt;li&gt;인덱스 크기 증가 → 메모리 낭비 → INSERT/UPDATE 성능 저하&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;혼동 주의&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Extra의 &quot;Using index&quot;&lt;/strong&gt;: 커버링 인덱스 (좋음)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;type의 &quot;index&quot;&lt;/strong&gt;: 인덱스 풀 스캔 (느림)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;19. Using index condition&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 인덱스 컨디션 푸시다운(ICP) 최적화 사용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 인덱스: ix_lastname_firstname (last_name, first_name)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; last_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Acton&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;%sal&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_lastname_firstname&lt;/td&gt;
&lt;td&gt;Using index condition&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;ICP가 없을 때의 문제점&lt;/h3&gt;
&lt;p&gt;인덱스에 &lt;code class=&quot;language-text&quot;&gt;(last_name, first_name)&lt;/code&gt; 두 컬럼이 모두 포함되어 있지만, 기존 방식에서는 비효율적으로 동작합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;기존 방식 (ICP 없이)&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;스토리지 엔진 (InnoDB):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;인덱스에서 &lt;code class=&quot;language-text&quot;&gt;last_name=&apos;Acton&apos;&lt;/code&gt; 조건만 확인&lt;/li&gt;
&lt;li&gt;매칭되는 100건 발견&lt;/li&gt;
&lt;li&gt;100건 모두 실제 테이블에서 전체 row 읽기&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQL 엔진:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;100건을 받아서 &lt;code class=&quot;language-text&quot;&gt;first_name LIKE &apos;%sal&apos;&lt;/code&gt; 체크&lt;/li&gt;
&lt;li&gt;실제로는 3건만 조건에 맞음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;97건은 쓸데없이 읽은 것&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;ICP 적용 후&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Index Condition Pushdown 방식&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;MySQL 엔진:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&quot;스토리지 엔진, &lt;code class=&quot;language-text&quot;&gt;first_name LIKE &apos;%sal&apos;&lt;/code&gt; 조건도 인덱스에서 체크할 수 있으니 너가 미리 확인해!&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;스토리지 엔진 (InnoDB):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;인덱스에서 &lt;code class=&quot;language-text&quot;&gt;last_name=&apos;Acton&apos;&lt;/code&gt; 확인&lt;/li&gt;
&lt;li&gt;인덱스에 &lt;code class=&quot;language-text&quot;&gt;first_name&lt;/code&gt;도 있으니 여기서 바로 체크&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;first_name LIKE &apos;%sal&apos;&lt;/code&gt;도 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;3건만 조건 만족 → 이 3건만 테이블에서 읽기&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQL 엔진:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;3건만 받음 (97건 안 읽음)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;성능 개선&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;불필요한 테이블 접근 97건 제거&lt;/li&gt;
&lt;li&gt;인덱스에 포함된 컬럼은 최대한 활용하여 필터링&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;20. Using index for group-by&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: GROUP BY 처리를 인덱스로 최적화 (루스 인덱스 스캔)&lt;/p&gt;
&lt;h3&gt;타이트 인덱스 스캔 (Using index for group-by 없음)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt; counter
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; first_name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;AVG(), SUM(), COUNT()처럼 모든 인덱스를 읽어야 하면 듬성듬성 읽을 수 없습니다.&lt;/p&gt;
&lt;h3&gt;루스 인덱스 스캔 (Using index for group-by 표시)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;salaries&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;Using index for group-by&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;MIN()/MAX()처럼 첫 번째/마지막 레코드만 읽으면 되는 경우 루스 인덱스 스캔을 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;루스 인덱스 스캔 사용 조건&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WHERE 조건이 없거나&lt;/li&gt;
&lt;li&gt;WHERE 조건과 GROUP BY가 같은 인덱스를 사용할 수 있어야 함&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;21. Using index for skip scan&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 인덱스 스킵 스캔 최적화 사용 (MySQL 8.0+)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;ADD&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INDEX&lt;/span&gt; ix_gender_birthdate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gender&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; birth_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; gender&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; birth_date
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; birth_date&lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1965-02-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_gender_birthdate&lt;/td&gt;
&lt;td&gt;Using where; Using index for skip scan&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;인덱스의 첫 번째 컬럼(gender)을 건너뛰고 두 번째 컬럼(birth_date)만으로 검색할 수 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;&lt;a href=&quot;mysql-extra-part2&quot;&gt;2편에서 계속...&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;2편에서는 다음 내용을 다룹니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Using join buffer (Block Nested Loop, Batched Key Access, hash join)&lt;/li&gt;
&lt;li&gt;Using MRR&lt;/li&gt;
&lt;li&gt;Using sort_union / Using union / Using intersect&lt;/li&gt;
&lt;li&gt;Using temporary&lt;/li&gt;
&lt;li&gt;Using where&lt;/li&gt;
&lt;li&gt;Zero limit&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;튜닝 체크리스트&lt;/h2&gt;
&lt;p&gt;쿼리 튜닝 시 Extra 컬럼에서 확인할 항목:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Using filesort&lt;/strong&gt;: 인덱스로 정렬 가능한가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using temporary&lt;/strong&gt;: GROUP BY/ORDER BY를 인덱스로 처리 가능한가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using index&lt;/strong&gt;: 커버링 인덱스 적용 가능한가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using where + type: ALL&lt;/strong&gt;: 인덱스 추가가 필요한가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Using index condition&lt;/strong&gt;: ICP 최적화가 적용됐는가?&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - possible_keys, key, key_len, ref, rows, filtered 컬럼]]></title><description><![CDATA[이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다. possible_keys…]]></description><link>https://gotobill.github.io/mysql-key/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-key/</guid><pubDate>Sun, 26 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;possible_keys 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 옵티마이저가 후보로 선정했던 인덱스 목록&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;실제로 사용된 인덱스가 아니라 &quot;사용될 법했던&quot; 인덱스 목록입니다&lt;/li&gt;
&lt;li&gt;테이블의 모든 인덱스가 나열되는 경우가 많아 튜닝에 큰 도움이 되지 않습니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;실행 계획 확인 시 무시해도 됩니다&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;possible_keys에 인덱스가 나열됐다고 해서 그 인덱스를 사용한다고 판단하지 마세요. 실제 사용 인덱스는 &lt;strong&gt;key 컬럼&lt;/strong&gt;을 확인해야 합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;key 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 최종 선택된 실행 계획에서 &lt;strong&gt;실제로 사용하는 인덱스&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;중요성&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;쿼리 튜닝 시 의도한 인덱스가 표시되는지 확인하는 것이 매우 중요합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;표시 값&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PRIMARY&lt;/code&gt;: 프라이머리 키 사용&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt;: 인덱스를 전혀 사용하지 않음 (type이 ALL일 때)&lt;/li&gt;
&lt;li&gt;그 외: 테이블/인덱스 생성 시 부여한 인덱스 이름&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;index_merge의 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11000&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Smith&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;index_merge&lt;/td&gt;
&lt;td&gt;PRIMARY,ix_firstname&lt;/td&gt;
&lt;td&gt;4,58&lt;/td&gt;
&lt;td&gt;Using union(PRIMARY,ix_firstname); Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;type이 index_merge일 때는 2개 이상의 인덱스가 &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt;로 구분되어 표시됩니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;key_len 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 다중 컬럼 인덱스에서 &lt;strong&gt;몇 바이트까지 사용했는지&lt;/strong&gt; 표시&lt;/p&gt;
&lt;p&gt;많은 사용자가 무시하지만 &lt;strong&gt;매우 중요한 정보&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h3&gt;기본 예시&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;프라이머리 키 일부만 사용&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- dept_emp 테이블: PRIMARY KEY (dept_no, emp_no)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- dept_no: CHAR(4), utf8mb4 문자셋 (4 * 4바이트 = 16바이트)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;dept_no만 사용했으므로 key_len이 16바이트입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;프라이머리 키 전체 사용&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- emp_no: INTEGER (4바이트)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;dept_no(16) + emp_no(4) = 20바이트입니다.&lt;/p&gt;
&lt;h3&gt;NULL 허용 컬럼&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; titles &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    emp_no &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    title &lt;span class=&quot;token keyword&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    from_date &lt;span class=&quot;token keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    to_date &lt;span class=&quot;token keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- NULL 허용&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; ix_todate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;to_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; titles &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; to_date&lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1985-10-10&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;titles&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_todate&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;DATE 타입은 3바이트인데 왜 4바이트?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;NULL 허용 컬럼은 NULL 여부를 저장하기 위해 &lt;strong&gt;1바이트를 추가&lt;/strong&gt;로 사용합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;to_date: DATE 타입 3바이트&lt;/li&gt;
&lt;li&gt;NULL 플래그: 1바이트&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;합계: 4바이트&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;ref 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 접근 방법이 ref일 때 &lt;strong&gt;참조 조건으로 어떤 값이 제공됐는지&lt;/strong&gt; 표시&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;표시 값&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;: 상수값 사용&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;테이블명.컬럼명&lt;/code&gt;: 다른 테이블의 컬럼값 사용&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;func&lt;/code&gt;: 값의 변환이나 연산이 수행됨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;일반적인 조인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;employees.de.emp_no&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;조인 대상 컬럼 이름이 그대로 표시됩니다.&lt;/p&gt;
&lt;h3&gt;func가 표시되는 경우&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;func&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;func가 표시되는 상황&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;명시적인 값 변환 (예: &lt;code class=&quot;language-text&quot;&gt;de.emp_no-1&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;콜레이션 변환&lt;/li&gt;
&lt;li&gt;문자셋이 일치하지 않는 문자열 조인&lt;/li&gt;
&lt;li&gt;숫자 타입과 문자열 타입 조인&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;권장 사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;MySQL 서버가 내부 변환을 하지 않도록 조인 컬럼의 타입과 문자셋을 일치시키는 것이 좋습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;rows 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 실행 계획의 효율성 판단을 위해 &lt;strong&gt;예측한 레코드 건수&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;스토리지 엔진의 통계 정보를 기반으로 한 예상값입니다 (정확하지 않음)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;반환할 레코드 수가 아니라&lt;/strong&gt;, 읽고 체크해야 할 레코드 수입니다&lt;/li&gt;
&lt;li&gt;실제 쿼리 결과 건수와 일치하지 않는 경우가 많습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;예시 1: 풀 테이블 스캔&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; from_date&lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1985-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;331143&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;전체 레코드가 331,143건이므로 모든 레코드를 비교해야 한다고 판단했습니다.&lt;/p&gt;
&lt;h3&gt;예시 2: 인덱스 레인지 스캔&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; from_date&lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2002-07-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_fromdate&lt;/td&gt;
&lt;td&gt;292&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;292건(8.8%)만 읽으면 되므로 인덱스 레인지 스캔을 선택했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;참고&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;rows 값이 부정확하면 옵티마이저가 잘못된 실행 계획을 수립할 수 있습니다. MySQL 8.0부터는 &lt;strong&gt;히스토그램&lt;/strong&gt; 기능으로 예측 정확도를 개선했습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;filtered 컬럼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;의미&lt;/strong&gt;: 인덱스를 사용하지 못하는 조건으로 필터링한 후 남은 레코드 비율 (%)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;핵심 개념&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;filtered 컬럼은 인덱스로 처리되지 않는 조건을 적용한 후 남은 레코드의 비율을 나타냅니다. 조인 시 다음 테이블로 전달될 실제 레코드 건수를 예측하는 데 중요합니다.&lt;/p&gt;
&lt;h3&gt;예시&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     salaries s
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hire_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1991-01-01&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1991-01-01&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50000&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;233&lt;/td&gt;
&lt;td&gt;16.03&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;0.48&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;분석&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;employees 테이블에서:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;first_name=&apos;Matt&apos;&lt;/code&gt; (인덱스 사용): 233건 조회&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;hire_date BETWEEN &apos;1990-01-01&apos; AND &apos;1991-01-01&apos;&lt;/code&gt; (인덱스 미사용): 추가 필터링&lt;/li&gt;
&lt;li&gt;filtered 16.03% = 233건 중 16.03%만 hire_date 조건도 만족&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;실제 salaries 테이블로 조인되는 건수&lt;/strong&gt;: 233 × 0.1603 = &lt;strong&gt;약 37건&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;왜 중요한가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;옵티마이저는 조인 순서를 결정할 때 filtered 값을 참고합니다. 조인 후 남는 레코드가 적을수록 다음 테이블 조인 비용이 줄어들기 때문에 filtered 값이 낮은 테이블을 선행 테이블로 선택하는 경향이 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;개선 방안&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;MySQL 8.0부터는 &lt;strong&gt;히스토그램&lt;/strong&gt; 기능으로 filtered 값의 예측 정확도를 높였습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;튜닝 체크리스트&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;key&lt;/strong&gt;: 의도한 인덱스가 사용되는가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;key_len&lt;/strong&gt;: 다중 컬럼 인덱스를 충분히 활용하는가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ref&lt;/strong&gt;: func가 표시되면 타입/문자셋 불일치 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rows&lt;/strong&gt;: 예상 읽기 건수가 합리적인가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;filtered&lt;/strong&gt;: 조인 시 필터링 비율이 적절한가?&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - type 컬럼]]></title><description><![CDATA[이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다. type 컬럼이란? type 컬럼은 MySQL…]]></description><link>https://gotobill.github.io/mysql-type/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-type/</guid><pubDate>Sat, 25 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;type 컬럼이란?&lt;/h2&gt;
&lt;p&gt;type 컬럼은 MySQL이 각 테이블의 레코드를 &lt;strong&gt;어떤 방식으로 읽었는지&lt;/strong&gt;를 나타냅니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;핵심 개념&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;인덱스를 사용했는지, 풀 테이블 스캔을 했는지 확인&lt;/li&gt;
&lt;li&gt;쿼리 튜닝 시 반드시 체크해야 할 핵심 정보&lt;/li&gt;
&lt;li&gt;MySQL 매뉴얼에서는 &lt;strong&gt;조인 타입&lt;/strong&gt;이라 부르지만, &lt;strong&gt;테이블 접근 방법&lt;/strong&gt;(Access type)으로 이해하는 것이 좋습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;공통 규칙&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;하나의 SELECT 쿼리는 12가지 중 &lt;strong&gt;단 하나의 접근 방법만&lt;/strong&gt; 사용합니다&lt;/li&gt;
&lt;li&gt;index_merge를 제외하면 &lt;strong&gt;하나의 인덱스만&lt;/strong&gt; 사용합니다&lt;/li&gt;
&lt;li&gt;MySQL 옵티마이저는 이 접근 방법들과 비용을 계산하여 최소 비용의 방법을 선택합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;type 컬럼의 12가지 값&lt;/h2&gt;
&lt;p&gt;성능이 좋은 순서대로 정리하면 다음과 같습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;순위&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;system&lt;/td&gt;
&lt;td&gt;레코드 1건 이하 (MyISAM, MEMORY)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;td&gt;PK/UK로 단일 행 조회&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;조인에서 PK/UK로 단일 행 조회&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;인덱스로 동등 조건 검색&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;fulltext&lt;/td&gt;
&lt;td&gt;전문 검색 인덱스 사용&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;ref_or_null&lt;/td&gt;
&lt;td&gt;ref + NULL 비교&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;unique_subquery&lt;/td&gt;
&lt;td&gt;IN 서브쿼리 (중복 없음)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;index_subquery&lt;/td&gt;
&lt;td&gt;IN 서브쿼리 (중복 제거)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;인덱스 레인지 스캔&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;index_merge&lt;/td&gt;
&lt;td&gt;2개 이상 인덱스 병합&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;인덱스 풀 스캔&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;풀 테이블 스캔&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;1. system&lt;/h2&gt;
&lt;p&gt;레코드가 1건 이하인 테이블 접근 방법입니다. &lt;strong&gt;InnoDB에서는 나타나지 않고&lt;/strong&gt;, MyISAM이나 MEMORY 테이블에서만 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; tb_dual &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd1 &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;MyISAM&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; tb_dual &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; tb_dual&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;tb_dual&lt;/td&gt;
&lt;td&gt;system&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;InnoDB로 변경하면 ALL 또는 index로 표시됩니다. 일반적으로 거의 보이지 않습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;2. const&lt;/h2&gt;
&lt;p&gt;PK나 Unique Key로 &lt;strong&gt;반드시 1건만 반환&lt;/strong&gt;하는 쿼리에 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;const가 되는 조건&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PK/UK의 &lt;strong&gt;모든 컬럼&lt;/strong&gt;을 동등 조건으로 사용&lt;/li&gt;
&lt;li&gt;반드시 1건만 반환&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;const가 안 되는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- PK의 일부만 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;165571&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;PK의 일부만 사용하면 ref 타입으로 표시됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;옵티마이저의 상수화&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;const 타입은 쿼리 최적화 단계에서 미리 실행되어 상수로 변환됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 원본 쿼리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; first_name &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e2 &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 옵티마이저가 변환한 쿼리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Jasminko&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;-- 서브쿼리 결과를 상수로 변환&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;3. eq_ref&lt;/h2&gt;
&lt;p&gt;조인에서 &lt;strong&gt;두 번째 이후 테이블&lt;/strong&gt;을 PK/UK로 검색할 때 사용됩니다. 반드시 1건만 반환됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;165571&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;eq_ref 조건&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;조인에서만 사용&lt;/li&gt;
&lt;li&gt;PK/UK의 모든 컬럼을 조인 조건으로 사용&lt;/li&gt;
&lt;li&gt;Unique 인덱스는 NOT NULL이어야 함&lt;/li&gt;
&lt;li&gt;반드시 1건만 반환&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;4. ref&lt;/h2&gt;
&lt;p&gt;인덱스로 &lt;strong&gt;동등 조건 검색&lt;/strong&gt;할 때 사용됩니다. 1건 반환 보장이 없어도 됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ref 컬럼의 const는 비교 값이 상수(&apos;d005&apos;)임을 의미합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;5. fulltext&lt;/h2&gt;
&lt;p&gt;전문 검색(Full-text Search) 인덱스를 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employee_name &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    emp_no &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    first_name &lt;span class=&quot;token keyword&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    last_name &lt;span class=&quot;token keyword&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    FULLTEXT &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; fx_name &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; last_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WITH&lt;/span&gt; PARSER ngram
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;InnoDB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employee_name
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10005&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;MATCH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; last_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; AGAINST&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Facello&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BOOLEAN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;MODE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employee_name&lt;/td&gt;
&lt;td&gt;fulltext&lt;/td&gt;
&lt;td&gt;fx_name&lt;/td&gt;
&lt;td&gt;Using where; Ft_hints: no_ranking&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;쿼리에 전문 검색 조건이 있으면 높은 우선순위로 선택됩니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;const, eq_ref, ref가 아닌 경우 일반 인덱스보다 전문 인덱스를 우선 선택합니다&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;일반 인덱스의 range가 더 빠른 경우가 많으므로 성능 테스트가 필요합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;6. ref_or_null&lt;/h2&gt;
&lt;p&gt;ref와 동일하지만 &lt;strong&gt;NULL 비교(IS NULL)&lt;/strong&gt; 가 추가된 형태입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; titles
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; to_date&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1985-03-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; to_date &lt;span class=&quot;token operator&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;titles&lt;/td&gt;
&lt;td&gt;ref_or_null&lt;/td&gt;
&lt;td&gt;ix_todate&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;자주 사용되지는 않지만, 사용되면 나쁘지 않은 접근 방법입니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;7. unique_subquery&lt;/h2&gt;
&lt;p&gt;IN(subquery)에서 &lt;strong&gt;서브쿼리가 중복 없는 유니크한 값&lt;/strong&gt;만 반환할 때 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- semijoin 최적화를 끄고 테스트&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; optimizer_switch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;semijoin=off&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; departments
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dept_no &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; dept_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;departments&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ux_deptname&lt;/td&gt;
&lt;td&gt;162&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DEPENDENT SUBQUERY&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;unique_subquery&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;MySQL 8.0에서는 세미 조인 최적화로 인해 더 최적화된 실행 계획이 나올 수 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;8. index_subquery&lt;/h2&gt;
&lt;p&gt;IN(subquery)에서 &lt;strong&gt;서브쿼리가 중복된 값을 반환&lt;/strong&gt;할 수 있지만, 인덱스로 중복 제거가 가능할 때 사용됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;unique_subquery vs index_subquery&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;unique_subquery&lt;/strong&gt;: 서브쿼리 결과에 중복 없음, 중복 제거 불필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;index_subquery&lt;/strong&gt;: 서브쿼리 결과에 중복 가능, 인덱스로 중복 제거&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;9. range&lt;/h2&gt;
&lt;p&gt;인덱스를 &lt;strong&gt;범위로 검색&lt;/strong&gt;하는 인덱스 레인지 스캔입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10002&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10004&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;range를 사용하는 연산자&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;&gt;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;&amp;lt;=&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;&gt;=&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;BETWEEN&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IN&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IS NULL&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LIKE&lt;/code&gt; (와일드카드가 뒤에 있는 경우)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;참고사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;일반적으로 &lt;strong&gt;const, ref, range&lt;/strong&gt;를 통칭하여 &quot;인덱스 레인지 스캔&quot;이라 부릅니다. 이 레벨만 돼도 충분히 최적화된 것으로 볼 수 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;10. index_merge&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;2개 이상의 인덱스를 사용&lt;/strong&gt;하여 각각 검색한 후 결과를 병합합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11000&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Smith&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;index_merge&lt;/td&gt;
&lt;td&gt;PRIMARY,ix_firstname&lt;/td&gt;
&lt;td&gt;4,58&lt;/td&gt;
&lt;td&gt;Using union(PRIMARY,ix_firstname); Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;여러 인덱스를 읽으므로 일반적으로 range보다 비효율적입니다&lt;/li&gt;
&lt;li&gt;교집합, 합집합, 중복 제거 등 부가 작업이 필요합니다&lt;/li&gt;
&lt;li&gt;전문 검색 인덱스에는 적용되지 않습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;11. index&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;인덱스 풀 스캔&lt;/strong&gt;을 의미합니다. 인덱스를 처음부터 끝까지 읽습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; departments &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; dept_name &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;departments&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ux_deptname&lt;/td&gt;
&lt;td&gt;162&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;index가 사용되는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;range/const/ref 방법을 사용할 수 없을 때&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인덱스 컬럼만으로 처리 가능한 쿼리&lt;/strong&gt;(커버링 인덱스)&lt;/li&gt;
&lt;li&gt;인덱스로 정렬/그룹핑이 가능한 경우 (별도 정렬 회피)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;12. ALL&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;풀 테이블 스캔&lt;/strong&gt;입니다. 테이블을 처음부터 끝까지 읽습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MySQL에서 가장 비효율적인 방법입니다&lt;/li&gt;
&lt;li&gt;InnoDB는 &lt;strong&gt;리드 어헤드&lt;/strong&gt;(Read Ahead) 기능으로 대량 I/O를 최적화합니다&lt;/li&gt;
&lt;li&gt;데이터 웨어하우스나 배치 프로그램에서는 의도적으로 사용하기도 합니다&lt;/li&gt;
&lt;li&gt;웹 서비스 같은 OLTP 환경에는 적합하지 않습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;MySQL 8.0 병렬 테이블 스캔&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;MySQL 8.0에서는 병렬 쿼리 기능으로 여러 스레드가 동시에 테이블을 스캔할 수 있습니다. (초기이기에 조건 없이 전체 테이블 건수를 가져오는 정도만 가능)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 단일 스레드 (2분 33초)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ SET_VAR(innodb_parallel_read_threads=1) */&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; big_table&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 4개 스레드 (21초)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ SET_VAR(innodb_parallel_read_threads=4) */&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; big_table&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 32개 스레드 (5초)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ SET_VAR(innodb_parallel_read_threads=32) */&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; big_table&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - table, partitions, type 컬럼]]></title><description><![CDATA[이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다. table 컬럼 MySQL 실행 계획은 단위 SELECT 쿼리가 아닌 테이블 기준으로 표시됩니다. 테이블에 별칭이 있으면 별칭이 표시됩니다. 테이블을 사용하지 않는 쿼리 id…]]></description><link>https://gotobill.github.io/mysql-table/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-table/</guid><pubDate>Fri, 24 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 Real MySQL 8.0 책의 내용을 참고하여 작성되었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;table 컬럼&lt;/h2&gt;
&lt;p&gt;MySQL 실행 계획은 단위 SELECT 쿼리가 아닌 &lt;strong&gt;테이블 기준&lt;/strong&gt;으로 표시됩니다. 테이블에 별칭이 있으면 별칭이 표시됩니다.&lt;/p&gt;
&lt;h3&gt;테이블을 사용하지 않는 쿼리&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; DUAL&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;key_len&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;No tables used&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;DUAL 테이블&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Oracle RDBMS 호환성을 위해 MySQL이 내부적으로 지원합니다&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;FROM DUAL&lt;/code&gt;은 자동으로 제거되어 첫 번째 쿼리와 동일하게 처리됩니다&lt;/li&gt;
&lt;li&gt;별도의 테이블을 사용하지 않으면 table 컬럼에 &lt;strong&gt;NULL&lt;/strong&gt;이 표시됩니다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;실제로 &quot;dual&quot;이라는 이름의 테이블을 생성하려면 백틱으로 감싸야 합니다. 하지만 예약어이므로 사용하지 않는 것이 좋습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;token identifier&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;dual&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;token identifier&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;dual&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token identifier&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;dual&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;임시 테이블 표시&lt;/h3&gt;
&lt;p&gt;table 컬럼에 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived N&gt;&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;union M,N&gt;&lt;/code&gt; 형태로 표시되면 임시 테이블을 의미합니다. 숫자는 단위 SELECT 쿼리의 id 값입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de &lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; tb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived2&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;331143&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DERIVED&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_empno_fromdate&lt;/td&gt;
&lt;td&gt;331143&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;실행 계획 분석&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;첫 번째 라인의 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived2&gt;&lt;/code&gt;는 id=2인 라인이 먼저 실행되어야 함을 의미합니다&lt;/li&gt;
&lt;li&gt;세 번째 라인(id=2)은 DERIVED 타입으로 dept_emp 테이블에서 파생 테이블을 생성합니다&lt;/li&gt;
&lt;li&gt;첫 번째와 두 번째 라인은 id가 같으므로 조인 쿼리입니다&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived2&gt;&lt;/code&gt;가 먼저 표시되므로 드라이빙 테이블이고, e 테이블이 드리븐 테이블입니다&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;MATERIALIZED 서브쿼리&lt;/h3&gt;
&lt;p&gt;MySQL 8.0에서는 서브쿼리 최적화가 개선되었습니다. &lt;strong&gt;select_type이 MATERIALIZED&lt;/strong&gt;인 경우 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;subquery N&gt;&lt;/code&gt; 형태로 표시됩니다.&lt;/p&gt;
&lt;p&gt;이는 서브쿼리 결과를 구체화(Materialization)해서 임시 테이블로 만든 것이며, &lt;code class=&quot;language-text&quot;&gt;&amp;lt;derived N&gt;&lt;/code&gt;과 동일하게 해석하면 됩니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;partitions 컬럼&lt;/h2&gt;
&lt;p&gt;MySQL 8.0부터는 &lt;code class=&quot;language-text&quot;&gt;EXPLAIN&lt;/code&gt; 명령으로 파티션 관련 실행 계획까지 모두 확인할 수 있습니다.&lt;/p&gt;
&lt;h3&gt;파티션 테이블 예시&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employees_2 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    emp_no &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    birth_date &lt;span class=&quot;token keyword&quot;&gt;DATE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    first_name &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    last_name &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    gender &lt;span class=&quot;token keyword&quot;&gt;ENUM&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;M&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;F&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    hire_date &lt;span class=&quot;token keyword&quot;&gt;DATE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; hire_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; RANGE &lt;span class=&quot;token keyword&quot;&gt;COLUMNS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hire_date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; p1986_1990 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; LESS THAN &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; p1991_1995 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; LESS THAN &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1996-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; p1996_2000 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; LESS THAN &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2000-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;PARTITION&lt;/span&gt; p2001_2005 &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; LESS THAN &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2006-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; employees_2 &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;파티션 프루닝(Partition Pruning)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees_2
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; hire_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1999-11-15&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2000-01-15&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;partitions&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees_2&lt;/td&gt;
&lt;td&gt;p1996_2000,p2001_2005&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;21743&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;파티션 프루닝이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;옵티마이저가 WHERE 조건을 분석하여 필요한 파티션만 골라내는 과정입니다. &lt;strong&gt;위 쿼리는 4개 파티션 중 2개만 접근합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;type이 ALL인데 일부만 읽는 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;파티션은 물리적으로 개별 테이블처럼 별도의 저장 공간을 가집니다.&lt;/p&gt;
&lt;p&gt;따라서 전체 테이블이 아닌 p1996_2000과 p2001_2005 파티션만 풀 스캔합니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MySQL 실행 계획 - id와 select_type]]></title><description><![CDATA[실행 계획 포맷 MySQL 8.0부터는 실행 계획을 세 가지 포맷으로 출력할 수 있습니다. TABLE 포맷 (기본): 가장 일반적인 표 형태 TREE 포맷: 실행 순서를 들여쓰기로 표현 JSON 포맷: 상세한 정보를 JSON으로 제공 TABLE…]]></description><link>https://gotobill.github.io/mysql-select-type/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-select-type/</guid><pubDate>Thu, 23 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;실행 계획 포맷&lt;/h2&gt;
&lt;p&gt;MySQL 8.0부터는 실행 계획을 세 가지 포맷으로 출력할 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;TABLE 포맷&lt;/strong&gt; (기본): 가장 일반적인 표 형태&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TREE 포맷&lt;/strong&gt;: 실행 순서를 들여쓰기로 표현&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JSON 포맷&lt;/strong&gt;: 상세한 정보를 JSON으로 제공&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 기본 TABLE 포맷&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; salaries s &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ABC&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- TREE 포맷&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TREE
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- JSON 포맷&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;JSON
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;TABLE 포맷 실행 계획 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
|----|-------------|-------|------------|------|---------------|-----|---------|-----|------|----------|-------|
| 1 | SIMPLE | e | NULL | ref | PRIMARY,ix_firstname | ix_firstname | 58 | const | 1 | 100.00 | NULL |
| 1 | SIMPLE | s | NULL | ref | PRIMARY | PRIMARY | 4 | employees.e.emp_no | 10 | 100.00 | NULL |&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 포스트에서는 가독성이 높은 &lt;strong&gt;TABLE 포맷&lt;/strong&gt;을 중심으로 설명합니다.&lt;/p&gt;
&lt;h2&gt;실행 계획 읽는 기본 원칙&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;기본 규칙&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;조인 쿼리의 경우 id가 같으며, 위에서 아래로 순서대로 실행됩니다&lt;/li&gt;
&lt;li&gt;서브쿼리나 UNION이 포함되면 실행 순서가 복잡해지므로 TREE 포맷으로 확인해야 합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;id 칼럼&lt;/h2&gt;
&lt;p&gt;단위 SELECT 쿼리별로 부여되는 식별자입니다.&lt;/p&gt;
&lt;h3&gt;같은 id - 조인&lt;/h3&gt;
&lt;p&gt;하나의 SELECT 문장에서 여러 테이블을 조인하면 같은 id가 부여됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; salaries s
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;employees.e.emp_no&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;두 테이블 모두 &lt;strong&gt;id=1&lt;/strong&gt;로 동일합니다. 같은 SELECT 쿼리 안에서 조인되었기 때문입니다.&lt;/p&gt;
&lt;h3&gt;다른 id - 서브쿼리&lt;/h3&gt;
&lt;p&gt;서브쿼리가 포함되면 각 단위 SELECT마다 다른 id가 부여됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; departments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt; total_count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;No tables used&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;SUBQUERY&lt;/td&gt;
&lt;td&gt;departments&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ux_deptname&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;SUBQUERY&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_hiredate&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;3개의 단위 SELECT 쿼리가 각각 &lt;strong&gt;id=1, 2, 3&lt;/strong&gt;을 받았습니다.&lt;/p&gt;
&lt;h3&gt;실행 순서 확인 - TREE 포맷&lt;/h3&gt;
&lt;p&gt;TABLE 포맷에서는 실행 순서가 헷갈릴 수 있습니다. TREE 포맷을 사용하면 명확합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TREE
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
    &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
    &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Georgi&apos;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Facello&apos;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;TABLE 포맷&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_empno_fromdate&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;SUBQUERY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;253&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;TABLE 포맷만 보면 dept_emp가 먼저 실행될 것 같지만, 실제로는 &lt;strong&gt;employees → dept_emp&lt;/strong&gt; 순서입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TREE 포맷&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-&gt; Filter: (de.emp_no = (select #2)) (cost=1.10 rows=1)
   -&gt; Index lookup on de using ix_empno_fromdate (emp_no=(select #2)) (cost=1.10 rows=1)
   -&gt; Select #2 (subquery in condition; run only once)
         -&gt; Limit: 1 row(s)
            -&gt; Filter: (e.last_name = &apos;Facello&apos;) (cost=70.49 rows=25)
               -&gt; Index lookup on e using ix_firstname (first_name=&apos;Georgi&apos;) (cost=70.49 rows=253)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;가장 들여쓰기가 많은 부분(employees 테이블)부터 실행됩니다.
Index lookup on de가 &lt;code class=&quot;language-text&quot;&gt;emp_no=(select #2)&lt;/code&gt;를 사용하므로, Select #2가 완료되어야 emp_no 값을 알 수 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;select_type 칼럼&lt;/h2&gt;
&lt;p&gt;각 단위 SELECT 쿼리가 어떤 타입인지 표시하는 칼럼입니다.&lt;/p&gt;
&lt;h3&gt;SIMPLE&lt;/h3&gt;
&lt;p&gt;UNION이나 서브쿼리를 사용하지 않는 단순한 SELECT 쿼리입니다. 조인이 포함되어도 SIMPLE입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실행 계획에서 &lt;strong&gt;SIMPLE은 하나만&lt;/strong&gt; 존재합니다. 가장 바깥쪽 SELECT가 SIMPLE로 표시됩니다.&lt;/p&gt;
&lt;h3&gt;PRIMARY&lt;/h3&gt;
&lt;p&gt;UNION이나 서브쿼리가 있는 SELECT 쿼리에서 가장 바깥쪽 쿼리입니다.&lt;/p&gt;
&lt;p&gt;바깥쪽 SELECT가 &lt;strong&gt;PRIMARY&lt;/strong&gt;로 표시되고, &lt;strong&gt;PRIMARY도 하나만&lt;/strong&gt; 존재합니다.&lt;/p&gt;
&lt;h3&gt;UNION&lt;/h3&gt;
&lt;p&gt;UNION으로 결합하는 단위 SELECT 중 &lt;strong&gt;두 번째 이후&lt;/strong&gt; 쿼리입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1 &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e2 &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e3 &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; tb&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;&amp;#x3C;derived2&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DERIVED&lt;/td&gt;
&lt;td&gt;e1&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_hiredate&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;UNION&lt;/td&gt;
&lt;td&gt;e2&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_hiredate&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;UNION&lt;/td&gt;
&lt;td&gt;e3&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_hiredate&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;첫 번째(e1)는 DERIVED, 나머지(e2, e3)는 &lt;strong&gt;UNION&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h3&gt;DEPENDENT UNION&lt;/h3&gt;
&lt;p&gt;UNION이면서 외부 쿼리에 의존하는 경우입니다.&lt;/p&gt;
&lt;h4&gt;Before&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e2 &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e3 &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;After&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e1
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e2 
     &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- e1 추가됨!&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e3 
     &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;-- e1 추가됨!&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;mysql이 자동으로 &lt;strong&gt;semijoin&lt;/strong&gt;으로 변환&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;ref&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e1&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DEPENDENT SUBQUERY&lt;/td&gt;
&lt;td&gt;e2&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;func&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;DEPENDENT UNION&lt;/td&gt;
&lt;td&gt;e3&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;func&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;UNION RESULT&lt;/td&gt;
&lt;td&gt;&amp;#x3C;union2,3&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;Using temporary&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;UNION의 두 번째 쿼리(e3)가 외부 쿼리(e1.emp_no)에 의존하므로 &lt;strong&gt;DEPENDENT UNION&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;내부적으로 &lt;code class=&quot;language-text&quot;&gt;e2.emp_no = e1.emp_no&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;e3.emp_no = e1.emp_no&lt;/code&gt; 조건이 자동 추가됩니다.&lt;/p&gt;
&lt;h3&gt;UNION RESULT&lt;/h3&gt;
&lt;p&gt;UNION 결과를 담는 임시 테이블입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100000&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;DISTINCT&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; from_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2001-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;salaries&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_salary&lt;/td&gt;
&lt;td&gt;191348&lt;/td&gt;
&lt;td&gt;Using where; Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;UNION&lt;/td&gt;
&lt;td&gt;dept_emp&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_fromdate&lt;/td&gt;
&lt;td&gt;5325&lt;/td&gt;
&lt;td&gt;Using where; Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;UNION RESULT&lt;/td&gt;
&lt;td&gt;&amp;#x3C;union1,2&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;Using temporary&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;#x3C;union1,2&gt;는 &lt;strong&gt;id=1과 id=2&lt;/strong&gt;의 결과를 UNION했다는 의미입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UNION ALL vs UNION&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- UNION ALL은 UNION RESULT 없음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100000&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ALL&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; from_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2001-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e3e463cb04c524b114bd76987d743a48/1bba8/10.3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42n2RWYvCQBCE8///iiAo+hIVjYiYRBEVDJ5R0XiC4n2XVi1Z8rDswEfXVNI93TPGdrvFbDbDfD4XUU0WiwWCIBDUUT+E+9VqhefzCaNSqSAej8M0TSSTSaTTacVUKiWvXC4jkUhoT02PlEol5PN5WJaFYrGIQqGA4/EIg2YsFoPneWi328jlcqjVauj3++h0OhiNRnAcB7btYDwey+/1eupqOp0Kavqn0+mnYCaT0UiHw+Gb7H7HDrDb7TQGY7fbhe/7+r7ZbLBcLnE+n9URoaangvV6XZ0xgV3ato1ms4nhcPiL67oak51PJhPdGwvt93tBzS5VMLxsJlarVRVvNBoYDAbyWq2WDshms4Lj8uHW67UmINT0rtcrjMvlAnK/3/F6vfRSjI/HQ0Q1Rwv/+Qsu4/1+43a7CZ4QEvVCHSb9tz7LX0hrR//+RAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.3&quot;
        title=&quot;&quot;
        src=&quot;/static/e3e463cb04c524b114bd76987d743a48/f058b/10.3.png&quot;
        srcset=&quot;/static/e3e463cb04c524b114bd76987d743a48/c26ae/10.3.png 158w,
/static/e3e463cb04c524b114bd76987d743a48/6bdcf/10.3.png 315w,
/static/e3e463cb04c524b114bd76987d743a48/f058b/10.3.png 630w,
/static/e3e463cb04c524b114bd76987d743a48/1bba8/10.3.png 642w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;MySQL 8.0부터 UNION ALL은 임시 테이블을 사용하지 않으므로 UNION RESULT가 없습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;그러나 UNION이나 UNION DISTINCT는 여전히 중복 제거를 위해 임시 테이블에서 버퍼링하기에 UNION RESULT가 필요함.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;SUBQUERY&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FROM 절 이외에서 사용되는 서브쿼리만을 의미합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dept_manager dm
        &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt; cnt
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;const&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;SUBQUERY&lt;/td&gt;
&lt;td&gt;dm&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;SUBQUERY&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;41392&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;서브쿼리 용어 정리&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;서브쿼리는 사용하는 위치에 따라 각각 다른 이름을 지니고 있다.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;중첩된 쿼리(Nested Query)&lt;/strong&gt;: SELECT되는 칼럼에 사용된 서브쿼리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;서브쿼리(Subquery)&lt;/strong&gt;: WHERE 절에 사용된 서브쿼리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;파생 테이블(Derived Table)&lt;/strong&gt;: FROM 절에 사용된 서브쿼리 (인라인 뷰, 서브 셀렉트라고도 함)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;서브쿼리가 반환하는 값의 특성에 따라:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;스칼라 서브쿼리(Scalar Subquery)&lt;/strong&gt;: 하나의 값만 반환 (칼럼 1개, 레코드 1건)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;로우 서브쿼리(Row Subquery)&lt;/strong&gt;: 하나의 레코드만 반환 (칼럼 개수 무관)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3&gt;DEPENDENT SUBQUERY&lt;/h3&gt;
&lt;p&gt;서브쿼리가 외부 SELECT 쿼리의 칼럼을 사용하는 경우입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dept_manager dm
        &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; dm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt; cnt
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;233&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DEPENDENT SUBQUERY&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_empno_fromdate&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DEPENDENT SUBQUERY&lt;/td&gt;
&lt;td&gt;dm&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;서브쿼리가 외부 쿼리의 &lt;code class=&quot;language-text&quot;&gt;e.emp_no&lt;/code&gt;를 참조하므로 &lt;strong&gt;DEPENDENT SUBQUERY&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;외부 쿼리가 먼저 실행되고, 각 레코드마다 서브쿼리가 실행되므로 일반 SUBQUERY보다 느릴 수 있습니다.&lt;/p&gt;
&lt;h3&gt;DERIVED&lt;/h3&gt;
&lt;p&gt;FROM 절에 사용된 서브쿼리입니다. 임시 테이블(파생 테이블)을 생성합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de &lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; tb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;&amp;#x3C;derived2&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;331143&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DERIVED&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;ix_empno_fromdate&lt;/td&gt;
&lt;td&gt;331143&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;FROM 절의 서브쿼리(tb)가 &lt;strong&gt;DERIVED&lt;/strong&gt;로 표시되고, &amp;#x3C;derived2&gt;라는 임시 테이블이 생성됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MySQL 8.0부터는 가능하면 서브쿼리를 조인으로 재작성하여 최적화합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;쿼리를 튜닝하기 위해 실행 계획을 확인할 때 가장 먼저 select_type 칼럼의 값이 DERIVED인 것이 있는지 확인해야 한다.
&lt;br&gt;
&lt;br&gt;
&lt;strong&gt;서브쿼리를 조인으로 해결할 수 있는 경우라면 서브쿼리보다는 조인을 사용할 것을 강력히 권장한다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;DEPENDENT DERIVED&lt;/h3&gt;
&lt;p&gt;MySQL 8.0부터 지원하는 래터럴 조인(LATERAL JOIN)에서 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; LATERAL &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries s
    &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
    &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AS&lt;/span&gt; s2 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; s2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;Rematerialize (&amp;#x3C;derived2&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;&amp;#x3C;derived2&gt;&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;&amp;#x3C;auto_key0&gt;&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;DEPENDENT DERIVED&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;Using filesort&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;FROM 절의 서브쿼리가 외부 칼럼(e.emp_no)을 참조하므로 &lt;strong&gt;DEPENDENT DERIVED&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h3&gt;UNCACHEABLE SUBQUERY&lt;/h3&gt;
&lt;p&gt;서브쿼리 결과를 캐시할 수 없는 경우입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;서브쿼리 캐시 동작&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SUBQUERY&lt;/strong&gt;: 처음 한 번만 실행하고 결과를 캐시&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DEPENDENT SUBQUERY&lt;/strong&gt;: 외부 쿼리 값마다 캐시 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/80b519a7d4e901878d481ad124e0936b/ddc81/10.4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVR42pVSyYrCUBD0/7/Bq+hBJbgmiKioBzVG3IOQuKGi4hJxFy2nenCZw+BMQ5Pkpbu6qvq58BaXywWHwwGj0QjD4RDdbhebzQan0wm3201qzuczdrsdJpMJBoOB1Gy3WxyPR/nvIggP+Gy32wgEAohEIlAUBcFgEIlEAplMBtPpFI7jIJvNwufzyf9wOIx8Po9yuSzgArher2FZFsbjMXK5HLxeL0KhkDQw4/E4YrEYUqmU1BmGgWQyiXQ6jWg0Kmo4aLVavRjygDJY6Ha7BdTj8Uj6/X5hSuaUN5vNUK1WYZqmDOr1elgul5JPQH5QNht0XUetVpMmZqPRQKfTEfatVkukk2Wz2YSmaQK4WCxegPgQj2XYti0ecxmFQkGG0kN6R9t+ALLpt7xer1JoWbYwpFeUy3dVVYUhfZzP51L/L4b1ev15vt/vxQ5aRYbcA6/UnwH7/f4XI02Ai8USSqXvJPB7fAR8BKVTZqViPO8eF0RW74PvODzfb7zPfSgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;그림 10.4&quot;
        title=&quot;&quot;
        src=&quot;/static/80b519a7d4e901878d481ad124e0936b/f058b/10.4.png&quot;
        srcset=&quot;/static/80b519a7d4e901878d481ad124e0936b/c26ae/10.4.png 158w,
/static/80b519a7d4e901878d481ad124e0936b/6bdcf/10.4.png 315w,
/static/80b519a7d4e901878d481ad124e0936b/f058b/10.4.png 630w,
/static/80b519a7d4e901878d481ad124e0936b/ddc81/10.4.png 837w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;캐시 불가능한 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;사용자 변수 사용&lt;/li&gt;
&lt;li&gt;NOT-DETERMINISTIC 스토어드 루틴 사용&lt;/li&gt;
&lt;li&gt;UUID(), RAND() 같은 비결정적 함수 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;@status&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; dept_emp de
    &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; de&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dept_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;d005&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;300252&lt;/td&gt;
&lt;td&gt;Using where&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;UNCACHEABLE SUBQUERY&lt;/td&gt;
&lt;td&gt;de&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;165571&lt;/td&gt;
&lt;td&gt;Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;사용자 변수 &lt;code class=&quot;language-text&quot;&gt;@status&lt;/code&gt;를 사용하므로 &lt;strong&gt;UNCACHEABLE SUBQUERY&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h3&gt;UNCACHEABLE UNION&lt;/h3&gt;
&lt;p&gt;UNION이면서 캐시할 수 없는 경우입니다. UNION과 UNCACHEABLE의 속성을 모두 가집니다.&lt;/p&gt;
&lt;h3&gt;MATERIALIZED&lt;/h3&gt;
&lt;p&gt;MySQL 5.7부터 IN(subquery)나 FROM 절 서브쿼리를 임시 테이블로 구체화하여 최적화합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; emp_no &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;Extra&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;&amp;#x3C;subquery2&gt;&lt;/td&gt;
&lt;td&gt;ALL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;eq_ref&lt;/td&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;MATERIALIZED&lt;/td&gt;
&lt;td&gt;salaries&lt;/td&gt;
&lt;td&gt;range&lt;/td&gt;
&lt;td&gt;ix_salary&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Using where; Using index&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;서브쿼리 내용이 임시 테이블로 &lt;strong&gt;구체화&lt;/strong&gt;(Materialization)되어 employees 테이블과 조인됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MySQL 5.6까지는 employees 테이블의 각 레코드마다 서브쿼리를 실행했지만, 5.7부터는 서브쿼리를 먼저 구체화한 후 조인하므로 성능이 개선되었습니다.&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MySQL 코스트 모델 이해하기]]></title><description><![CDATA[코스트 모델이란? MySQL 옵티마이저는 여러 실행 계획 중에서 가장 비용이 낮은 계획을 선택합니다. 이때 비용을 계산하는 기준이 코스트 모델(Cost Model…]]></description><link>https://gotobill.github.io/mysql-cost-model/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-cost-model/</guid><pubDate>Sun, 19 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;코스트 모델이란?&lt;/h2&gt;
&lt;p&gt;MySQL 옵티마이저는 여러 실행 계획 중에서 가장 &lt;strong&gt;비용이 낮은&lt;/strong&gt; 계획을 선택합니다. 이때 비용을 계산하는 기준이 &lt;strong&gt;코스트 모델&lt;/strong&gt;(Cost Model)입니다.&lt;/p&gt;
&lt;h3&gt;쿼리 실행에 필요한 작업들&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders o
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; customers c &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;customer_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amount &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;created_at&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 쿼리를 실행하려면:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;디스크에서 데이터 페이지 읽기&lt;/li&gt;
&lt;li&gt;InnoDB 버퍼 풀에서 데이터 페이지 읽기&lt;/li&gt;
&lt;li&gt;인덱스 키 비교&lt;/li&gt;
&lt;li&gt;WHERE 조건 레코드 평가&lt;/li&gt;
&lt;li&gt;정렬을 위한 임시 테이블 생성&lt;/li&gt;
&lt;li&gt;조인 수행&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;각 작업마다 비용이 다릅니다. 디스크 읽기는 메모리 읽기보다 느리고, 정렬은 단순 비교보다 비쌉니다.&lt;/p&gt;
&lt;h3&gt;코스트 모델의 역할&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;실행 계획 A = (디스크 읽기 × 100) + (메모리 읽기 × 1000) + (키 비교 × 500)
실행 계획 B = (디스크 읽기 × 10) + (메모리 읽기 × 5000) + (키 비교 × 2000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;옵티마이저는 이런 식으로 각 실행 계획의 총 비용을 계산하고, 가장 비용이 낮은 계획을 선택합니다.&lt;/p&gt;
&lt;h2&gt;MySQL 5.7 이전 vs 5.7+&lt;/h2&gt;
&lt;h3&gt;MySQL 5.7 이전: 하드코딩된 비용&lt;/h3&gt;
&lt;p&gt;각 단위 작업의 비용이 MySQL 소스 코드에 상수로 고정되어 있었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// MySQL 소스 코드 (의사 코드)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; DISK_READ_COST &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; MEMORY_READ_COST &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.25&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; KEY_COMPARE_COST &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버 하드웨어가 바뀌어도 비용은 동일&lt;/li&gt;
&lt;li&gt;사용자가 조정 불가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;MySQL 5.7+: 조정 가능한 코스트 모델&lt;/h3&gt;
&lt;p&gt;비용 정보를 시스템 테이블에 저장하여 관리자가 조정할 수 있게 되었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 코스트 모델 테이블 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_cost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;engine_cost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;MySQL 8.0에서는 히스토그램과 버퍼 풀 메모리 적재 비율까지 반영하여 정확도가 더 높아졌습니다.&lt;/p&gt;
&lt;h2&gt;코스트 모델 구성&lt;/h2&gt;
&lt;h3&gt;server_cost 테이블&lt;/h3&gt;
&lt;p&gt;쿼리 처리 과정의 일반적인 작업 비용을 관리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    cost_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    default_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    cost_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;comment&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_cost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;cost_name&lt;/th&gt;
&lt;th&gt;default_value&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;disk_temptable_create_cost&lt;/td&gt;
&lt;td&gt;20.00&lt;/td&gt;
&lt;td&gt;디스크 임시 테이블 생성&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;disk_temptable_row_cost&lt;/td&gt;
&lt;td&gt;0.50&lt;/td&gt;
&lt;td&gt;디스크 임시 테이블 레코드 읽기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;key_compare_cost&lt;/td&gt;
&lt;td&gt;0.05&lt;/td&gt;
&lt;td&gt;인덱스 키 비교&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;memory_temptable_create_cost&lt;/td&gt;
&lt;td&gt;1.00&lt;/td&gt;
&lt;td&gt;메모리 임시 테이블 생성&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;memory_temptable_row_cost&lt;/td&gt;
&lt;td&gt;0.10&lt;/td&gt;
&lt;td&gt;메모리 임시 테이블 레코드 읽기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;row_evaluate_cost&lt;/td&gt;
&lt;td&gt;0.10&lt;/td&gt;
&lt;td&gt;레코드 조건 평가&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;engine_cost 테이블&lt;/h3&gt;
&lt;p&gt;스토리지 엔진별 작업 비용을 관리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    engine_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    cost_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    default_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    cost_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;comment&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;engine_cost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;engine_name&lt;/th&gt;
&lt;th&gt;cost_name&lt;/th&gt;
&lt;th&gt;default_value&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;default&lt;/td&gt;
&lt;td&gt;io_block_read_cost&lt;/td&gt;
&lt;td&gt;1.00&lt;/td&gt;
&lt;td&gt;디스크 데이터 페이지 읽기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;default&lt;/td&gt;
&lt;td&gt;memory_block_read_cost&lt;/td&gt;
&lt;td&gt;0.25&lt;/td&gt;
&lt;td&gt;메모리 데이터 페이지 읽기&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;engine_name&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;default&lt;/strong&gt;: 모든 스토리지 엔진에 적용되는 기본값&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;InnoDB&lt;/strong&gt;, &lt;strong&gt;MyISAM&lt;/strong&gt;, &lt;strong&gt;MEMORY&lt;/strong&gt;: 특정 엔진별로 다른 값 설정 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;현재는 InnoDB에서만 코스트 모델이 의미 있게 작동합니다.&lt;/p&gt;
&lt;h2&gt;단위 작업 비용이 미치는 영향&lt;/h2&gt;
&lt;p&gt;각 비용을 조정하면 옵티마이저의 선택이 달라집니다. 하지만 &lt;strong&gt;절대 함부로 변경하지 마세요.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;row_evaluate_cost&lt;/h3&gt;
&lt;p&gt;레코드 조건 평가 비용입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;값을 높이면&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 많은 레코드를 평가하는 풀 테이블 스캔이 비쌈&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 적은 레코드를 평가하는 인덱스 레인지 스캔이 선호됨&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;풀 테이블 스캔보다 인덱스 레인지 스캔을 선택할 가능성이 높아집니다.&lt;/p&gt;
&lt;h3&gt;key_compare_cost&lt;/h3&gt;
&lt;p&gt;인덱스 키 비교 비용입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;값을 높이면&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 정렬(ORDER BY)처럼 키 비교가 많은 작업이 비쌈&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 가능하면 정렬을 피하는 실행 계획 선택&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;정렬을 수행하지 않는 방향의 실행 계획을 선택할 가능성이 높아집니다.&lt;/p&gt;
&lt;h3&gt;io_block_read_cost&lt;/h3&gt;
&lt;p&gt;디스크 읽기 비용입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;값을 높이면&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 디스크 읽기가 많은 인덱스는 비쌈&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- InnoDB 버퍼 풀에 많이 적재된 인덱스를 선호&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;버퍼 풀 적중률이 높은 인덱스를 사용할 가능성이 높아집니다.&lt;/p&gt;
&lt;h3&gt;memory_block_read_cost&lt;/h3&gt;
&lt;p&gt;메모리 읽기 비용입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;값을 높이면&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 메모리 읽기도 비싸다고 판단&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 버퍼 풀 적중률이 낮아도 해당 인덱스를 사용 가능&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;버퍼 풀에 적재되지 않았어도 효율적인 인덱스라면 사용할 가능성이 높아집니다.&lt;/p&gt;
&lt;h3&gt;disk_temptable_create_cost&lt;/h3&gt;
&lt;p&gt;디스크 임시 테이블 생성 비용입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;값을 높이면&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 디스크 임시 테이블 생성을 회피&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- GROUP BY, ORDER BY를 인덱스로 처리하려 시도&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;임시 테이블을 만들지 않는 방향의 실행 계획을 선택할 가능성이 높아집니다.&lt;/p&gt;
&lt;h3&gt;기본 EXPLAIN&lt;/h3&gt;
&lt;p&gt;일반적인 EXPLAIN은 비용을 보여주지 않습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;select_type&lt;/th&gt;
&lt;th&gt;table&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;SIMPLE&lt;/td&gt;
&lt;td&gt;employees&lt;/td&gt;
&lt;td&gt;ref&lt;/td&gt;
&lt;td&gt;ix_firstname&lt;/td&gt;
&lt;td&gt;233&lt;/td&gt;
&lt;td&gt;100.00&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;예상 레코드 수(rows)만 표시되고 &lt;strong&gt;비용은 표시되지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;EXPLAIN FORMAT=TREE&lt;/h3&gt;
&lt;p&gt;간단하게 비용을 확인할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TREE
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-&gt; Index lookup on employees using ix_firstname (first_name=&apos;Matt&apos;)
   (cost=256.10 rows=233)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;해석&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;cost=256.10&lt;/strong&gt;: 예상 비용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rows=233&lt;/strong&gt;: 예상 레코드 수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;더 복잡한 쿼리 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TREE
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; hire_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; birth_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-&gt; Sort: employees.birth_date  (cost=285.33 rows=77)
    -&gt; Filter: (employees.hire_date &gt; &apos;1990-01-01&apos;)  (cost=256.10 rows=77)
        -&gt; Index lookup on employees using ix_firstname (first_name=&apos;Matt&apos;)
           (cost=256.10 rows=233)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;해석&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;각 단계별로 들여쓰기되어 표시됩니다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;인덱스 조회&lt;/strong&gt; (cost=256.10): ix_firstname 인덱스로 first_name=&apos;Matt&apos; 검색&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;필터링&lt;/strong&gt; (cost=256.10): hire_date 조건으로 233건 → 77건 필터링&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;정렬&lt;/strong&gt; (cost=285.33): birth_date로 정렬&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;비용이 증가하는 것을 볼 수 있습니다 (256.10 → 285.33).&lt;/p&gt;
&lt;h3&gt;EXPLAIN FORMAT=JSON&lt;/h3&gt;
&lt;p&gt;상세한 비용 정보를 확인할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; FORMAT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;JSON
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;query_block&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;select_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;cost_info&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;query_cost&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;255.08&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;table&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;table_name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;employees&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;access_type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ref&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ix_firstname&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;rows_examined_per_scan&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;233&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;rows_produced_per_join&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;233&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;filtered&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100.00&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;cost_info&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;read_cost&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;231.78&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;eval_cost&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;23.30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;prefix_cost&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;255.08&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;비용 항목&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;read_cost&lt;/strong&gt;: 인덱스/테이블 읽기 비용 (231.78)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;eval_cost&lt;/strong&gt;: 레코드 평가 비용 (23.30)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prefix_cost&lt;/strong&gt;: 전체 비용 (255.08 = read_cost + eval_cost)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;query_cost&lt;/strong&gt;: 쿼리 전체 비용&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;EXPLAIN ANALYZE로 실제 성능 측정&lt;/h3&gt;
&lt;p&gt;MySQL 8.0.18부터 지원하는 기능으로, &lt;strong&gt;실제 쿼리를 실행&lt;/strong&gt;하여 예상 비용과 실제 소요 시간을 함께 보여줍니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EXPLAIN vs EXPLAIN ANALYZE&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;EXPLAIN&lt;/th&gt;
&lt;th&gt;EXPLAIN ANALYZE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;실행 방식&lt;/td&gt;
&lt;td&gt;실행 계획만 수립&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;실제 쿼리 실행&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;소요 시간&lt;/td&gt;
&lt;td&gt;즉시&lt;/td&gt;
&lt;td&gt;쿼리 완료까지 대기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;제공 정보&lt;/td&gt;
&lt;td&gt;예상 비용, 예상 rows&lt;/td&gt;
&lt;td&gt;예상 + &lt;strong&gt;실제 시간, 실제 rows&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;용도&lt;/td&gt;
&lt;td&gt;빠른 계획 확인&lt;/td&gt;
&lt;td&gt;실제 성능 측정&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;기본 사용법&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-&gt; Index lookup on employees using ix_firstname (first_name=&apos;Matt&apos;)
   (cost=256.10 rows=233)
   (actual time=0.348..1.046 rows=233 loops=1)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;필드 설명&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;cost=256.10&lt;/strong&gt;: 예상 비용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rows=233&lt;/strong&gt;: 예상 레코드 수&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;actual time=0.348..1.046&lt;/strong&gt;: 실제 소요 시간 (밀리초)
&lt;ul&gt;
&lt;li&gt;첫 번째 값 (0.348): 첫 레코드를 가져오는 데 걸린 시간&lt;/li&gt;
&lt;li&gt;두 번째 값 (1.046): 마지막 레코드를 가져오는 데 걸린 시간&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rows=233&lt;/strong&gt;: 실제 처리한 레코드 수&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;loops=1&lt;/strong&gt;: 반복 실행 횟수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;TREE 포맷 읽는 법&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;EXPLAIN ANALYZE는 항상 TREE 포맷으로 결과를 표시합니다. 들여쓰기로 실행 순서를 파악할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;AVG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees e
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; salaries s &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
    &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50000&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from_date &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_date &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1990-01-01&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Matt&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hire_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;A) -&gt; Table scan on &amp;lt;temporary&gt;
       (actual time=0.001..0.004 rows=48 loops=1)

B)    -&gt; Aggregate using temporary table
          (actual time=3.799..3.808 rows=48 loops=1)

C)       -&gt; Nested loop inner join (cost=685.24 rows=135)
             (actual time=0.367..3.602 rows=48 loops=1)

D)          -&gt; Index lookup on e using ix_firstname (first_name=&apos;Matt&apos;)
                (cost=215.08 rows=233)
                (actual time=0.348..1.046 rows=233 loops=1)

E)          -&gt; Filter: ((s.salary &gt; 50000) and (s.from_date &amp;lt;= &apos;1990-01-01&apos;)
                        and (s.to_date &gt; &apos;1990-01-01&apos;))
                (actual time=0.009..0.011 rows=0 loops=233)

F)             -&gt; Index lookup on s using PRIMARY (emp_no=e.emp_no)
                   (cost=0.98 rows=10)
                   (actual time=0.007..0.009 rows=10 loops=233)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;실행 순서 규칙&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;들여쓰기가 같은 레벨&lt;/strong&gt;: 상단에 위치한 라인이 먼저 실행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;들여쓰기가 다른 레벨&lt;/strong&gt;: 가장 안쪽에 위치한 라인이 먼저 실행&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;위 쿼리의 실제 실행 순서&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;D) Index lookup on e using ix_firstname&lt;/strong&gt; - employees 테이블 인덱스로 first_name=&apos;Matt&apos; 조회&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;F) Index lookup on s using PRIMARY&lt;/strong&gt; - salaries 테이블 프라이머리 키로 emp_no 조회&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;E) Filter&lt;/strong&gt; - salary, from_date, to_date 조건 필터링&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C) Nested loop inner join&lt;/strong&gt; - 조인 수행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;B) Aggregate using temporary table&lt;/strong&gt; - GROUP BY를 위한 임시 테이블 생성 및 집계&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;A) Table scan on temporary&lt;/strong&gt; - 임시 테이블 결과 반환&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;한글로 풀어쓴 실행 계획&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;employees 테이블의 ix_firstname 인덱스를 통해 first_name=&apos;Matt&apos; 조건에 일치하는 레코드 검색 (233건)&lt;/li&gt;
&lt;li&gt;salaries 테이블의 PRIMARY 키를 통해 emp_no가 1번 결과의 emp_no와 동일한 레코드 검색 (평균 10건씩)&lt;/li&gt;
&lt;li&gt;salary &gt; 50000, from_date &amp;#x3C;= &apos;1990-01-01&apos;, to_date &gt; &apos;1990-01-01&apos; 조건에 일치하는 건만 필터링&lt;/li&gt;
&lt;li&gt;1번과 3번의 결과를 조인&lt;/li&gt;
&lt;li&gt;임시 테이블에 결과를 저장하면서 hire_date로 GROUP BY 집계 실행&lt;/li&gt;
&lt;li&gt;임시 테이블의 결과를 읽어서 최종 반환 (48건)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;loops의 의미&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;F) -&gt; Index lookup on s using PRIMARY (emp_no=e.emp_no)
      (actual time=0.007..0.009 rows=10 loops=233)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;loops=233&lt;/strong&gt;: 이 작업을 233번 반복 실행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rows=10&lt;/strong&gt;: 매번 평균 10건의 레코드 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;actual time=0.007..0.009&lt;/strong&gt;: 첫 레코드는 평균 0.007ms, 마지막 레코드를 읽는데는 평균 0.009ms 소요&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;즉, employees 테이블에서 233명을 찾았고, 각 사람마다 salaries 테이블을 조회(10건씩)하여 총 233번 반복했다는 의미입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;활용 방법&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 1. 먼저 EXPLAIN으로 실행 계획 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 2. 계획이 합리적이면 EXPLAIN ANALYZE로 실제 성능 측정&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EXPLAIN ANALYZE는 &lt;strong&gt;실제로 쿼리를 실행&lt;/strong&gt;합니다&lt;/li&gt;
&lt;li&gt;느린 쿼리는 완료될 때까지 기다려야 결과를 볼 수 있습니다&lt;/li&gt;
&lt;li&gt;대용량 테이블에서는 먼저 EXPLAIN으로 계획을 확인하고 튜닝한 후 사용하세요&lt;/li&gt;
&lt;li&gt;UPDATE, DELETE 쿼리도 실행되므로 프로덕션 환경에서는 주의가 필요합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;단위 작업 비용이 미치는 영향&lt;/h2&gt;</content:encoded></item><item><title><![CDATA[MySQL 히스토그램으로 쿼리 성능 개선하기]]></title><description><![CDATA[기존 통계 정보의 한계 MySQL 5.7까지의 통계 정보는 치명적인 약점이 있었습니다. 데이터 분포를 전혀 알 수 없다는 점입니다. 평균만 알려주는 통계 10…]]></description><link>https://gotobill.github.io/mysql-histogram/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-histogram/</guid><pubDate>Sat, 18 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;기존 통계 정보의 한계&lt;/h2&gt;
&lt;p&gt;MySQL 5.7까지의 통계 정보는 치명적인 약점이 있었습니다. &lt;strong&gt;데이터 분포를 전혀 알 수 없다는 점&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;h3&gt;평균만 알려주는 통계&lt;/h3&gt;
&lt;p&gt;100만 건의 주문 테이블에서 사용자별 통계를 보겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 통계 정보&lt;/span&gt;
전체 레코드: &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;000&lt;/span&gt;건
유니크한 user_id: &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;000&lt;/span&gt;개&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;옵티마이저는 이렇게 계산합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;평균 주문 건수 = 1,000,000 / 10,000 = 100건&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;실제 데이터 분포&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; order_count
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; user_id
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; order_count &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;user_id&lt;/th&gt;
&lt;th&gt;order_count&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1001&lt;/td&gt;
&lt;td&gt;50000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1002&lt;/td&gt;
&lt;td&gt;45000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1003&lt;/td&gt;
&lt;td&gt;30000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9999&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;실제로는 소수의 VIP 고객이 대부분의 주문을 차지하지만, 옵티마이저는 모든 사용자가 평균 100건씩 주문했다고 가정합니다.&lt;/p&gt;
&lt;h3&gt;잘못된 실행 계획의 결과&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders o
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; order_items oi &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;order_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; oi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;order_id
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- VIP 고객 (50000건)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;옵티마이저 판단 (히스토그램 없이)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;user_id = 1001은 대략 100건일 것이다&lt;/li&gt;
&lt;li&gt;orders 테이블을 먼저 읽고 order_items와 조인하면 되겠다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;실제 실행&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;orders에서 50000건 조회&lt;/li&gt;
&lt;li&gt;order_items와 50000번 조인&lt;/li&gt;
&lt;li&gt;예상보다 500배 많은 데이터 처리&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이런 상황에서 히스토그램이 필요합니다.&lt;/p&gt;
&lt;h2&gt;히스토그램이란?&lt;/h2&gt;
&lt;p&gt;히스토그램은 칼럼값의 &lt;strong&gt;분포도&lt;/strong&gt;를 저장하는 통계 정보입니다. MySQL 8.0부터 지원됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;평균 vs 분포&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;기존 통계&lt;/th&gt;
&lt;th&gt;히스토그램&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;제공 정보&lt;/td&gt;
&lt;td&gt;평균&lt;/td&gt;
&lt;td&gt;구간별 분포&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id=1001 예측&lt;/td&gt;
&lt;td&gt;100건&lt;/td&gt;
&lt;td&gt;50000건&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id=9999 예측&lt;/td&gt;
&lt;td&gt;100건&lt;/td&gt;
&lt;td&gt;1건&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;정확도&lt;/td&gt;
&lt;td&gt;낮음&lt;/td&gt;
&lt;td&gt;높음&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;히스토그램을 사용하면 옵티마이저가 실제 데이터 분포를 알고 더 정확한 실행 계획을 수립할 수 있습니다.&lt;/p&gt;
&lt;h2&gt;히스토그램 종류&lt;/h2&gt;
&lt;p&gt;MySQL 8.0은 두 가지 히스토그램을 지원합니다.&lt;/p&gt;
&lt;h3&gt;Singleton 히스토그램&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;값별로&lt;/strong&gt; 레코드 건수를 관리합니다. 값의 개수가 적을 때 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 성별 칼럼 (값이 2개)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; gender&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    COLUMN_NAME&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    JSON_EXTRACT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HISTOGRAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;$.histogram-type&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; information_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;COLUMN_STATISTICS
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; SCHEMA_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;employees&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; TABLE_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;employees&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;히스토그램 데이터 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;buckets&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// &apos;M&apos;: 60%&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token comment&quot;&gt;// &apos;F&apos;: 40% (누적 100%)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;data-type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;enum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;histogram-type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;singleton&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;해석&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;남성(&apos;M&apos;): 60%&lt;/li&gt;
&lt;li&gt;여성(&apos;F&apos;): 40% (1.0 - 0.6)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;모든 값이 누적 비율로 표시됩니다.&lt;/p&gt;
&lt;h3&gt;Equi-Height 히스토그램&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;범위별로&lt;/strong&gt; 레코드 건수를 관리합니다. 값의 개수가 많을 때 사용됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 입사일 칼럼 (값이 수천 개)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; hire_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;히스토그램 데이터 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;buckets&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;1985-01-01&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1990-12-31&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.25&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1980년대: 25%&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;1991-01-01&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1995-12-31&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1990년대 전반: 25%&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;1996-01-01&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2000-12-31&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.75&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1990년대 후반: 25%&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2001-01-01&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2005-12-31&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1400&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 2000년대: 25%&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;histogram-type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;equi-height&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 버킷은 &lt;strong&gt;비슷한 레코드 건수&lt;/strong&gt;를 갖도록 범위가 나뉩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;버킷 구성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;범위 시작값&lt;/li&gt;
&lt;li&gt;범위 종료값&lt;/li&gt;
&lt;li&gt;누적 비율&lt;/li&gt;
&lt;li&gt;유니크 값 개수&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;히스토그램 생성 및 관리&lt;/h2&gt;
&lt;h3&gt;히스토그램 생성&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 단일 칼럼&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 여러 칼럼&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; product_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; amount&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 버킷 개수 지정 (기본값 100, 최대 1024)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id &lt;span class=&quot;token keyword&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; BUCKETS&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;히스토그램 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 히스토그램 목록 조회&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    SCHEMA_NAME&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    TABLE_NAME&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    COLUMN_NAME&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    JSON_EXTRACT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HISTOGRAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;$.histogram-type&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    JSON_EXTRACT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HISTOGRAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;$.number-of-buckets-specified&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; buckets
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; information_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;COLUMN_STATISTICS&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;SCHEMA_NAME&lt;/th&gt;
&lt;th&gt;TABLE_NAME&lt;/th&gt;
&lt;th&gt;COLUMN_NAME&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;buckets&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;mydb&lt;/td&gt;
&lt;td&gt;orders&lt;/td&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;&quot;equi-height&quot;&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mydb&lt;/td&gt;
&lt;td&gt;orders&lt;/td&gt;
&lt;td&gt;amount&lt;/td&gt;
&lt;td&gt;&quot;equi-height&quot;&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;히스토그램 삭제&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 히스토그램 삭제 (즉시 완료, 데이터는 건드리지 않음)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;DROP&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; amount&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;히스토그램 삭제는 딕셔너리 정보만 제거하므로 빠르게 완료됩니다. 하지만 삭제 후 실행 계획이 달라질 수 있으니 주의해야 합니다.&lt;/p&gt;
&lt;h2&gt;히스토그램의 성능 개선 효과&lt;/h2&gt;
&lt;h3&gt;조건절 예측 정확도 향상&lt;/h3&gt;
&lt;p&gt;히스토그램이 없을 때와 있을 때의 차이를 비교해보겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 히스토그램 없이 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Zita&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; birth_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1960-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;th&gt;예상 건수&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;224&lt;/td&gt;
&lt;td&gt;11.11%&lt;/td&gt;
&lt;td&gt;24.8건&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;옵티마이저는 birth_date가 균등 분포라고 가정하여 11.11%를 예측했습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 히스토그램 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; birth_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 다시 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Zita&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; birth_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1960-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;rows&lt;/th&gt;
&lt;th&gt;filtered&lt;/th&gt;
&lt;th&gt;예상 건수&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;224&lt;/td&gt;
&lt;td&gt;60.82%&lt;/td&gt;
&lt;td&gt;136.2건&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;히스토그램을 사용하니 실제 데이터 분포를 반영하여 60.82%로 정확히 예측했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제 데이터 확인&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; total&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;SUM&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;CASE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHEN&lt;/span&gt; birth_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1960-01-01&apos;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ELSE&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;END&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;matched&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;ROUND&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SUM&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;CASE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHEN&lt;/span&gt; birth_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1960-01-01&apos;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;THEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ELSE&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;END&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; ratio
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Zita&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;total&lt;/th&gt;
&lt;th&gt;matched&lt;/th&gt;
&lt;th&gt;ratio&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;224&lt;/td&gt;
&lt;td&gt;143&lt;/td&gt;
&lt;td&gt;63.84%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;히스토그램 예측(60.82%)이 실제 비율(63.84%)에 매우 근접합니다.&lt;/p&gt;
&lt;h3&gt;조인 순서 최적화&lt;/h3&gt;
&lt;p&gt;히스토그램은 조인 순서 결정에 큰 영향을 미칩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 두 테이블 조인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; salaries s
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; employees e &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;emp_no
    &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;birth_date &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-01-01&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1950-02-01&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;salary &lt;span class=&quot;token operator&quot;&gt;BETWEEN&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;40000&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;70000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;조인 순서별 성능 차이&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;조인 순서&lt;/th&gt;
&lt;th&gt;실행 시간&lt;/th&gt;
&lt;th&gt;드라이빙 테이블 건수&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;employees → salaries&lt;/td&gt;
&lt;td&gt;0.13초&lt;/td&gt;
&lt;td&gt;소수&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;salaries → employees&lt;/td&gt;
&lt;td&gt;1.29초&lt;/td&gt;
&lt;td&gt;다수&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;거의 10배 차이입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;히스토그램이 없으면&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;birth_date와 salary 칼럼의 데이터 분포를 모름&lt;/li&gt;
&lt;li&gt;테이블 크기만 보고 조인 순서 결정&lt;/li&gt;
&lt;li&gt;잘못된 순서 선택 가능성 높음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;히스토그램이 있으면&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;각 조건에 일치하는 레코드 수를 정확히 예측&lt;/li&gt;
&lt;li&gt;적은 건수를 반환하는 테이블을 드라이빙으로 선택&lt;/li&gt;
&lt;li&gt;최적의 조인 순서 자동 선택&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;InnoDB 버퍼 풀에 데이터가 없는 경우 디스크 I/O까지 발생하면 수십 배 이상 차이가 날 수 있습니다.&lt;/p&gt;
&lt;h2&gt;히스토그램 vs 인덱스&lt;/h2&gt;
&lt;h3&gt;인덱스가 있는 칼럼은 어떻게 되나?&lt;/h3&gt;
&lt;p&gt;결론부터 말하면, &lt;strong&gt;인덱스가 있는 칼럼은 히스토그램을 사용하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- user_id에 인덱스가 있는 경우&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;옵티마이저는 히스토그램 대신 &lt;strong&gt;인덱스 다이브&lt;/strong&gt;(Index Dive)를 수행합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;인덱스 다이브&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;실제 인덱스 B-Tree를 탐색&lt;/li&gt;
&lt;li&gt;검색 조건의 실제 값에 대해 샘플링 수행&lt;/li&gt;
&lt;li&gt;히스토그램보다 정확함&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;인덱스 다이브는 실제 데이터를 직접 확인하므로 히스토그램보다 항상 정확합니다.&lt;/p&gt;
&lt;h3&gt;히스토그램을 만들어야 하는 칼럼&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;인덱스가 없는 칼럼&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 조회는 자주 하지만 인덱스를 만들기엔 애매한 칼럼&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; amount&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created_date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;WHERE 조건에 자주 사용되지만 인덱스는 없는 칼럼&lt;/li&gt;
&lt;li&gt;조인 조건이지만 인덱스를 만들기 어려운 칼럼&lt;/li&gt;
&lt;li&gt;데이터 분포가 균등하지 않은 칼럼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;인덱스가 있어도 도움이 되는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 복합 조건&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1001&lt;/span&gt;          &lt;span class=&quot;token comment&quot;&gt;-- 인덱스 있음&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; amount &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100000&lt;/span&gt;         &lt;span class=&quot;token comment&quot;&gt;-- 인덱스 없음, 히스토그램 활용&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;COMPLETED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;-- 인덱스 없음, 히스토그램 활용&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;user_id는 인덱스를 사용하고, amount와 status는 히스토그램으로 정확도를 높입니다.&lt;/p&gt;
&lt;h2&gt;활용 가이드&lt;/h2&gt;
&lt;h3&gt;MySQL 8.0.19 미만 버전 주의&lt;/h3&gt;
&lt;p&gt;MySQL 8.0.19 이전 버전은 히스토그램 생성 시 &lt;strong&gt;무조건 풀 테이블 스캔&lt;/strong&gt;을 수행합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 8.0.19 미만: 전체 테이블 스캔 (주의!)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; large_orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;대용량 테이블이라면 서비스 시간대를 피해 실행해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;8.0.19 이상 버전&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB 자체 샘플링 알고리즘을 사용하여 풀 스캔 없이 히스토그램을 생성합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 샘플링 메모리 크기 조정 (기본 20MB)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; histogram_generation_max_mem_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20971520&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;히스토그램 비활성화&lt;/h3&gt;
&lt;p&gt;히스토그램을 삭제하지 않고 사용만 중단하려면:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 전역 설정&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; optimizer_switch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;condition_fanout_filter=off&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 현재 세션만&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SESSION&lt;/span&gt; optimizer_switch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;condition_fanout_filter=off&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 특정 쿼리만&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*+ SET_VAR(optimizer_switch=&apos;condition_fanout_filter=off&apos;) */&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;condition_fanout_filter 옵션은 히스토그램을 포함한 여러 최적화 기능을 제어하므로 신중하게 사용해야 합니다.&lt;/p&gt;
&lt;h3&gt;버킷 개수 설정&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 기본값 100 (대부분 충분함)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 값의 종류가 매우 많은 경우&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id &lt;span class=&quot;token keyword&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; BUCKETS&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;일반적으로 100개 버킷이면 충분합니다. 최대 1024개까지 설정 가능하지만, 200개를 넘으면 효과가 크지 않습니다.&lt;/p&gt;
&lt;h3&gt;히스토그램 갱신 시점&lt;/h3&gt;
&lt;p&gt;히스토그램은 자동으로 갱신되지 않습니다. 수동으로 갱신해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;갱신 시점&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 대량 데이터 변경 후&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; created_at &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2020-01-01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; amount&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 데이터 분포가 크게 바뀐 경우&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 예: 특정 프로모션으로 특정 상품 주문 급증&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; product_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;정기적인 갱신보다는 의미 있는 변화가 있을 때 갱신하는 것이 효율적입니다.&lt;/p&gt;
&lt;h2&gt;요약&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;히스토그램은 칼럼의 데이터 분포를 저장하여 옵티마이저의 예측 정확도를 높입니다.&lt;/li&gt;
&lt;li&gt;Singleton 히스토그램은 값이 적을 때, Equi-Height는 값이 많을 때 사용됩니다.&lt;/li&gt;
&lt;li&gt;조인 순서 최적화로 10배 이상 성능 차이가 발생할 수 있습니다.&lt;/li&gt;
&lt;li&gt;인덱스가 있는 칼럼은 인덱스 다이브를 사용하므로 히스토그램이 불필요합니다.&lt;/li&gt;
&lt;li&gt;MySQL 8.0.19 미만 버전은 풀 테이블 스캔이 발생하므로 주의해야 합니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;권장 사항&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 인덱스 없는 칼럼 중 WHERE/JOIN 조건에 자주 사용되는 칼럼&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; amount&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 대량 데이터 변경 후 갱신&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; user_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 불필요한 히스토그램 제거&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;DROP&lt;/span&gt; HISTOGRAM &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; unused_column&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음 포스트에서는 MySQL 코스트 모델을 통해 옵티마이저가 실행 계획의 비용을 어떻게 계산하는지 알아보겠습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MySQL 테이블 통계 정보]]></title><description><![CDATA[통계 정보가 왜 중요한가? MySQL 옵티마이저는 쿼리 실행 계획을 수립할 때 통계 정보에 의존합니다. 통계 정보가 부정확하면 최악의 실행 계획이 선택될 수 있습니다. 실제 사례 1억 건의 레코드가 있는 테이블인데 통계 정보가 갱신되지 않아 1…]]></description><link>https://gotobill.github.io/mysql-stats-info/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-stats-info/</guid><pubDate>Fri, 17 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;통계 정보가 왜 중요한가?&lt;/h2&gt;
&lt;p&gt;MySQL 옵티마이저는 쿼리 실행 계획을 수립할 때 통계 정보에 의존합니다. 통계 정보가 부정확하면 최악의 실행 계획이 선택될 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제 사례&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1억 건의 레코드가 있는 테이블인데 통계 정보가 갱신되지 않아 10건으로 잘못 기록된 경우:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;옵티마이저 판단: &quot;레코드가 10건밖에 없으니 인덱스보다 풀 테이블 스캔이 빠르겠다&quot;&lt;/li&gt;
&lt;li&gt;실제 실행: 1억 건을 모두 스캔&lt;/li&gt;
&lt;li&gt;결과: 0.1초면 끝날 쿼리가 1시간 소요&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;비용 기반 최적화(Cost-based Optimization)에서 통계 정보의 정확도는 곧 쿼리 성능입니다.&lt;/p&gt;
&lt;h2&gt;MySQL 5.5 vs 5.6+ 통계 정보 관리&lt;/h2&gt;
&lt;h3&gt;MySQL 5.5 이전: 휘발성 통계&lt;/h3&gt;
&lt;p&gt;통계 정보가 메모리에만 존재했습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 통계 정보 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INDEX&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 재시작 시 통계 정보 소실&lt;/li&gt;
&lt;li&gt;서버 시작 시 모든 테이블 통계 재수집 필요&lt;/li&gt;
&lt;li&gt;의도하지 않은 시점에 통계 자동 갱신&lt;/li&gt;
&lt;li&gt;갱신 시점을 예측할 수 없어 실행 계획이 갑자기 변경됨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;자동 갱신 조건&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;테이블 새로 오픈&lt;/li&gt;
&lt;li&gt;전체 레코드의 1/16 이상 변경&lt;/li&gt;
&lt;li&gt;ANALYZE TABLE 실행&lt;/li&gt;
&lt;li&gt;SHOW TABLE STATUS 실행&lt;/li&gt;
&lt;li&gt;InnoDB 모니터 활성화&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이런 조건에서 통계가 갑자기 변경되면 잘 동작하던 쿼리가 갑자기 느려질 수 있습니다.&lt;/p&gt;
&lt;h3&gt;MySQL 5.6+: 영구 통계 정보&lt;/h3&gt;
&lt;p&gt;통계 정보를 테이블에 저장하여 영구 보관합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 통계 정보 저장 테이블 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLES&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;%_stats&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Tables_in_mysql&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;innodb_index_stats&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;innodb_table_stats&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;innodb_table_stats&lt;/strong&gt;: 테이블 전체 통계&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innodb_table_stats
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; database_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mydb&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; table_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;orders&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;n_rows&lt;/th&gt;
&lt;th&gt;clustered_index_size&lt;/th&gt;
&lt;th&gt;sum_of_other_index_sizes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;299202&lt;/td&gt;
&lt;td&gt;929&lt;/td&gt;
&lt;td&gt;642&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;n_rows&lt;/strong&gt;: 테이블 전체 레코드 수&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;clustered_index_size&lt;/strong&gt;: 프라이머리 키 크기 (InnoDB 페이지 개수)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sum_of_other_index_sizes&lt;/strong&gt;: 프라이머리 키를 제외한 인덱스의 크기&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;innodb_index_stats&lt;/strong&gt;: 인덱스별 통계&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; index_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stat_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stat_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stat_description
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innodb_index_stats
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; database_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mydb&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; table_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;orders&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;index_name&lt;/th&gt;
&lt;th&gt;stat_name&lt;/th&gt;
&lt;th&gt;stat_value&lt;/th&gt;
&lt;th&gt;stat_description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;n_diff_pfx01&lt;/td&gt;
&lt;td&gt;1000000&lt;/td&gt;
&lt;td&gt;order_id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PRIMARY&lt;/td&gt;
&lt;td&gt;n_leaf_pages&lt;/td&gt;
&lt;td&gt;2300&lt;/td&gt;
&lt;td&gt;Number of leaf pages&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;idx_user&lt;/td&gt;
&lt;td&gt;n_diff_pfx01&lt;/td&gt;
&lt;td&gt;50000&lt;/td&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;idx_user&lt;/td&gt;
&lt;td&gt;n_leaf_pages&lt;/td&gt;
&lt;td&gt;800&lt;/td&gt;
&lt;td&gt;Number of leaf pages&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;n_diff_pfx01&lt;/strong&gt;: 인덱스 유니크 값 개수 (카디널리티)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;n_leaf_pages&lt;/strong&gt;: 리프 노드 페이지 개수&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;size&lt;/strong&gt;: 인덱스 전체 페이지 개수&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;영구 통계 정보 설정&lt;/h2&gt;
&lt;h3&gt;STATS_PERSISTENT 옵션&lt;/h3&gt;
&lt;p&gt;테이블 생성 시 통계 정보 관리 방식을 지정합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 영구 통계 사용&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    order_id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    amount &lt;span class=&quot;token keyword&quot;&gt;DECIMAL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;InnoDB&lt;/span&gt; STATS_PERSISTENT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 휘발성 통계 사용 (5.5 방식)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; temp_orders &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    order_id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    amount &lt;span class=&quot;token keyword&quot;&gt;DECIMAL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;InnoDB&lt;/span&gt; STATS_PERSISTENT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 기존 테이블 변경&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; products STATS_PERSISTENT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;옵션 값&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;STATS_PERSISTENT=1&lt;/strong&gt;: 통계 정보를 innodb_table_stats, innodb_index_stats에 저장&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;STATS_PERSISTENT=0&lt;/strong&gt;: MySQL 5.5 방식 (메모리에만 저장)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;STATS_PERSISTENT=DEFAULT&lt;/strong&gt;: innodb_stats_persistent 시스템 변수 값 따름 (기본값 ON)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;STATS_AUTO_RECALC 옵션&lt;/h3&gt;
&lt;p&gt;통계 정보 자동 갱신 여부를 제어합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 자동 갱신 비활성화&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    order_id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;InnoDB&lt;/span&gt;
  STATS_PERSISTENT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  STATS_AUTO_RECALC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 기존 테이블 변경&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; orders STATS_AUTO_RECALC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;옵션 값&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;STATS_AUTO_RECALC=0&lt;/strong&gt;: 자동 갱신 비활성화, ANALYZE TABLE로만 갱신&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;STATS_AUTO_RECALC=1&lt;/strong&gt;: MySQL 5.5 방식처럼 자동 갱신&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;STATS_AUTO_RECALC=DEFAULT&lt;/strong&gt;: innodb_stats_auto_recalc 시스템 변수 값 따름 -&gt; 1이 디폴트임.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;샘플링 설정&lt;/h3&gt;
&lt;p&gt;MySQL은 전체 데이터를 스캔하지 않고 일부 페이지만 샘플링하여 통계를 수집합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;시스템 변수&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 영구 통계 샘플링 (ANALYZE TABLE 실행 시)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_stats_persistent_sample_pages &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 기본값&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 자동 통계 샘플링 (자동 갱신 시)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_stats_transient_sample_pages &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 기본값&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;샘플링 크기와 정확도&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;샘플 페이지&lt;/th&gt;
&lt;th&gt;정확도&lt;/th&gt;
&lt;th&gt;수집 시간&lt;/th&gt;
&lt;th&gt;용도&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;낮음&lt;/td&gt;
&lt;td&gt;빠름&lt;/td&gt;
&lt;td&gt;자동 갱신 (참고용)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;보통&lt;/td&gt;
&lt;td&gt;보통&lt;/td&gt;
&lt;td&gt;기본 설정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td&gt;높음&lt;/td&gt;
&lt;td&gt;느림&lt;/td&gt;
&lt;td&gt;대용량 테이블, 중요 쿼리&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;대부분의 경우 기본값 20으로 충분합니다. 다만 수억 건 이상의 대용량 테이블이면서 쿼리 성능이 매우 중요한 경우 샘플링 값을 높일 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 특정 테이블만 정밀하게 수집&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_stats_persistent_sample_pages &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; critical_orders&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_stats_persistent_sample_pages &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 원복&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;통계 정보 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 인덱스 통계 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INDEX&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 상세 통계 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    index_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    stat_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    stat_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    stat_description
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innodb_index_stats
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; database_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mydb&apos;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; table_name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;orders&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; index_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stat_name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;설정 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 현재 설정 확인&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;innodb_stats%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable_name&lt;/th&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;innodb_stats_auto_recalc&lt;/td&gt;
&lt;td&gt;ON&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;innodb_stats_persistent&lt;/td&gt;
&lt;td&gt;ON&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;innodb_stats_persistent_sample_pages&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;innodb_stats_transient_sample_pages&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;요약&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MySQL 5.6+에서는 영구 통계 정보를 사용하여 서버 재시작 후에도 통계가 유지됩니다.&lt;/li&gt;
&lt;li&gt;STATS_PERSISTENT=1을 통해서 실행 계획을 유지할 수 있습니다.&lt;/li&gt;
&lt;li&gt;샘플링 크기는 대부분 기본값(20)으로 충분하며, 필요시에만 조정합니다.&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Netty 이벤트 루프 완전 정복]]></title><description><![CDATA[Netty 완전 정복 가이드 Selector 기초부터 OS 레벨 동작, 순수 Java NIO vs Netty 구현, WebClient까지 모든 것을 다룹니다. 목차 Selector란 무엇인가 OS 레벨 I/O 멀티플렉싱 순수 Java NIO…]]></description><link>https://gotobill.github.io/netty-eventloop/</link><guid isPermaLink="false">https://gotobill.github.io/netty-eventloop/</guid><pubDate>Thu, 09 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Netty 완전 정복 가이드&lt;/h1&gt;
&lt;p&gt;Selector 기초부터 OS 레벨 동작, 순수 Java NIO vs Netty 구현, WebClient까지 모든 것을 다룹니다.&lt;/p&gt;
&lt;h2&gt;목차&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#selector%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80&quot;&gt;Selector란 무엇인가&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#os-%EB%A0%88%EB%B2%A8-io-%EB%A9%80%ED%8B%B0%ED%94%8C%EB%A0%89%EC%8B%B1&quot;&gt;OS 레벨 I/O 멀티플렉싱&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%EC%88%9C%EC%88%98-java-nio-%EA%B5%AC%ED%98%84&quot;&gt;순수 Java NIO 구현&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#netty-nioeventloop-%EA%B5%AC%ED%98%84&quot;&gt;Netty NioEventLoop 구현&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%EC%BD%94%EB%93%9C-%EB%B9%84%EA%B5%90-%EB%B6%84%EC%84%9D&quot;&gt;코드 비교 분석&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#webclient%EC%97%90%EC%84%9C-netty%EA%B9%8C%EC%A7%80&quot;&gt;WebClient에서 Netty까지&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-%EA%B8%B0%EB%B2%95&quot;&gt;성능 최적화 기법&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;Selector란 무엇인가&lt;/h2&gt;
&lt;h3&gt;개념&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Selector&lt;/strong&gt;는 단일 스레드로 여러 채널의 I/O 이벤트를 모니터링하는 Java NIO의 핵심 컴포넌트입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;전통적인 블로킹 I/O (BIO)
Thread 1 → Socket 1 (blocking read...)
Thread 2 → Socket 2 (blocking read...)
Thread 3 → Socket 3 (blocking read...)
...
Thread 1000 → Socket 1000 (blocking read...)

문제: 1000개 연결 = 1000개 스레드 = 메모리 부족&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Selector 기반 논블로킹 I/O (NIO)
        Selector (1개 스레드)
            ↓
    ┌───────┼───────┐
Channel 1 Channel 2 Channel 3 ... Channel 1000
(wait)    (ready!)   (wait)         (wait)

해결: 1000개 연결 = 1개 스레드 = 메모리 효율적&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Selector의 역할&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;채널 등록&lt;/strong&gt;: 여러 채널을 Selector에 등록&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;이벤트 감시&lt;/strong&gt;: 등록된 채널의 I/O 이벤트 모니터링&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;준비된 채널 선택&lt;/strong&gt;: I/O 가능한 채널만 선택&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;이벤트 처리&lt;/strong&gt;: 선택된 채널에 대해 I/O 작업 수행&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;SelectionKey의 이벤트 타입&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_ACCEPT&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 서버가 클라이언트 연결 수락 가능&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_CONNECT&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 클라이언트가 서버 연결 완료&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt;     &lt;span class=&quot;token comment&quot;&gt;// 채널에서 데이터 읽기 가능&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_WRITE&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// 채널에 데이터 쓰기 가능&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;OS 레벨 I/O 멀티플렉싱&lt;/h2&gt;
&lt;h3&gt;System Call의 진화&lt;/h3&gt;
&lt;h4&gt;1단계: select() (초기)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Linux select() system call&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nfds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           fd_set &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;readfds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// 읽기 가능한 파일 디스크립터&lt;/span&gt;
           fd_set &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;writefds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 쓰기 가능한 파일 디스크립터&lt;/span&gt;
           fd_set &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;exceptfds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 예외 발생한 파일 디스크립터&lt;/span&gt;
           &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;timeval&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fd_set 크기 제한 (일반적으로 1024개)&lt;/li&gt;
&lt;li&gt;매번 전체 fd_set을 커널로 복사 (O(n))&lt;/li&gt;
&lt;li&gt;준비된 fd를 찾기 위해 전체 순회 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;2단계: poll() (개선)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Linux poll() system call&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;fds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 파일 디스크립터 배열&lt;/span&gt;
         &lt;span class=&quot;token class-name&quot;&gt;nfds_t&lt;/span&gt; nfds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;token comment&quot;&gt;// 배열 크기&lt;/span&gt;
         &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; fd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;// 파일 디스크립터&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;short&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;token comment&quot;&gt;// 관심 이벤트&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;short&lt;/span&gt; revents&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// 실제 발생한 이벤트&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;개선점&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fd 개수 제한 없음&lt;/li&gt;
&lt;li&gt;비트마스크 대신 구조체 배열 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;여전한 문제&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;매번 전체 배열을 커널로 복사 (O(n))&lt;/li&gt;
&lt;li&gt;준비된 fd를 찾기 위해 전체 순회&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;3단계: epoll() (Linux 최적화)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// epoll 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; epfd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;epoll_create1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// fd 등록 (한 번만!)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;epoll_event&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;events &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; EPOLLIN&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 읽기 이벤트&lt;/span&gt;
event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sockfd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;epoll_ctl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;epfd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; EPOLL_CTL_ADD&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sockfd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 이벤트 대기&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;epoll_event&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;MAX_EVENTS&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nfds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;epoll_wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;epfd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MAX_EVENTS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 준비된 fd만 반환됨! (O(1) 조회)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; nfds&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;events&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;events &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; EPOLLIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 읽기 가능한 소켓 처리&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; fd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 개선&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fd를 커널에 한 번만 등록&lt;/li&gt;
&lt;li&gt;준비된 fd만 반환 (O(1) 조회)&lt;/li&gt;
&lt;li&gt;Red-Black Tree로 fd 관리&lt;/li&gt;
&lt;li&gt;Ready List에 준비된 fd만 추가&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;4단계: kqueue() (BSD/macOS)&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// kqueue 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; kq &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;kqueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 이벤트 등록&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;kevent&lt;/span&gt; change&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;EV_SET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;change&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sockfd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; EVFILT_READ&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; EV_ADD&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;kevent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kq&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;change&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 이벤트 대기&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;kevent&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;kevent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kq&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nev &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; EVFILT_READ&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 읽기 가능&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ident&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Java NIO와 OS의 연결&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Java Selector.select()
        ↓
JNI (Java Native Interface)
        ↓
┌───────────────────────────────┐
│   Linux    │   macOS   │ Windows │
│   epoll()  │  kqueue() │  IOCP   │
└───────────────────────────────┘
        ↓
커널이 파일 디스크립터 모니터링
        ↓
네트워크 카드에서 패킷 도착
        ↓
커널 인터럽트 발생
        ↓
Ready List에 fd 추가
        ↓
epoll_wait() 반환
        ↓
Java Selector.select() 반환&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;OS별 구현 차이&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;OS&lt;/th&gt;
&lt;th&gt;System Call&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Linux&lt;/td&gt;
&lt;td&gt;epoll&lt;/td&gt;
&lt;td&gt;Red-Black Tree, O(1) 조회&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;macOS/BSD&lt;/td&gt;
&lt;td&gt;kqueue&lt;/td&gt;
&lt;td&gt;Event-driven, 파일 시스템 감시도 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Windows&lt;/td&gt;
&lt;td&gt;IOCP&lt;/td&gt;
&lt;td&gt;Completion 기반, 비동기 I/O&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Solaris&lt;/td&gt;
&lt;td&gt;/dev/poll&lt;/td&gt;
&lt;td&gt;poll 최적화 버전&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;순수 Java NIO 구현&lt;/h2&gt;
&lt;h3&gt;전체 코드&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InetSocketAddress&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;nio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NioEchoServer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PORT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7381&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BUFFER_SIZE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 1. Selector 생성 - OS의 epoll/kqueue와 연결&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt; selector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 2. 서버 소켓 생성 및 설정&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt; serverSocket &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        serverSocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InetSocketAddress&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        serverSocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureBlocking&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 논블로킹 모드!&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 3. Selector에 서버 소켓 등록 (ACCEPT 이벤트 감시)&lt;/span&gt;
        serverSocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_ACCEPT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Echo Server started on port &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; inBuffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BUFFER_SIZE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; outBuffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BUFFER_SIZE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 4. 이벤트 루프 - 무한 반복&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 5. I/O 이벤트 대기 (블로킹) - OS epoll_wait() 호출&lt;/span&gt;
            selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 6. 준비된 채널의 SelectionKey 가져오기&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; selectedKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; iterator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 7. 준비된 채널 순회&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 처리 후 제거 (중요!)&lt;/span&gt;

                &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token comment&quot;&gt;// 8-1. ACCEPT 이벤트: 클라이언트 연결&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isAcceptable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 연결 수락&lt;/span&gt;

                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureBlocking&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            &lt;span class=&quot;token comment&quot;&gt;// 클라이언트를 READ 이벤트로 등록&lt;/span&gt;
                            client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Client connected: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRemoteAddress&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;token comment&quot;&gt;// 8-2. READ 이벤트: 데이터 읽기&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isReadable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                        inBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; readBytes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inBuffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 논블로킹 읽기&lt;/span&gt;

                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readBytes &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;token comment&quot;&gt;// 클라이언트 연결 종료&lt;/span&gt;
                            &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Client disconnected: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRemoteAddress&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readBytes &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;token comment&quot;&gt;// 읽은 데이터를 출력 버퍼로 복사 (Echo)&lt;/span&gt;
                            inBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            outBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            outBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inBuffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                            &lt;span class=&quot;token comment&quot;&gt;// 쓰기 준비&lt;/span&gt;
                            outBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;outBuffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 논블로킹 쓰기&lt;/span&gt;

                            &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Echoed &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; readBytes &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; bytes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Error processing key: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// ignore&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;동작 흐름&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. Selector.open()
   ↓
   JNI → epoll_create1() (Linux)
   ↓
   커널에 epoll 인스턴스 생성

2. serverSocket.register(selector, OP_ACCEPT)
   ↓
   JNI → epoll_ctl(EPOLL_CTL_ADD, fd, EPOLLIN)
   ↓
   커널의 Red-Black Tree에 fd 등록

3. selector.select()
   ↓
   JNI → epoll_wait(timeout)
   ↓
   커널이 Ready List 확인 (블로킹 대기)
   ↓
   패킷 도착 → 인터럽트 → Ready List에 fd 추가
   ↓
   epoll_wait() 반환 (준비된 fd 개수)
   ↓
   Java로 복귀

4. selector.selectedKeys()
   ↓
   준비된 SelectionKey 집합 반환

5. key.isAcceptable() / key.isReadable()
   ↓
   이벤트 타입 확인 및 처리

6. channel.read(buffer) / channel.write(buffer)
   ↓
   JNI → read(fd, buf, len) / write(fd, buf, len)
   ↓
   실제 I/O 수행 (논블로킹)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;Netty NioEventLoop 구현&lt;/h2&gt;
&lt;h3&gt;1. Selector 생성&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt; selector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop&lt;/strong&gt; (라인 169~230)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectorTuple&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;openSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Selector&lt;/span&gt; unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// OS의 epoll/kqueue와 연결&lt;/span&gt;
        unwrappedSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; provider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;openSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChannelException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;failed to open a new selector&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DISABLE_KEY_SET_OPTIMIZATION&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectorTuple&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Netty 최적화: selectedKeys를 Array로 교체&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectedSelectionKeySet&lt;/span&gt; selectedKeySet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectedSelectionKeySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Reflection으로 Selector 내부 필드 교체&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; maybeException &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AccessController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doPrivileged&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PrivilegedAction&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt; selectedKeysField &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectorImplClass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;selectedKeys&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt; publicSelectedKeysField &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectorImplClass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;publicSelectedKeys&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;token comment&quot;&gt;// Set → Array로 교체 (순회 성능 향상!)&lt;/span&gt;
                selectedKeysField&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; selectedKeySet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                publicSelectedKeysField&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; selectedKeySet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    selectedKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeySet&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectorTuple&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                             &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectedSelectionKeySetSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; selectedKeySet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty 최적화 포인트&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Selector 내부의 &lt;code class=&quot;language-text&quot;&gt;Set&amp;lt;SelectionKey&gt;&lt;/code&gt;를 배열로 교체&lt;/li&gt;
&lt;li&gt;Set 순회보다 배열 순회가 빠름 (캐시 친화적)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. 채널 등록&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;serverSocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_ACCEPT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop&lt;/strong&gt; (라인 302~340)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; interestOps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ObjectUtil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;checkNotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;interestOps &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;interestOps must be non-zero.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isShutdown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IllegalStateException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;event loop shut down&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// EventLoop 스레드에서 실행 중인지 확인&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;inEventLoop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 같은 스레드면 즉시 실행&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;register0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interestOps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 다른 스레드면 EventLoop에 제출&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;register0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interestOps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; ignore&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interrupt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;register0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; interestOps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 실제 등록 - OS epoll_ctl() 호출&lt;/span&gt;
        ch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unwrappedSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interestOps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventLoopException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;failed to register a channel&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty 최적화 포인트&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;스레드 안전성 보장 (다른 스레드에서 등록 가능)&lt;/li&gt;
&lt;li&gt;EventLoop 스레드에서만 실제 등록 수행&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. 이벤트 루프 - run()&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; selectedKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; iterator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 처리...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop&lt;/strong&gt; (라인 441~555)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; selectCnt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 무한 루프&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; strategy&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// 전략 계산: SELECT, CONTINUE, BUSY_WAIT&lt;/span&gt;
                strategy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectStrategy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;calculateStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectNowSupplier&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hasTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CONTINUE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BUSY_WAIT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// NIO는 busy-wait 미지원, SELECT로 fall-through&lt;/span&gt;

                    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// 다음 예약된 작업의 데드라인 계산&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; curDeadlineNanos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nextScheduledTaskDeadlineNanos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curDeadlineNanos &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            curDeadlineNanos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NONE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                        nextWakeupNanos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curDeadlineNanos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                                &lt;span class=&quot;token comment&quot;&gt;// Task 없으면 I/O 대기&lt;/span&gt;
                                strategy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curDeadlineNanos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                            nextWakeupNanos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lazySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;AWAKE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// fall through&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// Selector 문제 발생 시 재구성&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;rebuildSelector0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                selectCnt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;handleLoopException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            selectCnt&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            cancelledKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            needsToSelectAgain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// I/O 작업과 일반 Task의 비율 설정 (기본 50:50)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; ioRatio &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ioRatio&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; ranTasks&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ioRatio &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// I/O 100%: I/O 먼저, Task는 남은 시간 전부&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token function&quot;&gt;processSelectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// I/O 이벤트 처리&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    ranTasks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runAllTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 모든 Task 처리&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// I/O와 Task 비율 조절&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; ioStartTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nanoTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;processSelectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// I/O 처리&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; ioTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nanoTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; ioStartTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token comment&quot;&gt;// I/O 시간에 비례해서 Task 시간 계산&lt;/span&gt;
                    ranTasks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runAllTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ioTime &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; ioRatio&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; ioRatio&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// I/O 없음: 최소한의 Task만 처리&lt;/span&gt;
                ranTasks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runAllTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ranTasks &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; strategy &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectCnt &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;MIN_PREMATURE_SELECTOR_RETURNS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isDebugEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Selector.select() returned prematurely {} times in a row&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                            selectCnt &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                selectCnt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unexpectedSelectorWakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectCnt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// 예기치 않은 wakeup (JDK epoll bug 대응)&lt;/span&gt;
                selectCnt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CancelledKeyException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 무해한 예외, 로그만&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isDebugEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CancelledKeyException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSimpleName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; raised&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;handleLoopException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 종료 처리&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isShuttingDown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;closeAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;confirmShutdown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;handleLoopException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty 최적화 포인트&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ioRatio&lt;/strong&gt;: I/O 작업과 일반 Task의 CPU 시간 비율 조절&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JDK epoll bug 대응&lt;/strong&gt;: 예기치 않은 wakeup 감지 및 Selector 재구성&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;예약된 작업 고려&lt;/strong&gt;: 타임아웃을 다음 예약 작업에 맞춤&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;4. selector.select() 호출&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 무한 대기&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 또는&lt;/span&gt;
selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 타임아웃 대기&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop&lt;/strong&gt; (라인 885~893)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; deadlineNanos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deadlineNanos &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NONE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 예약된 작업 없음: 무한 대기&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// OS epoll_wait(-1)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 데드라인까지 남은 시간 계산&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; timeoutMillis &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deadlineToDelayNanos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deadlineNanos &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;995000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 타임아웃이 0 이하면 논블로킹 select&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; timeoutMillis &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectNow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeoutMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//                          ↑ 즉시 반환           ↑ 타임아웃 대기&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;호출 흐름&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;selector.select(timeoutMillis)
    ↓
JNI
    ↓
Linux: epoll_wait(epfd, events, maxevents, timeout)
macOS: kevent(kq, NULL, 0, events, nevents, timeout)
    ↓
커널이 Ready List 확인
    ↓
패킷 도착 or 타임아웃
    ↓
반환 (준비된 fd 개수)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;5. selectedKeys 처리&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; selectedKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; iterator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    iterator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 처리...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop - 최적화된 버전&lt;/strong&gt; (라인 719~753)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processSelectedKeysOptimized&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// selectedKeys는 배열로 교체됨 (openSelector에서)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// GC를 위해 null 처리&lt;/span&gt;
        selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token annotation punctuation&quot;&gt;@SuppressWarnings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; task &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;needsToSelectAgain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 배열 초기화&lt;/span&gt;
            selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;selectAgain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop - 일반 버전&lt;/strong&gt; (라인 673~711)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processSelectedKeysPlain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Iterator에서 제거&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token annotation punctuation&quot;&gt;@SuppressWarnings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; task &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NioTask&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectableChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; task&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;needsToSelectAgain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;selectAgain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            selectedKeys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;selectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// ConcurrentModificationException 방지&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;최적화 포인트&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set Iterator 대신 배열 인덱스 사용&lt;/li&gt;
&lt;li&gt;Iterator 생성 오버헤드 제거&lt;/li&gt;
&lt;li&gt;캐시 친화적인 순차 접근&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;6. 개별 이벤트 처리&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;순수 Java NIO&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isAcceptable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureBlocking&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isReadable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; readBytes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inBuffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readBytes &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Echo&lt;/span&gt;
        inBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inBuffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty NioEventLoop&lt;/strong&gt; (라인 768~821)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NioUnsafe&lt;/span&gt; unsafe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsafe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// SelectionKey 유효성 검사&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventLoop&lt;/span&gt; eventLoop&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            eventLoop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eventLoop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; ignored&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 이 EventLoop에 등록된 채널인지 확인&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eventLoop &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;voidPromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; readyOps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readyOps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// OP_CONNECT: 연결 완료&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readyOps &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_CONNECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// OP_CONNECT 제거 (무한 루프 방지)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; ops &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interestOps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            ops &lt;span class=&quot;token operator&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_CONNECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            k&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;interestOps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ops&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;finishConnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// OP_WRITE: 쓰기 가능&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readyOps &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_WRITE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 버퍼에 남은 데이터 flush&lt;/span&gt;
            unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forceFlush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// OP_READ or OP_ACCEPT: 읽기/연결 수락&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// readyOps == 0 체크는 JDK bug workaround&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readyOps &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_ACCEPT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; readyOps &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CancelledKeyException&lt;/span&gt; ignored&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;voidPromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty의 Unsafe 클래스&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;실제 I/O 작업을 수행하는 내부 클래스&lt;/li&gt;
&lt;li&gt;채널 타입별로 구현 (NioServerSocketChannel, NioSocketChannel 등)&lt;/li&gt;
&lt;li&gt;사용자는 직접 호출 불가 (internal API)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;코드 비교 분석&lt;/h2&gt;
&lt;h3&gt;1. Selector 생성&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;순수 Java NIO&lt;/th&gt;
&lt;th&gt;Netty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;생성&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Selector.open()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;provider.openSelector()&lt;/code&gt; + 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;최적화&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;selectedKeys를 Set → Array로 교체&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;코드&lt;/td&gt;
&lt;td&gt;1줄&lt;/td&gt;
&lt;td&gt;~60줄 (Reflection 포함)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;2. 이벤트 루프 구조&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;순수 Java NIO&lt;/th&gt;
&lt;th&gt;Netty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;루프&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;while(true)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;for(;;)&lt;/code&gt; + 종료 처리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;select()&lt;/td&gt;
&lt;td&gt;매번 호출&lt;/td&gt;
&lt;td&gt;전략 패턴 (Task 있으면 skip)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Task 처리&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;I/O와 Task 비율 조절 (ioRatio)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;예외 처리&lt;/td&gt;
&lt;td&gt;기본 try-catch&lt;/td&gt;
&lt;td&gt;epoll bug 감지 및 재구성&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;3. selectedKeys 순회&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;순수 Java NIO&lt;/th&gt;
&lt;th&gt;Netty (최적화)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;자료구조&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Set&amp;lt;SelectionKey&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;SelectionKey[]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;순회&lt;/td&gt;
&lt;td&gt;Iterator&lt;/td&gt;
&lt;td&gt;배열 인덱스&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;성능&lt;/td&gt;
&lt;td&gt;Iterator 생성 오버헤드&lt;/td&gt;
&lt;td&gt;캐시 친화적 순차 접근&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;성능 차이&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Set Iterator 순회: ~100ns per iteration
Array 인덱스 순회: ~10ns per iteration

10배 빠름!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4. 이벤트 처리&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;순수 Java NIO&lt;/th&gt;
&lt;th&gt;Netty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;처리 방식&lt;/td&gt;
&lt;td&gt;직접 I/O 호출&lt;/td&gt;
&lt;td&gt;Unsafe 클래스 위임&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;에러 처리&lt;/td&gt;
&lt;td&gt;간단한 예외 처리&lt;/td&gt;
&lt;td&gt;세밀한 상태 관리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;확장성&lt;/td&gt;
&lt;td&gt;하드코딩&lt;/td&gt;
&lt;td&gt;채널 타입별 다형성&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;5. 스레드 모델&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;순수 Java NIO&lt;/th&gt;
&lt;th&gt;Netty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;스레드 개수&lt;/td&gt;
&lt;td&gt;1개 (단일 스레드)&lt;/td&gt;
&lt;td&gt;N개 (EventLoopGroup)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;스레드 안전성&lt;/td&gt;
&lt;td&gt;보장 안 됨&lt;/td&gt;
&lt;td&gt;inEventLoop() 체크&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;작업 제출&lt;/td&gt;
&lt;td&gt;지원 안 됨&lt;/td&gt;
&lt;td&gt;execute(Runnable)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;전체 비교표&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;┌─────────────────────────────────────────────────────────────┐
│                    순수 Java NIO                             │
├─────────────────────────────────────────────────────────────┤
│ while (true) {                                              │
│     selector.select();              // OS epoll_wait()      │
│     Set&amp;lt;SelectionKey&gt; keys =                                │
│         selector.selectedKeys();                            │
│     Iterator&amp;lt;SelectionKey&gt; it =                             │
│         keys.iterator();                                    │
│     while (it.hasNext()) {                                  │
│         SelectionKey key = it.next();                       │
│         it.remove();                                        │
│         if (key.isReadable()) {                             │
│             SocketChannel ch =                              │
│                 (SocketChannel) key.channel();              │
│             ch.read(buffer);        // 직접 I/O            │
│         }                                                   │
│     }                                                       │
│ }                                                           │
└─────────────────────────────────────────────────────────────┘

                            VS

┌─────────────────────────────────────────────────────────────┐
│                      Netty NioEventLoop                      │
├─────────────────────────────────────────────────────────────┤
│ for (;;) {                                                  │
│     // 전략 계산: Task 있으면 select skip                   │
│     strategy = selectStrategy.calculate();                  │
│                                                             │
│     if (strategy == SELECT) {                               │
│         // 다음 예약 작업 고려한 타임아웃                    │
│         strategy = select(nextDeadline);                    │
│     }                                                       │
│                                                             │
│     // I/O 처리 (최적화된 배열 순회)                        │
│     if (strategy &gt; 0) {                                     │
│         processSelectedKeys();      // 배열 인덱스 순회     │
│     }                                                       │
│                                                             │
│     // Task 처리 (I/O와 비율 조절)                          │
│     runAllTasks(ioTime * ratio);                            │
│                                                             │
│     // epoll bug 감지 및 재구성                             │
│     if (unexpectedWakeup()) {                               │
│         rebuildSelector();                                  │
│     }                                                       │
│ }                                                           │
└─────────────────────────────────────────────────────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;WebClient에서 Netty까지&lt;/h2&gt;
&lt;h3&gt;전체 호출 스택&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;┌─────────────────────────────────────────────────────────┐
│          Application Layer (당신의 코드)                  │
├─────────────────────────────────────────────────────────┤
│ WebClient.post()                                        │
│     .uri(&quot;/api&quot;)                                        │
│     .bodyValue(requestBody)                             │
│     .retrieve()                                         │
│     .bodyToMono(Map.class)                              │
│     .subscribe(...)                                     │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│       Spring WebFlux Layer (DefaultWebClient)           │
├─────────────────────────────────────────────────────────┤
│ DefaultWebClient.exchange()                             │
│   → ExchangeFunction.exchange(request)                  │
│   → ReactorClientHttpConnector.connect()                │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│    Reactor Netty Layer (HttpClient)                     │
├─────────────────────────────────────────────────────────┤
│ HttpClient.request(POST)                                │
│     .uri(&quot;https://api.example.com&quot;)                     │
│     .send((request, outbound) -&gt; ...)                   │
│     .responseConnection((response, connection) -&gt; ...)  │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│       Netty Core Layer (NioEventLoop)                   │
├─────────────────────────────────────────────────────────┤
│ NioEventLoop.run()                                      │
│   for (;;) {                                            │
│       selector.select()      // I/O 이벤트 대기         │
│       processSelectedKeys()  // 이벤트 처리             │
│       runAllTasks()          // Task 처리               │
│   }                                                     │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│          JNI Layer (Native Code)                        │
├─────────────────────────────────────────────────────────┤
│ EPollArrayWrapper.poll()     // Linux                   │
│ KQueueArrayWrapper.poll()    // macOS                   │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│           OS Kernel Layer                               │
├─────────────────────────────────────────────────────────┤
│ epoll_wait(epfd, events, maxevents, timeout)  // Linux  │
│ kevent(kq, NULL, 0, events, nevents, timeout) // macOS  │
│                                                         │
│ [Ready List 모니터링]                                   │
│   fd 1: 대기 중                                         │
│   fd 2: READ 준비 완료! ← 패킷 도착                     │
│   fd 3: 대기 중                                         │
└─────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────┐
│         Network Hardware Layer                          │
├─────────────────────────────────────────────────────────┤
│ 네트워크 카드에서 패킷 수신                              │
│   ↓                                                     │
│ 인터럽트 발생                                           │
│   ↓                                                     │
│ 커널이 Ready List에 fd 추가                             │
│   ↓                                                     │
│ epoll_wait() 반환                                       │
└─────────────────────────────────────────────────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;상세 실행 흐름&lt;/h3&gt;
&lt;h4&gt;1. WebClient 요청 시작&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 당신의 코드 (http-nio-8080-exec-5 스레드)&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/api&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;requestBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 이 부분은 reactor-http-nio-2에서 실행&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;2. Spring WebFlux Layer&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// DefaultWebClient.java&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClientResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;exchange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// HTTP 요청 생성&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ClientHttpRequest&lt;/span&gt; httpRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// ReactorClientHttpConnector로 전달&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;uri&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            requestCallback
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;3. Reactor Netty Layer&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ReactorClientHttpConnector.java&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClientHttpResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpMethod&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;URI&lt;/span&gt; uri&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;httpClient
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;adaptHttpMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uri&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; outbound&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 요청 본문 전송&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; requestCallback&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReactorClientHttpRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;responseConnection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; connection&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 응답 수신&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReactorClientHttpResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;4. Netty Core - Channel 등록&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Bootstrap.java&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChannelFuture&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketAddress&lt;/span&gt; remoteAddress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ChannelFuture&lt;/span&gt; regFuture &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initAndRegister&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Channel을 EventLoop에 등록&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Channel&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; regFuture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;EventLoop&lt;/span&gt; eventLoop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eventLoop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// EventLoop에서 실행&lt;/span&gt;
    eventLoop&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;OP_CONNECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;remoteAddress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; regFuture&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;5. Netty Core - EventLoop 동작&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// NioEventLoop.run() - reactor-http-nio-2 스레드&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 1. I/O 이벤트 대기&lt;/span&gt;
    selector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeoutMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// JNI → epoll_wait()&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 커널이 Ready List 확인&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// HTTP 응답 패킷 도착!&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// fd가 READ 가능 상태가 됨&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// epoll_wait() 반환&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 2. 준비된 채널 처리&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;processSelectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;SelectionKey&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AbstractNioChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;attachment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;readyOps &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OP_READ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 3. 데이터 읽기&lt;/span&gt;
            channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsafe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// ByteBuffer에 데이터 읽기&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8192&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bytesRead &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; socketChannel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 4. Pipeline 처리&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ChannelPipeline&lt;/span&gt; pipeline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fireChannelRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// HttpClientCodec: HTTP 파싱&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// HttpObjectAggregator: 청크 병합&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// ReactorNettyHandler: Mono/Flux로 변환&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;//   ↓&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 5. Mono에 데이터 전달&lt;/span&gt;
            sink&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;httpResponse&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 6. 일반 Task 처리&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;runAllTasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;6. 데이터가 Mono로 전달&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// reactor-http-nio-2 스레드&lt;/span&gt;
mono
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 여기서 실행!&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 출력: Thread: reactor-http-nio-2&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 최종 처리&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;성능 최적화 기법&lt;/h2&gt;
&lt;h3&gt;1. Zero-Copy&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;일반적인 데이터 복사&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;네트워크 카드
    ↓ DMA 복사
커널 버퍼
    ↓ CPU 복사 (1)
JVM 힙
    ↓ CPU 복사 (2)
애플리케이션 버퍼

총 4번의 데이터 이동!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty의 Zero-Copy&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Direct Buffer 사용&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; directBuffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocateDirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8192&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 네트워크 카드&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     ↓ DMA 복사&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 커널 버퍼&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     ↓ DMA 복사 (CPU 개입 없음!)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Direct Buffer (JVM 힙 외부)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     ↓&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 애플리케이션 직접 접근&lt;/span&gt;

총 &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;번의 이동&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CPU&lt;/span&gt; 사용 최소화&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Netty CompositeByteBuf&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 여러 버퍼를 복사 없이 결합&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ByteBuf&lt;/span&gt; header &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ByteBuf&lt;/span&gt; body &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;CompositeByteBuf&lt;/span&gt; composite &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Unpooled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;compositeBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
composite&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addComponents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; header&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 실제 복사 없음! 논리적 결합만&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. Object Pooling&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Netty의 PooledByteBufAllocator&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ByteBufAllocator&lt;/span&gt; alloc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PooledByteBufAllocator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DEFAULT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 풀에서 재사용&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ByteBuf&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; alloc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8192&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeBytes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 풀로 반환 (GC 없음!)&lt;/span&gt;
    buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;효과&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GC 압박 감소&lt;/li&gt;
&lt;li&gt;메모리 할당 오버헤드 제거&lt;/li&gt;
&lt;li&gt;처리량 30-50% 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. 배치 처리&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// NioEventLoop - 여러 이벤트를 한 번에 처리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processSelectedKeys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 배치 처리로 시스템 콜 최소화&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;processSelectedKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectedKeys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Write 배치 처리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 여러 write를 모아서 한 번에 전송&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ByteBuf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; buffers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; outboundBuffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nioBuffers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; bytesWritten &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4. Backpressure&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Netty의 자동 Backpressure&lt;/span&gt;
channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAutoRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 읽기 중단&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 처리 완료 후 재개&lt;/span&gt;
channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 읽기 재개&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Reactor의 Backpressure&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Flux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onBackpressureBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 버퍼링&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onBackpressureDrop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;         &lt;span class=&quot;token comment&quot;&gt;// 드랍&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onBackpressureLatest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;       &lt;span class=&quot;token comment&quot;&gt;// 최신 값만&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BaseSubscriber&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hookOnSubscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Subscription&lt;/span&gt; subscription&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 10개만 요청&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hookOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 처리&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1개 더 요청&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;5. 스레드 친화성 (Thread Affinity)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// EventLoopGroup - CPU 코어별 EventLoop&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;EventLoopGroup&lt;/span&gt; group &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NioEventLoopGroup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;availableProcessors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 각 EventLoop는 하나의 Selector를 가짐&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// → CPU 캐시 친화적&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;정리&lt;/h2&gt;
&lt;h3&gt;Java NIO Selector의 핵심&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;단일 스레드로 다중 채널 처리&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OS 커널의 I/O 멀티플렉싱 활용&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;논블로킹 I/O로 스레드 블로킹 없음&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Netty가 Java NIO보다 나은 이유&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;성능 최적화&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;selectedKeys를 Set → Array로 교체&lt;/li&gt;
&lt;li&gt;Zero-Copy 기술&lt;/li&gt;
&lt;li&gt;Object Pooling&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;안정성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JDK epoll bug 자동 감지 및 복구&lt;/li&gt;
&lt;li&gt;세밀한 에러 처리&lt;/li&gt;
&lt;li&gt;Backpressure 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;확장성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EventLoopGroup으로 멀티 스레드&lt;/li&gt;
&lt;li&gt;Channel Pipeline으로 확장 가능&lt;/li&gt;
&lt;li&gt;다양한 프로토콜 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;사용성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;고수준 추상화 (Channel, Pipeline)&lt;/li&gt;
&lt;li&gt;Reactor와 통합&lt;/li&gt;
&lt;li&gt;Spring WebFlux 기본 클라이언트&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;WebClient → Netty → OS 전체 흐름&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;WebClient.subscribe()
    ↓ (메인 스레드)
Mono 체인 구성
    ↓
ReactorClientHttpConnector
    ↓
Netty HttpClient.request()
    ↓
Channel.write() → EventLoop에 제출
    ↓ (reactor-http-nio-2 스레드)
NioEventLoop.execute(task)
    ↓
selector.select() 호출
    ↓ (JNI)
epoll_wait() / kevent() 호출
    ↓ (OS 커널)
Ready List 모니터링
    ↓
네트워크 패킷 도착
    ↓
인터럽트 발생
    ↓
Ready List에 fd 추가
    ↓
epoll_wait() 반환
    ↓ (Java)
processSelectedKeys()
    ↓
channel.read() → ByteBuf
    ↓
Pipeline 처리 (HTTP 파싱)
    ↓
Mono.next(response)
    ↓
.doOnNext() 실행
    ↓
.subscribe() 콜백 실행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;핵심 코드 위치&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Java NIO&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;java.nio.channels.Selector&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;java.nio.channels.SelectionKey&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;java.nio.channels.SocketChannel&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Netty&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;io.netty.channel.nio.NioEventLoop&lt;/code&gt; - EventLoop 구현&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;io.netty.channel.nio.NioSocketChannel&lt;/code&gt; - Channel 구현&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;io.netty.buffer.ByteBuf&lt;/code&gt; - 버퍼 추상화&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;io.netty.channel.ChannelPipeline&lt;/code&gt; - 처리 파이프라인&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Reactor Netty&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;reactor.netty.http.client.HttpClient&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;reactor.netty.Connection&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Spring WebFlux&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;org.springframework.web.reactive.function.client.WebClient&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;org.springframework.http.client.reactive.ReactorClientHttpConnector&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Netty 이벤트 루프를 이해하면 WebClient의 비동기 처리를 완전히 이해할 수 있습니다&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;a href=&quot;../webclient&quot;&gt;Spring WebClient와 논블로킹 I/O&lt;/a&gt;에서 WebClient의 실전 사용법을 확인하세요.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[Spring WebClient와 논블로킹 I/O]]></title><description><![CDATA[WebClient란? 항목 RestTemplate WebClient 방식 동기/블로킹 비동기/논블로킹 스레드 모델 요청당 스레드 대기 Netty 이벤트 루프 동시 처리 1000개 요청 = 1000개 스레드 100…]]></description><link>https://gotobill.github.io/webclient/</link><guid isPermaLink="false">https://gotobill.github.io/webclient/</guid><pubDate>Wed, 08 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;WebClient란?&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;RestTemplate&lt;/th&gt;
&lt;th&gt;WebClient&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;방식&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;동기/블로킹&lt;/td&gt;
&lt;td&gt;비동기/논블로킹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;스레드 모델&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;요청당 스레드 대기&lt;/td&gt;
&lt;td&gt;Netty 이벤트 루프&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;동시 처리&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1000개 요청 = 1000개 스레드&lt;/td&gt;
&lt;td&gt;1000개 요청 = 소수의 스레드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;상태&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;더 이상 권장하지 않음&lt;/td&gt;
&lt;td&gt;권장&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;WebClient는 Netty 기반 논블로킹 HTTP 클라이언트입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
소수의 이벤트 루프 스레드로 수천 개의 동시 연결을 처리할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Spring 5부터 RestTemplate 대신 WebClient 사용을 권장합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Netty의 이벤트 루프 방식이 어떻게 동작하는지 자세히 알고 싶다면 &lt;a href=&quot;../netty-eventloop&quot;&gt;Netty 이벤트 루프 완전 정복&lt;/a&gt;을 참고하세요.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;의존성 설정&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;implementation &lt;span class=&quot;token string&quot;&gt;&apos;org.springframework.boot:spring-boot-starter-webflux&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;WebClient 설정&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;HttpClient vs WebClient&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;HttpClient&lt;/strong&gt; (Netty): 네트워크 통신 계층.&lt;/p&gt;
&lt;p&gt;소켓 연결, 바이트 읽기/쓰기, 타임아웃 등 네트워크 레벨 처리&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;WebClient&lt;/strong&gt; (Spring): 애플리케이션 계층.&lt;/p&gt;
&lt;p&gt;URI 구성, JSON 변환, Reactive 스트림 처리 등 개발자 친화적 기능 제공&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;WebClient가 내부적으로 HttpClient를 사용합니다.&lt;/strong&gt; HttpClient가 실제 네트워크 통신을 담당하고, WebClient가 이를 편리하게 사용할 수 있도록 감싸는 구조입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;기본 설정&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebClientConfig&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${api.base-url}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; baseUrl&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebClient&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;webClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;HttpClient&lt;/span&gt; httpClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ChannelOption&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CONNECT_TIMEOUT_MILLIS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;responseTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnConnected&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conn &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                        conn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addHandlerLast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReadTimeoutHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addHandlerLast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WriteTimeoutHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;ExchangeStrategies&lt;/span&gt; exchangeStrategies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExchangeStrategies&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;codecs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configurer &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; configurer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defaultCodecs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;maxInMemorySize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;baseUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;baseUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clientConnector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReactorClientHttpConnector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;httpClient&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exchangeStrategies&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exchangeStrategies&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defaultHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;주요 설정 항목&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;타임아웃 종류&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CONNECT_TIMEOUT_MILLIS&lt;/code&gt;
서버와 TCP 연결을 맺을 때까지의 타임아웃입니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;responseTimeout&lt;/code&gt;
요청을 보낸 후 전체 응답을 받을 때까지의 타임아웃입니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ReadTimeoutHandler&lt;/code&gt;
서버로부터 응답 데이터를 읽는 중 타임아웃입니다. 데이터를 읽다가 30초 동안 아무 데이터도 오지 않으면 실패합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WriteTimeoutHandler&lt;/code&gt;
서버로 요청 데이터를 쓰는 중 타임아웃입니다. 데이터를 보내다가 30초 동안 전송이 안 되면 실패합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;메모리 버퍼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;maxInMemorySize&lt;/code&gt;
메모리 버퍼 크기 제한을 설정합니다. 기본값은 256KB입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;대용량 파일 처리 시 주의&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
이미지나 대용량 파일을 처리할 때는 반드시 maxInMemorySize를 적절히 설정해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
그렇지 않으면 &lt;strong&gt;DataBufferLimitException&lt;/strong&gt;이 발생합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;WebClient 빌더&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;baseUrl&lt;/code&gt;
모든 요청에 공통으로 사용할 기본 URL을 설정합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;clientConnector&lt;/code&gt;
HTTP 클라이언트 커넥터를 설정합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HttpClient&lt;/strong&gt;는 Netty의 설정 객체이고, &lt;strong&gt;ReactorClientHttpConnector&lt;/strong&gt;는 이 설정을 Spring WebFlux가 사용할 수 있도록 감싸는 어댑터입니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;exchangeStrategies&lt;/code&gt;
메시지 인코딩/디코딩 전략을 설정합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;defaultHeader&lt;/code&gt;
모든 요청에 기본으로 포함될 헤더를 설정합니다.&lt;/p&gt;
&lt;h2&gt;기본 사용법&lt;/h2&gt;
&lt;h3&gt;메서드 체이닝 구조&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                          &lt;span class=&quot;token comment&quot;&gt;// HTTP 메서드 선택&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                    &lt;span class=&quot;token comment&quot;&gt;// 요청 URI 설정&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;requestBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;token comment&quot;&gt;// 요청 본문 설정&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                      &lt;span class=&quot;token comment&quot;&gt;// 응답 가져오기&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponseType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 응답을 Mono로 변환&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;// 데이터 변환&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;logSuccess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;// 성공 시 로깅&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;logError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;// 에러 시 로깅&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponseType&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponseType&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;logSuccess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponseType&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;API 호출 성공: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;logError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;API 호출 실패: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Reactive 스트림 처리&lt;/h2&gt;
&lt;h3&gt;Controller와 Service 예시&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;시나리오:&lt;/strong&gt; 우리 서버가 외부 User API를 호출하여 사용자 정보를 가져옵니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Client → 우리 서버 (Controller) → Service → WebClient → 외부 User API 서버&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 우리 서버의 Controller&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@RequiredArgsConstructor&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; userService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/api/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 클라이언트가 우리 서버에 요청&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@PathVariable&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; userService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Mono&amp;lt;User&gt; 즉시 반환&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 우리 서버의 Service (외부 API 호출)&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@RequiredArgsConstructor&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebClient&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 외부 API 호출용&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UserDTO&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 외부 User API 서버로 요청&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;외부 API에서 사용자 조회 성공: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserDTO&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                    successData &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;성공: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; successData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token function&quot;&gt;handleSuccess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;successData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 성공 시 처리 로직&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;실패&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;token function&quot;&gt;handleError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 에러 시 처리 로직&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;완료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 완료 시 처리 로직 (선택)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleSuccess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UserDTO&lt;/span&gt; userDTO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 사용자 정보를 캐시에 저장하거나 이벤트 발행&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 에러 알림 전송 또는 폴백 처리&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;비동기 처리 흐름 (Netty 이벤트 루프)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[메인 스레드 (http-nio-exec-1)]
    1. Client 요청 수신
        ↓
    2. webClient.get().uri(&quot;/users/1&quot;)
        .retrieve()
        .bodyToMono(User.class)
        .doOnNext(...)
        .map(...)  호출
        ↓
    3. Mono&amp;lt;User&gt; 객체만 생성 (빈 깡통, 실제 HTTP 요청은 아직 안 보냄)
        ↓
    4. Controller 메서드가 Mono&amp;lt;User&gt; 반환 (빈 깡통만, Client는 아직 응답 못 받음)
        ↓
    5. 메인 스레드 해제 (다른 요청 처리 가능)

    6. Spring이 Mono를 subscribe() 호출하고 대기 ← 실제 실행 시작!
        ↓
══════════════════════════════  스레드 전환 ══════════════════════════════ 

[Netty 이벤트 루프 스레드 (reactor-http-nio-2)]
    7. 실제 HTTP 요청 전송 (외부 API로)
        ↓
    8. 응답 대기 (블로킹 없음, 이벤트 루프는 다른 작업 처리)
        ↓
    9. 응답 수신 (JSON 데이터)
        ↓
    10. bodyToMono: JSON → User 객체 변환
        ↓
    11. doOnNext: 변환된 User로 로깅/상태 업데이트 (데이터는 변경 안 함)
        ↓
    12. map: User를 다른 형태로 변환 (예: UserDTO)
        ↓
    13. Mono에 실제 데이터 채움 (빈 깡통에 피자 담기)
        ↓
    14. Client에게 최종 응답 전달 ← Client는 실제 데이터를 1번만 받음!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;데이터 흐름 요약:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;응답 JSON
    ↓
bodyToMono → User 객체
    ↓
doOnNext → User (그대로 통과, 로깅만)
    ↓
map → UserDTO (변환)
    ↓
subscribe 람다 → UserDTO를 받아서 최종 처리&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;논블로킹의 핵심&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
메인 스레드는 블로킹되지 않고 즉시 반환됩니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Netty 이벤트 루프 스레드가 비동기로 처리합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;doOnNext는 데이터를 변경하지 않고&lt;/strong&gt;, &lt;strong&gt;map은 데이터를 변환&lt;/strong&gt;하며, &lt;strong&gt;subscribe 람다는 최종 변환된 데이터를 받아서 처리&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;URI 구성 방법&lt;/h2&gt;
&lt;h3&gt;Path Variable 사용&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}/posts/{postId}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; postId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 URI:&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;/users/123/posts/456&lt;/code&gt; (userId=123, postId=456일 때)&lt;/p&gt;
&lt;h3&gt;Query Parameter 사용&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uriBuilder &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; uriBuilder
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryParam&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;John&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryParam&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 URI:&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;/users?name=John&amp;amp;age=30&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;동적 파라미터&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ACTIVE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;limit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uriBuilder &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; uriBuilder
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/items&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryParam&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{status}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queryParam&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;limit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{limit}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 URI:&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;/items?status=ACTIVE&amp;amp;limit=100&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;응답 처리&lt;/h2&gt;
&lt;h3&gt;retrieve() 사용&lt;/h3&gt;
&lt;p&gt;간단한 응답 처리에 적합합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;exchangeToMono() 사용&lt;/h3&gt;
&lt;p&gt;상태 코드, 헤더 등 세밀한 제어가 필요할 때 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exchangeToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;statusCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is2xxSuccessful&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;statusCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is4xxClientError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorBody &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CustomException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Client error: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; errorBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;exchangeToMono() 사용 시 주의&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
반드시 응답 본문을 소비해야 합니다.
그렇지 않으면 메모리 누수가 발생할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
본문 소비 방법 &lt;strong&gt;3가지&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; 직접 읽기
response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; 자동으로 읽어서 예외에 포함
response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;releaseBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; 본문 버리기&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h2&gt;에러 핸들링&lt;/h2&gt;
&lt;h3&gt;onStatus로 상태 코드별 처리&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpStatusCode&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is4xxClientError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorBody &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CustomException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Client error: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; errorBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpStatusCode&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is5xxServerError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;doOnError로 에러 로깅&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/api&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;API 호출 실패: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onErrorResume&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defaultValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;주요 연산자&lt;/h2&gt;
&lt;h3&gt;doOnNext: 사이드 이펙트 처리&lt;/h3&gt;
&lt;p&gt;데이터를 변경하지 않고 로깅, 상태 업데이트 등을 수행합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/data&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;데이터 수신: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;updateProgress&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;map: 즉시 값으로 변환&lt;/h4&gt;
&lt;p&gt;일반 값을 반환할 때 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Flux&amp;lt;User&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// User → String&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collectList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Mono&amp;lt;List&amp;lt;String&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과:&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;[&quot;John&quot;, &quot;Jane&quot;, &quot;Bob&quot;]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;User(id=1, name=&quot;John&quot;) → &quot;John&quot;
User(id=2, name=&quot;Jane&quot;) → &quot;Jane&quot;
User(id=3, name=&quot;Bob&quot;) → &quot;Bob&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;flatMap: Mono/Flux로 변환&lt;/h3&gt;
&lt;p&gt;변환 과정에서 추가 비동기 작업(API 호출, DB 조회 등)이 필요할 때 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Flux&amp;lt;User&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}/posts&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 각 User마다 API 호출&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// User → Flux&amp;lt;Post&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collectList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Mono&amp;lt;List&amp;lt;Post&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과:&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;[Post(user1의 글1), Post(user1의 글2), Post(user2의 글1), ...]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;User(1) → API 호출 /users/1/posts → [Post1, Post2]
User(2) → API 호출 /users/2/posts → [Post3]
User(3) → API 호출 /users/3/posts → [Post4, Post5]

최종: [Post1, Post2, Post3, Post4, Post5] (평탄화됨)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 flatMap인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;map을 쓰면 중첩됩니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 결과: Flux&amp;lt;Flux&amp;lt;Post&gt;&gt;  ← 이중 Flux!&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flatMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 결과: Flux&amp;lt;Post&gt;  ← 평탄화!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;filter: 필터링&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collectList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;collectList: Flux를 List로 변환&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; users &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collectList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;타임아웃 설정&lt;/h2&gt;
&lt;h3&gt;요청별 타임아웃&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/slow-api&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;실전 패턴&lt;/h2&gt;
&lt;h3&gt;Retry 설정&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/api/data&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retryWhen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Retry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;backoff&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;maxBackoff&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;throwable &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; throwable &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeoutException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;설정 설명:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;backoff(3, Duration.ofSeconds(2))&lt;/code&gt;: 최대 3번 재시도, 초기 대기 2초&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;maxBackoff(Duration.ofSeconds(10))&lt;/code&gt;: 최대 대기 시간 10초&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;filter(...)&lt;/code&gt;: TimeoutException일 때만 재시도&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;재시도 간격 (Exponential Backoff):&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;대기 시간이 2배씩 증가합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1차 실패 → 2초 대기 (2 × 2^0)
2차 실패 → 4초 대기 (2 × 2^1)
3차 실패 → 8초 대기 (2 × 2^2)
4차 실패 → 최종 실패&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 지수적으로 증가하나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;서버가 과부하 상태일 때 계속 빠르게 재시도하면 부담이 가중됩니다. 대기 시간을 점진적으로 늘려서 서버 회복 시간을 확보합니다.&lt;/p&gt;
&lt;h3&gt;폴백 처리&lt;/h3&gt;
&lt;p&gt;API 호출 실패 시 기본값을 반환하여 애플리케이션이 중단되지 않도록 합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;999&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onErrorResume&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;사용자 조회 실패, 익명 사용자 반환&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;익명&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;정상: /users/999 → User(999, &quot;John&quot;) 반환
실패: /users/999 → 404 에러 → User(0, &quot;익명&quot;) 반환 (에러 대신 기본값)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;병렬 요청 처리&lt;/h3&gt;
&lt;p&gt;여러 API를 동시에 호출하고 결과를 합칩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; userMono &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; postsMono &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}/posts&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToFlux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collectList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;zip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userMono&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; postsMono&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tuple &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tuple&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getT1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 첫 번째 결과&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; posts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tuple&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getT2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 두 번째 결과&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserWithPosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; posts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;실행 흐름:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;userMono 요청 전송 → 논블로킹 대기
postsMono 요청 전송 → 논블로킹 대기
  ↓
이벤트 루프는 다른 작업 처리 (블로킹 없음!)
  ↓
User 응답 도착 → userMono에 채움
Post 응답 도착 → postsMono에 채움
  ↓
두 개 모두 준비되면 → zip의 map 실행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;주의사항&lt;/h2&gt;
&lt;h3&gt;subscribe() 사용 구분&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;핵심 원칙: Mono/Flux는 &quot;레시피&quot;이고, subscribe()는 &quot;실행 버튼&quot;입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Mono/Flux는 subscribe 전까지 아무것도 실행하지 않습니다. (Lazy Execution)&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Mono/Flux를 반환하면 받는 쪽에서 subscribe하고, void 반환이면 직접 subscribe해야 실행됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;실행 흐름:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. Mono 생성 (레시피 작성)
   Mono&amp;lt;User&gt; mono = webClient.get()...bodyToMono(User.class)
   → HTTP 요청 아직 안 보냄!

2-1. Mono 반환 (레시피 전달)
   return mono;
   → 받는 쪽(Spring/호출자)이 subscribe → 실행

2-2. void 반환 (레시피 바로 실행)
   mono.subscribe();
   → 직접 subscribe → 실행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Controller - Mono 반환&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Spring이 subscribe → Client에게 응답 전달&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Controller - void 반환&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@PostMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/notifications&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sendNotification&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/notifications&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// void니까 직접 subscribe → 알림만 보내고 응답은 안 줌&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Service - Mono 반환&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Controller가 받아서 처리&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Service - void 반환&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/process&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 결과 필요 없으니 직접 subscribe&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;잘못된 예 - Mono 반환인데 subscribe까지&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; mono &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    mono&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1차 실행 (결과는 버려짐)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mono&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;       &lt;span class=&quot;token comment&quot;&gt;// Spring이 2차 실행 (중복!)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;block()은 개발/테스트 용도로만&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;프로덕션 코드에서 block() 사용 금지&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
block()을 사용하면 논블로킹의 이점을 모두 잃습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
테스트 코드에서만 허용됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;프로덕션 (잘못됨)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;프로덕션 (올바름)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;테스트 (허용)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;testGetUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users/{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;John&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;트랜잭션 경계 주의&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;subscribe() 내부는 별도 스레드에서 실행됩니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
외부 트랜잭션과 분리되므로, 트랜잭션이 필요한 경우 별도 서비스로 분리해야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    mono&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        data &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            separateTransactionalService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;saveData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; requestId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;스레드 로깅으로 비동기 흐름 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: API 호출 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

mono&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: 응답 수신&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;출력 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Thread [http-nio-8080-exec-1]: API 호출 시작
Thread [reactor-http-nio-2]: 응답 수신&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;실전 예제: 메뉴 추출 API 스레드 분석&lt;/h2&gt;
&lt;p&gt;실제 운영 중인 메뉴 추출 API의 로그를 통해 WebClient의 비동기 처리를 분석합니다.&lt;/p&gt;
&lt;h3&gt;핵심 요약&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;메인 스레드 (http-nio-8080-exec-5)&lt;/strong&gt;: Mono 레시피 구성 및 subscribe() 호출 → 즉시 반환 (190ms)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Netty 스레드 (reactor-http-nio-2)&lt;/strong&gt;: 실제 HTTP 요청, 응답 처리, DB 저장 (5.8초)&lt;/p&gt;
&lt;h3&gt;스레드 전환 시점&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Phase 1: 메인 스레드 (http-nio-8080-exec-5)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@PostMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/menu/extract&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApiResponse&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MenuExtractionStartResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startMenuExtraction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; requestId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; extractionService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startMenuExtraction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; storeId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApiResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MenuExtractionStartResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;requestId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 190ms만에 응답 반환&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startMenuExtraction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; storeId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MultipartFile&lt;/span&gt; image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 1. Progress 초기화 및 DB 저장 (동기)&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; requestId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;randomUUID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    progressRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;saveAndFlush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;progress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 2. WebClient Mono 생성 (레시피만 만듦)&lt;/span&gt;
    geminiService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractTextFromImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mimeType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseExtractedText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 실행 예약만 하고 즉시 다음 라인으로&lt;/span&gt;

    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: 즉시 반환 - Request ID: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;requestId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; requestId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 즉시 반환 (5초를 기다리지 않음!)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;로그:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;19:04:04.039 [http-nio-8080-exec-5] 메뉴 추출 시작
19:04:04.121 [http-nio-8080-exec-5] Gemini API 호출 시작
19:04:04.229 [http-nio-8080-exec-5] 즉시 반환 - Request ID: dcf4cb95-...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Phase 2: Netty 스레드 (reactor-http-nio-2)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Netty 스레드가 비동기로 처리 시작&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;extractTextFromImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; imageBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; mimeType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: Gemini API 호출 시작 - 이미지 크기: {} bytes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; imageBytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; base64Image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Base64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEncoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;encodeToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageBytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; requestBody &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;buildGeminiRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base64Image&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mimeType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/models/{model}:generateContent?key={key}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; modelName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; apiKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;requestBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: Gemini API 응답 수신&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractTextFromResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread [{}]: Gemini API 호출 실패 - {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;geminiService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractTextFromImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mimeType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doOnNext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;텍스트 파싱 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// reactor-http-nio-2&lt;/span&gt;
        progressRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;progress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Netty 스레드에서 DB 쿼리&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseExtractedText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// reactor-http-nio-2&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        items &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;DB 저장 요청 - {} 개 아이템&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            menuPersistenceService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;saveMenuItemsWithProgress&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;storeId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; requestId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        error &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;메뉴 추출 실패&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;로그:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;19:04:09.976 [reactor-http-nio-2] Gemini API 응답 수신
19:04:09.977 [reactor-http-nio-2] 텍스트 추출 성공
19:04:09.977 [reactor-http-nio-2] 텍스트 파싱 시작
19:04:09.981 [reactor-http-nio-2] DB 저장 요청 - 14 개 아이템
19:04:09.983 [reactor-http-nio-2] DB 트랜잭션 시작
19:04:10.024 [reactor-http-nio-2] DB 트랜잭션 완료 - 14개 아이템 추가&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;전체 흐름 다이어그램&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Client 요청]
    ↓
[http-nio-8080-exec-5] ← 메인 스레드
    ↓
    1. 컨트롤러 진입
    2. Progress 초기화 (DB 저장)
    3. WebClient Mono 생성 (레시피만)
    4. subscribe() 호출 (실행 예약)
    5. requestId 즉시 반환 ← 190ms
    ↓
[Client 응답 완료]

━━━━━━━━━━━━━━━━━━━━━━━━━

[reactor-http-nio-2] ← Netty 스레드
    ↓
    1. HTTP 요청 전송
    2. Gemini API 응답 수신
    3. JSON 파싱
    4. DTO 변환
    5. DB 저장 (14개 INSERT)
    6. Progress 완료 처리
    ↓
[완료]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;핵심 포인트&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. subscribe()의 두 얼굴&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;geminiService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractTextFromImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 호출은 메인 스레드, 실행은 Netty 스레드&lt;/span&gt;

log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;즉시 반환&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// subscribe() 후 바로 실행됨&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;subscribe() 호출&lt;/strong&gt;: http-nio-8080-exec-5&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;subscribe 내부 콜백&lt;/strong&gt;: reactor-http-nio-2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. 메인 스레드는 블로킹 안 됨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;시간 증거:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메인 스레드 종료: 19:04:04.229&lt;/li&gt;
&lt;li&gt;Netty 응답 수신: 19:04:09.976&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;차이: 5.7초&lt;/strong&gt; ← 메인 스레드는 기다리지 않았음!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. Netty 스레드에서 DB 작업&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;19:04:09.981 [reactor-http-nio-2] DB 저장 요청
Hibernate: insert into food_items ...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;모든 DB 쿼리가 Netty 스레드에서 실행됩니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;트랜잭션 주의&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Netty 스레드는 메인 스레드와 &lt;strong&gt;다른 스레드&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt;은 스레드 로컬 방식으로 동작하므로, 메인 스레드의 트랜잭션은 Netty 스레드에 적용되지 않습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
subscribe() 내부에서 DB 작업이 필요하면 &lt;strong&gt;별도 트랜잭션 서비스&lt;/strong&gt;를 호출해야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;올바른 예:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startExtraction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    progressRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;progress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;items &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        persistenceService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;saveMenuItems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;items&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 새 트랜잭션 시작&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; requestId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PersistenceService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Netty 스레드에서 새 트랜잭션 시작&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;saveMenuItems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MenuItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        menuRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;saveAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;items&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;4. 실행 시간 비교&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;동기 방식 (RestTemplate):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;사용자 대기: 5.8초&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;비동기 방식 (WebClient):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;사용자 대기: 190ms
백그라운드 처리: 5.8초&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;결론&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Mono는 레시피&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; recipe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 실행 안 됨 (메인 스레드)&lt;/span&gt;
recipe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                       &lt;span class=&quot;token comment&quot;&gt;// 실행 예약 (메인 스레드)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 실제 실행은 Netty 스레드에서&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;스레드 전환 자동&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;개발자가 스레드를 명시적으로 관리할 필요 없음. WebClient가 알아서 Netty 스레드로 전환합니다.
&lt;strong&gt;논블로킹의 이점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;메인 스레드는 즉시 반환하고, Netty 스레드가 백그라운드에서 처리. 사용자는 5초가 아닌 190ms만 대기합니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[InnoDB 잠금 메커니즘]]></title><description><![CDATA[InnoDB 잠금 종류 InnoDB 스토리지 엔진은 레코드 기반 잠금 기능을 제공합니다. 락 에스컬레이션이란?  일부 DBMS…]]></description><link>https://gotobill.github.io/mysql-part5/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-part5/</guid><pubDate>Mon, 06 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;InnoDB 잠금 종류&lt;/h2&gt;
&lt;p&gt;InnoDB 스토리지 엔진은 &lt;strong&gt;레코드 기반 잠금 기능&lt;/strong&gt;을 제공합니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;락 에스컬레이션이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
일부 DBMS에서는 잠금 개수가 많아지면 메모리 부족을 방지하기 위해 여러 개의 레코드 락을 페이지 락이나 테이블 락으로 자동 업그레이드합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
예: 1000개 레코드 락 → 1개 테이블 락으로 변환&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;InnoDB는 잠금 정보를 매우 작은 공간으로 관리하므로 락 에스컬레이션이 발생하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;일반 상용 DBMS와는 다르게 InnoDB에서는 다음과 같은 잠금 종류를 제공합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/59c75b04f97d222ea3bfe54bdf7a6878/715a3/5.1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 98.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5klEQVR42pWUZ67CMBCEuf+BcgMEiPCDInrvvfe2T99KiwI4PFjJimPMeGZnnIg46n6/y/l8luPxqM/r9arP0+mkg3fbZ8Mq4gLc7XYymUxks9nIfD6XUqkkw+FQttutTKdTabVab4AGGnllRhnQfr+X1Wolg8FAgXifzWaSy+UeB8MY9k6GQcBmsynr9VoqlYpkMhlluVwupVgsiud5slgsJJVK6TqMAQ8F5Ec2lctlHYVCQYEAz2azkk6ndR/s6DPMmYcCwgyJ1OFwkNFopIwoWgBwcH+oKUHJAOImbOkbcnmnt7CmbrdbuCnBRUxAMk7Djnmv19NDarWa9u2V2cfYIKnRaKhMwDGlWq0qc+bJZPKNxBMgG9vttjKAUT6fl263q6AMHLc5wNFoVE0wyU+Al8tFOp2Oyur3+xpgWIzH44fjgNM7OxxACNBL+huaw6BkAO264bQFGJfj8bgC0xJUEZ2PLtM3ZHI6TMggbPgzkhOJhISVE5A7i5sMQozEWCwm9Xpd2VmwiZHTFFcOkczTBocw6PFrsP8F5KaYKfQMZgBRBNyC/TWgMSFChJte8uQQHKcVPwEikSjhLk4CgFG4bF+fnxlaiLlmvu/rV4Y1bsnXgFbcAJMGCNEhRvSSNfsSuQD/AGhX/2tW6boyAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;락 종류&quot;
        title=&quot;&quot;
        src=&quot;/static/59c75b04f97d222ea3bfe54bdf7a6878/f058b/5.1.png&quot;
        srcset=&quot;/static/59c75b04f97d222ea3bfe54bdf7a6878/c26ae/5.1.png 158w,
/static/59c75b04f97d222ea3bfe54bdf7a6878/6bdcf/5.1.png 315w,
/static/59c75b04f97d222ea3bfe54bdf7a6878/f058b/5.1.png 630w,
/static/59c75b04f97d222ea3bfe54bdf7a6878/715a3/5.1.png 830w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;레코드 락&lt;/h3&gt;
&lt;p&gt;레코드 자체만을 잠그는 것을 &lt;strong&gt;레코드 락&lt;/strong&gt;(Record Lock, Record Only Lock)이라고 합니다. 다른 상용 DBMS의 레코드 락과 동일한 역할을 하지만, 중요한 차이점이 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;InnoDB는 레코드 자체가 아니라 인덱스의 레코드를 잠급니다.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;인덱스가 하나도 없는 테이블이라도 내부적으로 자동 생성된 &lt;strong&gt;클러스터 인덱스&lt;/strong&gt;를 이용해 잠금을 설정합니다.&lt;/li&gt;
&lt;li&gt;레코드 자체를 잠그느냐, 인덱스를 잠그느냐는 상당히 크고 중요한 차이를 만들어냅니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;인덱스 종류에 따른 잠금 범위&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 1. 유니크 인덱스로 조회 (특정 레코드 1건만 존재)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 잠금: id=100 레코드만 잠금 (갭 락 없음)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 이유: 유니크이므로 id=100은 딱 1건만 존재, 중간에 끼어들 수 없음&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 2. 일반 인덱스로 조회 (같은 값의 레코드가 여러 개 가능)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; age &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 잠금: age=30인 레코드들 + 그 사이사이 갭까지 잠금 (넥스트 키 락)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 이유: age=30인 레코드 사이에 새로운 age=30 레코드가 INSERT될 수 있음&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 차이가 나는가?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;유니크 인덱스&lt;/strong&gt;: 해당 값이 딱 1건만 존재 → 중간에 끼어들 여지가 없음 → 갭 락 불필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;일반 인덱스&lt;/strong&gt;: 같은 값이 여러 개 → 그 사이에 새로운 레코드 INSERT 가능 → 갭 락 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;갭 락&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;갭 락&lt;/strong&gt;(Gap Lock)은 레코드 자체가 아니라 &lt;strong&gt;레코드와 바로 인접한 레코드 사이의 간격만을 잠급니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;갭 락의 역할은 레코드와 레코드 사이의 간격에 새로운 레코드가 생성(INSERT)되는 것을 제어하는 것입니다.&lt;/p&gt;
&lt;p&gt;갭 락 그 자체보다는 다음에 설명할 &lt;strong&gt;넥스트 키 락의 일부로 자주 사용&lt;/strong&gt;됩니다.&lt;/p&gt;
&lt;h3&gt;넥스트 키 락&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;레코드 락 + 갭 락 = 넥스트 키 락&lt;/strong&gt;(Next Key Lock)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 필요한가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;MySQL의 복제(Replication) 환경에서 Master와 Replica 서버의 데이터 일관성을 보장하기 위해 필요합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Master 서버&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;START&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TRANSACTION&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; price &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 현재 10건 삭제&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 만약 갭 락이 없다면?&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 다른 트랜잭션에서 INSERT INTO orders VALUES (11, 15000); 실행 가능&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 바이너리 로그에 기록됨: &quot;DELETE FROM orders WHERE price &gt;= 10000&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;문제 상황&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;갭 락이 없으면&lt;/strong&gt;: DELETE 실행 중에 price=15000인 새 주문이 INSERT될 수 있음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replica 서버에서 재생 시&lt;/strong&gt;: 이 INSERT가 없는 상태에서 DELETE 실행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;결과&lt;/strong&gt;: Master는 11건 삭제, Replica는 10건 삭제 → &lt;strong&gt;데이터 불일치&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;넥스트 키 락으로 해결&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DELETE 실행 시 price &gt;= 10000 범위의 레코드 + 갭까지 모두 잠금&lt;/li&gt;
&lt;li&gt;그 사이에 INSERT 불가능&lt;/li&gt;
&lt;li&gt;Master와 Replica의 결과가 동일하게 보장됨&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;바이너리 로그 포맷 차이&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;STATEMENT 포맷&lt;/strong&gt;: SQL 문장 자체를 기록&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Master에서 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; price &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 바이너리 로그에 기록&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&quot;DELETE FROM orders WHERE price &gt;= 10000&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Replica에서 이 SQL을 그대로 재실행&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 문제: Replica 실행 시점에 Master와 데이터가 다를 수 있음&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 해결: 넥스트 키 락으로 INSERT 차단 필요&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ROW 포맷&lt;/strong&gt;: 변경된 행의 실제 데이터를 기록&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Master에서 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; price &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 바이너리 로그에 기록&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&quot;id=5, price=10000 삭제&quot;&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&quot;id=7, price=12000 삭제&quot;&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&quot;id=9, price=15000 삭제&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Replica에서 정확히 이 행들만 삭제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 중간에 INSERT가 있어도 상관없음 (삭제할 행이 명확히 지정됨)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 해결: 넥스트 키 락 불필요&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ROW 포맷은 삭제할 행을 명확히 지정하므로 갭 락이 불필요하여 성능이 향상됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;자동 증가 락&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;AUTO_INCREMENT 락이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AUTO_INCREMENT 컬럼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JPA의 &lt;code class=&quot;language-text&quot;&gt;@GeneratedValue(strategy = GenerationType.IDENTITY)&lt;/code&gt;을 사용할 때, 여러 커넥션에서 동시에 INSERT해도 ID 값이 중복되지 않도록 보장하는 테이블 수준의 잠금입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 테이블 정의&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    id &lt;span class=&quot;token keyword&quot;&gt;BIGINT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;AUTO_INCREMENT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- JPA @GeneratedValue(IDENTITY)&lt;/span&gt;
    name &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 동시에 두 INSERT 실행&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- Connection 1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- id=1 할당&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 2&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;김철수&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- id=2 할당 (중복 없이)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;INSERT/REPLACE에서만 사용 (UPDATE/DELETE는 무관)&lt;/li&gt;
&lt;li&gt;ID 값을 가져오는 순간만 잠금 후 즉시 해제&lt;/li&gt;
&lt;li&gt;트랜잭션과 무관하게 작동&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;락 방식의 차이&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;AUTO_INCREMENT 락 vs 경량 래치(Mutex)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;AUTO_INCREMENT 락&lt;/strong&gt;: INSERT 문장이 완료될 때까지 락 유지 (느림)&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;경량 래치(Mutex)&lt;/strong&gt;: ID 값만 가져가면 즉시 해제 (빠름, 뮤텍스라고도 함)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- AUTO_INCREMENT 락 사용 시&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; temp_users&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 1000건&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 락 획득&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. ID 1~1000 할당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. 1000건 모두 INSERT 완료&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. 락 해제 ← INSERT가 끝나야 해제 (느림)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 경량 래치 사용 시&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 래치 획득&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. ID=5 할당받음&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. 래치 즉시 해제 ← INSERT 완료 전에 해제 (빠름)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. INSERT 계속 진행&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → 다른 커넥션이 바로 ID=6 받아갈 수 있음&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;innodb_autoinc_lock_mode 설정 (MySQL 8.0 기준)&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;모드&lt;/th&gt;
&lt;th&gt;잠금 방식&lt;/th&gt;
&lt;th&gt;성능&lt;/th&gt;
&lt;th&gt;연속성&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;모든 INSERT에 락 사용&lt;/td&gt;
&lt;td&gt;느림&lt;/td&gt;
&lt;td&gt;완벽 보장&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;단순 INSERT는 래치, 대량은 락&lt;/td&gt;
&lt;td&gt;중간&lt;/td&gt;
&lt;td&gt;한 문장만&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;2&lt;/strong&gt; (기본값)&lt;/td&gt;
&lt;td&gt;모든 INSERT에 래치만&lt;/td&gt;
&lt;td&gt;빠름&lt;/td&gt;
&lt;td&gt;보장 안 됨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;각 모드별 동작 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 모드 1: 단순 INSERT (건수 예측 가능)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 경량 래치 사용 (빠름)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 모드 1: 대량 INSERT (건수 예측 불가)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; temp_users&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- AUTO_INCREMENT 락 사용 (느림)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 모드 2: 모든 경우&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 항상 경량 래치 (가장 빠름, 하지만 연속성 보장 안 됨)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ID 연속성이 보장되지 않는다는 의미&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Connection 1이 대량 INSERT 시작&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; temp_users&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 1000건&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 모드 1 (연속성 보장):&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. Connection 1이 AUTO_INCREMENT 락 획득&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. id=1~1000 모두 할당받음&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. 1000건 INSERT 완료&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. 락 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → Connection 1이 끝날 때까지 다른 커넥션은 대기&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → 결과: Connection 1은 id=1~1000을 연속으로 받음&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 모드 2 (연속성 보장 안 됨):&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. Connection 1: id=1 받음 → 래치 즉시 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. Connection 1: id=2 받음 → 래치 즉시 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. Connection 2: id=3 받음 → 래치 즉시 해제 (끼어듦!)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. Connection 1: id=4 받음 → 래치 즉시 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 5. Connection 2: id=5 받음 → 래치 즉시 해제 (또 끼어듦!)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 6. Connection 1: id=6 받음...&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → Connection 1은 id=1,2,4,6,7... (중간이 빠짐)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → Connection 2는 id=3,5,8,10... (끼어든 것들)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;핵심&lt;/strong&gt;: 모드 2에서는 대량 INSERT 중간에 다른 커넥션이 끼어들어 ID를 가져갈 수 있어서, 한 INSERT 문장이 연속된 ID를 받지 못합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;MySQL 8.0 기본값이 2인 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
ROW 포맷은 실제 데이터를 기록하므로 (&quot;id=1 삭제&quot;, &quot;id=3 삭제&quot;) ID 순서가 뒤섞여도 복제에 문제가 없습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;STATEMENT 포맷 사용 시 주의&lt;/strong&gt;: 모드 2에서는 Master와 Replica의 AUTO_INCREMENT 값이 달라질 수 있으므로 모드 1로 변경 권장&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;왜 INSERT 실패 시 ID가 건너뛰는가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;AUTO_INCREMENT는 &lt;strong&gt;테이블 전체에서 공유하는 하나의 카운터&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- AUTO_INCREMENT 카운터 = 5 (테이블 전체 공유)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 1&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 래치 획득 → 카운터에서 5 받음 → 카운터 6으로 증가 → 래치 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. INSERT 실행 중...&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 2 (동시에 실행)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 래치 획득 → 카운터에서 6 받음 → 카운터 7으로 증가 → 래치 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. INSERT 완료&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 3&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 래치 획득 → 카운터에서 7 받음 → 카운터 8으로 증가 → 래치 해제&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. INSERT 완료&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 1&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. INSERT 실패! (중복 이메일)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. 카운터를 5로 되돌리려면?&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;--    → 이미 카운터는 8&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;--    → 다른 커넥션이 6, 7 사용 중&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;--    → 되돌리면 6, 7과 충돌! (매우 복잡)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그래서 &lt;strong&gt;실패해도 카운터는 되돌리지 않고&lt;/strong&gt;, id=5는 영구 건너뛴 채로 단순하게 처리합니다.&lt;/p&gt;
&lt;h2&gt;인덱스와 잠금&lt;/h2&gt;
&lt;p&gt;InnoDB의 잠금과 인덱스는 상당히 중요한 연관 관계가 있습니다. &lt;strong&gt;InnoDB의 잠금은 레코드를 잠그는 것이 아니라 인덱스를 잠그는 방식으로 처리됩니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;즉, &lt;strong&gt;변경해야 할 레코드를 찾기 위해 검색한 인덱스의 레코드를 모두 락을 걸어야 합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;예제: 인덱스와 잠금 범위&lt;/h3&gt;
&lt;p&gt;employees 테이블에 다음과 같은 인덱스가 있다고 가정하겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- ix_firstname 인덱스 구성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; ix_firstname &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;데이터 분포&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- first_name=&apos;Georgi&apos;인 사원: 253명&lt;/span&gt;
mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Georgi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;----------+&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;token number&quot;&gt;253&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;----------+&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- first_name=&apos;Georgi&apos;이고 last_name=&apos;Klassen&apos;인 사원: 1명&lt;/span&gt;
mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Georgi&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; last_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Klassen&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;----------+&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;----------+&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;UPDATE 쿼리 실행&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; employees
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; hire_date&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; first_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Georgi&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; last_name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Klassen&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 분석&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;실제로 업데이트되는 레코드: 1건&lt;/li&gt;
&lt;li&gt;실제로 잠금이 걸리는 레코드: 253건&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 253건이 잠기는가?&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;인덱스를 이용할 수 있는 조건은 &lt;code class=&quot;language-text&quot;&gt;first_name=&apos;Georgi&apos;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;last_name&lt;/code&gt; 컬럼은 인덱스에 없음&lt;/li&gt;
&lt;li&gt;따라서 &lt;code class=&quot;language-text&quot;&gt;first_name=&apos;Georgi&apos;&lt;/code&gt;인 레코드 253건을 모두 검색하면서 잠금&lt;/li&gt;
&lt;li&gt;각 레코드에서 &lt;code class=&quot;language-text&quot;&gt;last_name=&apos;Klassen&apos;&lt;/code&gt; 조건을 추가로 필터링&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d491435c5d210719aa646475b105866a/37523/5.2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEklEQVR42nVTyWoqURDNl2cVFDdR4rwTF6KJiorzPCYYBREXEkWMC6cYTdTgrOe9U9DmCb6G6tt1695TdU5V3+DvczwecTqdzkZfeQ6HA/b7/XmPK/do154bHvj4+EC73cbb25usg8FAgsvlEu/v7+J3Oh28vLyg2+2i3++j1+thtVrJOaUQAeSrUChAr9fDYrFAq9UiHo9LcDqdwuFwwGw24+HhASqVCjqdDlarFU6nEz8/P2fAc4V8xWIx3N/f4/b2Fnd3d/B4PBIcj8cwGAzQaDSS0GQyCSCT2mw2qfT7+xufn59iBBbAWq2GRCIhF9xuN/L5PDabjVAleCgUkjgtk8mIXywW0Wg08Pr6img0ilKpJFoLYKVSQTAYlCpcLpdcYnA0GsnlZDKJbDaLXC4nyejTqCm1rdfraDabv4DValWyGI1GeL1e0ZRdJGUFMJ1OCyhN8ZUGrtdr7Ha7X8oEjEQiQvnx8VEq3G63GA6HeHp6gs/nQzgclqRMQJ+6U8P5fC5nL5pCQFJWq9Ww2+1CjeWzQlbs9/sFjBYIBASQwAS82mUCplIp0Y+VUGBS5nzyIqsnTZ5hZYqGyrxeANJptVoCyq6x4xSZ+7PZTLSips/Pz5KoXC4LA64c/KuAHGDOETOSBqkuFgt8fX1Jp+krMepKY/zfX/QCkMNJ42VeJFV+c2UiJqRPm0wmsve/f/kPOhiUruxhVnoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;업데이트시의 잠금&quot;
        title=&quot;&quot;
        src=&quot;/static/d491435c5d210719aa646475b105866a/f058b/5.2.png&quot;
        srcset=&quot;/static/d491435c5d210719aa646475b105866a/c26ae/5.2.png 158w,
/static/d491435c5d210719aa646475b105866a/6bdcf/5.2.png 315w,
/static/d491435c5d210719aa646475b105866a/f058b/5.2.png 630w,
/static/d491435c5d210719aa646475b105866a/37523/5.2.png 720w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;인덱스가 하나도 없다면?&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 사용자가 생성한 인덱스가 없어도 InnoDB는 자동으로 클러스터 인덱스를 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; test &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;-- PRIMARY KEY 없음&lt;/span&gt;
    name &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; test &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;김철수&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 동작:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1. 클러스터 인덱스(내부적으로 자동 생성)로 풀 스캔&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 2. 모든 레코드를 검색하면서 잠금&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 3. name=&apos;김철수&apos; 조건에 맞는 레코드만 UPDATE&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 4. 결과: 30만 건 모두 잠금 (1건만 UPDATE해도!)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;클러스터 인덱스 자동 생성 규칙&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PRIMARY KEY가 있으면 그것을 클러스터 인덱스로 사용&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PRIMARY KEY가 없으면 첫 번째 UNIQUE NOT NULL 인덱스를 사용&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;둘 다 없으면 InnoDB가 숨겨진 6바이트 Row ID를 자동 생성하여 클러스터 인덱스로 사용&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;문제&lt;/strong&gt;: 자동 생성된 Row ID 클러스터 인덱스는 WHERE 조건에 사용할 수 없어서, 결국 풀 스캔하며 모든 레코드에 잠금을 걸게 됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;인덱스 설계의 중요성&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
UPDATE 문장을 위해 적절한 인덱스가 준비되어 있지 않다면 클라이언트 간의 동시성이 상당히 떨어집니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
한 세션에서 UPDATE 작업을 하는 중에는 다른 클라이언트는 그 테이블을 업데이트하지 못하고 기다려야 하는 상황이 발생합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;레코드 수준의 잠금 확인 및 해제&lt;/h2&gt;
&lt;p&gt;InnoDB 스토리지 엔진을 사용하는 테이블의 레코드 수준 잠금은 테이블 수준 잠금보다 조금 더 복잡합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;테이블 잠금&lt;/strong&gt;: 잠금의 대상이 테이블 자체라 쉽게 문제의 원인을 발견하고 해결 가능&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;레코드 잠금&lt;/strong&gt;: 각각의 레코드에 잠금이 걸리므로 자주 사용되지 않으면 오랜 시간 잠겨 있어도 잘 발견되지 않음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;MySQL 버전별 잠금 조회 방법&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MySQL 5.1 이전&lt;/strong&gt;: 레코드 잠금에 대한 메타 정보(딕셔너리 테이블)를 제공하지 않아 어려움&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL 5.1 ~ 7.x&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;information_schema&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;INNODB_TRX&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;INNODB_LOCKS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;INNODB_LOCK_WAITS&lt;/code&gt; 테이블로 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL 8.0 이상&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;performance_schema&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;data_locks&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;data_lock_waits&lt;/code&gt; 테이블로 대체&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;강제 해제는 &lt;code class=&quot;language-text&quot;&gt;KILL&lt;/code&gt; 명령어로 프로세스를 종료하면 됩니다.&lt;/p&gt;
&lt;h3&gt;잠금 시나리오 예제&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;커넥션 1&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;커넥션 2&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;커넥션 3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;BEGIN;&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;UPDATE employees SET birth_date=NOW() WHERE emp_no=100001;&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;UPDATE employees SET hire_date=NOW() WHERE emp_no=100001;&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;UPDATE employees SET hire_date=NOW(), birth_date=NOW() WHERE emp_no=100001;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;프로세스 목록 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; PROCESSLIST&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;+----+------+-----------+-------+---------+------+----------+------------------------------------------------------------------+
| Id | User | Host      | db    | Command | Time | State    | Info                                                             |
+----+------+-----------+-------+---------+------+----------+------------------------------------------------------------------+
| 17 | root | localhost | testdb| Sleep   | 607  |          | NULL                                                             |
| 18 | root | localhost | testdb| Query   | 22   | updating | UPDATE employees SET hire_date=NOW() WHERE emp_no=100001         |
| 19 | root | localhost | testdb| Query   | 21   | updating | UPDATE employees SET hire_date=NOW(), birth_date=NOW() WHERE ... |
+----+------+-----------+-------+---------+------+----------+------------------------------------------------------------------+&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 해석&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;17번 스레드&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;Sleep&lt;/code&gt; 상태, 607초 동안 유휴 상태&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;트랜잭션을 시작(&lt;code class=&quot;language-text&quot;&gt;BEGIN&lt;/code&gt;)하고 UPDATE 후 커밋하지 않은 상태&lt;/li&gt;
&lt;li&gt;현재 실행 중인 쿼리가 없어서 &lt;code class=&quot;language-text&quot;&gt;NULL&lt;/code&gt;로 표시&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;이 스레드가 잠금을 보유하고 있어서 다른 스레드들이 대기 중&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;18번 스레드&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;updating&lt;/code&gt; 상태, 22초 동안 대기&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;17번 스레드가 잠근 레코드를 UPDATE하려고 시도&lt;/li&gt;
&lt;li&gt;잠금을 획득하지 못해 대기 중&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;19번 스레드&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;updating&lt;/code&gt; 상태, 21초 동안 대기&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;17번과 18번 스레드가 잠근 레코드를 UPDATE하려고 시도&lt;/li&gt;
&lt;li&gt;두 스레드 모두 완료될 때까지 대기 중&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;잠금 대기 순서 확인&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;performance_schema&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;data_locks&lt;/code&gt; 테이블과 &lt;code class=&quot;language-text&quot;&gt;data_lock_waits&lt;/code&gt; 테이블을 조인하여 잠금 대기 순서를 확인합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;
    r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_id waiting_trx_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_mysql_thread_id waiting_thread&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_query waiting_query&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_id blocking_trx_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_mysql_thread_id blocking_thread&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_query blocking_query
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; performance_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data_lock_waits w
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; information_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innodb_trx b
    &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;blocking_engine_transaction_id
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; information_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innodb_trx r
    &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;trx_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;requesting_engine_transaction_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;+-------------+----------------+------------------+----------------+------------------+----------------+
| waiting_trx | waiting_thread | waiting_query    | blocking_trx   | blocking_thread  | blocking_query |
| _id         |                |                  | _id            |                  |                |
+-------------+----------------+------------------+----------------+------------------+----------------+
| 11990       | 19             | UPDATE employees | 11984          | 17               | NULL           |
| 11990       | 19             | UPDATE employees | 11984          | 17               | NULL           |
| 11989       | 18             | UPDATE employees | 11984          | 17               | NULL           |
+-------------+----------------+------------------+----------------+------------------+----------------+&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 분석&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;18번 스레드는 17번 스레드를 기다리고 있음&lt;/li&gt;
&lt;li&gt;19번 스레드는 17번 스레드와 18번 스레드를 기다리고 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;잠금 대기 큐&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;17번 스레드가 잠금을 해제&lt;/li&gt;
&lt;li&gt;18번 스레드가 잠금을 획득하고 UPDATE 완료 후 잠금 해제&lt;/li&gt;
&lt;li&gt;19번 스레드가 UPDATE 실행 가능&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;상세 잠금 정보 확인&lt;/h3&gt;
&lt;p&gt;17번 스레드가 어떤 잠금을 가지고 있는지 더 상세히 확인하려면 &lt;code class=&quot;language-text&quot;&gt;performance_schema&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;data_locks&lt;/code&gt; 테이블을 조회합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; performance_schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data_locks\G&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;*************************** 1. row ***************************
                  ENGINE: INNODB
                        ...
               LOCK_TYPE: TABLE
               LOCK_MODE: IX
             LOCK_STATUS: GRANTED
               LOCK_DATA: NULL
*************************** 2. row ***************************
                  ENGINE: INNODB
                        ...
               LOCK_TYPE: RECORD
               LOCK_MODE: X,REC_NOT_GAP
             LOCK_STATUS: GRANTED
               LOCK_DATA: 100001&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 해석&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;17번 스레드가 &lt;strong&gt;2개의 락을 동시에 보유&lt;/strong&gt;하고 있습니다:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1행&lt;/strong&gt;: 테이블에 IX 잠금 (의도 표시)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOCK_TYPE: TABLE&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOCK_MODE: IX&lt;/code&gt; (Intention Exclusive)&lt;/li&gt;
&lt;li&gt;역할: &quot;이 테이블에 레코드 락을 걸 예정&quot;이라고 선언&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2행&lt;/strong&gt;: 실제 레코드에 쓰기 잠금&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOCK_TYPE: RECORD&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOCK_MODE: X,REC_NOT_GAP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;역할: &lt;code class=&quot;language-text&quot;&gt;emp_no=100001&lt;/code&gt; 레코드를 실제로 잠금&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;IX 잠금의 역할&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB는 레코드 락을 걸 때 &lt;strong&gt;항상 2단계&lt;/strong&gt;로 진행합니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;먼저&lt;/strong&gt; 테이블에 IX 락을 걸어서 의도를 표시&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;그 다음&lt;/strong&gt; 실제 레코드에 레코드 락을 걸음&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;IX 락은 실제 데이터 접근을 막지 않고, &lt;code class=&quot;language-text&quot;&gt;LOCK TABLES&lt;/code&gt; 같은 테이블 전체 락과의 충돌만 방지합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;다른 레코드는 동시에 접근 가능한가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;인덱스가 있는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Connection 1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;BEGIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- IX 락 + emp_no=100001 레코드 락만&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 2 (다른 레코드)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6000&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100002&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 성공! 동시 실행 가능&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 3 (같은 레코드)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; employees &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7000&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; emp_no &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 대기! emp_no=100001은 Connection 1이 보유 중&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;인덱스가 없는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; test &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    id &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;-- PRIMARY KEY 없음&lt;/span&gt;
    name &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;BEGIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; test &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;홍길동&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- IX 락 + 전체 레코드 락 (30만 건)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 2 (다른 조건)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; test &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; salary &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6000&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;김철수&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 대기! &apos;김철수&apos; 레코드도 이미 Connection 1이 잠금&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Connection 3 (전혀 다른 조건)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; test &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; age &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;박영희&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 대기! &apos;박영희&apos; 레코드도 이미 Connection 1이 잠금&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심&lt;/strong&gt;: IX 락끼리는 충돌하지 않습니다. 실제 충돌은 &lt;strong&gt;레코드 락 레벨&lt;/strong&gt;에서 발생합니다. 하지만 인덱스가 없으면 전체 레코드를 잠그므로 WHERE 조건이 달라도 모두 대기하게 됩니다.&lt;/p&gt;
&lt;h3&gt;잠금 강제 해제&lt;/h3&gt;
&lt;p&gt;17번 스레드가 잠금을 가진 상태에서 상당히 오래 시간 멈춰 있다면 다음과 같이 강제 종료하여 나머지 UPDATE 명령들이 실행되도록 할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KILL&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;MySQL의 격리 수준&lt;/h2&gt;
&lt;h3&gt;격리 수준이란?&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;트랜잭션의 격리 수준&lt;/strong&gt;(Isolation Level)이란 여러 트랜잭션이 동시에 처리될 때 특정 트랜잭션이 다른 트랜잭션에서 변경하거나 조회하는 데이터를 볼 수 있게 허용할지 말지를 결정하는 것입니다.&lt;/p&gt;
&lt;h3&gt;4가지 격리 수준&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;READ UNCOMMITTED&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;READ COMMITTED&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REPEATABLE READ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SERIALIZABLE&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;격리 수준이 높아질수록 트랜잭션 간의 데이터 격리(고립) 정도가 높아집니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;격리 수준이 높아질수록 동시 처리 성능은 떨어지는 것이 일반적입니다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SERIALIZABLE&lt;/strong&gt; 격리 수준이 아니라면 크게 성능의 개선이나 저하는 발생하지 않습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;격리 수준별 부정합 문제&lt;/h3&gt;
&lt;p&gt;데이터베이스의 격리 수준을 이야기하면 항상 함께 언급되는 &lt;strong&gt;세 가지 부정합 문제&lt;/strong&gt;가 있습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;DIRTY READ&lt;/th&gt;
&lt;th&gt;NON-REPEATABLE READ&lt;/th&gt;
&lt;th&gt;PHANTOM READ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;READ UNCOMMITTED&lt;/td&gt;
&lt;td&gt;발생&lt;/td&gt;
&lt;td&gt;발생&lt;/td&gt;
&lt;td&gt;발생&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;READ COMMITTED&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;발생&lt;/td&gt;
&lt;td&gt;발생&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;REPEATABLE READ&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;발생(InnoDB는 없음)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERIALIZABLE&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;td&gt;없음&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;InnoDB의 특별한 점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
SQL-92 또는 SQL-99 표준에 따르면 REPEATABLE READ 격리 수준에서는 PHANTOM READ가 발생할 수 있지만, &lt;strong&gt;InnoDB에서는 독특한 특성 때문에 REPEATABLE READ 격리 수준에서도 PHANTOM READ가 발생하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;부정합 문제 상세 설명&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;DIRTY READ&lt;/strong&gt;: 커밋되지 않은 데이터를 읽는 문제&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NON-REPEATABLE READ&lt;/strong&gt;: 하나의 트랜잭션에서 같은 쿼리를 두 번 실행했을 때 결과가 다른 문제&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PHANTOM READ&lt;/strong&gt;: 같은 쿼리를 두 번 실행했을 때 없던 레코드가 나타나는 문제&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;각 부정합 문제에 대한 상세한 내용은 각 격리 수준별 설명에서 다루겠습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;테스트 환경 설정&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;여기서 설명하는 SQL 예제는 모두 &lt;strong&gt;AUTOCOMMIT이 OFF인 상태&lt;/strong&gt;에서만 테스트할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; autocommit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;OFF&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 자동 커밋이 false여야 할까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
AUTO-COMMIT을 자동으로 해놓으면 각 SQL 문이 바로 커밋됩니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
SELECT, UPDATE, INSERT, DELETE 등 모든 명령이 자체적으로 트랜잭션을 시작하고 끝내기 때문에 트랜잭션은 Rollback이 불가능합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;READ UNCOMMITTED&lt;/h3&gt;
&lt;p&gt;READ UNCOMMITTED 격리 수준에서는 각 트랜잭션에서의 변경 내용이 &lt;strong&gt;COMMIT이나 ROLLBACK 여부와 상관없이 다른 트랜잭션에서 보입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/75ced9fd5cd6720205a7bad1697e467d/084e2/read_uncomm.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 92.40506329113923%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+ElEQVR42pVUyaoCMRCcLxc8qKg/4MmDFxdEBAURvAgeBEU9KO4r7vu+az2qIaLyfM5rCJmZdCpV1Z3R7vc7lsslFosF1uu1PO92O3yLw+GA+XyO1Wolg/uu1ys0AubzeVSrVcxmM1nsdDpfAZmbzWYxGAyEzHg8lm8CmEqlkEgk0Gq10O12ZWZw7bfBmEwmiMViKBQKQqBerwsZTSWRcqPRQK1Ww36/x+12w+l0egC8B+Ux+v2+MLxcLpKrqQ2bzUZo851A5/NZfOr1ejIojaxUvpqn0+mL5y+A9IBBdgxKsdlsMBgMMJvNMBqNKJVKLww/Am63W6FPD8mI73x2Op3weDzw+/1wuVxot9svh/7JkLK4SHOPx6Mc4Ha7EQwGEYlEZB4Oh/oB3yWzUKxkOBxGNBpFPB6XvH8DKn/K5TIsFov4Z7fbYbVapQsYrCovAu1hV+hiSA8dDge8Xq946PP5kEwm0Ww2pVfT6TQymYx0hS5AMuAtKhaLqFQqyOVyUnkWjMx49aiC7fUVUH0nKItEWWrQW/YsZx6kWzL9on/sQ5PJJB5Sru6isCVGo5GczrahPPYe2yUUCiEQCDzaRhWOt+fPxqYvTKJUAvOPwmZmgXiAkvf16hGAQM/J6sdBeWq832UeSjIPQPVAiWrheeOneCbCvQrwB42rTn1gVNTUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;read_uncommited&quot;
        title=&quot;&quot;
        src=&quot;/static/75ced9fd5cd6720205a7bad1697e467d/f058b/read_uncomm.png&quot;
        srcset=&quot;/static/75ced9fd5cd6720205a7bad1697e467d/c26ae/read_uncomm.png 158w,
/static/75ced9fd5cd6720205a7bad1697e467d/6bdcf/read_uncomm.png 315w,
/static/75ced9fd5cd6720205a7bad1697e467d/f058b/read_uncomm.png 630w,
/static/75ced9fd5cd6720205a7bad1697e467d/084e2/read_uncomm.png 632w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자 A가 &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;first_name=&quot;Lara&quot;&lt;/code&gt;인 새로운 사원을 INSERT&lt;/li&gt;
&lt;li&gt;사용자 A가 커밋하기 전에 사용자 B가 &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt;인 사원을 SELECT&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;사용자 B는 커밋되지 않은 상태에서도 사원 정보를 조회할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;사용자 A가 알 수 없는 문제로 INSERT를 ROLLBACK&lt;/li&gt;
&lt;li&gt;사용자 B는 여전히 &quot;Lara&quot;가 정상적인 사원이라고 생각하고 계속 처리&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;DIRTY READ란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;어떤 트랜잭션에서 처리한 작업이 완료되지 않았는데도 다른 트랜잭션에서 볼 수 있는 현상을 &lt;strong&gt;더티 리드&lt;/strong&gt;(Dirty Read)라고 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;데이터가 나타났다가 사라졌다 하는 현상 발생&lt;/li&gt;
&lt;li&gt;애플리케이션 개발자와 사용자를 상당히 혼란스럽게 만듦&lt;/li&gt;
&lt;li&gt;RDBMS 표준에서는 트랜잭션의 격리 수준으로 인정하지 않을 정도로 정합성에 문제가 많음&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;권장사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
MySQL을 사용한다면 최소한 &lt;strong&gt;READ COMMITTED 이상의 격리 수준&lt;/strong&gt;을 사용할 것을 권장합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;READ COMMITTED&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;READ COMMITTED&lt;/strong&gt;는 Oracle DBMS에서 기본으로 사용되는 격리 수준이며, 온라인 서비스에서 가장 많이 선택되는 격리 수준입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;더티 리드(Dirty Read) 같은 현상은 발생하지 않음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;COMMIT이 완료된 데이터만&lt;/strong&gt; 다른 트랜잭션에서 조회 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;COMMIT된 데이터만 읽기&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/19b6b22e4756c29a07ff646dc3012a73/8ae78/read_commit1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVR42o1UN6uqQRD1z9pZWylc7AQrC0OhqJUINlZiIQYQTGBEDJhzzlnPe2cfK3rDuw4My7e7c/bMnJlPgb+22Wwwn8+xXq+xWq2w3W4h7X6/v/jtdhP7x+NRxPA+45bLJa7XKxS81Ol0kEqlMB6PBVi73cb5fH4B/GwEYkyj0cBiscBoNBKrgoetVgvxeBzValWAd7vdR2AgEIDJZILdbofNZkO5XBb7ZJVMJlEoFNBsNgXwfr//x5DGD75CI3W5er1eGI1GWK1WWCwWpNNpcSZTn06ngq3MRiGZsCb9fh+Xy+WRIoPq9TpqtZp4bDgcilrJYBrrKGv+AsiaMZ1er4fT6SScjxCAYFzp8kHJ8FdA1mIwGAg2dLfbDZ1OB71eD4PBgGw2+5Lyj4CHw+FRQ7Kg86LH44HZbIbL5RKiRCIR0Q30XC4nnLHfAk4mk0dLMF0KRfX9fj/C4TCi0agAoBC8S3ZUeLfbfQVkMC/QE4kESqWS6KtYLAan0ynahmwJ+HbKfJmtQoacntlsho+PDyiVSqjVaqhUKvh8PiEYBSIQ+/ZHQJmybAmCs1ZsJ55RsGKxiEqlIoaBE0Uhmd1/AZnOd+MmBSMAWfJBdsTbDGlkRWEymQzy+fzLVPxaQ6b3XHCaw+EQ9dNoNNBqtQgGg++JwhT4c2BdOC1Mi87ZDYVCgh3/Ljx7ZkjhKOAXQNaGyvFlTg3rw5V7VJ9BdPbnM+DnvT/3+/kbdkf8FwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;read_commited&quot;
        title=&quot;&quot;
        src=&quot;/static/19b6b22e4756c29a07ff646dc3012a73/f058b/read_commit1.png&quot;
        srcset=&quot;/static/19b6b22e4756c29a07ff646dc3012a73/c26ae/read_commit1.png 158w,
/static/19b6b22e4756c29a07ff646dc3012a73/6bdcf/read_commit1.png 315w,
/static/19b6b22e4756c29a07ff646dc3012a73/f058b/read_commit1.png 630w,
/static/19b6b22e4756c29a07ff646dc3012a73/40601/read_commit1.png 945w,
/static/19b6b22e4756c29a07ff646dc3012a73/8ae78/read_commit1.png 1096w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자 A가 &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt;인 사원의 &lt;code class=&quot;language-text&quot;&gt;first_name&lt;/code&gt;을 &quot;Lara&quot;에서 &quot;Toto&quot;로 변경
&lt;ul&gt;
&lt;li&gt;새로운 값 &quot;Toto&quot;는 employees 테이블에 즉시 기록&lt;/li&gt;
&lt;li&gt;이전 값 &quot;Lara&quot;는 &lt;strong&gt;언두 영역&lt;/strong&gt;으로 백업&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;사용자 A가 커밋을 수행하기 전에 사용자 B가 &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt;인 사원을 SELECT
&lt;ul&gt;
&lt;li&gt;조회된 결과의 &lt;code class=&quot;language-text&quot;&gt;first_name&lt;/code&gt;은 &quot;Toto&quot;가 아니라 &lt;strong&gt;&quot;Lara&quot;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;SELECT 쿼리 결과는 employees 테이블이 아니라 &lt;strong&gt;언두 영역에 백업된 레코드&lt;/strong&gt;에서 가져옴&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;사용자 A가 변경된 내용을 커밋
&lt;ul&gt;
&lt;li&gt;그때부터 다른 트랜잭션에서도 새롭게 변경된 &quot;Toto&quot; 값을 참조 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;NON-REPEATABLE READ 문제&lt;/h4&gt;
&lt;p&gt;READ COMMITTED 격리 수준에서도 &lt;strong&gt;NON-REPEATABLE READ&lt;/strong&gt;라는 부정합 문제가 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f76f1150b12d916ce574fe02669d13c5/1843f/read_commit2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0ElEQVR42pVUuaoCQRD08w0EDcREUUED0chIDTQVETFQRPAW7/u+td6rhpZ1vd5rmO1he6e6u7p2LPi1w+GAzWaD/X4v/ng84pudTies12vsdjtst1vBoFn4mEwmyGazmM1mmM/nGA6HErzdbrher+J1r7ZcLpHP5zEajeRMr9d7BMxkMqhWq2g2mxiPx/eDCmi21WqFdDqNYrGIdrv9CMgDbKHf74u/XC4SZGaHwwGr1QqbzYZwOCxxXd1uF+VyWZLqGYtmPJ/PmE6n91ZppMDtdiMUCglYIpGQStguY6yMoMYzd0BmYOtm4kkDOV0sFhgMBmi1WgJGn8vlUCgUXgOyQjOg2ZiUSqAKOF0mqtfrrwHJA1vgQHSaTOD1euHxeGSlUqmHw/xOB/gEyBe1Wk1a5ASpLe7tdjtcLhecTiei0ehdQlzsirJ5WyF5oWxIPHniPhKJIB6PIxaLibTMFLytkICdTkd4oVw4EPKkMnqlx48tG4eiQcojGAwKj36/H8lk8uHP0cl/lY0GWSmH4fP5EAgERIsUMikh35RMpVL5u2zYbqlUkioYoye3XI1GQ8A+6tD4D+tHfE9gao9e29WujBfJ01B4df3HCMIrzGg/luG/bWAJkfsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;read_commited&quot;
        title=&quot;&quot;
        src=&quot;/static/f76f1150b12d916ce574fe02669d13c5/f058b/read_commit2.png&quot;
        srcset=&quot;/static/f76f1150b12d916ce574fe02669d13c5/c26ae/read_commit2.png 158w,
/static/f76f1150b12d916ce574fe02669d13c5/6bdcf/read_commit2.png 315w,
/static/f76f1150b12d916ce574fe02669d13c5/f058b/read_commit2.png 630w,
/static/f76f1150b12d916ce574fe02669d13c5/40601/read_commit2.png 945w,
/static/f76f1150b12d916ce574fe02669d13c5/1843f/read_commit2.png 1186w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자 B가 &lt;code class=&quot;language-text&quot;&gt;BEGIN&lt;/code&gt; 명령으로 트랜잭션을 시작&lt;/li&gt;
&lt;li&gt;사용자 B가 &lt;code class=&quot;language-text&quot;&gt;first_name=&quot;Toto&quot;&lt;/code&gt;인 사용자를 검색 → 결과 없음&lt;/li&gt;
&lt;li&gt;사용자 A가 사원 번호 500000인 사원의 이름을 &quot;Toto&quot;로 변경하고 커밋&lt;/li&gt;
&lt;li&gt;사용자 B가 똑같은 SELECT 쿼리로 다시 조회 → 결과 1건 조회됨&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;READ COMMITTED의 동작 원리&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 초기 상태: name=&apos;Lara&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 사용자 A&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Toto&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 실제 테이블: name=&apos;Toto&apos; (즉시 변경)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 언두 로그: name=&apos;Lara&apos; (백업)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 아직 커밋 안 함&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 사용자 B (READ COMMITTED)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 결과: name=&apos;Lara&apos;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 왜? 커밋되지 않은 데이터는 언두 로그에서 변경 전 데이터를 읽음&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 사용자 A&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 커밋 완료&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 사용자 B (같은 트랜잭션 내에서)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 결과: name=&apos;Toto&apos;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 왜? 커밋된 데이터는 실제 테이블에서 읽음&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;READ COMMITTED의 핵심&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;커밋 안 된 데이터&lt;/strong&gt;: 언두 로그에서 변경 전 데이터를 읽음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;커밋된 데이터&lt;/strong&gt;: 실제 테이블에서 변경 후 데이터를 읽음&lt;/li&gt;
&lt;li&gt;같은 트랜잭션 내에서도 &lt;strong&gt;매번 커밋 상태를 확인&lt;/strong&gt;하므로 결과가 달라집니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;사용자 B가 하나의 트랜잭션 내에서 똑같은 SELECT 쿼리를 실행했을 때는 항상 같은 결과를 가져와야 한다는 &lt;strong&gt;REPEATABLE READ 정합성에 어긋납니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;REPEATABLE READ&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;REPEATABLE READ&lt;/strong&gt;는 MySQL의 InnoDB 스토리지 엔진에서 기본으로 사용되는 격리 수준입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;바이너리 로그를 가진 MySQL 서버에서는 최소 REPEATABLE READ 격리 수준 이상을 사용해야 함&lt;/li&gt;
&lt;li&gt;READ COMMITTED 격리 수준에서 발생하는 &lt;strong&gt;NON-REPEATABLE READ&lt;/strong&gt; 부정합이 발생하지 않음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MVCC&lt;/strong&gt;(Multi Version Concurrency Control)를 이용해 동일 트랜잭션 내에서는 동일한 결과를 보장&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;MVCC를 통한 스냅샷 격리&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;MVCC란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
레코드가 변경되기 전의 데이터를 언두(Undo) 공간에 백업하여, 동일한 레코드에 여러 버전의 데이터가 존재하도록 하는 방식입니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
REPEATABLE READ는 MVCC를 활용하여 트랜잭션 시작 시점의 스냅샷을 기준으로 항상 동일한 결과를 보장합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;트랜잭션 번호와 스냅샷 메커니즘&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;모든 트랜잭션은 &lt;strong&gt;고유한 트랜잭션 번호&lt;/strong&gt;(순차적으로 증가)를 가짐&lt;/li&gt;
&lt;li&gt;언두 영역의 백업 레코드에는 &lt;strong&gt;변경한 트랜잭션의 번호&lt;/strong&gt;가 포함됨&lt;/li&gt;
&lt;li&gt;트랜잭션은 &lt;strong&gt;자신의 번호보다 작은 트랜잭션 번호에서 변경한 데이터만 조회&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;실행 중인 가장 오래된 트랜잭션 번호보다 앞선 언두 데이터는 삭제 불가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;동작 예시&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3287abb19d0801b762664fa9b873ea1e/636d3/repeatable1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 98.73417721518987%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdklEQVR42pVUW0tyURD1tyo+CIa+i/4JLxCZig+CvvQgPghqBoKCpFSmFpWXMvKS5l3RXLHmY8tJi/wGhn3O2bPXXrNm5ug+Pz8xmUzEx+MxptMpDrXZbIbRaCRneJ5Yus1mg+vra9Trddl8e3vDcrmUA+v1WoIYQ+czncb15eUFlUoFHx8fcm4wGPwDvLq6ws3NDZ6fn9FsNgVIa4zRGvcXiwUeHh6Qy+XkTKPREEI6Fdzv9/H+/i7B6tvFxQVcLpe42+2Gz+dDqVSSDMiO8U9PT2i329tsdOpWolMHLYtMJoNwOAy/3y9rKBSSbIbDocQzxXK5LO8qk2+AdGWr1UrEJvPHx0dZ6a1WC91uF9VqVfS7vLxEr9f7GZBV3tVMFURbWV5EdmTG1L8BqmAG1Go12WQgdcpmszg9PUUgEEAwGEQkEpEYVWUaSbDKe4AUmBVTN7INotEovF4vnE4nTk5O4PF4UCwWtxqrzH4EJEO2jbrx9fUV+XweiUQCsVhMKs5ntohWlj2Gu1VWE8OUO52ONPzt7S3u7u6E/a7OvwJygyxZPU4OdWSqer0eBoMBJpMJRqMRyWTyMA358f7+XrSjhmwRsiMz9hpbh8/8rmW4p6FiSEYEm8/n0hpq8AnEEePKiVBzfpCGu/pwMmw2G+x2u7jD4UA6nZY9ArMfmcWvk6IAaQzmRLCqnAYOP1nyndPCArET+FNhy/0JyL8Jb2aa1I5ALBpl0U7On22jNjjLx8fHMJvNODo6gtVqhcViwdnZmcSQPZ29qy3UFpC3aH8O1KhQKCCVSiEej0tjn5+fC1uyZ48SkAXjugfIIFXB/zGe4VllX6ex1NiEcKEfAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;repeatable_read&quot;
        title=&quot;&quot;
        src=&quot;/static/3287abb19d0801b762664fa9b873ea1e/f058b/repeatable1.png&quot;
        srcset=&quot;/static/3287abb19d0801b762664fa9b873ea1e/c26ae/repeatable1.png 158w,
/static/3287abb19d0801b762664fa9b873ea1e/6bdcf/repeatable1.png 315w,
/static/3287abb19d0801b762664fa9b873ea1e/f058b/repeatable1.png 630w,
/static/3287abb19d0801b762664fa9b873ea1e/40601/repeatable1.png 945w,
/static/3287abb19d0801b762664fa9b873ea1e/636d3/repeatable1.png 1222w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자 B: 트랜잭션 시작 (트랜잭션 번호: 10)&lt;/li&gt;
&lt;li&gt;사용자 A: 트랜잭션 시작 (트랜잭션 번호: 12) → &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt;의 이름을 &quot;Lara&quot;에서 &quot;Toto&quot;로 변경 후 커밋&lt;/li&gt;
&lt;li&gt;사용자 B: &lt;code class=&quot;language-text&quot;&gt;emp_no=500000&lt;/code&gt; 조회 → 결과는 항상 &lt;strong&gt;&quot;Lara&quot;&lt;/strong&gt; (언두 로그에서 조회)&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
장시간 트랜잭션을 종료하지 않으면 언두 영역이 무한정 커져 &lt;strong&gt;MySQL 서버의 처리 성능이 떨어질 수 있습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;PHANTOM READ 문제&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fd12afb359aa633402ca7bf4c6527e4d/8affb/repeatable2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.24050632911393%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVR42o1U16piQRD0x9VfuIig6A+Igr4YUFQUffBBFDEj5pxzDrVUw7jn6r27NgwzJ1RNdU336B6PB/b7PXa7HQ6Hg8x890kcj0f5X8232w06gmu1GqrVKjabDZbLJebzuQD47XWo4LrdbqNUKmG1WglmNptBx4/NZhP5fB6tVguDwUAUK9BPcb/fcT6f5f9MJiN44ihIp0Db7Raj0ehNCVNZLBZYr9eSGon4jgRURJXD4fCJ0ykg/SOQQS8YgUAAer0eBoNBhtFoRDwelwyoZjqdolAoPHG/EiqFjUYD6XQa0WgUqVRK1sViUbKhum63K89az38l5KBSqiGY8/V6lTXV0bd6vY5KpYLJZPKXUKkhoFwuizdMhT4lk0l8fX3BZDLBbDbDbrfL4Wlt4X/fFCpCGp5IJISUu6p0g8EgPB4PfD4f/H6/pKi15TWzbynzlJkWyTkIjkQicDgcCIfDCIVCstHHhPSEhc3B8uh0Oshms5ImB9fj8fhzwl6v92w/enq5XP7bfv8kfC0b7Ym/xkcK1Qe2FoOH43Q64XK54Ha74fV63zxkTdKijwhjsRhsNhusVqvMFotFSoltyFKhRezljwubz/1+H7lcTnqWB8LuICFvGN5S7KAfCVVHaNMhiIQEciYZC5+HxuLnJtyM5fZGqG4RLSFnpq+9D/nMWlWdcjqdxEdF+AcuVVAkqwUrLgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;phantom_read&quot;
        title=&quot;&quot;
        src=&quot;/static/fd12afb359aa633402ca7bf4c6527e4d/f058b/repeatable2.png&quot;
        srcset=&quot;/static/fd12afb359aa633402ca7bf4c6527e4d/c26ae/repeatable2.png 158w,
/static/fd12afb359aa633402ca7bf4c6527e4d/6bdcf/repeatable2.png 315w,
/static/fd12afb359aa633402ca7bf4c6527e4d/f058b/repeatable2.png 630w,
/static/fd12afb359aa633402ca7bf4c6527e4d/40601/repeatable2.png 945w,
/static/fd12afb359aa633402ca7bf4c6527e4d/8affb/repeatable2.png 1254w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;REPEATABLE READ에서도 PHANTOM READ가 발생하는 경우&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;일반 SELECT만 사용하면 PHANTOM READ가 발생하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
일반 SELECT는 트랜잭션 시작 시점의 스냅샷(언두 로그)을 읽기 때문에 중간에 INSERT가 발생해도 영향을 받지 않습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;하지만 SELECT -&gt; INSERT -&gt; SELECT FOR UPDATE 순서면 PHANTOM READ가 발생할 수 있습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/85053/phan1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.27848101265823%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6ElEQVR42pVUiZKbMAzl/7+us9vt7nQbNkAODgfCDb5eZYNNkmlnss4otmQhS3rPDriQ0BoYpwl5wWDGTDahNHJW4VLVdi2kwrXpECUnDBMHVwr9OCHcH/C5i7D7SjDOHAH5ImEtPo8X/DmV+E1zO3KA7JI+Ula0FaMLKb2upLY6J3H2wGSUVy3ivEZc1Iiykk6SS6bKZLqsnxmm0kCbfxopBX2PMyi3Sb8fRYKf7Ai1+vTDiCxnmKbZB7nOA17Ir+OT1W2GdTfiyBrKrkZWNuBCmYrRixmT5HCHmtmUdZ+VtlWYBGAzJGOYVvhIGHbnEq9fGeph9iVYP1ps8qhvhxkJ3ImsGRBmV8g1ypLNAsjjx4+2Wz1YfXBpR8SsWwP+r+mEtFRPglK2+LXPKODmIIsCIk03AOoGYXRA0/beVhMor8VhA8Vn2IzYEyi3PdfELS3EdoDhHBeWc24YBkxKeCZQD5eNvOossYVyQNhpkVV/LO/W7taBi5xfe0K5ItYvO/of4m+IfgKUspsJlPauh54337spi3ImUN6i/B4UxiCyzK7N42HAMFJcKn9b9DyDh6HvtSV2Q49BWvU4lT3xccTsqEEN1isAGy+VfST0TfM058vsrl5IvXsjynzEOV7C8/LafKvYreS/c9rmp6NkHB4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;팬텀리드&quot;
        title=&quot;&quot;
        src=&quot;/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/f058b/phan1.png&quot;
        srcset=&quot;/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/c26ae/phan1.png 158w,
/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/6bdcf/phan1.png 315w,
/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/f058b/phan1.png 630w,
/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/40601/phan1.png 945w,
/static/bb8c3414aa67ebf9d7a43a645e9b4bb7/85053/phan1.png 1225w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PHANTOM READ가 발생하는 원리&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Transaction A&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; member &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 갭 락 없음, 언두 로그 읽음 → id=50 한 건&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Transaction B&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INTO&lt;/span&gt; member &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;51&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;홍길순&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 갭 락이 없어서 성공&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Transaction A (같은 트랜잭션)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; member &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 쓰기 잠금 필요 → 실제 테이블 읽음 → id=50, 51 두 건 (PHANTOM READ!)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;왜 SELECT FOR UPDATE는 실제 테이블을 읽어야 하는가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;언두 로그에는 잠금을 걸 수 없기 때문입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
언두 로그는 여러 트랜잭션이 공유하는 읽기 전용 히스토리 공간으로, 과거 버전에 잠금을 걸면 다른 트랜잭션의 스냅샷 읽기를 방해합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
따라서 &lt;code class=&quot;language-text&quot;&gt;SELECT FOR UPDATE&lt;/code&gt;는 쓰기 잠금을 걸어야 하므로 실제 테이블의 현재 레코드를 읽을 수밖에 없습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;SELECT FOR UPDATE의 잠금 방식&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;SELECT FOR UPDATE&lt;/code&gt;는 &lt;strong&gt;쓰기 잠금(X Lock) + 갭 락&lt;/strong&gt;을 모두 획득합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;레코드 락 (X Lock)&lt;/strong&gt;: 조회된 레코드에 쓰기 잠금&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;갭 락 (Gap Lock)&lt;/strong&gt;: 레코드 사이 간격을 잠궈 &lt;strong&gt;INSERT 차단&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;반면 일반 SELECT는 아무 잠금도 걸지 않아 언두 로그에서 스냅샷을 읽고, INSERT도 허용합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;일반 DBMS는 어떻게 동작하는가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
일반 DBMS에서는 갭 락 자체가 없어 &lt;code class=&quot;language-text&quot;&gt;SELECT FOR UPDATE&lt;/code&gt;를 처음부터 사용해도 범위 내 INSERT를 막지 못해 PHANTOM READ가 발생합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;SERIALIZABLE&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;SERIALIZABLE&lt;/strong&gt;은 가장 엄격한 트랜잭션 격리 수준입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;가장 높은 데이터 일관성 보장&lt;/li&gt;
&lt;li&gt;트랜잭션들이 마치 &lt;strong&gt;순차적으로&lt;/strong&gt;(serial) 실행되는 것처럼 처리&lt;/li&gt;
&lt;li&gt;여러 트랜잭션이 &lt;strong&gt;동일한 레코드에 동시에 접근하는 일이 차단&lt;/strong&gt;됨&lt;/li&gt;
&lt;li&gt;데이터의 부정합이나 예기치 않은 읽기 문제는 발생하지 않음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;병렬 실행이 제한&lt;/strong&gt;되므로, &lt;strong&gt;동시 처리 성능은 크게 떨어질 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;SERIALIZABLE의 동작 방식&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;일반 SELECT조차도 공유 잠금(Shared Lock)을 획득&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Next-Key Lock을 통해 해당 범위의 삽입, 수정, 삭제를 차단&lt;/li&gt;
&lt;li&gt;한 트랜잭션에서 읽는 레코드를 다른 트랜잭션에서는 변경 불가능&lt;/li&gt;
&lt;li&gt;PHANTOM READ 완전 방지&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;InnoDB에서는 SERIALIZABLE이 불필요한 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
InnoDB 스토리지 엔진에서는 &lt;strong&gt;갭 락&lt;/strong&gt;과 &lt;strong&gt;넥스트 키 락&lt;/strong&gt; 덕분에 REPEATABLE READ 격리 수준에서도 이미 PHANTOM READ가 발생하지 않기 때문에 굳이 SERIALIZABLE을 사용할 필요성은 없어 보입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;권장사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;안정성이 최우선인 특수한 상황&lt;/strong&gt;이 아닌 이상, &lt;strong&gt;일반적인 애플리케이션에서는 이 수준을 사용하지 않는 것이 바람직&lt;/strong&gt;합니다.&lt;/li&gt;
&lt;li&gt;동시성이 중요한 데이터베이스에서는 거의 사용하지 않음&lt;/li&gt;
&lt;li&gt;성능 저하를 감수하고 최고 수준의 데이터 일관성이 필요한 경우에만 사용&lt;/li&gt;
&lt;li&gt;트랜잭션 간 충돌과 잠금 경합이 빈번해져 &lt;strong&gt;성능 저하가 크기 때문에&lt;/strong&gt;, 일반적인 트랜잭션 처리에서는 신중하게 사용&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[MySQL 엔진 아키텍처]]></title><description><![CDATA[MySQL의 전체 구조  MySQL 엔진 커넥션 핸들러 SQL 파서 및 전처리기 옵티마이저 스토리지 엔진 디스크 스토리지에 write, read MySQL…]]></description><link>https://gotobill.github.io/mysql-part4/</link><guid isPermaLink="false">https://gotobill.github.io/mysql-part4/</guid><pubDate>Sun, 05 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;MySQL의 전체 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/50162303799fd4577f72c8ca362a1592/ea64c/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 97.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACoUlEQVR42l2UyWpyQRCFfUTfIbu8QpaCko2PYAgEBFEIghvJIgsRNMY5cc7gFDGawThGY4WvfqqJ/4Wyr9Xdp0+dU7c92+1WVquVBu+bzUZ2u528vb1Jo9GQdrstT09Psl6vdc7i5+dHc/8/ntlsJi8vLwqQzWal1WpJrVaTer0ut7e3Eo/H9b1YLEqv15Nut6trwuGwPD4+yvf39yHgYrFQBtPpVDfncjkpl8uaSyaTEgwGpd/vKxg53u/v7yUQCCggbA8Av76+5OHhQU8eDocHAfPRaKTvg8HA5RhfX18VEHkOAEksl0uBqcV8PldNkQPmaGX5v2vI7/d7F44hC0xsFqELh4zHY2X08fHh5mzEFKqaTCZq5ufn5z9AzHh/f1cAA2ckj26dTkd1Yx5WBMypAC2RBEDWO0AmcBF3MQQQAncJ8tVq1Y24zHypVFJt0ZNDXMmUBn0m6Dt0oxT+s9HmMQGn2YMMAHMgoA7Q6APEAhw/PT2V4+Nj7UMcDYVCcnFxofPNZlP8fr/4fD5ljBxIhtbI4cGA6+trOTs7c+UA6PV65fLyUjdEIhFJJBLKOJ1Oy9HRkZycnKg85OgUKgHYw08mk1E9CPQsFAoud3d3p6woDQC0vrq6klQqJfl8XuUBEHMwzoMWJCmVU9AHVoAwBwPAyGGguU5QkWnvNEQ/yozFYhKNRnUhDM7Pz/VyQEe+Wz5De6yJMYiK0A8izmXE5GSM4QCMoFTkYA629KQB2fj8/KzOA+gam/agpEqlopqxgP/oAxCHcGFQnnWCaXpzc6MtZZ+vAppOMLCbxK4wSuLLQR82AkSekd4zAujovmUWg85mnIIZC2GFhjzMUx5gdACH/tWQjnCA6GT3HCexkbB3RgtKJsxpZIC53ToA/gIja2stG6PlrgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;전체 아키텍처&quot;
        title=&quot;&quot;
        src=&quot;/static/50162303799fd4577f72c8ca362a1592/f058b/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png&quot;
        srcset=&quot;/static/50162303799fd4577f72c8ca362a1592/c26ae/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 158w,
/static/50162303799fd4577f72c8ca362a1592/6bdcf/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 315w,
/static/50162303799fd4577f72c8ca362a1592/f058b/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 630w,
/static/50162303799fd4577f72c8ca362a1592/40601/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 945w,
/static/50162303799fd4577f72c8ca362a1592/ea64c/%EC%A0%84%EC%B2%B4%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 1116w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;MySQL 엔진&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;커넥션 핸들러&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SQL 파서 및 전처리기&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;옵티마이저&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;스토리지 엔진&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;디스크 스토리지에 write, read&lt;/li&gt;
&lt;li&gt;MySQL 엔진 하나에 여러 스토리지 엔진을 동시에 사용할 수 있음&lt;/li&gt;
&lt;li&gt;각 스토리지 엔진은 성능 향상을 위해 &lt;strong&gt;키 캐시&lt;/strong&gt; (MyISAM 스토리지 엔진)나 &lt;strong&gt;InnoDB 버퍼 풀&lt;/strong&gt; (InnoDB 스토리지 엔진)과 같은 기능을 내장&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; test_table &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fd1 &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fd2 &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;INNODB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;핸들러 API&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 엔진의 쿼리 실행기가 각 스토리지 엔진에 요청을 보낼 때 사용되는 API&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. MySQL 엔진이 쿼리를 파싱하고 최적화합니다

2. 실행 엔진이 최적화된 계획에 따라 각 스토리지 엔진에 핸들러 요청을 보냅니다

3. 스토리지 엔진이 핸들러 API를 통해 실제 데이터 작업을 수행합니다

4. 결과를 다시 MySQL 엔진으로 전달합니다&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;핸들러 API를 통해 얼마나 많은 작업이 있었나?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;STATUS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Handler%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h2&gt;MySQL 스레딩 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0f218eb4e70f099269af67f2a83d1bc4/9cea8/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVR42lWTx6pCQRBE7z+7dOWPuBFc6kI34kIUcwZzzlkx59CP0zDiGxjm2t1TXVU9WvKzDoeDbLdb2e12373f778xTjZ1vzXEqPt8PmIZsMfjIePxWJbLpUynUz0nk4kMBgP9JrdYLHQPh0OZzWYam8/nmm+323p+Aa/Xqybp2Gq1pNvt6qVOpyOn00lj/X5f2RCDEft4PMr9ftf8aDQSCwAWlwC4XC56svgGmGa3201/c/Z6PW2MKsDe77fWwdiCqvHPSK3X61pE92g0KslkUtbrtTKkHivK5bIy4k6j0VAblCEFmElHAqzn8ymlUkkqlYr4/X7NI3O1WmmeO7A7n88KziKvDJHBQgqARh7s6J5OpzUGCB5TDzsUAcA3alClgGYor9dLvalWq5LP5yUSiUgqlZJarSbFYvG7YZ7NZiUejysYcokVCgW1xUKOGcBms9Fn4nA4xG63i81mU4YszIcBDb1erzidTgkGgzpMyDSbTZX/jyFsEomEuFwucbvdeikUCikL/MzlchKLxcTn84nH45FAIKDskMvg/r1DBoGHdOJEDhZQTAzmZpI8EYBoZGqoR+UXkIkxOQbBxr9MJqN+McHfOoCIh8NhHQ624R+W/ZMMEAxgwsuHGad5EmzysCJGzvwNUYCff0R1ug1d8XUPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;mysql 스레드 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/0f218eb4e70f099269af67f2a83d1bc4/f058b/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png&quot;
        srcset=&quot;/static/0f218eb4e70f099269af67f2a83d1bc4/c26ae/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 158w,
/static/0f218eb4e70f099269af67f2a83d1bc4/6bdcf/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 315w,
/static/0f218eb4e70f099269af67f2a83d1bc4/f058b/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 630w,
/static/0f218eb4e70f099269af67f2a83d1bc4/40601/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 945w,
/static/0f218eb4e70f099269af67f2a83d1bc4/78612/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 1260w,
/static/0f218eb4e70f099269af67f2a83d1bc4/9cea8/%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B5%AC%EC%A1%B0.png 1278w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;프로세스가 아닌 &lt;strong&gt;스레드 기반&lt;/strong&gt;으로 작동&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;포그라운드&lt;/strong&gt; (Foreground)와 &lt;strong&gt;백그라운드&lt;/strong&gt; (Background)&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;MySQL에서 실행 중인 스레드의 목록&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; thread_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; processlist_user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; processlist_host
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; performance_shcema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;threads &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; thread_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h3&gt;포그라운드 스레드(클라이언트 스레드)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MySQL 서버에 접속한 클라이언트 수만큼 존재&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;각 클라이언트 사용자가 요청하는 쿼리를 처리&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;커넥션을 종료하면 &lt;strong&gt;스레드 캐시&lt;/strong&gt; (Thread cache)로 돌아감&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;이미 일정 개수의 스레드 캐시가 있다면 종료&lt;/li&gt;
&lt;li&gt;스레드 캐시의 최대 스레드 개수는 &lt;code class=&quot;language-text&quot;&gt;thread_cache_size&lt;/code&gt; 시스템 변수로 설정&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;데이터를 MySQL의 &lt;strong&gt;데이터 버퍼&lt;/strong&gt;나 &lt;strong&gt;캐시&lt;/strong&gt;로부터 가져오고, 없으면 직접 &lt;strong&gt;디스크&lt;/strong&gt;나 &lt;strong&gt;인덱스 파일&lt;/strong&gt;로부터 가져옴&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;데이터 버퍼&lt;/strong&gt;: InnoDB의 버퍼 풀(Buffer Pool), MyISAM의 키 캐시(Key Cache)&lt;br&gt;
&lt;strong&gt;캐시&lt;/strong&gt;: 메모리에 캐싱된 데이터 페이지와 인덱스&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyISAM 테이블은 쓰기 작업까지 포그라운드 스레드가 처리&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;포그라운드 스레드(클라이언트 스레드)가 &lt;strong&gt;디스크 I/O까지 직접 담당&lt;/strong&gt;&lt;br&gt;
테이블 락으로 인해 쓰기 중에는 다른 작업이 대기&lt;br&gt;
&lt;strong&gt;Table Level Locking&lt;/strong&gt;을 사용하여 전체 테이블을 잠금&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;InnoDB 테이블은 데이터 버퍼나 캐시까지만 포그라운드 스레드가 처리&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;포그라운드 스레드는 &lt;strong&gt;변경사항을 버퍼 풀(메모리)에만 기록하고 즉시 반환&lt;/strong&gt;
실제 디스크 쓰기는 백그라운드 스레드가 나중에 처리 (쓰기 지연)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MyISAM vs InnoDB 비교&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MyISAM: 디스크까지 직접 처리 → 느림, Table Level Locking&lt;/li&gt;
&lt;li&gt;InnoDB: 메모리까지만 처리 → 빠름, Row Level Locking&lt;/li&gt;
&lt;li&gt;자세한 동작 방식은 아래 백그라운드 스레드 섹션 참고&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;백그라운드 스레드&lt;/h3&gt;
&lt;p&gt;백그라운드 스레드는 &lt;strong&gt;청소부&lt;/strong&gt;와 같은 역할입니다. 포그라운드 스레드가 급하게 메모장(버퍼 풀)에 메모만 남기고 가면, 백그라운드 스레드가 나중에 그 메모를 정리해서 안전한 금고(디스크)에 보관합니다.&lt;/p&gt;
&lt;h4&gt;주요 백그라운드 스레드 종류&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;로그 스레드&lt;/strong&gt; (Log Thread)&lt;/p&gt;
&lt;p&gt;변경 내역(Redo Log, Undo Log)을 디스크에 기록하여 장애 복구와 데이터 일관성을 보장합니다.&lt;/p&gt;
&lt;p&gt;비유: 회사의 &lt;strong&gt;작업 일지&lt;/strong&gt;를 기록하는 담당자&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;누가, 언제, 무엇을 변경했는지 기록&lt;/li&gt;
&lt;li&gt;문제 발생 시 이 기록을 보고 복구&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;쓰기 스레드&lt;/strong&gt; (Write Thread)&lt;/p&gt;
&lt;p&gt;버퍼 풀의 더티 페이지(변경된 데이터)를 실제 데이터 파일로 내려씁니다.&lt;/p&gt;
&lt;p&gt;비유: &lt;strong&gt;정리 담당자&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메모장에 적힌 변경사항을 실제 파일 캐비닛(디스크)에 정리&lt;/li&gt;
&lt;li&gt;여러 건을 모아서 한 번에 처리 (배치 처리로 효율성 향상)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;설정 예시:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 일반 디스크: 2~4개, 고성능 SSD: 4개 이상 권장&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;innodb_write_io_threads&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_write_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;읽기 스레드&lt;/strong&gt; (Read Thread)&lt;/p&gt;
&lt;p&gt;데이터를 디스크에서 버퍼 풀로 읽어오는 작업을 &lt;strong&gt;보조&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;쓰기 vs 읽기 스레드의 결정적 차이&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;쓰기 스레드:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;포그라운드 → 메모리에만 기록 → 즉시 &quot;완료&quot; 반환 (클라이언트 대기 안 함)
백그라운드 → 나중에 디스크에 기록&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;읽기 스레드:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;포그라운드 → 버퍼 풀 확인
  - 있으면: 즉시 반환
  - 없으면: 포그라운드가 직접 디스크에서 읽어옴 (클라이언트 대기)
백그라운드 → 병렬 처리로 속도만 향상 (클라이언트는 여전히 대기)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;읽기 스레드는 언제 사용되나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;단일 행 조회:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 1개 페이지만 필요&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 포그라운드 스레드가 직접 디스크에서 읽어옴&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 백그라운드 스레드 개입 안 함&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;대량 데이터 조회 (테이블 풀 스캔):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 100만 건&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 수천 개 페이지 필요&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 포그라운드 스레드 혼자서는 느림&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 백그라운드 읽기 스레드 4개 활용&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 포그라운드: 페이지 1~25 담당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 백그라운드1: 페이지 26~50 담당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 백그라운드2: 페이지 51~75 담당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 백그라운드3: 페이지 76~100 담당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- → 병렬 처리로 더 빠름 (하지만 클라이언트는 대기)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 정리&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;읽기는 본질적으로 &lt;strong&gt;클라이언트가 지금 당장 필요&lt;/strong&gt;하기 때문에 백그라운드로 미룰 수 없습니다. 읽기 스레드는 단지 &lt;strong&gt;병렬 처리로 속도를 높여줄 뿐&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;설정 예시:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 보통 4개면 충분&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;innodb_read_io_threads&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_read_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;기타 스레드&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;인서트 버퍼 병합 스레드&lt;/strong&gt;: 인덱스 삽입 작업을 모아서 일괄 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;잠금/데드락 모니터링 스레드&lt;/strong&gt;: 교착 상태 감지 및 해결&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;왜 백그라운드 스레드가 중요한가?&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;포그라운드 vs 백그라운드 역할 분담&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;포그라운드 스레드가 디스크 I/O까지 직접 하면:&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;디스크는 느리기 때문에 클라이언트가 오래 대기&lt;/li&gt;
&lt;li&gt;동시에 많은 요청 처리 불가&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;백그라운드로 분리하면:&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;포그라운드는 빠르게 메모리 작업만 하고 응답&lt;/li&gt;
&lt;li&gt;느린 디스크 작업은 백그라운드가 알아서 처리&lt;/li&gt;
&lt;li&gt;동시 처리 능력 대폭 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;실제 시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;커피숍으로 비유:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;포그라운드 스레드 = 주문 받는 직원&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;고객 주문을 메모장에 적고 즉시 &quot;주문 완료!&quot;&lt;/li&gt;
&lt;li&gt;실제 커피는 안 만듦 (빠른 응답)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;백그라운드 스레드 = 바리스타&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메모장 보고 실제 커피 제조&lt;/li&gt;
&lt;li&gt;고객은 기다리지 않음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyISAM 방식 = 주문 받는 직원이 커피까지 만듦&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;한 고객당 시간 오래 걸림&lt;/li&gt;
&lt;li&gt;뒤 고객들은 계속 대기&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;스레드 개수 설정 가이드&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 고성능 스토리지(SSD) 환경&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_write_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_read_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 일반 환경&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_write_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_read_io_threads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;읽기 작업은 주로 포그라운드 스레드가 처리 → 읽기 스레드는 많이 필요 없음&lt;/li&gt;
&lt;li&gt;쓰기 작업은 대부분 백그라운드로 처리 → 쓰기 스레드를 충분히 설정해야 병목 방지&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;쓰기 버퍼링 (Write Buffering)&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;핵심 개념&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;읽기 작업은 즉시 처리해야 함 (고객이 기다림)&lt;/li&gt;
&lt;li&gt;쓰기 작업은 지연해도 됨 (나중에 처리해도 문제없음)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;MyISAM vs InnoDB&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MyISAM&lt;/strong&gt;: 쓰기도 포그라운드 스레드가 즉시 디스크에 기록 → 느림&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;InnoDB&lt;/strong&gt;: 메모리에 먼저 기록 후, 백그라운드 스레드가 일괄 처리 → 빠름&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;InnoDB UPDATE 쿼리 실행 시 전체 과정&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;BEGIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;John&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;1단계: UPDATE 실행 시점&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;① 포그라운드 스레드가 버퍼 풀에서 해당 페이지 찾기
② 버퍼 풀의 데이터 수정 (더티 페이지로 표시)
③ 리두 로그 버퍼에 물리적 변경사항 기록
   예: &quot;페이지 100, 오프셋 50에 &apos;John&apos; 기록&quot;
④ 바이너리 로그 캐시에 SQL 기록
   예: &quot;UPDATE users SET name = &apos;John&apos; WHERE id = 1&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2단계: COMMIT 시점 (중요!) - 포그라운드 스레드가 직접 처리&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;① 리두 로그 버퍼 → 리두 로그 파일(디스크)에 기록 
   (WAL - Write Ahead Log 원칙)
   → 포그라운드 스레드가 직접 기록 (동기적)

② 바이너리 로그 캐시 → 바이너리 로그 파일(디스크)에 기록
   → 포그라운드 스레드가 직접 기록 (동기적)

③ 트랜잭션 커밋 완료
④ 클라이언트에게 &quot;OK&quot; 응답&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3단계: 이후 백그라운드 처리 - 백그라운드 스레드가 처리&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;백그라운드 쓰기 스레드가 적절한 시점에
버퍼 풀의 더티 페이지 → 실제 데이터 파일(디스크)에 기록 (비동기적)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;누가 무엇을 기록하나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;포그라운드 스레드가 디스크에 기록 (COMMIT 시):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;리두 로그 파일&lt;/li&gt;
&lt;li&gt;바이너리 로그 파일&lt;/li&gt;
&lt;li&gt;이유: 데이터 영속성 보장이 필요한 시점 (클라이언트가 대기)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;백그라운드 스레드가 디스크에 기록 (나중에):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;실제 데이터 파일&lt;/li&gt;
&lt;li&gt;이유: 리두 로그가 있으면 복구 가능하므로 굳이 기다릴 필요 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 이렇게 설계되었나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;COMMIT은 데이터 영속성 보장이 필수:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;만약 백그라운드가 로그 기록을 한다면?

포그라운드: &quot;OK&quot; 응답 → 클라이언트는 성공으로 인식
백그라운드: 아직 로그 기록 중...
서버 다운! → 데이터 손실! (복구 불가능)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;포그라운드가 로그를 디스크에 확실히 기록한 후 응답:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;포그라운드: 리두 로그 기록 완료 → 바이너리 로그 기록 완료 → &quot;OK&quot; 응답
서버 다운해도 → 리두 로그로 복구 가능!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 정리&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;리두 로그가 먼저 디스크에 기록되는 이유:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;장애 발생 시 리두 로그만 있으면 복구 가능&lt;/li&gt;
&lt;li&gt;실제 데이터 파일은 나중에 써도 안전함&lt;/li&gt;
&lt;li&gt;이를 &lt;strong&gt;WAL&lt;/strong&gt; (Write Ahead Log) 원칙이라고 함&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;실제 데이터 파일 기록은 왜 백그라운드로?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;여러 변경사항을 모아서 한 번에 쓰면 효율적&lt;/li&gt;
&lt;li&gt;디스크 I/O 횟수 최소화&lt;/li&gt;
&lt;li&gt;클라이언트는 로그 기록만 기다리면 되므로 빠르게 응답 받음&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;메모리 할당 및 사용 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b34bfa50432dd088aceac929b66d335/dc333/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABl0lEQVR42nWT544CMQyE9/3fih/0vvSOECABu0vvZU6fUTjujotkJXHs8YyTeKfTSev1WpvNxuy/9SfjfLlc2hyGoc7nszwch8NBu91Ox+NRFGB2hp9z1vv9/nVO8mKxUKlUUq/XUy6X03w+lwcyRvB4PFa73Va/39dwODQjeTabmY+4VqtlAKPRSN1uV41Gw/y+72s6ncqjyna7FQMZQRAoiiKbV6uV+dlT6H6/mw9VgDi5DJhOJpMnILIul4tVzOfzRj+ZTKpYLBoYibCiMMDlclnZbNZYsb9er6pUKt+AyL3dbiarUCgYEEm1Ws0YYRQjjsRUKqVqtWpxxMD8ByAMAaQfBDvQTCZjDH8Dwt4pqdfrlvuRIdXS6fQrmLXrpZOMTPwUI4acP5JdD5vNpjGEQTwetyQAXQ+5ABgBlEgkrDB7cl+AvB0AqTIYDOy2CEYyLQAMhjSf8Xg89D7cnp7bs4EBQPQIJ1W5QWYM1gDTV94lse/GRfImY7HYkyG/oNPpWCIsMPYYa/w8ZgoiD/B349wZSr8A9dBuj/684ysAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메모리 할당&quot;
        title=&quot;&quot;
        src=&quot;/static/1b34bfa50432dd088aceac929b66d335/f058b/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png&quot;
        srcset=&quot;/static/1b34bfa50432dd088aceac929b66d335/c26ae/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png 158w,
/static/1b34bfa50432dd088aceac929b66d335/6bdcf/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png 315w,
/static/1b34bfa50432dd088aceac929b66d335/f058b/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png 630w,
/static/1b34bfa50432dd088aceac929b66d335/dc333/%EB%A9%94%EB%AA%A8%EB%A6%AC%ED%95%A0%EB%8B%B9.png 938w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;MySQL의 메모리는 크게 &lt;strong&gt;글로벌 메모리 영역&lt;/strong&gt; (모든 스레드 공유)과 &lt;strong&gt;로컬 메모리 영역&lt;/strong&gt; (각 클라이언트 전용)으로 나뉩니다.&lt;/p&gt;
&lt;h3&gt;어떤 메모리가 더 중요할까?&lt;/h3&gt;
&lt;p&gt;많은 사람들이 &quot;성능을 위해 글로벌 메모리(특히 InnoDB 버퍼 풀)가 중요하다&quot;고 말합니다. 맞는 말입니다. 하지만 &lt;strong&gt;운영 관점에서는 로컬 메모리가 훨씬 더 위험하고 중요합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 로컬 메모리가 더 중요한가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;글로벌 메모리: 예측 가능하고 안전&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버 시작 시 한 번만 할당&lt;/li&gt;
&lt;li&gt;크기가 고정됨 (예: 버퍼 풀 8GB → 항상 8GB)&lt;/li&gt;
&lt;li&gt;모니터링과 관리가 쉬움&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;로컬 메모리: 예측 불가능하고 위험&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클라이언트가 접속할 때마다 동적으로 할당&lt;/li&gt;
&lt;li&gt;총 메모리 = &lt;code class=&quot;language-text&quot;&gt;클라이언트 수 × 버퍼 크기&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;트래픽 급증 시 메모리 폭증 → 서버 다운 위험&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;실제 장애 시나리오&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;설정:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; sort_buffer_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10485760&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 10MB로 설정&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;정상 상황:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클라이언트 100개 접속&lt;/li&gt;
&lt;li&gt;메모리 사용: 100 × 10MB = 1GB (괜찮음)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;장애 상황:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;갑자기 이벤트로 트래픽 급증&lt;/li&gt;
&lt;li&gt;클라이언트 1000개 동시 접속&lt;/li&gt;
&lt;li&gt;메모리 사용: 1000 × 10MB = &lt;strong&gt;10GB 폭증!&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;서버 메모리 부족 → &lt;strong&gt;OOM (Out of Memory) 에러&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;MySQL 서버 다운 → 서비스 장애&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;글로벌 메모리 영역&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;모든 클라이언트 스레드가 공유&lt;/li&gt;
&lt;li&gt;MySQL 서버 시작 시 한 번만 할당&lt;/li&gt;
&lt;li&gt;클라이언트 수와 무관하게 고정 크기&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;주요 메모리 영역&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;InnoDB 버퍼 풀&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;데이터와 인덱스를 메모리에 캐싱하여 디스크 I/O 최소화&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 전체 메모리의 50~80% 할당 권장&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;innodb_buffer_pool_size&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;InnoDB 리두 로그 버퍼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;트랜잭션 로그를 임시 보관 (장애 복구용)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;InnoDB 어댑티브 해시 인덱스&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;자주 사용되는 데이터의 인덱스를 자동 생성&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;테이블 캐시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;테이블 메타데이터(구조 정보) 캐싱&lt;/p&gt;
&lt;h3&gt;로컬 메모리 영역 (주의 필요!)&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;각 클라이언트 스레드마다 독립적으로 할당&lt;/li&gt;
&lt;li&gt;쿼리 실행에 필요한 경우에만 동적 할당&lt;/li&gt;
&lt;li&gt;쿼리 종료 시 해제&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;로컬 메모리는 &lt;strong&gt;클라이언트 수에 비례&lt;/strong&gt;하므로 신중하게 설정해야 합니다.&lt;/p&gt;
&lt;h4&gt;주요 메모리 영역&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;정렬 버퍼&lt;/strong&gt; (Sort Buffer)&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ORDER BY&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GROUP BY&lt;/code&gt; 시 사용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 기본값: 256KB (적절함)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sort_buffer_size&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 잘못된 설정 (위험!)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; sort_buffer_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10485760&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 10MB&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 클라이언트 1000개 시 = 10GB 메모리 사용!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;조인 버퍼&lt;/strong&gt; (Join Buffer)&lt;/p&gt;
&lt;p&gt;테이블 조인 시 사용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;join_buffer_size&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;바이너리 로그 캐시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;트랜잭션의 변경 내역을 메모리에 임시 저장하는 공간&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 로컬 메모리인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;각 트랜잭션마다 독립적으로 할당해야 하기 때문입니다.&lt;/p&gt;
&lt;p&gt;트랜잭션 격리:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 세션 1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;BEGIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;John&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 커밋 전 → 바이너리 로그 캐시에만 있음&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 세션 2&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;BEGIN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Jane&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 각 세션은 독립적인 캐시 사용&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;COMMIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 이때 캐시 → 디스크 바이너리 로그 파일로 기록&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;리두 로그 vs 바이너리 로그 차이&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;둘 다 변경사항을 기록하지만 용도가 다릅니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;리두 로그&lt;/strong&gt; (Redo Log)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;목적: 장애 복구 (Crash Recovery)&lt;/li&gt;
&lt;li&gt;대상: InnoDB 전용&lt;/li&gt;
&lt;li&gt;내용: 물리적 변경 (어떤 페이지의 어떤 위치를)&lt;/li&gt;
&lt;li&gt;형식: 바이너리 형식 (사람이 못 읽음)&lt;/li&gt;
&lt;li&gt;위치: 글로벌 메모리 (InnoDB 리두 로그 버퍼)&lt;/li&gt;
&lt;li&gt;예시: &lt;code class=&quot;language-text&quot;&gt;페이지 100, 오프셋 50에 값 0x1234 기록&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;바이너리 로그&lt;/strong&gt; (Binary Log)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;목적: 복제(Replication), 백업/복구&lt;/li&gt;
&lt;li&gt;대상: MySQL 전체 (모든 스토리지 엔진)&lt;/li&gt;
&lt;li&gt;내용: 논리적 변경 (어떤 SQL을 실행했는지)&lt;/li&gt;
&lt;li&gt;형식: SQL 문장 또는 Row 변경 내역&lt;/li&gt;
&lt;li&gt;위치: 로컬 메모리 (각 트랜잭션마다)&lt;/li&gt;
&lt;li&gt;예시: &lt;code class=&quot;language-text&quot;&gt;UPDATE users SET name = &apos;John&apos; WHERE id = 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 둘 다 필요한가?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;리두 로그: MySQL 재시작 시 빠른 복구&lt;/li&gt;
&lt;li&gt;바이너리 로그: Slave 서버 동기화, 특정 시점 복구&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 리두 로그로 복제가 안 되나?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;리두 로그는 물리적 구조에 의존하기 때문에 복제에 사용할 수 없습니다.&lt;/p&gt;
&lt;p&gt;물리적 vs 논리적 차이:&lt;/p&gt;
&lt;p&gt;리두 로그 (물리적):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;페이지 100, 오프셋 50에 0x1234 기록
페이지 200, 오프셋 30에 0x5678 기록&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;→ Master의 페이지 100 ≠ Slave의 페이지 100 (구조가 다를 수 있음)&lt;/p&gt;
&lt;p&gt;바이너리 로그 (논리적):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;John&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;→ 어떤 서버에서든 실행 가능 (구조 독립적)&lt;/p&gt;
&lt;p&gt;실제 복제 시나리오:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Master에서 실행&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;John&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 리두 로그 방식 (불가능)&lt;/span&gt;
페이지 &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;에서 행 삭제  ← Slave는 페이지 번호가 다를 수 있음
페이지 &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;에서 값 변경   ← 적용 불가능

&lt;span class=&quot;token comment&quot;&gt;-- 바이너리 로그 방식 (가능)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  ← Slave에서 &lt;span class=&quot;token keyword&quot;&gt;SQL&lt;/span&gt; 실행
&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;John&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  ← Slave의 구조에 맞게 자동 적용&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;스토리지 엔진 독립성:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Master: InnoDB, Slave: MyISAM 조합 가능&lt;/li&gt;
&lt;li&gt;리두 로그: InnoDB 전용 → MyISAM Slave에 적용 불가&lt;/li&gt;
&lt;li&gt;바이너리 로그: SQL이므로 모든 엔진에서 실행 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;핵심 정리&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;리두 로그: 같은 서버 내에서 빠른 복구 (물리적, InnoDB 전용)&lt;/li&gt;
&lt;li&gt;바이너리 로그: 다른 서버로 복제 (논리적, 모든 엔진 지원)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;설정:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;binlog_cache_size&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 기본값: 32KB (트랜잭션당)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 클라이언트 1000개 × 32KB = 32MB&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;네트워크 버퍼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;클라이언트와의 통신용 버퍼&lt;/p&gt;
&lt;h4&gt;메모리 설정 가이드라인&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;글로벌 메모리&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;크게 설정해도 안전 (고정 크기)&lt;/li&gt;
&lt;li&gt;성능 향상에 직접적인 효과&lt;/li&gt;
&lt;li&gt;전체 메모리의 50~80%를 버퍼 풀에 할당&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;로컬 메모리&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;보수적으로 설정 (작게 시작)&lt;/li&gt;
&lt;li&gt;기본값(256KB~1MB)이 대부분 적절&lt;/li&gt;
&lt;li&gt;특별한 이유 없이 크게 설정하지 말 것&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;안전한 설정 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 글로벌: 크게 설정 (16GB 서버 기준)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_buffer_pool_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10737418240&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 10GB&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 로컬: 작게 유지&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; sort_buffer_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;262144&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;        &lt;span class=&quot;token comment&quot;&gt;-- 256KB (기본값)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; join_buffer_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;262144&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;        &lt;span class=&quot;token comment&quot;&gt;-- 256KB (기본값)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 최대 동시 접속자 1000명이라도&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 로컬 메모리: 1000 × 256KB = 256MB (안전)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;성능은 글로벌 메모리로 높이되, 안정성은 로컬 메모리 관리에 달려있습니다. 특히 트래픽이 많은 서비스라면 로컬 메모리 설정을 더욱 신중하게 해야 합니다.&lt;/p&gt;
&lt;h2&gt;플러그인 스토리지 엔진 모델&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;스토리지 엔진 뿐만 아니라 다양한 플러그인이 가능
&lt;ul&gt;
&lt;li&gt;검색어 파서&lt;/li&gt;
&lt;li&gt;Native Authentication&lt;/li&gt;
&lt;li&gt;Caching SHA-2 Authentication&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;스토리지 엔진은 쿼리의 실행 과정 중 &lt;strong&gt;데이터의 읽기/쓰기&lt;/strong&gt; 작업만 담당
&lt;ol&gt;
&lt;li&gt;SQL 파서&lt;/li&gt;
&lt;li&gt;SQL 옵티마이저&lt;/li&gt;
&lt;li&gt;SQL 실행기&lt;/li&gt;
&lt;li&gt;데이터 읽기/쓰기&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;스토리지 엔진 확인
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Support 칼럼
&lt;ul&gt;
&lt;li&gt;YES: 사용 가능&lt;/li&gt;
&lt;li&gt;DEFAULT: 필수 스토리지 엔진&lt;/li&gt;
&lt;li&gt;NO: 포함되지 않음&lt;/li&gt;
&lt;li&gt;DISABLED: 포함됐지만 파라미터에 의해 비활성화&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;플러그인 확인
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; PLUGINS&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;컴포넌트&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;플러그인 아키텍처의 단점을 보완하기 위해 등장
&lt;ul&gt;
&lt;li&gt;오직 MySQL 서버와 인터페이스할 수 있고, 플러그인끼리는 통신할 수 없음&lt;/li&gt;
&lt;li&gt;MySQL 서버의 변수나 함수를 직접 호출 → 캡슐화가 되지 않아 안전하지 않음&lt;/li&gt;
&lt;li&gt;상호 의존 관계를 설정할 수 없어 초기화가 어려움&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;INSTALL COMPONENT &lt;span class=&quot;token string&quot;&gt;&apos;file://component_validate_password&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;component&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;쿼리 실행 구조&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4c9b2549ad1fe08dfa34a20b272270e/0f246/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.82278481012659%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtUlEQVR42nWTR47CQBBFff/TsIAFC1gDIieRc845Q43eHzWCkcdSqbvtqte/gj3zeS6Xi+33ezscDlrd3p3dutvtbLlc2nq9ttVqZY/Hw7zX62UYj1s3m42dTifZ9XrVBe58u910Zj0ej1atVq3dblu5XBbc+1TmgPP53LbbrVQMBgMZsOl0qv35fJbPZDKx8XgsZQA5e7PZzBaLhQJwJh2cMVLhXbfbVUrD4dD6/b78R6ORlHEmJpvN/gKR3Gg07Pl86gMp8gFIr9ezYrEo63Q61mq1BGWPFQoFq9fr8s9kMsrAA3C/379SphYoJx1SKZVKb0UAuYh9Pp8XENAbCAx1f4GkDJBA1LJHFTDglKLZbOqMfy6X+x9IjagZ3UYdKmkS6iqVii6p1WqWTqfVZeBvhbTfTyHFJiAYDFogELB4PC4IKp0I/OkwD3VWU/wUoo7AaDRqoVDIwuGwRSIRqSV95/8Z8waiECgjwgv21M81hQmg8K6GpOsgn0AuE5DbgDKsjA1ANzY4JZNJi8ViUkAtec8fgj/G/JI2NeRS3z+FlBlUasiKEQAcMGsqlfqyRCKhxv0AMpvLs+gKN1YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;쿼리실행구조&quot;
        title=&quot;&quot;
        src=&quot;/static/f4c9b2549ad1fe08dfa34a20b272270e/f058b/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png&quot;
        srcset=&quot;/static/f4c9b2549ad1fe08dfa34a20b272270e/c26ae/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png 158w,
/static/f4c9b2549ad1fe08dfa34a20b272270e/6bdcf/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png 315w,
/static/f4c9b2549ad1fe08dfa34a20b272270e/f058b/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png 630w,
/static/f4c9b2549ad1fe08dfa34a20b272270e/40601/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png 945w,
/static/f4c9b2549ad1fe08dfa34a20b272270e/0f246/%EC%BF%BC%EB%A6%AC%EC%8B%A4%ED%96%89%EA%B5%AC%EC%A1%B0.png 1118w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;쿼리 파서&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;사용자 요청으로 들어온 쿼리 문장은 토큰으로 분리
&lt;ul&gt;
&lt;li&gt;토큰: MySQL이 인식할 수 있는 최소 단위의 어휘나 기호&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;토큰을 트리 형태의 구조로 만드는 작업&lt;/li&gt;
&lt;li&gt;쿼리 문장의 기본 문법 오류를 발견&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;전처리기&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;파서 트리를 기반으로 쿼리 문장에 구조적인 문제점이 있는지 확인&lt;/li&gt;
&lt;li&gt;각 토큰을 테이블 이름이나 칼럼 이름, 또는 내장 함수와 같은 개체와 매핑&lt;/li&gt;
&lt;li&gt;객체의 존재 여부와 객체의 접근 권한 등을 확인&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;옵티마이저&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;요청으로 들어온 쿼리 문장을 가장 빠르게 처리하는 방법을 결정&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;실행 엔진&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;만들어진 계획대로 각 핸들러에게 요청해서 받은 결과를 또 다른 핸들러의 요청의 입력으로 연결하는 역할&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;핸들러&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 실행 엔진의 요청에 따라 데이터를 디스크로 저장하고 읽어오는 역할&lt;/li&gt;
&lt;li&gt;결국 스토리지 엔진을 의미
&lt;ul&gt;
&lt;li&gt;MyISAM 테이블을 조작하는 경우 핸들러가 MyISAM 스토리지 엔진&lt;/li&gt;
&lt;li&gt;InnoDB 테이블을 조작하는 경우 핸들러가 InnoDB 스토리지 엔진&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;쿼리 캐시&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;SQL의 &lt;strong&gt;실행 결과를 메모리에 캐시&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;동일 SQL 쿼리가 실행되면 테이블을 읽지 않고 즉시 결과를 반환&lt;/li&gt;
&lt;li&gt;테이블의 데이터가 변경되면 캐시에 저장된 결과 중 이와 관련된 것들을 모두 삭제(Invalidate)해야 함
&lt;ul&gt;
&lt;li&gt;심각한 동시 처리 성능 저하 → &lt;strong&gt;MySQL8.0에서 제거&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;스레드 풀&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;사용자의 요청을 처리하는 스레드 개수를 줄여서 서버의 자원 소모를 줄이는 것이 목표&lt;/li&gt;
&lt;li&gt;스케줄링 과정에서 CPU 시간을 제대로 확보하지 못하면 더 느려질 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Percona Server&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 서버 엔터프라이즈 에디션은 스레드 풀 기능을 제공&lt;/li&gt;
&lt;li&gt;MySQL 커뮤니티 에디션을 지원하지 않아서 &lt;strong&gt;Percona Server의 스레드 풀 플러그인&lt;/strong&gt;을 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;스레드 개수&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Percona Server의 스레드 풀은 기본적으로 &lt;strong&gt;CPU 코어의 개수만큼&lt;/strong&gt; 스레드 그룹을 생성
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;thread_pool_size&lt;/code&gt; 시스템 변수로 조정 가능&lt;/li&gt;
&lt;li&gt;일반적으로 CPU 코어의 개수와 맞추는 것이 CPU 프로세서 친화도를 높이는 데 좋음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;스레드 추가&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;스레드 풀에 이미 처리중인 작업이 있는 경우에는 &lt;code class=&quot;language-text&quot;&gt;thread_pool_oversubscribe&lt;/code&gt;에 설정된 개수만큼 추가로 처리
&lt;ul&gt;
&lt;li&gt;기본값 3&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;모든 스레드가 작업중이라면
&lt;ul&gt;
&lt;li&gt;새로운 작업 스레드를 추가할지, 기존 스레드가 작업을 완료할 때까지 기다릴지 판단&lt;/li&gt;
&lt;li&gt;스레드 풀의 &lt;strong&gt;타이머 스레드&lt;/strong&gt;가 주기적으로 스레드 그룹의 상태를 체크&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;thread_pool_stall_limit&lt;/code&gt; 시스템 변수만큼 스레드가 작업을 끝내지 못하면 새로 스레드를 추가&lt;/li&gt;
&lt;li&gt;모든 스레드가 작업중이라면 &lt;code class=&quot;language-text&quot;&gt;thread_pool_stall_limit&lt;/code&gt; 이후에 새 요청을 처리할 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;중요한 제한 조건&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;스레드는 무한정 추가될 수 없습니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;thread_pool_max_threads&lt;/code&gt; 시스템 변수로 최대 스레드 개수 제한&lt;/li&gt;
&lt;li&gt;이 값을 초과하면 더 이상 스레드를 추가할 수 없음&lt;/li&gt;
&lt;li&gt;초과 시 기존 스레드가 작업을 완료할 때까지 대기&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;선순위 큐 &amp;#x26; 후순위 큐&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;먼저 시작된 트랜잭션 내에 속한 SQL을 빨리 처리&lt;/li&gt;
&lt;li&gt;해당 트랜잭션이 가지고 있던 잠금을 빨리 해제 → 경합 감소 → 처리 성능 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;트랜잭션 지원 메타데이터&lt;/h2&gt;
&lt;h3&gt;메타데이터&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;테이블의 구조 정보&lt;/li&gt;
&lt;li&gt;스토어드 프로그램&lt;/li&gt;
&lt;li&gt;기존에는 FRM 등 &lt;strong&gt;파일 기반&lt;/strong&gt;으로 관리
→ 트랜잭션을 지원하지 않아 테이블 생성 도중 비정상 종료시 일관성이 깨짐&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;InnoDB&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;테이블의 구조 정보나 스토어드 프로그램과 관련된 정보를 InnoDB에 저장하도록 개선&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;시스템 테이블&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 서버가 작동하는 데 기본적으로 필요한 테이블들&lt;/li&gt;
&lt;li&gt;사용자의 인증과 권한 관리 등&lt;/li&gt;
&lt;li&gt;mysql DB에 저장됨
&lt;ul&gt;
&lt;li&gt;통째로 &lt;code class=&quot;language-text&quot;&gt;mysql.ibd&lt;/code&gt; 테이블스페이스에 저장&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;시스템 테이블에 접근
보안을 위해 &lt;code class=&quot;language-text&quot;&gt;information_schema&lt;/code&gt;를 통해 조회&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; INFORMATION_SCHEMA&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;TABLES&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;직접 접근 시 ‘테이블 없음’ 에러가 아닌 ‘접근 거절’&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;tables&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h3&gt;SDI(Serialized Dictionary Information)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;InnoDB 스토리지 엔진을 사용하는 테이블은 메타데이터를 InnoDB 테이블 기반의 딕셔너리에 저장&lt;/li&gt;
&lt;li&gt;MyISAM이나 CSV 등과 같은 스토리지 엔진의 메타데이터는 여전히 저장할 공간이 필요&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;*.sdi&lt;/code&gt; 파일이 기존의 &lt;code class=&quot;language-text&quot;&gt;*.FRM&lt;/code&gt;과 동일한 역할을 수행&lt;/li&gt;
&lt;li&gt;InnoDB 테이블들의 구조도 SDI 파일로 변환 가능
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;idb2sdi&lt;/code&gt; 유틸리티 이용&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;InnoDB 스토리지 엔진 아키텍처&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;레코드 기반의 잠금&lt;/strong&gt;을 제공&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;높은 동시성 처리&lt;/strong&gt;가 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f1205540704124e45963f5e440dc313c/33d1d/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACoUlEQVR42mWUSUsrURSE/b0uXejGEYMGhKxURHCRXdy4Ety4CBkdo0biFGfjPMUhamK0Hl/BzcvjXTjc7tunq+rUOd0dX19furu70/39vd7f3/X29uY9XLcHZx8fH75+fHzU09OT9+fnZ/3+/orV8fr66sOHhwedn58Lgs/PT3EegMM1OTc3Nzo7O9PBwYHK5bL29/dVLBadY0ASm82mGo2GLi8v/WK1WlW9XvcOAASoubi40PHxsa6vr3V0dORzFK+vr7tCA3K4u7vruLq60u3trVmxIZFIaHx8XPPz85qcnNTU1JQmJiY0OztrQPKpam1tzeoNCAPSSahUKgbc29tzwvT0tDo7OzUzM6NIJKLu7m719PRoYGBAW1tbfmd7e1urq6u2reUhICgC8PDwUJlMxmXADtnS0pKGhobU19fnGBkZMSBeQl4oFLxjkxVSP6AAYHY2m3USCugoyf39/Qbr7e01IIQA8HxjY8Ni6LQ9hA3pqAMwnU67c/F4XLFYTHNzcxoeHm4BRqNRbW5uusTv728D/tMUukaH6SBqUqmUCQDs6uqyh2NjY/ZucHBQo6OjriAAco1lBqzVaiIYF0BhQmmpVHLiwsKCTV9ZWVEymVQul9Pi4qJJGSNieXn5b5cB+vn5MRM+MNgQUDJl4RFN4tnLy4sbdHJyYlLGi2BsWl1uB0QhTQIUL5lNhj4owHT8CmpYnFEJBOB0oCB8Kcinc7Dt7OwY8PT01EpRwogxRnw9kEJOANhqCuXRFKY+fFKUS2kow7N8Pu/gjAngPAR2MGYIMyCSkcqOSlSEe1gZXhSxKJXmYA2LPKYET5lhl6y2BSCKw+K3hPLADgEeQgJh+GVBgOf/AdIYAFDElxPmEnbswEfMJ/CWHIJ7/kyU/Ae5G8PnO96ETAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;스토리지 엔진 아키텍처&quot;
        title=&quot;&quot;
        src=&quot;/static/f1205540704124e45963f5e440dc313c/f058b/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png&quot;
        srcset=&quot;/static/f1205540704124e45963f5e440dc313c/c26ae/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 158w,
/static/f1205540704124e45963f5e440dc313c/6bdcf/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 315w,
/static/f1205540704124e45963f5e440dc313c/f058b/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 630w,
/static/f1205540704124e45963f5e440dc313c/40601/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 945w,
/static/f1205540704124e45963f5e440dc313c/33d1d/%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%97%94%EC%A7%84%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png 1150w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;프라이머리 키에 의한 클러스터링&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;InnoDB의 모든 테이블은 &lt;strong&gt;프라이머리 키를 기준으로 클러스터링되어 저장&lt;/strong&gt;
→ &lt;strong&gt;프라이머리 키 값의 순서대로 디스크에 저장&lt;/strong&gt;
→ 모든 세컨더리 인덱스는 레코드의 주소 대신 &lt;strong&gt;프라이머리 키의 값을 논리적인 주소로 사용&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;MyISAM 스토리지 엔진에서는 클러스터링 키를 지원하지 않음
&lt;ul&gt;
&lt;li&gt;프라이머리 키는 유니크 제약을 가진 세컨더리 인덱스와 동일하게 동작&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e52a5b4ef155db3b26f80a80ec08f7a9/064b2/cluster.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVR42n2Qa1faQBCG+f9/pqdVe/q51lqoihUihEsaQhKSAGZzJ/EkT4eg9lixH56d2XffmZ3djrFp+B+zdc39ImRkZ23+nm++bliEDZ2BU3NnH+eX0JtEnN+YnGshvVn2vndZM/ZraegeCl/TcGsjppIbI+VCL7icFlyb5RHvgf5zQ00aDmXKwRNDp0GzS3TTR1sk9BeVTBdzqaf0zR0D++D5l4EMMfHlySNZ7n1e0DwYOQW6naA5FVf7CUeK7iTh2sgYygDaqnnD0G2Yyj92PHuFay5wLUdY4v2eE6x8/ByCrMFP6xe8pG61V6R/83UuDZfSxDItTMNg5Qds0xK1q1ElRBVv4nOujmlCp4h18u0VsfuNneqzS+6FEdnmJ/HqB0XYp1BDimhAGvSIva5ot+RKE/8did9ttX1tknp0VLQiimzBFRzUHuUQJx5JviYtNhK3ErckWSBF/kErtoeYrVvSzCfOEzqBaxHYc3xrhmdND/nSIIxCokQRqgdUuJVLHtq9SlOiWLX79mzvi0NUVhDun1za36nmn8lGH8nGn6hmZ1TWV4rlBdX0tNVT7QOFfiK+M3K7S2V8IR8/6ZNTHmcn8h064SP8AQIZM9AH22LVAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;클러스터링 인덱스&quot;
        title=&quot;&quot;
        src=&quot;/static/e52a5b4ef155db3b26f80a80ec08f7a9/f058b/cluster.png&quot;
        srcset=&quot;/static/e52a5b4ef155db3b26f80a80ec08f7a9/c26ae/cluster.png 158w,
/static/e52a5b4ef155db3b26f80a80ec08f7a9/6bdcf/cluster.png 315w,
/static/e52a5b4ef155db3b26f80a80ec08f7a9/f058b/cluster.png 630w,
/static/e52a5b4ef155db3b26f80a80ec08f7a9/40601/cluster.png 945w,
/static/e52a5b4ef155db3b26f80a80ec08f7a9/78612/cluster.png 1260w,
/static/e52a5b4ef155db3b26f80a80ec08f7a9/064b2/cluster.png 1874w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;외래 키 지원&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;InnoDB 스토리지 엔진 레벨에서 지원
&lt;ul&gt;
&lt;li&gt;MyISAM이나 MEMORY에서는 사용 불가&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;잠금이 여러 테이블로 전파되며 데드락이 발생&lt;/strong&gt;할 수 있음
&lt;ul&gt;
&lt;li&gt;외래 키는 부모 테이블과 자식 테이블 모두 해당 칼럼에 인덱스 생성이 필요&lt;/li&gt;
&lt;li&gt;변경 시 반드시 부모 테이블이나 자식 테이블에 데이터가 있는지 체크하는 작업이 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;foreign_key_checks&lt;/code&gt; 시스템 변수를 &lt;code class=&quot;language-text&quot;&gt;OFF&lt;/code&gt;로 설정하여 일시적으로 외래 키 관계 체크 작업을 비활성화
&lt;ul&gt;
&lt;li&gt;비활성화된 동안 &lt;code class=&quot;language-text&quot;&gt;ON DELETE CASCADE&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;ON UPDATE CASCADE&lt;/code&gt; 옵션도 무시&lt;/li&gt;
&lt;li&gt;대량 레코드 적재 및 삭제 작업을 빠르게 진행할 수 있음&lt;/li&gt;
&lt;li&gt;일관성을 맞춰준 후 다시 활성화해줘야 함&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;MVCC(Multi Version Concurrency Control)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;일반적으로 레코드 레벨의 트랜잭션을 지원하는 DBMS가 제공하는 기능&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;잠금을 사용하지 않는 일관된 읽기를 제공&lt;/strong&gt;하는 것이 가장 큰 목적&lt;/li&gt;
&lt;li&gt;InnoDB는 &lt;strong&gt;언두 로그&lt;/strong&gt; (Undo log)를 이용해 구현&lt;/li&gt;
&lt;li&gt;멀티 버전: &lt;strong&gt;하나에 레코드에 대해 여러 개의 버전&lt;/strong&gt;이 동시에 관리됨을 의미&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;격리 수준(Isolation level)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;INSERT&lt;/code&gt; 이후 InnoDB 버퍼 풀과 데이터 파일에 새로운 값이 추가됨&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;UPDATE&lt;/code&gt;를 하면
&lt;ul&gt;
&lt;li&gt;커밋 실행 여부와 관계없이 InnoDB의 &lt;strong&gt;버퍼 풀을 새로운 값으로&lt;/strong&gt; 업데이트됨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;변경 전 값을 언두로그&lt;/strong&gt;에 기록&lt;/li&gt;
&lt;li&gt;데이터 파일은 백그라운드 스레드에 의해 기록되기 때문에 시점에 따라 업데이트 여부가 다름&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;아직 &lt;code class=&quot;language-text&quot;&gt;COMMIT&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;ROLLBACK&lt;/code&gt;되지 않은 상태에서 다른 사용자가 해당 레코드를 조회하면
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;transaction_isolation&lt;/code&gt;에 설정된 &lt;strong&gt;격리 수준&lt;/strong&gt;에 따라 결과가 다름&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;READ_UNCOMMITTED&lt;/code&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;버퍼 풀이 가지고 있는 데이터를 반환&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;READ_COMMITTED&lt;/code&gt;&lt;/strong&gt;, &lt;code class=&quot;language-text&quot;&gt;REPEATABLE_READ&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;SERIALIZABLE&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;버퍼 풀이나 데이터 파일에 있는 내용 대신 변경되기 이전의 내용인 &lt;strong&gt;언두 영역의 데이터를 반환&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;트랜잭션 종료&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;COMMIT&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;더 이상의 변경 작업 없이 지금의 상태를 영구적인 데이터로 만들어버림&lt;/li&gt;
&lt;li&gt;언두 영역의 백업 데이터를 바로 삭제하지 않고, 이를 필요로하는 트랜잭션이 더 없을 때 삭제&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ROLLBACK&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;언두 영역에 있는 백업된 데이터를 버퍼 풀로 다시 복구하고, 언두 영역의 내용을 삭제&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;잠금 없는 일관된 읽기&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MVCC 기술을 이용해 잠금을 걸지 않고 읽기 작업을 수행
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;SERIALIZABLE&lt;/code&gt; 제외&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;특정 사용자가 레코드를 변경하고 아직 커밋하지 않았다 하더라도 언두 로그의 데이터를 읽음&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;오랜 시간 동안 트래잭션이 활성 상태이면
언두 로그를 삭제하지 못하고 계속 유지해야 함
MySQL 서버가 느려지거나 문제가 발생할 수 있음&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;자동 데드락 감지&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;잠금 대기 목록을 &lt;strong&gt;그래프&lt;/strong&gt; (Wait-for List) 형태로 관리&lt;/li&gt;
&lt;li&gt;데드락 감지 스레드가 잠금 대기 그래프를 검사해 교착 상태에 빠진 트랜잭션들 중 하나를 강제 종료
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;언두 로그를 더 적게 가진 트랜잭션&lt;/strong&gt;이 일반적으로 롤백의 대상이 됨
→ 롤백을 해도 언두 처리를 해야 할 내용이 적기 때문&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MySQL 엔진에서 관리되는 테이블 잠금(&lt;code class=&quot;language-text&quot;&gt;LOCK TABLES&lt;/code&gt; 명령)은 볼 수 없어서 데드락 감지가 불확실
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_table_locks&lt;/code&gt;&lt;/strong&gt; 시스템 변수를 활성화하면 테이블 레벨의 잠금까지 감지 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;데드락 감지 부하&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;데드락 스레드가 잠금 목록을 검사하기 위해 &lt;strong&gt;잠금 목록이 저장된 리스트(잠금 테이블)에 새로운 잠금&lt;/strong&gt;을 걸음&lt;/li&gt;
&lt;li&gt;동시 처리 스레드가 많아지거나, 각 트랜잭션의 잠금 개수가 증가하면 데드락 감지 스레드가 느려짐&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_deadlock_detect&lt;/code&gt; 시스템 변수를 &lt;code class=&quot;language-text&quot;&gt;OFF&lt;/code&gt;로 설정하면 감지 안함
→ &lt;strong&gt;데드락 발생 시 무한정 대기&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_lock_wait_timeout&lt;/code&gt; 시스템 변수를 활성화
→ &lt;strong&gt;데드락 상황에서 자동으로 요청이 실패&lt;/strong&gt;하고 에러 메시지를 반환&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;자동화된 장애 복구&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;InnoDB 데이터 파일은 기본적으로 MySQL 서버가 시작될 때 자동으로 복구를 수행
&lt;ul&gt;
&lt;li&gt;복구될 수 없는 손상이 있다면 종료&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_force_recovery&lt;/code&gt; 시스템 변수로 &lt;strong&gt;파일의 손상 여부를 선별적으로 진행&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;1부터 6까지, 높을수록 심각한 상황&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;mysqldump&lt;/code&gt;를 이용해 데이터를 가능한 만큼 백업한 뒤 새로 DB와 테이블을 생성하는 것이 좋음&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_force_recovery&lt;/code&gt; 옵션&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;1(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_IGNORE_CORRUPT&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;데이터나 인덱스 페이지에서 손상된 부분이 발견돼도 무시하고 시작하는 모드&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;2(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_NO_BACKGROUND&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;불필요한 언두 데이터는 메인 스레드가 주기적으로 삭제(Undo purge)&lt;/li&gt;
&lt;li&gt;메인 스레드를 시작하지 않고 서버를 시작하여 언두 데이터로 인한 장애를 무시하는 모드&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;3(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_NO_TRX_UNDO&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;일반적으로 서버가 다시 시작하면서 언두 영역의 데이터를 데이터 파일의 적용하고, 리두 파일의 내용을 덮어써서 장애 시점의 데이터 상태를 만들어 냄&lt;/li&gt;
&lt;li&gt;커밋되지 않은 트랜잭션의 작업을 롤백하지 않고 그대로 두는 모드&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;4(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_NO_IBUF_MERGE&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;데이터 변경으로 인한 인덱스 변경 작업은 인서트 버퍼에 저장해두고 나중에 처리될 수 있음&lt;/li&gt;
&lt;li&gt;인서트 버퍼의 내용을 무시하고 시작하는 모드&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;5(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_NO_UNDO_LOG_SCAN&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;언두 로그를 모두 무시하고 시작하는 모드&lt;/li&gt;
&lt;li&gt;커밋되지 않은 트랜잭션을 모두 커밋된 것처럼 처리&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;6(&lt;code class=&quot;language-text&quot;&gt;SRV_FORCE_NO_LOG_REDO&lt;/code&gt;)
&lt;ul&gt;
&lt;li&gt;리두 로그를 무시한 채로 시작&lt;/li&gt;
&lt;li&gt;커밋이 되어도 리두 로그에만 기록되였다면 무시됨 → 마지막 체크포인트 시점의 데이터만 남음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;InnoDB 버퍼 풀&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;디스크의 데이터 파일이나 인덱스 정보를 &lt;strong&gt;메모리에 캐시&lt;/strong&gt;해두는 공간&lt;/li&gt;
&lt;li&gt;쓰기 작업을 지연시켜 일괄 작업으로 처리할 수 있게 해주는 &lt;strong&gt;버퍼 역할&lt;/strong&gt;
→ 랜덤한 디스크 작업의 횟수를 줄임&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;버퍼 풀의 크기 설정&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;레코드 버퍼&lt;/strong&gt;: 각 클라이언트 세션에서 테이블의 레코드를 읽고 쓸 때 버퍼로 사용하는 공간
&lt;ul&gt;
&lt;li&gt;별도로 설정할 수 없고, 전체 커넥션 개수와 각 커넥션이 다루는 테이블 개수에 따라 결정됨&lt;/li&gt;
&lt;li&gt;동적으로 해제되기도 해서 정확한 필요 메모리 계산이 불가능&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;버퍼 풀의 크기를 적절히 &lt;strong&gt;작은 값으로 설정한 뒤 조금씩 증가&lt;/strong&gt;시키는 방법이 최적&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_size&lt;/code&gt; 시스템 변수로 크기를 설정
&lt;ul&gt;
&lt;li&gt;동적으로 버퍼 풀의 크기를 확장할 수 있음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;크기를 줄이는 작업&lt;/strong&gt;은 크리티컬하므로 주의&lt;/li&gt;
&lt;li&gt;버퍼 풀 크기의 단위는 128MB&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;버퍼 풀 인스턴스&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;문제: 단일 버퍼 풀의 경합&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;버퍼 풀은 여러 클라이언트 스레드가 동시에 접근하는 공유 자원입니다.&lt;/p&gt;
&lt;p&gt;단일 버퍼 풀 사용 시:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트 1000개가 동시에 버퍼 풀 접근
→ 하나의 버퍼 풀을 잠금(세마포어)으로 보호
→ 한 번에 하나의 스레드만 접근 가능
→ 나머지 999개는 대기 (심각한 경합)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;해결: 버퍼 풀을 여러 개로 분할&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;비유: 은행 창구 1개 vs 창구 8개&lt;/p&gt;
&lt;p&gt;창구 1개:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1000명이 한 줄로 대기&lt;/li&gt;
&lt;li&gt;대기 시간 매우 길음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;창구 8개:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1000명을 8개 줄로 분산 (각 줄당 125명)&lt;/li&gt;
&lt;li&gt;대기 시간 대폭 감소&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;버퍼 풀도 마찬가지:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 버퍼 풀 8GB를 8개 인스턴스로 분할&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_buffer_pool_size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8589934592&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 8GB&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_buffer_pool_instances &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;-- 8개로 분할&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 각 인스턴스: 1GB씩 담당&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- 경합: 1/8로 감소&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;버퍼 풀 인스턴스 8개로 분할:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;인스턴스 1: 페이지 1, 9, 17, 25...
인스턴스 2: 페이지 2, 10, 18, 26...
인스턴스 3: 페이지 3, 11, 19, 27...
...
인스턴스 8: 페이지 8, 16, 24, 32...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;스레드 A가 페이지 1 요청 → 인스턴스 1만 잠금
스레드 B가 페이지 2 요청 → 인스턴스 2만 잠금 (동시 처리 가능!)&lt;/p&gt;
&lt;h3&gt;버퍼 풀의 구조&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;버퍼 풀을 페이지 크기의 조각으로 쪼개어 InnoDB 스토리지 엔진이 데이터를 필요로 할 때, 해당 데이터 페이지를 읽어와 각 조각에 저장&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LRU&lt;/strong&gt; (Least Recently Used) 리스트, &lt;strong&gt;플러시&lt;/strong&gt; (Flush) 리스트, &lt;strong&gt;프리&lt;/strong&gt; (Free) 리스트&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;프리(Free) 리스트&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;프리 리스트는 InnoDB 버퍼 풀이 처음 시작될 때 존재하는 빈 페이지들의 목록&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;버퍼 풀 초기화 시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;MySQL이 시작되면 버퍼 풀(예: 10GB)이 할당되지만, 처음에는 모든 페이지가 비어있습니다. 이 빈 페이지들이 프리 리스트에 들어갑니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;데이터 적재 과정&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;쿼리가 실행되면 디스크에서 데이터를 읽어와야 함&lt;/li&gt;
&lt;li&gt;프리 리스트에서 빈 페이지를 하나 가져옴&lt;/li&gt;
&lt;li&gt;디스크에서 읽은 데이터로 해당 페이지를 채움&lt;/li&gt;
&lt;li&gt;채워진 페이지는 LRU 리스트로 이동&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;프리 리스트가 고갈되면?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;프리 리스트가 비면 LRU 리스트의 꼬리(Tail)에서 가장 오래 사용되지 않은 페이지를 제거하여 공간을 확보합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;깨끗한 페이지: 바로 제거하고 재사용&lt;/li&gt;
&lt;li&gt;더티 페이지: 디스크에 먼저 기록한 후 재사용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;따라서 프리 리스트는 &quot;아직 한 번도 사용되지 않은 빈 공간&quot;이고, LRU 리스트는 &quot;실제 데이터가 들어있는 공간&quot;입니다.&lt;/p&gt;
&lt;h4&gt;LRU(Least Recentrly Used)&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/74fa368ef7163bf451f741ffb95235e7/764be/LRU.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACbUlEQVR42oWU6UsqYRTG+5dFpA+KWKiJSy4ofvaDpPQ5IhAX1NxSc99FS02JXEFz68RzLjPIbbp34PDOvO+c33nOMnNGEtfxeKTxeEzD4ZBGoxHfv729ic/Cir3dbkeHw4E+Pz/Z90wKuN1u6enpiR4eHigYDFK5XGZLp9MUj8cplUrR8/MzPw8GA1osFtTtdhksCUTUXC5H+XyerV6vU7PZ5L37+3t6fHykSqVChUKB9wCE4v1+Lw2EfChC1E6nQ+12m2q1GitLJBKsDDCoRDAAW63W7wqRcrFY5JcajQavcAQkFouxKkFhNpul2WzGqf8XCGWAwaAQzplMhpWVSiVeAV0ul9woMeWvry/RBCAcToFQCEA4HOaGQSHqW61WabVascJfa3gKRDOEGgIkNAsZIABqjRpihMSU0QREWa/XtNlseIUDYKghDEqSySTd3d1RNBrlVAGGUvgCKCrs9XocGR0ECIdI8+Xlhfr9Pq/oOKDoNCA4hzpkghqCwUB8FVAFm8/nvDmZTMjv95PP52O7vb3lZ6/XS263mzweD93c3PAZgPB7fX39k7LQCKE5uJCyyWQimUxG5+fnpNPpSK/Xk1qtJrlcTkqlki4uLshsNnPqHx8fnMWPsRGAUOt0OsloNLKTxWKh6+trMhgMDEMAnDkcDm4M5hAKf3T5FOhyuRhktVrZoFir1TLs6uqKV5vNJjYFtf4nELWCKjjZ7XaG/q0QWSBl1PD9/Z3/UpJA1BAOGo2GLi8v2XAPmEKhIJVKxfdQjJFClwHG/EoONoqLEQqFQhSJRPjrwBoIBETDbw3ziOC4ptMp/6W+AcjYquhwO0S1AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;lru 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/74fa368ef7163bf451f741ffb95235e7/f058b/LRU.png&quot;
        srcset=&quot;/static/74fa368ef7163bf451f741ffb95235e7/c26ae/LRU.png 158w,
/static/74fa368ef7163bf451f741ffb95235e7/6bdcf/LRU.png 315w,
/static/74fa368ef7163bf451f741ffb95235e7/f058b/LRU.png 630w,
/static/74fa368ef7163bf451f741ffb95235e7/764be/LRU.png 806w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;엄밀하게는 LRU와 MRU(Most Recently Used) 리스트가 결합된 형태&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;필요한 레코드가 저장된 데이터 페이지가 버퍼 풀에 있는지 검사
&lt;ul&gt;
&lt;li&gt;InnoDB 어댑티브 해시 인덱스로 페이지 검색&lt;/li&gt;
&lt;li&gt;해당 테이블의 인덱스(B-Tree)를 이용해 버퍼 풀에서 페이지를 검색&lt;/li&gt;
&lt;li&gt;버퍼 풀에 이미 데이터가 있었다면 해당 페이지의 포인터를 &lt;strong&gt;MRU 방향으로 승급&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;디스크에서 필요한 데이터 페이지를 버퍼 풀에 적재&lt;/li&gt;
&lt;li&gt;적재된 페이지에 대한 포인터를 &lt;strong&gt;LRU 헤더 부분에 추가&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;적재된 페이지가 실제로 읽히면 &lt;strong&gt;MRU 헤더 부분으로 이동&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;대량 읽기의 경우 버퍼 풀에 적재되고 실제 쿼리에서 사용되지 않을 수 있기 때문&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;버퍼 풀에서 오랫동안 사용되지 않으면 Aging되어 버퍼 풀에서 제거되고, 사용되면 나이가 초기화되고 &lt;strong&gt;MRU의 헤더 부분으로 이동&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;자주 접근됐다면 해당 페이지의 인덱스 키를 &lt;strong&gt;어댑티브 해시 인덱스에 추가&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;플러시 리스트&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;더티 페이지&lt;/strong&gt; (Dirty Page)란 버퍼 풀에서 변경되었지만 아직 디스크에 기록되지 않은 데이터 페이지를 의미합니다.&lt;/p&gt;
&lt;p&gt;플러시 리스트는 이러한 더티 페이지들을 변경 시점 순서대로 관리하는 자료구조입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UPDATE 쿼리 실행 시 데이터 흐름&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자가 &lt;code class=&quot;language-text&quot;&gt;UPDATE users SET age = 30 WHERE id = 1&lt;/code&gt; 실행&lt;/li&gt;
&lt;li&gt;InnoDB는 다음 두 곳에 변경사항을 기록:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;리두 로그 버퍼&lt;/strong&gt;에 변경 내역 기록 (WAL 원칙)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;버퍼 풀의 데이터 페이지&lt;/strong&gt;를 직접 수정 (이때 해당 페이지는 더티 페이지가 됨)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;더티 페이지는 &lt;strong&gt;플러시 리스트에 추가&lt;/strong&gt;되어 관리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;COMMIT 시점&lt;/strong&gt;에 리두 로그 버퍼 내용이 디스크의 리두 로그 파일에 기록 (fsync)&lt;/li&gt;
&lt;li&gt;하지만 &lt;strong&gt;데이터 페이지 자체는 아직 디스크에 기록되지 않음&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;리두 로그가 디스크에 기록되었다고 해서 실제 데이터 페이지가 디스크에 기록된 것은 아닙니다.&lt;/p&gt;
&lt;p&gt;데이터 페이지는 플러시 리스트에서 관리되다가 다음 시점에 디스크로 기록됩니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;체크포인트 이벤트&lt;/strong&gt; 발생 시&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;버퍼 풀 공간 부족&lt;/strong&gt; 시 (LRU 알고리즘에 의해 오래된 더티 페이지 방출)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;백그라운드 페이지 클리너 스레드&lt;/strong&gt;가 주기적으로 처리&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이러한 구조 덕분에 MySQL은 커밋 성능을 유지하면서도 크래시 복구가 가능합니다.&lt;/p&gt;
&lt;p&gt;크래시 발생 시 리두 로그를 재생하여 디스크에 기록되지 않은 더티 페이지를 복구할 수 있기 때문입니다.&lt;/p&gt;
&lt;h3&gt;버퍼 풀과 리두 로그&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9a0f92b050926d19c0c18bafed7b45ac/31198/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVR42n2UyU5qURBF/SR+gz9haJw6Y8KIkWHkFyiE0IUmIn0PSqs0CoSeAMpYIdbLqpd7H8Tkkezcc8+p2qdq77pc/Pz8yHq9luVyKavV6gyLxULm8/kZiDNwGvfx8SH8Lr6+vuTp6UleXl6k0+koWq2WtNttyeVyEgqFJBwO6zMYDEqhUJButyuvr68aS97z87Pum4QcjEYjBUTFYlFJ8/m83N/fa4JxEQTJZFIikYj0ej0Zj8d6Qblc/kcIydvbmwyHQ6lWq5JOp2U6nUoikZCrqytNoMXJZKLyeL1eubm5kWazqYRc8ovw/f1dSamkXq9rEq2WSiWxWq1yfX2tOqFjrVZTQERX/yWkLarx+/0Sj8e1osvLS3E6nbLb7ZRgMBhotcT+Ivz+/jZbJpD1drs1EyH//PzUyjabjcxmM5UDZ2kZmejqrELDFA4RmptpGz1pjXeMYRqAMQUUYZiCkUp4PB5VJ4xgTADu8p7JZOTx8VFHAmASiaxPY9nnciU8HA4alEqlJBaLSTQa1ZHw+XwKzGEGA4GAuN1uBeeAWHIAlZstM6S0gUbohUEej0ccDoe4XC7V6u7uTmw2m1gsFun3+7Lf7/UrwXlyzZYhxCWAFgRD8PDwoENNhZVKRSu6vb0Vu90ujUZDDaMQ4tGbGJPQmCmEBpgEOZWiJXKgJfu4zPM0lnaz2exfQv4cIEPUUycBFxlOUwFrnqfn5DAyTAeEfwAQY8QSUbyojgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;버퍼풀과 리두 로그&quot;
        title=&quot;&quot;
        src=&quot;/static/9a0f92b050926d19c0c18bafed7b45ac/f058b/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png&quot;
        srcset=&quot;/static/9a0f92b050926d19c0c18bafed7b45ac/c26ae/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png 158w,
/static/9a0f92b050926d19c0c18bafed7b45ac/6bdcf/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png 315w,
/static/9a0f92b050926d19c0c18bafed7b45ac/f058b/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png 630w,
/static/9a0f92b050926d19c0c18bafed7b45ac/31198/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90%EB%A1%9C%EA%B7%B8.png 694w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;버퍼 풀의 크기는 서버의 메모리가 허용하는 한 &lt;strong&gt;클수록 쿼리의 성능이 향상&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;캐시 기능만 향상시키는 것&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;활성 리두 로그(Active Redo Log)&lt;/h4&gt;
&lt;p&gt;리두 로그는 고정된 크기의 파일들을 &lt;strong&gt;원형 큐처럼 순환&lt;/strong&gt;하면서 사용합니다. 마치 카세트테이프처럼 끝까지 가면 다시 처음으로 돌아와서 기존 내용을 덮어쓰는 구조입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;예시: 리두 로그 파일이 3개 (각 1GB)인 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[ib_logfile0: 1GB] → [ib_logfile1: 1GB] → [ib_logfile2: 1GB] → (다시 처음으로)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작 과정&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;처음에는 &lt;code class=&quot;language-text&quot;&gt;ib_logfile0&lt;/code&gt;부터 차례로 기록&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ib_logfile2&lt;/code&gt;까지 가득 차면 다시 &lt;code class=&quot;language-text&quot;&gt;ib_logfile0&lt;/code&gt;의 처음부터 덮어쓰기 시작&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;문제&lt;/strong&gt;: 아직 디스크에 기록되지 않은 더티 페이지의 로그를 덮어쓰면 크래시 복구 불가능&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;활성 리두 로그 = 재사용 불가능한 영역&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;리두 로그의 일부 영역은 아직 디스크에 반영되지 않은 더티 페이지와 연결되어 있어서 덮어쓸 수 없습니다. 이 영역을 &lt;strong&gt;활성 리두 로그&lt;/strong&gt; (Active Redo Log)라고 합니다.&lt;/p&gt;
&lt;h4&gt;LSN(Log Sequence Number)&lt;/h4&gt;
&lt;p&gt;LSN은 리두 로그의 &lt;strong&gt;논리적 위치&lt;/strong&gt;를 나타내는 단조 증가하는 숫자입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;물리적으로는 리두 로그 파일이 순환하지만, LSN은 절대 감소하지 않고 계속 증가합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;주요 개념&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;리두 로그 파일은 물리적으로 &lt;strong&gt;순환&lt;/strong&gt;하지만, LSN은 논리적으로 &lt;strong&gt;계속 증가&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;InnoDB는 주기적으로 &lt;strong&gt;체크포인트 이벤트&lt;/strong&gt;를 발생시켜 더티 페이지를 디스크에 동기화&lt;/li&gt;
&lt;li&gt;체크포인트가 발생하면 체크포인트 LSN보다 작은 리두 로그 엔트리와 연결된 더티 페이지가 디스크로 기록됨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;체크포인트 에이지&lt;/strong&gt; (Checkpoint Age) = 현재 LSN - 마지막 체크포인트 LSN
&lt;ul&gt;
&lt;li&gt;이 값이 활성 리두 로그의 크기를 나타냄&lt;/li&gt;
&lt;li&gt;이 값이 전체 리두 로그 크기에 가까워지면 &lt;strong&gt;쓰기 작업이 지연&lt;/strong&gt;될 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/abea2e538dd97be2f92769a095ae142e/ac25d/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABzklEQVR42o2Su24TURCG9zl4Dx4DuaGJFOUNeAUkTAEVEkKiIbRAFQIUoaDgIiUoQlRQgIghgC8kttf27vrcz8ecs1EaHORidkZnZr6dfzSFsY5Vpo0FB4f1gEc7Lzm58wT97SsGMNpyUV+x6lElWIDd/icuvb7N/Vc7NLfuMe1coXn77gxq1gNqa3HOU2nF5Td3eXz8McMTpNnbY7a52cKkxhi7BlCKvDRP+kNeXL+JUgrV+476PcCUJfOtLdRRr51yHWAqsjGyGC/4fPUa1eEHZAHZlvsHzDY20HWD8WFNYLIkSQDzp7uUnQ719kOqB9s5bp49//8OtWllrpw0T7XP4kaXRbfL8uD9hVLPgVaW60PAugT+d59JfoYkS/FFsLP3oqprhqORPGiiNMWYv2SXouAk9kTvW5+zOXEe5x6xECKFkqkWjZXbC/QGlnoZkV7KoaMugxTJfYv28pecSSUQJ/laoX/2CY2WpKg7naB/HMs/AsVSQDMFo4nmy9GY4Z8lMjTVHOqpoxlMUP0pdX9OdaIwM7nTmcZOanzZEOcNdlyihyOi0hRedheD7NFbmca1PrbyQnQEp/HJgpFhJJ9qRW4Sn32MrYl05z1/AcKKkinlBsGTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;LSN 체크&quot;
        title=&quot;&quot;
        src=&quot;/static/abea2e538dd97be2f92769a095ae142e/f058b/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png&quot;
        srcset=&quot;/static/abea2e538dd97be2f92769a095ae142e/c26ae/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 158w,
/static/abea2e538dd97be2f92769a095ae142e/6bdcf/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 315w,
/static/abea2e538dd97be2f92769a095ae142e/f058b/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 630w,
/static/abea2e538dd97be2f92769a095ae142e/40601/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 945w,
/static/abea2e538dd97be2f92769a095ae142e/78612/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 1260w,
/static/abea2e538dd97be2f92769a095ae142e/ac25d/%EB%B2%84%ED%8D%BC%ED%92%80_%EB%A6%AC%EB%91%90_%EA%B7%B8%EB%9E%98%ED%94%84.png 2342w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;버퍼 풀 vs 리두 로그: 왜 리두 로그가 훨씬 작아도 되는가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;예시로 이해해봅시다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;UPDATE&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; age &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;31&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;버퍼 풀에 저장되는 것&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;전체 데이터 페이지 (16KB)&lt;/li&gt;
&lt;li&gt;해당 페이지에는 여러 행의 데이터가 포함됨&lt;/li&gt;
&lt;li&gt;예: &lt;code class=&quot;language-text&quot;&gt;id=1&lt;/code&gt;부터 &lt;code class=&quot;language-text&quot;&gt;id=100&lt;/code&gt;까지의 사용자 정보 모두&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;리두 로그에 저장되는 것&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;변경된 부분만 (수십 바이트)&lt;/li&gt;
&lt;li&gt;예: &quot;users 테이블, id=1, age 컬럼을 30에서 31로 변경&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;따라서 버퍼 풀이 10GB라도 리두 로그는 1~2GB 정도면 충분합니다. 리두 로그는 &lt;strong&gt;변경 이력&lt;/strong&gt;만 기록하기 때문입니다.&lt;/p&gt;
&lt;h3&gt;버퍼 풀 플러시(Buffer Pool Flush)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;더티 페이지를 성능상의 악영향 없이 디스크에 동기화하기 위해 2개의 플러시 기능을 백그라운드로 실행&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;플러시 리스트 플러시&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;오래된 리두 로그 공간이 지워지려면 반드시 InnoDB 버퍼 풀의 &lt;strong&gt;더티 페이지가 먼저 디스크와 동기화&lt;/strong&gt;돼야함&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;주기적으로 &lt;strong&gt;플러시 리스트&lt;/strong&gt; (Flush_list) 플러시 함수를 호출&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;오래전에 변경된 데이터 페이지 순서대로 디스크에 동기화&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_page_cleaners&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;클리너 스레드&lt;/strong&gt; (더티 페이지를 디스크로 동기화하는 스레드)의 개수를 조정&lt;/li&gt;
&lt;li&gt;하나의 클리너 스레드가 하나의 버퍼 풀 인스턴스를 처리
&lt;ul&gt;
&lt;li&gt;버퍼 풀 인스턴스보다 많은 클리너 스레드가 설정되어도 버퍼 풀 인스턴스의 개수에 맞춰짐&lt;/li&gt;
&lt;li&gt;버퍼 풀 인스턴스보다 적을 때에는 하나의 클리너 스레드가 여러 버퍼 풀 인스턴스를 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;되도록 동일한 값으로 설정&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_max_dirty_pages_pct&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;더티 페이지의 비율&lt;/strong&gt;을 조정&lt;/li&gt;
&lt;li&gt;더티 페이지의 비율이 클수록 디스크 쓰기 작업을 줄이는 효과가 극대화 → &lt;strong&gt;가능한 기본값 유지&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_io_capacity&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;innodb_io_capacity_max&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;디스크 IO Burst 문제&lt;/strong&gt;: 더티 페이지가 계속 쌓이다가 한계에 도달하면 갑자기 대량의 디스크 쓰기가 발생&lt;/li&gt;
&lt;li&gt;예시: 평소에는 초당 100MB 쓰기 → 갑자기 초당 5GB 쓰기 발생 → 쿼리 응답 시간 폭증&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_io_capacity&lt;/code&gt;: InnoDB가 평상시에 초당 디스크에 쓸 수 있는 IOPS (기본값: 200)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_io_capacity_max&lt;/code&gt;: 급한 상황에서 사용할 수 있는 최대 IOPS&lt;/li&gt;
&lt;li&gt;주의: 디스크의 최대 성능을 그대로 설정하면 안 됨 (사용자 쿼리 처리에도 디스크 IO 필요)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_max_dirty_pages_pct_lwm&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;디스크로 기록되는 더티 페이지보다 더 많은 더티 페이지가 발생하면 디스크 폭발 가능&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;일정 수준 이상의 더티 페이지&lt;/strong&gt;가 발생하면 조금씩 디스크로 동기화&lt;/li&gt;
&lt;li&gt;더티 페이지의 비율이 너무 낮은 값으로 유지된다면, 높게 조정&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_adaptive_flushing&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;다른 시스템 변수를 무시하고, &lt;strong&gt;리두 로그의 증가 속도를 분석해서 적절한 수준의 더티 페이지가 버퍼 풀에 유지될 수 있도록&lt;/strong&gt; 디스크 쓰기를 실행&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_adaptive_flushing_lwm&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;이 값보다 활성 리두 공간의 비율이 낮으면 어댑티브 플러시가 작동 안함&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_flush_neighbors&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;이웃 페이지 함께 쓰기 기능&lt;/strong&gt;: 더티 페이지를 디스크에 기록할 때, 물리적으로 인접한 페이지 중 더티 페이지가 있으면 같이 기록&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;예시로 이해하기&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;디스크에 페이지가 다음과 같이 저장되어 있다고 가정:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[페이지100] [페이지101] [페이지102] [페이지103] [페이지104]
   더티       깨끗한       더티       더티       깨끗한&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_flush_neighbors = 0&lt;/code&gt; (비활성화)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;페이지100만 디스크에 쓰기 (1번의 디스크 IO)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_flush_neighbors = 1&lt;/code&gt; (활성화)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;페이지100, 102, 103을 한 번에 쓰기 (1번의 디스크 IO로 3개 처리)&lt;/li&gt;
&lt;li&gt;HDD는 헤드가 움직이는 비용이 크므로 한 번에 여러 페이지를 쓰는 게 효율적&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;디스크 타입별 권장 설정&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HDD&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;innodb_flush_neighbors = 1&lt;/code&gt; 권장
&lt;ul&gt;
&lt;li&gt;디스크 헤드 이동 비용이 크므로 인접 페이지를 함께 쓰면 IO 횟수 감소&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SSD&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;innodb_flush_neighbors = 0&lt;/code&gt; 권장 (기본값)
&lt;ul&gt;
&lt;li&gt;랜덤 쓰기 성능이 좋아서 인접 페이지를 찾는 오버헤드가 더 비효율적&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;LRU 리스트 플러시&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;LRU 리스트에서 사용 빈도가 낮은 데이터 페이지를 제거할 때 &lt;strong&gt;LRU 리스트&lt;/strong&gt; (LRU_list) 플러시 함수를 사용&lt;/li&gt;
&lt;li&gt;LRU 리스트의 끝에서 최대 &lt;code class=&quot;language-text&quot;&gt;innodb_lru_scan_depth&lt;/code&gt;만큼 페이지를 스캔&lt;/li&gt;
&lt;li&gt;클린 페이지는 즉시 프리 리스트로, 더티 페이지는 디스크에 동기화&lt;/li&gt;
&lt;li&gt;버퍼 풀 인스턴스마다 스캔하기 때문에 스캔은 &lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_instances * innodb_lru_scan_depth&lt;/code&gt; 수만큼 수행&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;버퍼 풀 상태 백업 및 복구&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;버퍼 풀에 쿼리들이 사용할 데이터가 이미 준비되어 있어야 성능이 좋음
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;워밍업&lt;/strong&gt; (Warming Up): 버퍼 풀에 데이터가 적재되어있는 상태&lt;/li&gt;
&lt;li&gt;몇십 배의 쿼리 처리 속도를 보임&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_dump_now&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_load_now&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;서버를 재시작 하는 과정에서 버퍼 풀의 상태를 백업한 뒤 복구&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;백업&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;데이터 디렉토리의 &lt;code class=&quot;language-text&quot;&gt;ib_buffer_pool&lt;/code&gt; 파일에 저장&lt;/li&gt;
&lt;li&gt;LRU 리스트에 적재된 데이터 페이지의 메타 정보만 저장
→ 버퍼 풀의 크기에 비해 작은 용량만 차지&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;복구&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;백업된 메타 정보를 바탕으로 디스크에서 데이터 페이지를 읽어와야 하기 때문에 상당한 시간이 소요됨&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_load_abort&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;복구가 완료되지 않은 상태에서 서버를 재개할 수 있도록 함&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ib_buffer_pool&lt;/code&gt; 파일의 데이터 페이지가 실제로 존재하지 않는 페이지는 무시
&lt;br&gt;
셧다운 직전의 파일을 사용하지 않더라도 정상적으로 서버를 시작할 수 있음&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;자동화&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_dump_at_shutdown&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;innodb_buffer_pool_load_at_startup&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;버퍼 풀의 적재 내용 확인&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;information_schema&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;innodb_cached_indexes&lt;/code&gt; 테이블
&lt;ul&gt;
&lt;li&gt;인덱스별로 데이터 페이지가 얼마나 InnoDB 버퍼 풀에 적재되어 있는지 확인&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Double Write Buffer&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/88badb8b75b0c381d4965350ea5e6dd6/36c33/doublewrite.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYUlEQVR42oWUW0tqURSF+3G+90f8DT304KtvvgSBIJoPauIFNTW1vGSplamVpqWlBIJQSqjoPHzzsEQ553A2zL3muo01xlhz7731ei2z2Uym0+lObI+Rm/7397eGyReLhWw/ewzUajW5vb3dxP39vRSLRTk7O5NkMimhUEjS6bSuazQacnd3p1Eul6XdbisQxDaAj4+P8vLyIt1uV56enuTy8lIGg4F4vV5JpVIyGo10vl6v6xigb29v2j4/P/8J2Gw29aROp6M5gLBhs91ul3A4LJPJROfcbrcq6PV6esB/AWHLyR6PR1qtlhweHorVapXxeKwAZg2MHx4edO8/AQkk0yJpOBxKv9+Xj48Pzd/f3zVYgz3mgM/PT/n6+toFhLqJQqEg19fXanylUpGrqyvtk9PCDJa0AOM3Fuxcyuvrqw4iBcnksEQ2Y9VqVYLBoCQSCQkEAnJ+fq6VACDsYaqAaIcBJcKNxmIxiUajks1mJR6Pa9lcXFzoPIDMU0bM0ccOGHKwAi6XS5VG/SEJJtQXADc3N7rRyCTwjRYVzBuvUaGA8/lcTeYkv9+vpVIqlcThcOghMKVlDSAwwXMCIlhDkCvgarWSfD6vfuCNy+VSCzKZjPpKTWLF0dGRHBwcqAVOp1MsFov2uXU+y5+fn9+AvACiYAHggjAeacfHxzqOFcZTZHLIycmJRCIRZc0DsY2HbAaIkmEBkgHZ398Xm82mkpgz/hF4xs3+9UthIR5Rf0ilJADFF26VHNY+n0/VnJ6e6k3ncjklsgPIC6mGJYHxJmBBmL8QrfnbkPONbwP+AlTpXxNl2M+nAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;더블라이트&quot;
        title=&quot;&quot;
        src=&quot;/static/88badb8b75b0c381d4965350ea5e6dd6/f058b/doublewrite.png&quot;
        srcset=&quot;/static/88badb8b75b0c381d4965350ea5e6dd6/c26ae/doublewrite.png 158w,
/static/88badb8b75b0c381d4965350ea5e6dd6/6bdcf/doublewrite.png 315w,
/static/88badb8b75b0c381d4965350ea5e6dd6/f058b/doublewrite.png 630w,
/static/88badb8b75b0c381d4965350ea5e6dd6/40601/doublewrite.png 945w,
/static/88badb8b75b0c381d4965350ea5e6dd6/36c33/doublewrite.png 946w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 리두 로그만으로는 부족한가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;리두 로그는 &lt;strong&gt;변경된 내용&lt;/strong&gt;(delta)만 기록합니다. 예를 들어:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;리두 로그: &quot;13번 페이지의 100번째 바이트를 &apos;A&apos;에서 &apos;B&apos;로 변경&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이는 &lt;strong&gt;원본 페이지가 온전하다는 전제&lt;/strong&gt; 하에서만 복구가 가능합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;부분 페이지 손상(Partial Page) 문제&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;16KB 페이지를 디스크에 쓰는 도중 전원이 나가면:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;정상 페이지: [16KB 완전한 데이터]
손상 페이지: [8KB 새로운 데이터] [8KB 쓰레기 데이터]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 상태에서 리두 로그를 재생하면:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;리두 로그: &quot;13번 페이지의 100번째 바이트를 &apos;A&apos;에서 &apos;B&apos;로 변경&quot;&lt;/li&gt;
&lt;li&gt;문제: &lt;strong&gt;13번 페이지가 이미 손상되어 있어서 적용 불가능&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Double Write Buffer의 역할&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;더티 페이지를 디스크에 쓰기 전에:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;더티 페이지 → DoubleWrite 버퍼에 먼저 기록 (완전한 페이지 백업)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DoubleWrite 버퍼 기록 완료 후:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;더티 페이지 → 실제 데이터 파일에 기록&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;크래시 복구 시:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;데이터 파일 페이지가 손상되었나? → DoubleWrite 버퍼에서 복사&lt;/li&gt;
&lt;li&gt;데이터 파일 페이지가 정상인가? → 리두 로그로 복구&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;언두 로그&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;DML(&lt;code class=&quot;language-text&quot;&gt;INSERT&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;UPDATE&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;DELETE&lt;/code&gt;)로 &lt;strong&gt;변경되기 이전의 데이터를 백업&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;트랜잭션 보장&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;트랜잭션 롤백 시 언두 로그의 데이터를 이용해 복구&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;격리 수준 보장&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;데이터 변경 도중 다른 커넥션에서 데이터를 조회하면, 격리 수준에 따라 언두 로그의 데이터를 반환&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;언두 로그 레코드 모니터링&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;대용량의 데이터를 처리&lt;/strong&gt;하는 경우, &lt;strong&gt;트랜잭션이 오래 실행&lt;/strong&gt;되는 경우에 언두 로그의 양이 급격히 증가
&lt;ul&gt;
&lt;li&gt;여러 트랜잭션이 동일한 데이터를 다루는 경우, 남아있는 트랜잭션이 있으면 모든 리두 로그를 보관&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;이전에는 한 번 늘어난 언두 로그 사용 공간을 줄일 수 없었음
&lt;ul&gt;
&lt;li&gt;언두 로그를 순환하며 순차적으로 사용해 디스크 공간 절약&lt;/li&gt;
&lt;li&gt;MySQL 서버가 필요한 시점에 사용 공간을 자동으로 줄임&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;언두 로그 레코드 건수 확인&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHOW&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ENGINE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;INNODB&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;STATUS&lt;/span&gt; \G&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h3&gt;언두 테이블스페이스 관리&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;언두 테이블스페이스&lt;/strong&gt; (Undo Tablespace): 언두 로그가 저장되는 공간&lt;/li&gt;
&lt;li&gt;시스템 테이블스페이스 외부의 별도 로그 파일에 기록되도록 개선됨&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;언두 테이블스페이스 구조&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/497a021fcf60b8cacc96d777175615ff/e5715/undospace.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.27848101265823%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVR42pWUV6siQRBG/f9/RMUXQVAx54A555yzog+iYt09teiy9w6sO1DTPd1Vp76u7h6T/HpOp5PsdjvZ7/dqh8Ph3X63lw/+x+NRvj+m+/0uuVxOCoXC2zwej3i9XrHb7eJwOLT1+XwSDAbfvsViUX0ajYZcr1eFPZ9PMd1uN6nX69Lv92U4HEo+n5dMJiPlcln7AGq1ms53Oh3p9Xpq+MZiMQkEAprsfD7/VgiwWq2qc7vdFrfbLX6/X7OjFHgqlZJQKPROjF+325VIJKJQp9Mpi8XibyBZCahUKtpnDFutVgpotVqqmGQvMMBoNKoi8PsBpB7UhrZUKqnNZjP9RkGz2VQw/h8ByUy9BoOBBqJss9loOZbLpbbj8fhd04+AqALGpmDz+VzHXysgmZFCEhoCsdFopOqw7XarcyyZjZhMJoYKDYEoyGazqpLdpU8gSgH9N/ClkDqhjrHL5aJjBACijh8tGUcUcjS4CShEKeqAr9drBaKSMZKFw2HjTQHEyScrRSeI8wg8nU4rnIONz2tTaDnUPxQ+Hg8NisfjGvgy6pdMJvWWMI/xnUgktM+V5DYxD5DToEBe/D3IZLVaxWKxvI1vI2PObDaLzWbTa+dyuWQ6nf4B8qCUGvFHAU7B/2XUkJbVsHkAvwBep2Ou50bydAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;언두테이블스페이스&quot;
        title=&quot;&quot;
        src=&quot;/static/497a021fcf60b8cacc96d777175615ff/f058b/undospace.png&quot;
        srcset=&quot;/static/497a021fcf60b8cacc96d777175615ff/c26ae/undospace.png 158w,
/static/497a021fcf60b8cacc96d777175615ff/6bdcf/undospace.png 315w,
/static/497a021fcf60b8cacc96d777175615ff/f058b/undospace.png 630w,
/static/497a021fcf60b8cacc96d777175615ff/e5715/undospace.png 768w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;하나의 언두 테이블 스페이스는 1 ~ 128 개의 &lt;strong&gt;롤백 세그먼트&lt;/strong&gt;를 가짐&lt;/li&gt;
&lt;li&gt;롤백 세그먼트는 1개 이상의 &lt;strong&gt;언두 슬롯&lt;/strong&gt; (Undo Slot)을 가짐
&lt;ul&gt;
&lt;li&gt;InnoDB의 페이지 크기를 16바이트로 나눈 값 만큼&lt;/li&gt;
&lt;li&gt;예: 16KB 페이지 = 16 * 1024 / 16 = 1024개의 슬롯&lt;/li&gt;
&lt;li&gt;언두 로그 슬롯이 부족한 경우에는 트랜잭션을 시작할 수 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;하나의 트랜잭션이 필요로 하는 언두 슬롯의 개수는 &lt;strong&gt;최대 4개&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;일반적으로는 &lt;strong&gt;2개&lt;/strong&gt; 사용 (INSERT용 1개 + UPDATE/DELETE용 1개)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;최대 동시 처리 가능한 트랜잭션 개수 계산&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;공식:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(InnoDB 페이지 크기) / 16 * (롤백 세그먼트 개수) * (언두 테이블스페이스 개수) / (트랜잭션당 평균 슬롯)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;기본 설정 기준 계산:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;페이지 크기: 16KB&lt;/li&gt;
&lt;li&gt;롤백 세그먼트: 128개 (&lt;code class=&quot;language-text&quot;&gt;innodb_rollback_segments=128&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;언두 테이블스페이스: 2개 (&lt;code class=&quot;language-text&quot;&gt;innodb_undo_tablespaces=2&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;트랜잭션당 평균 슬롯: 2개&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;16 * 1024 / 16 * 128 * 2 / 2 = 131,072개&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;약 &lt;strong&gt;13만 개의 트랜잭션을 동시에 처리&lt;/strong&gt;할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;권장 사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;일반적인 서비스에서 13만 개의 동시 트랜잭션이 필요한 경우는 거의 없음&lt;/li&gt;
&lt;li&gt;기본값으로 충분하므로 &lt;strong&gt;가능하면 기본값을 유지&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;언두 로그 공간이 남는 것은 문제없지만, &lt;strong&gt;슬롯이 부족하면 트랜잭션을 시작할 수 없는 심각한 문제&lt;/strong&gt; 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Undo tablespace truncate&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;언두 테이블스페이스 공간을 필요한 만큼만 남기고 &lt;strong&gt;과도하게 할당된 공간을 운영체제로 반납&lt;/strong&gt;하는 것&lt;/li&gt;
&lt;li&gt;자동 모드
&lt;ul&gt;
&lt;li&gt;InnoDB 스토리지 엔진의 &lt;strong&gt;퍼지 스레드&lt;/strong&gt; (Purge Thread)가 주기적으로 불필요한 언두로그를 제거
&lt;ul&gt;
&lt;li&gt;완료된 트랜잭션이 생성한 언두 로그들&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_undo_log_tuncate&lt;/code&gt;을 설정해 퍼지 스레드가 언두 로그 파일의 사용되지 않는 부분을 반납&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_purge_rseg_truncate_frequency&lt;/code&gt;로 작업의 빈도를 조절&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;수동 모드
&lt;ul&gt;
&lt;li&gt;언두 테이블 스페이스를 비활성화&lt;/li&gt;
&lt;li&gt;퍼지 스레드가 비활성 상태의 언두 테이블의 불필요한 공간을 반납&lt;/li&gt;
&lt;li&gt;언두 테이블 스페이스가 최소 3개 이상 되어야 작동할 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;언두 테이블스페이스 비활성화&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ALTER&lt;/span&gt; UNDO &lt;span class=&quot;token keyword&quot;&gt;TABLESPACE&lt;/span&gt; tablespace_name &lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; INACTIVE&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h2&gt;체인지 버퍼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;버퍼 풀에는 데이터 페이지와 인덱스 페이지가 모두 캐시됩니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB는 데이터와 인덱스를 모두 16KB 페이지 단위로 관리하며, 이 페이지들이 버퍼 풀에 캐시됩니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;데이터 페이지&lt;/strong&gt;: 실제 테이블 행(row) 데이터&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인덱스 페이지&lt;/strong&gt;: B-Tree 인덱스 노드&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;체인지 버퍼가 필요한 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;레코드를 &lt;code class=&quot;language-text&quot;&gt;INSERT&lt;/code&gt;하거나 &lt;code class=&quot;language-text&quot;&gt;UPDATE&lt;/code&gt;할 때:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;데이터 페이지 수정&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;테이블의 실제 데이터를 저장하는 페이지 수정&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;인덱스 페이지 수정&lt;/strong&gt; (여러 개일 수 있음)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;해당 테이블의 모든 인덱스 업데이트 필요&lt;/li&gt;
&lt;li&gt;예: &lt;code class=&quot;language-text&quot;&gt;users&lt;/code&gt; 테이블에 &lt;code class=&quot;language-text&quot;&gt;email&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;created_at&lt;/code&gt; 인덱스가 있다면 둘 다 업데이트&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;문제&lt;/strong&gt;: 인덱스 페이지가 버퍼 풀에 없으면?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: INSERT INTO users (id, email) VALUES (1000, &apos;test@example.com&apos;)

필요한 작업:
1. users 테이블 데이터 페이지 수정 (버퍼 풀에 있음 - 즉시 수정)
2. email 인덱스 페이지 수정 (버퍼 풀에 없음 - 디스크에서 읽어야 함)
   → 랜덤 디스크 IO 발생 (느림)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;체인지 버퍼의 해결책&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;인덱스 페이지가 버퍼 풀에 &lt;strong&gt;있으면&lt;/strong&gt;: 즉시 업데이트&lt;/li&gt;
&lt;li&gt;인덱스 페이지가 버퍼 풀에 &lt;strong&gt;없으면&lt;/strong&gt;:
&lt;ol&gt;
&lt;li&gt;디스크에서 읽지 않고&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;체인지 버퍼&lt;/strong&gt;에 &quot;나중에 이 인덱스를 업데이트하라&quot;는 메모 저장&lt;/li&gt;
&lt;li&gt;나중에 해당 인덱스 페이지가 버퍼 풀에 로드되면 그때 병합&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;버퍼 머지 스레드&lt;/strong&gt; (Merge Thread)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;체인지 버퍼에 저장된 인덱스 변경 사항을 실제 인덱스 페이지에 병합하는 백그라운드 스레드&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;유니크 인덱스는 체인지 버퍼 사용 불가&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;유니크 인덱스는 중복 체크를 위해 &lt;strong&gt;즉시&lt;/strong&gt; 인덱스 페이지를 읽어야 하므로 체인지 버퍼를 사용할 수 없습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_change_buffering&lt;/code&gt;: 작업의 종류별로 체인지 버퍼를 활성화
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;all&lt;/code&gt;: 모든 인덱스 관련 작업(&lt;code class=&quot;language-text&quot;&gt;inserts&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;deletes&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;purges&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;: 버퍼링 안함&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;inserts&lt;/code&gt;: 인덱스에 새로운 아이템을 추가하는 작업만 버퍼링&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;deletes&lt;/code&gt;: 인덱스에서 기존 아이템을 삭제하는 작업(삭제됐다는 마킹 작업)만 버퍼링&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;changes&lt;/code&gt;: 인덱스에 추가하고 삭제하는 작업(&lt;code class=&quot;language-text&quot;&gt;inserts&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;deletes&lt;/code&gt;)만 버퍼링&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;purges&lt;/code&gt;: 인덱스 아이템을 영구적으로 삭제하는 작업만 버퍼링(백그라운드 작업)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;기본적으로 버퍼 풀의 25%, 최대 50%까지 사용 가능
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_change_buffer_max_size&lt;/code&gt;로 설정&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;리두 로그 및 로그 버퍼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;데이터베이스는 &lt;strong&gt;데이터 변경을 로그에 먼저 기록&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;읽기보다 쓰기가 더 느리기 때문에, &lt;strong&gt;쓰기 성능이 좋은 자료구조의 리두 로그를 관리&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;비정상 종료가 발생하면 리두 로그의 내용으로 데이터 파일을 서버가 종료되기 전으로 복구&lt;/li&gt;
&lt;li&gt;서버가 비정상 종료된 경우
&lt;ul&gt;
&lt;li&gt;커밋됐지만 데이터 파일에 기록되지 않은 데이터 → 리두 로그에 저장된 데이터를 데이터 파일에 복사&lt;/li&gt;
&lt;li&gt;롤백됐지만 데이터 파일에 이미 기록된 데이터 → 언두 로그에 저장된 데이터를 데이터 파일에 복사&lt;/li&gt;
&lt;li&gt;상황 판단을 위해서 우선 리두 로그가 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_flush_log_at_trx_commit&lt;/code&gt; - 리두 로그 디스크 동기화 설정&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;리두 로그를 &lt;strong&gt;리두 로그 파일&lt;/strong&gt; (디스크 파일)에 기록하는 방식을 결정하는 가장 중요한 설정입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;중요&lt;/strong&gt;: 리두 로그 파일도 결국 디스크의 파일입니다. 하지만 디스크 파일에 쓸 때 OS의 페이지 캐시(메모리 버퍼)를 거칩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;파일 쓰기의 2단계&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[MySQL 메모리 영역]
리두 로그 버퍼 (innodb_log_buffer_size)
     ↓ write() 시스템 콜

[OS 메모리 영역]
OS 페이지 캐시 (ib_logfile0, ib_logfile1의 메모리 캐시)
     ↓ fsync() 시스템 콜

[디스크]
리두 로그 파일 (ib_logfile0, ib_logfile1 실제 디스크 파일)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;write()&lt;/strong&gt;: 리두 로그 버퍼 → OS 페이지 캐시 (메모리 to 메모리, 빠름)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;fsync()&lt;/strong&gt;: OS 페이지 캐시 → 디스크의 리두 로그 파일 (메모리 to 디스크, 느림, 안전함)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 OS 페이지 캐시를 거치나요?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;모든 파일 쓰기는 성능을 위해 OS가 메모리에 먼저 캐싱합니다. &lt;code class=&quot;language-text&quot;&gt;fsync()&lt;/code&gt;를 명시적으로 호출해야만 실제 디스크로 강제 쓰기됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;설정값별 동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; - 가장 빠르지만 가장 위험&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;동작: 1초마다 write + fsync

트랜잭션 커밋 → 아무것도 안 함 (리두 로그 버퍼에만 존재)
1초 후 → 리두 로그 버퍼 → OS 페이지 캐시 (write) → ib_logfile (fsync)

위험: MySQL이나 서버 장애 시 최대 1초치 데이터 손실&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;&lt;/strong&gt; - 가장 안전하지만 가장 느림 (기본값, 권장)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;동작: 커밋마다 write + fsync

트랜잭션 커밋 → 리두 로그 버퍼 → OS 페이지 캐시 (write) → ib_logfile (fsync)

안전: 커밋된 트랜잭션은 절대 손실 안 됨 (ACID 보장)
단점: fsync 호출이 많아서 성능이 떨어짐&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;2&lt;/code&gt; - 절충안&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;동작: 커밋마다 write, 1초마다 fsync

트랜잭션 커밋 → 리두 로그 버퍼 → OS 페이지 캐시 (write)
1초 후 → OS 페이지 캐시 → ib_logfile (fsync)

위험: OS 장애(커널 패닉, 전원 차단) 시 최대 1초치 데이터 손실
      MySQL만 죽으면 데이터 안전 (OS 페이지 캐시에 있음)
장점: fsync를 1초마다만 하므로 성능이 1번보다 훨씬 좋음&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;추가 설정&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_flush_log_at_timeout&lt;/code&gt;: fsync 주기 조절 (기본값 1초 권장)&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ACID
Atomic - 원자성
Consistent - 일관성
Isolated - 격리성
Durable - 지속성&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;리두 로그 아카이빙&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;백업을 위해 데이터를 복사하는 동안, 리두 로그도 복사해줘야함
&lt;ul&gt;
&lt;li&gt;리두 로그가 매우 빠르게 증가하면 리두 로그를 복사하기 전에 &lt;strong&gt;새 리두 로그에 의해 덮어씌워질 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;리두 로그 아카이빙을 통해 리두 로그가 덮어쓰인다고 해도 &lt;strong&gt;백업이 실패하지 않도록&lt;/strong&gt; 함&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_redo_log_archive_dirs&lt;/code&gt;로 아카이빙된 리두 로그가 저장될 디렉토리를 설정&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_redo_log_archive_start&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;UDF&lt;/strong&gt; (User Defined Function)&lt;/li&gt;
&lt;li&gt;첫 번째 파라미터는 리두 로그를 아카이빙할 디렉토리&lt;/li&gt;
&lt;li&gt;두 번째 파라미터는 서브디렉토리 (&lt;code class=&quot;language-text&quot;&gt;innodb_redo_log_archive_dirs&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;DO innodb_redo_log_archive_start(&apos;backup&apos;, &apos;20251003&apos;);&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_redo_log_archive_stop&lt;/code&gt;으로 종료&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;로그 파일이 로테이션될 때가 아니라 리두 로그 파일에 로그 엔트리가 추가될 때 함께 기록&lt;/li&gt;
&lt;li&gt;아카이빙 중 세션이 종료되는 등 문제가 발생하면 &lt;strong&gt;아카이빙 파일도 자동으로 삭제&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;리두 로그 활성화 및 비활성화&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;트랜잭션이 커밋돼도 데이터 파일은 즉시 디스크로 동기화되지 않지만, 리두 로그는 항상 디스크로 기록&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;데이터 복구나 대용량 데이터를 한 번에 적재하는 경우&lt;/strong&gt; 리두 로그를 비활성화 가능
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ALTER INSTANCE DISABLE INNODB REDO_LOG;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ALTER INSTANCE ENABLE INNODB REDO_LOG;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;리두 로그가 비활성화된 상태에서 서버가 비정상적으로 종료된 경우
&lt;ul&gt;
&lt;li&gt;데이터 파일의 각 부분이 마지막 체크포인트 이후의 여러 시점의 데이터를 갖게 됨&lt;/li&gt;
&lt;li&gt;데이터가 중요하지 않더라도 리두 로그를 활성화해서 일관성을 유지&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;어댑티브 해시 인덱스&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7c6d5b52b09bcfc44c405a8f602638e7/fe83d/adaptive.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABsElEQVR42qWSbYvTQBCA8/9/kd9VsIKceOJJ7yxe22vaJmnzspt938dJWw88PCqY4WGWYZmd3TxFeUysm8iuTSgLzRDpxnxaDxdcSBgVaB4dXRkIGqKDYP9kqhXrNrOoMw/7JGS+rjzzbeR+lyWfa52JWDlodaPY/FTM1zvaMtNveKZ7AlVJw72CVQuPTWYteT/ApoPlYSLzJDVtE855quMgN9A0o2LQDqX9M4PyGBMonGzQdUu0DiubvHG4S/69jj7goufoWsZkSBLhLxElCt91uLommFGaGsKo8S+w1uKkaZK3jD4SZP0ahTKWQVDa0Mu0dpomxDP+jL8wNb1G0dQH9tuaumqoZdKUEv/zFUq0qcqIEm2sywyTMiPI0Ng+MR4zRkwIRrTwVwjSsBQHZ/eaShrOl5YP30c+PQSWotH2zrN451jOovw48OKfU68gdngZpDBDYjgETC/vZDNZbpyjzC45+UnYLMLmU+1fKJpqZDM37BdeHFPc6Dmz7huf7Q+OqUczorJmuEKfFTobikNtWd0ayjt3kvZ9f8ub3Ufedl9oYseQRvqkr9IlhUqGX5R4ok8YbbXoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;adaptive&quot;
        title=&quot;&quot;
        src=&quot;/static/7c6d5b52b09bcfc44c405a8f602638e7/f058b/adaptive.png&quot;
        srcset=&quot;/static/7c6d5b52b09bcfc44c405a8f602638e7/c26ae/adaptive.png 158w,
/static/7c6d5b52b09bcfc44c405a8f602638e7/6bdcf/adaptive.png 315w,
/static/7c6d5b52b09bcfc44c405a8f602638e7/f058b/adaptive.png 630w,
/static/7c6d5b52b09bcfc44c405a8f602638e7/40601/adaptive.png 945w,
/static/7c6d5b52b09bcfc44c405a8f602638e7/78612/adaptive.png 1260w,
/static/7c6d5b52b09bcfc44c405a8f602638e7/fe83d/adaptive.png 2262w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;B-Tree 인덱스 vs 어댑티브 해시 인덱스&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;일반적인 인덱스는 테이블에 사용자가 생성한 &lt;strong&gt;B-Tree 인덱스&lt;/strong&gt;를 의미
&lt;ul&gt;
&lt;li&gt;루트 노드 → 브랜치 노드 → 리프 노드 (3단계 탐색 필요)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;어댑티브 해시 인덱스는 &lt;strong&gt;사용자가 자주 요청하는 데이터에 대해 자동으로 생성하는 인덱스&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_adaptive_hash_index&lt;/code&gt; 시스템 변수로 활성화 여부 결정&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;자주 읽히는 데이터 페이지의 키 값을 이용해 &lt;strong&gt;해시 인덱스&lt;/strong&gt;를 구성
&lt;ul&gt;
&lt;li&gt;필요할 때마다 어댑티브 해시 인덱스를 검색해서 레코드가 저장된 데이터 페이지에 &lt;strong&gt;바로 1단계 접근&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;해시 인덱스 키와 값&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;인덱스 키&lt;/strong&gt;: B-Tree 인덱스의 고유번호(Id) + B-Tree 인덱스의 실제 키 값 조합
&lt;ul&gt;
&lt;li&gt;예: &lt;code class=&quot;language-text&quot;&gt;(idx_001, &quot;user@example.com&quot;)&lt;/code&gt; → &lt;code class=&quot;language-text&quot;&gt;hash_key_12345&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인덱스 값&lt;/strong&gt;: InnoDB 버퍼 풀에 로딩된 페이지의 메모리 주소
&lt;ul&gt;
&lt;li&gt;예: &lt;code class=&quot;language-text&quot;&gt;0x7f8a4c002000&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;파티션 구조&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;innodb_adaptive_hash_index_parts&lt;/code&gt;: 어댑티브 해시 인덱스의 파티션 개수 설정&lt;/li&gt;
&lt;li&gt;하나의 메모리 객체로 관리하면 내부 잠금(세마포어) 경합 발생&lt;/li&gt;
&lt;li&gt;파티션을 나누면 여러 스레드가 병렬로 접근 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;어댑티브 해시 인덱스 효과가 없는 경우&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. 디스크 읽기가 많은 경우&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;어댑티브 해시 인덱스는 &lt;strong&gt;버퍼 풀의 메모리 주소&lt;/strong&gt;를 저장합니다. 데이터가 버퍼 풀에 없으면 소용이 없습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: 100GB 데이터, 10GB 버퍼 풀

대부분의 쿼리가 디스크에서 데이터를 읽어야 함
→ 어댑티브 해시 인덱스 생성해도 버퍼 풀에 없어서 사용 불가
→ 해시 인덱스 관리 오버헤드만 발생&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2. 조인이나 LIKE 패턴 검색이 많은 경우&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;해시 인덱스는 &lt;strong&gt;동등 비교&lt;/strong&gt; (=)만 가능합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 효과 있음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; email &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a@test.com&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b@test.com&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 효과 없음&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;%kim%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 범위 검색&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; orders o &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; users u &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; u&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;-- 조인&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. 데이터 접근이 골고루 분산된 경우&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;어댑티브 해시 인덱스는 &lt;strong&gt;자주 접근하는 데이터&lt;/strong&gt; (핫 데이터)에만 생성됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: 1억 건 중 매번 다른 데이터 조회

id=1, id=5000, id=9999, id=12345... (매번 다름)
→ 같은 키를 100번 이상 연속 접근하지 않음
→ 해시 인덱스 생성 안 됨&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;어댑티브 해시 인덱스가 효과적인 경우&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. 워킹셋이 버퍼 풀에 들어가는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: 20GB 데이터, 32GB 버퍼 풀

자주 사용하는 데이터(워킹셋)가 모두 버퍼 풀에 상주
→ 해시 인덱스로 빠르게 접근 가능&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2. 동등 조건 검색이 많은 경우&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- PK 조회&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 유니크 키 조회&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; users &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; email &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test@example.com&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- IN 절&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; products &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. 핫 데이터 집중 패턴&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: 최근 1주일 주문 데이터만 반복 조회

전체 데이터: 1억 건
자주 조회: 최근 100만 건 (1%)
→ 100만 건에 대해 해시 인덱스 생성
→ 해당 데이터 조회 시 B-Tree 탐색 생략&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;테이블 변경 시 주의사항&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;DROP TABLE이나 ALTER TABLE 실행 시 문제&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;테이블 삭제/변경 시:
1. 해당 테이블의 모든 해시 인덱스 엔트리를 찾아서 제거해야 함
2. 해시 테이블 전체를 스캔해야 함 (시간 소요)
3. 스캔 중 다른 쿼리들이 해시 인덱스에 접근하지 못함 (세마포어 잠금)

큰 테이블의 경우:
- 수백만 개의 해시 인덱스 엔트리
- 제거하는데 수 초 ~ 수십 초 소요
- 그동안 CPU 사용률 급증&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;권장 사항&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;테이블 구조 변경이 빈번한 환경: 어댑티브 해시 인덱스 비활성화 고려&lt;/li&gt;
&lt;li&gt;대부분의 운영 환경: 기본값(ON) 유지 권장&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;InnoDB와 MyISAM, MEMORY 스토리지 엔진 비교&lt;/h2&gt;
&lt;h3&gt;MyISAM&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;기존에는 MyISAM이 기본 스토리지 엔진&lt;/li&gt;
&lt;li&gt;공간 좌표 검색, 전문 검색 기능 등 모두 InnoDB 스토리지 엔진을 지원하도록 개션&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL 서버의 모든 기능을 InnoDB 스토리지 엔진만으로 구현&lt;/strong&gt;할 수 있어서 없어질 것&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;MEMORY&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;메모리 기반이라 하나의 스레드에서만 데이터를 읽고 쓴다면 InnoDB보다 빠를 수 있음&lt;/li&gt;
&lt;li&gt;온라인 트랜잭션 처리에서는 &lt;strong&gt;동시 처리 성능&lt;/strong&gt;이 매우 중요
&lt;ul&gt;
&lt;li&gt;MEMORY 스토리지 엔진은 테이블 수준의 잠금으로 성능이 부족함&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;사용자의 쿼리를 처리하기 위한 임시 테이블도 MEMORY에서 TempTable 스토리지 엔진으로 대체&lt;/li&gt;
&lt;li&gt;향후 버전에서 제거될 것&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;에러 로그 파일&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MySQL이 실행되는 도중 발생하는 &lt;strong&gt;에러나 경고 메시지가 출력&lt;/strong&gt;되는 로그 파일&lt;/li&gt;
&lt;li&gt;MySQL 설정 파일(&lt;code class=&quot;language-text&quot;&gt;my.cnf&lt;/code&gt;)에서 &lt;code class=&quot;language-text&quot;&gt;log_error&lt;/code&gt; 파라미터로 정의된 경로에 생성
&lt;ul&gt;
&lt;li&gt;별도로 정의되지 않으면 &lt;code class=&quot;language-text&quot;&gt;datadir&lt;/code&gt; 파라미터로 정의된 경로에 &lt;code class=&quot;language-text&quot;&gt;.err&lt;/code&gt; 확장자로 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;MySQL이 시작하는 과정과 관련된 정보성 및 에러 메시지&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 서버의 정상적인 기동 확인 (&lt;code class=&quot;language-text&quot;&gt;mysqld: ready for connections&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;새로 변경하거나 추가한 파라미터가 정상적으로 적용되었는지 확인하는 용도&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;마지막으로 종료할 때 비정상적으로 종료된 경우 나타나는 InnoDB의 트랜잭션 복구 메시지&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;비정상으로 종료된 경우 다시 시작하면서 &lt;strong&gt;재처리 작업&lt;/strong&gt;을 수행
&lt;ol&gt;
&lt;li&gt;완료되지 못한 트랜잭션 정리&lt;/li&gt;
&lt;li&gt;디스크에 기록되지 못한 데이터를 다시 기록&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;쿼리 처리 도중 발생하는 문제에 대한 에러 메시지&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;사전 예방이 어려움
&lt;ul&gt;
&lt;li&gt;주기적으로 에러 로그 파일을 검토하며 발견&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;비정상적으로 종료된 커넥션 메시지(Aborted connection)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;클라이언트 애플리케이션에서 정상적으로 접속 종료를 하지 못하고 프로그램이 종료된 경우&lt;/li&gt;
&lt;li&gt;네트워크 문제일 수 있지만, &lt;strong&gt;애플리케이션의 커넥션 종료 로직을 검토&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;max_connect_errors&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;클라이언트 호스트에서 발생한 에러의 횟수가 이 시스템 변수를 넘어가는지 확인&lt;/li&gt;
&lt;li&gt;넘어가면 &lt;code class=&quot;language-text&quot;&gt;Host ‘host_name’ is blocked&lt;/code&gt; 에러 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;InnoDB의 모니터링 또는 상태 조회 명령의 결과 메시지&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;테이블 모니터링, 락 모니터링, 엔진 상태 조회 명령은 상대적으로 &lt;strong&gt;큰 메시지를 에러 로그 파일에 기록&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;InnoDB의 모니터링을 활성화 상태로 유지하는 경우, 에러 로그 파일이 매우 커질 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;MySQL의 종료 메시지&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;왜 MySQL이 종료됐는지 확인하는 유일한 방법&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Received SHUTDOWN from user ...&lt;/code&gt;: 누군가 MySQL 서버를 종료시킨 경우&lt;/li&gt;
&lt;li&gt;종료 메시지가 없거나 스택 트레이스가 출력되는 경우 &lt;strong&gt;세그멘테이션 폴트&lt;/strong&gt; (Segmentation fault)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;제너럴 쿼리 로그 파일&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MySQL 서버에서 실행되는 &lt;strong&gt;쿼리의 전체 목록 검토 목적&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;쿼리 로그 활성화 → 쿼리 로그 파일 기록&lt;/li&gt;
&lt;li&gt;슬로우 쿼리 로그와 달리 제너럴 쿼리 로그는 실행되기 전에 MySQL이 &lt;strong&gt;요청을 받으면 바로 기록&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;쿼리 실행 중 에러가 발생해도 일단 로그 파일에 기록됨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;general_log_file&lt;/code&gt;: 쿼리 로그 파일의 경로&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;log_output&lt;/code&gt;: 파일이 아닌 테이블에 저장하도록 설정할 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;슬로우 쿼리 로그&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;쿼리 튜닝&lt;/strong&gt; 목적으로 어떤 쿼리가 문제의 쿼리인지 판단하기 위함&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;long_query_time&lt;/code&gt; 시스템 변수보다 오래 걸린 쿼리를 기록&lt;/li&gt;
&lt;li&gt;쿼리가 &lt;strong&gt;정상적으로 실행이 완료되어야&lt;/strong&gt; 슬로우 쿼리에 기록될 수 있음&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;log_output&lt;/code&gt;: 쿼리를 파일로 기록할지 테이블로 기록할지 선택
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;TABLE&lt;/code&gt;로 설정하면 &lt;code class=&quot;language-text&quot;&gt;general_log&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;slow_log&lt;/code&gt; 테이블에 저장&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;InnoDB 테이블에만 접근하는 쿼리 문장의 슬로우 쿼리 로그에서 &lt;code class=&quot;language-text&quot;&gt;Lock_time&lt;/code&gt; 값은 도움안됨
&lt;ul&gt;
&lt;li&gt;InnoDB는 MySQL의 &lt;strong&gt;엔진 레벨 잠금&lt;/strong&gt;과 &lt;strong&gt;스토리지 엔진 자체의 잠금&lt;/strong&gt;을 갖고있음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Percona Toolkit의 &lt;code class=&quot;language-text&quot;&gt;pt-query-digest&lt;/code&gt; 스크립트를 이용하여 &lt;strong&gt;빈도나 처리 성능별 쿼리 정렬&lt;/strong&gt;이 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;슬로우 쿼리 통계&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;모든 쿼리를 대상으로 슬로우 쿼리 로그의 &lt;strong&gt;실행 시간&lt;/strong&gt; (&lt;code class=&quot;language-text&quot;&gt;Exec time&lt;/code&gt;), &lt;strong&gt;잠금 대기 시간&lt;/strong&gt; (&lt;code class=&quot;language-text&quot;&gt;Lock time&lt;/code&gt;)에 평균 및 최소/최대를 표시&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;실행 빈도 및 누적 실행 시간순 랭킹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;각 쿼리별 응답 시간과 실행 횟수&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Query ID&lt;/code&gt;는 쿼리 문장을 정규화해서 만들어진 해시 값을 의미
&lt;ul&gt;
&lt;li&gt;같은 모양의 쿼리라면 동일한 &lt;code class=&quot;language-text&quot;&gt;Query ID&lt;/code&gt;를 가짐&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;쿼리별 실행 횟수 및 누적 실행 시간 상세 정보&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Query ID&lt;/code&gt;별 쿼리를 쿼리 랭킹에 표시된 순서대로 자세한 내용을 표시&lt;/li&gt;
&lt;li&gt;쿼리가 얼마나 실행됐는지, 쿼리에 응답 시간에 대한 히스토그램&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Facebook Memcached 아키텍처 (2탄) - 대규모 확장과 성능 최적화]]></title><description><![CDATA[이 글은 Facebook Memcached 아키텍처 (1탄)의 후속편입니다. 이 글은 Facebook의 공식 논문 Scaling Memcache at Facebook…]]></description><link>https://gotobill.github.io/cache-part2/</link><guid isPermaLink="false">https://gotobill.github.io/cache-part2/</guid><pubDate>Thu, 02 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;이 글은 &lt;a href=&quot;../cache-part1&quot;&gt;Facebook Memcached 아키텍처 (1탄)&lt;/a&gt;의 후속편입니다.&lt;/p&gt;
&lt;p&gt;이 글은 Facebook의 공식 논문 &lt;a href=&quot;https://research.facebook.com/publications/scaling-memcache-at-facebook/&quot;&gt;Scaling Memcache at Facebook&lt;/a&gt;을 기반으로 작성되었습니다.&lt;/p&gt;
&lt;h2&gt;지역 내 확장: 데이터 복제&lt;/h2&gt;
&lt;p&gt;트래픽 증가에 따라 더 많은 웹 및 Memcached 서버를 추가하는 것만으로는 모든 문제를 해결할 수 없습니다. 더 많은 웹서버가 추가될수록 요청이 많은 아이템은 더욱 인기가 높아지고, Memcached 서버 수가 증가하면 Incast Congestion도 악화됩니다.&lt;/p&gt;
&lt;p&gt;Facebook은 웹 및 Memcached 서버를 여러 &lt;strong&gt;Frontend Cluster&lt;/strong&gt;로 분할했습니다. 이러한 클러스터와 데이터베이스를 포함하는 Storage Cluster가 함께 &lt;strong&gt;Region&lt;/strong&gt;을 정의합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Region 아키텍처의 이점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 더 작은 장애 도메인&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;한 Frontend Cluster에 장애가 발생해도 다른 Cluster는 영향받지 않음&lt;/li&gt;
&lt;li&gt;장애 범위가 전체 시스템이 아닌 하나의 Cluster로 제한됨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. 다루기 쉬운 네트워크 구성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;각 Cluster가 독립적으로 관리되어 네트워크 설정이 단순해짐&lt;/li&gt;
&lt;li&gt;대규모 단일 클러스터보다 관리와 문제 해결이 쉬움&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. Incast Congestion 감소&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;단일 거대 클러스터에서는 수백 대의 Memcached 서버가 동시에 응답을 보냄&lt;/li&gt;
&lt;li&gt;여러 작은 Cluster로 나누면 각 웹서버가 통신하는 Memcached 서버 수가 줄어듦&lt;/li&gt;
&lt;li&gt;동시 응답 수가 감소하여 네트워크 정체 현상 완화&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. 데이터 복제로 인한 독립적인 장애 도메인&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;각 Frontend Cluster가 독립적인 Memcached를 가짐&lt;/li&gt;
&lt;li&gt;같은 인기 데이터(예: 유명인 게시물)가 여러 Cluster의 캐시에 각각 복제되어 저장됨&lt;/li&gt;
&lt;li&gt;Cluster A 장애 시에도 Cluster B는 자신의 캐시 복사본으로 계속 서비스 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;지역 무효화 (Regional Invalidations)&lt;/h3&gt;
&lt;p&gt;Region의 Storage Cluster(MySQL)는 데이터의 &lt;strong&gt;원본&lt;/strong&gt;을 보유합니다. 사용자 요청에 따라 이 데이터가 여러 Frontend Cluster의 Memcached에 복제되어 캐시됩니다.&lt;/p&gt;
&lt;p&gt;Storage Cluster는 원본 데이터가 변경되면 모든 &lt;strong&gt;Frontend Cluster의 캐시된 복사본&lt;/strong&gt;을 &lt;strong&gt;무효화&lt;/strong&gt;(invalidate)하여 일관성을 유지할 책임이 있습니다.&lt;/p&gt;
&lt;h4&gt;mcsqueal 데몬&lt;/h4&gt;
&lt;p&gt;원본 데이터(DB)를 수정하는 SQL 문은 트랜잭션이 커밋되면 무효화해야 할 Memcache 키를 포함하도록 수정됩니다.&lt;/p&gt;
&lt;p&gt;모든 MySQL 데이터베이스에 &lt;strong&gt;mcsqueal 데몬&lt;/strong&gt;이 배포됩니다. 이 데몬은 &lt;strong&gt;CDC(Change Data Capture)&lt;/strong&gt; 방식으로 동작합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CDC란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;모든 현대적인 데이터베이스(Oracle, MySQL 등)는 데이터의 변경 이력을 안정적으로 기록하고 관리하기 위한 &lt;strong&gt;트랜잭션 로그&lt;/strong&gt;(Transaction Log)를 가지고 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CDC는 바로 이 데이터베이스의 핵심 기능을 활용&lt;/strong&gt;하여 애플리케이션과 완전히 분리되어, 데이터베이스의 &lt;strong&gt;트랜잭션 로그를 직접 읽는 방식으로 동작&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;p&gt;이를 통해 데이터베이스는 데이터가 변경되면 그 변경 내용을 통지하는 기능을 제공합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;mcsqueal의 동작 방식:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MySQL의 Commit Log를 실시간으로 모니터링&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;커밋된 SQL 문을 검사하여 무효화할 키(DELETE) 추출&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;해당 Region의 모든 Frontend Cluster에 무효화 명령 브로드캐스트&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;DELETE 명령의 이중 효과:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;mcsqueal이 보내는 DELETE 명령은 단순히 캐시 데이터만 삭제하는 것이 아닙니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;기존 캐시 데이터 삭제&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;해당 키에 발급된 모든 outstanding lease 무효화&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이를 통해 Race Condition을 방지합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;문제 상황:
1. 클라이언트 A: 캐시 미스 → lease 획득
2. 클라이언트 A: DB에서 데이터 읽음 (user:1 = &quot;Alice&quot;)
3. 클라이언트 B: DB 업데이트 (user:1 = &quot;Bob&quot;)
4. mcsqueal: DELETE 명령 브로드캐스트 → lease 무효화
5. 클라이언트 A: stale data를 set 시도 → lease가 무효화되어 set 실패

결과: stale data가 캐시에 들어가지 않음&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;무효화 파이프라인&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/60b3a/inval.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVR42m2RW2+bQBBG+f+/pM99dyulatWHRk7aylVJjInNbbkYWK5mYU/XhjSpm0GjDzE7H3NmLUyIEtZP+vzKNMsltHka1bEKbxkmZWqvi9Ms0Q26jf52WPtM8+2h4MOtz4PQpGWPiAJiEZP0OU8yZPXzM2GbElQJYRjgBxFlbFN4Nzjrdxw27zkd1xdL65d/4m5X892VZsoBNyjwvT2u4+JkB8I+w009IqNBk5Afj8ZQIOMN4/EjubeiESt08XU2VGbyYXzJM5ZeUhnMbjwx6FnHaVzAFuSpp+8qVF/Tt0aVwuLlyCu9ijc+62WfVV3h+QHbrWPWEc6GulforHmz6blRa31Vm1W4JV19YjI0oxoNsuyoNh7lJ5suLWfuK9O2bf/7mdkAnZxwvrRkuwG1HLGabYx//8ju7jfZvUt+iJEGQ0qJEIIoirBtmzg2t54kVLKi61tKMZDvNY8/zK3bkuIwT23pomdKG8akRqftBf8calAX07qu/8lxnAlUZybPlkwnunzewR9yNLSB/tI4hQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;무효화&quot;
        title=&quot;&quot;
        src=&quot;/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/f058b/inval.png&quot;
        srcset=&quot;/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/c26ae/inval.png 158w,
/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/6bdcf/inval.png 315w,
/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/f058b/inval.png 630w,
/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/40601/inval.png 945w,
/static/8b9cc074b2fc52b77cb43ed2bf2a5a30/60b3a/inval.png 1179w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이 방식의 장점은 데이터베이스의 신뢰할 수 있는 로그를 기반으로 하기 때문에, 무효화 명령이 손실되거나 잘못 전달되어도 로그를 재실행(replay)하여 복구할 수 있다는 것입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aadee91086a49f4321e70eda42e0169d/cc488/figure6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACV0lEQVR42m1S2W7iQBDk/38BCWm1EnlwpHBjErM4BkE4AhjbYG4IxwYI92kM1E4PIVGkbakZPDNdXVU9DuCCy+UCWm//b998vZ19rufzGafTiZ8djxYGgz7GoxHG4xEsy4LjcjmjWmtCK9dRqbWg6RXo5SrMehvVRgdG2URB1VGtd5BXDQz/vmO73WK/37O6Bh68IYTEKHz+EN/ngCY7oMtSLI6wKCGZyiKRysHrF6EbJlStAllJoViqwDRr6HY7aDabCIQiCD/GoOqMACN1Pp/guEoDj/1uh3argUI+g7gShSgGcXf3GwH/A7yeexQKr2i1WhzMMDQEg17cC3cQQ37YxyPHcNDPjtHfbDZ4Z3ICfgFyLID8q4Jn+QnSkw/hkACf181ASphOp/j4mCKXTeAlJSGT/gPl+ZH5aX8DDgYDKIqCdDqNbDbLmBS5R5Rk9Hq9gabpmEwmsO0T1qz5brfnIJZl871bcMDDwcJwOEQymUQmk0Gn00EsFmOSRUSjUcbiBbmkDMH9C1HRD72QYTWHz9fwMzggTader0NVVSbLYKZ3kUgk4PF4GGiESUuhZpZRKesw9BLP5XLJAW9P6Acgva31eo3ZbIbVasWl2rb9JXvHhkV3jsz4JTtfMDAC+l9wQDK6VCqh3+/jasGBNyBQKqSkRsSK1BA4sSIlun71loL2HFQkCAKcTifcbjd8Ph8fEHlHkmmNRCKQJAmyLPMkexaLBbfI5XIhHo9/A1K3t7ceHwR1NE0T7XabTVXjBcVikftKTCjpmwZIjOfzOb/X6/W+JP8DeU1nCfalkPEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;무효화 파이프라인&quot;
        title=&quot;&quot;
        src=&quot;/static/aadee91086a49f4321e70eda42e0169d/f058b/figure6.png&quot;
        srcset=&quot;/static/aadee91086a49f4321e70eda42e0169d/c26ae/figure6.png 158w,
/static/aadee91086a49f4321e70eda42e0169d/6bdcf/figure6.png 315w,
/static/aadee91086a49f4321e70eda42e0169d/f058b/figure6.png 630w,
/static/aadee91086a49f4321e70eda42e0169d/cc488/figure6.png 928w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;실제로 대부분의 무효화는 데이터를 삭제하지 않습니다. 발행된 모든 DELETE 중 &lt;strong&gt;단 4%만&lt;/strong&gt; 실제로 캐시된 데이터를 무효화합니다.&lt;/p&gt;
&lt;h4&gt;패킷 수 감소&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;mcsqueal&lt;/strong&gt;이 각 Memcached 서버에 직접 DELETE 명령을 보낼 수도 있지만, &lt;strong&gt;Storage Cluster&lt;/strong&gt;에서 수많은 &lt;strong&gt;Frontend Cluster의 수천 대 Memcached 서버로 패킷&lt;/strong&gt;을 직접 보내면 &lt;strong&gt;패킷 폭발&lt;/strong&gt;(packet storm)이 발생합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;최적화 방법&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 무효화 데몬이 DELETE를 배치로 묶음
2. 각 Frontend Cluster의 mcrouter 전용 서버로 전송
3. mcrouter가 배치를 개별 DELETE로 언팩
4. Frontend Cluster 내의 올바른 Memcached 서버로 라우팅&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;배치 처리 결과, 패킷당 DELETE 수의 중간값이 &lt;strong&gt;18배 개선&lt;/strong&gt;되었습니다.&lt;/p&gt;
&lt;h4&gt;웹서버를 통한 무효화를 사용하지 않는 이유&lt;/h4&gt;
&lt;p&gt;웹서버가 모든 Frontend Cluster에 무효화를 브로드캐스트하는 방법이 더 간단하지만 두 가지 문제가 있습니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;패킷 오버헤드&lt;/strong&gt;: 웹서버는 mcsqueal 파이프라인보다 배치 처리가 덜 효과적&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;시스템적 문제 대응 어려움&lt;/strong&gt;: 구성 오류로 인한 DELETE 잘못된 라우팅 발생 시, 과거에는 전체 Memcache 인프라를 롤링 재시작해야 했음 (느리고 방해적)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;반면, SQL 문에 무효화를 포함시키면 데이터베이스가 커밋하고 신뢰할 수 있는 로그에 저장하므로, mcsqueal은 손실되거나 잘못 라우팅된 무효화를 간단히 재생할 수 있습니다.&lt;/p&gt;
&lt;h3&gt;지역 풀 (Regional Pools)&lt;/h3&gt;
&lt;p&gt;각 클러스터는 전송되는 사용자 요청의 혼합에 따라 독립적으로 데이터를 캐시합니다. 사용자 요청이 모든 Frontend Cluster에 무작위로 라우팅되면, 캐시된 데이터는 모든 Frontend Cluster에서 대략 동일합니다.&lt;/p&gt;
&lt;p&gt;이를 통해 유지보수를 위해 클러스터를 오프라인으로 전환해도 히트율이 감소하지 않습니다. 하지만 데이터를 과도하게 복제하면 특히 크고 드물게 액세스되는 아이템의 경우 메모리 비효율적일 수 있습니다.&lt;/p&gt;
&lt;h4&gt;클러스터 vs 지역 복제 결정&lt;/h4&gt;
&lt;p&gt;여러 Frontend Cluster가 동일한 Memcached 서버 세트를 공유하도록 하여 복제본 수를 줄일 수 있습니다. 이를 &lt;strong&gt;Regional Pool&lt;/strong&gt;이라고 합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;복제&lt;/strong&gt;(단순 memcached 늘리기)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2d36b31b958437599f462997f53f6ee/ad1ae/cluster_repl.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKElEQVR42l2SW0/bQBCF+f8/qEUVUlupakOB5u5cHCcQSOK7vbZ3105Cvo4NDy0Px9odzzlzdmauEnMhN3RQ9g3tOZV4i/YeFRfi8i0ve49/zM8EUXXhKjKvvNiKR1OwqjI2uujOUX3iYA1PtmDoR0zimK0t8a0ltA1PpmRdKbwq7/JbjaAVPOgji/oZt5owSB6YqxEzu5AEzcqGLLTDNOszzQdyn+PZRIpmLK3bxYbCcStHOFv86pWrvT5L5SXYG2z8GaobYvODZ3HyqPfU9ivH9JpTds2x/s7GROIsQ9U9LuUX6vgTl+abFJlz0LQOT6zthkTfss970qtbnvQfcWiE7OPr3wQSbxGae8mNhZyzt0PpbY9DJhxzx8p44lAEA9Pg6BAna7j3FdO0pq8S9nXFUseMVUU/LBlEFVOl8UzCWqdMSsUotjwEhbSpYVwFBFqe7L8LuurMLDZ46pVh0QqWuCLoiKCbNh1mSv6bGE8nOGWBl5+ZC2dVnBiVvgiexaE8eWYOTMyOSbVjqLb0y8duKEshj5sDg2ovsRemRx/XtEMRd+VWCm87TsudSb+Ddihpu0fNhaxFLftmz4SFJd2FqL1MeTDFGzo4d31W47nEItKXgLBsSCQ3e+fmwg21rE3SCf6DkyxrVXNeurDZUA8G2Ntf2N5PmtEY1mtO8wVKRNTxf27Y7mEsn1h/QHkm3yWoXUzhy4rsog5ld467f7EM4CMvKC/8BRGCOiB0mCEeAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;클러스터 복제&quot;
        title=&quot;&quot;
        src=&quot;/static/c2d36b31b958437599f462997f53f6ee/f058b/cluster_repl.png&quot;
        srcset=&quot;/static/c2d36b31b958437599f462997f53f6ee/c26ae/cluster_repl.png 158w,
/static/c2d36b31b958437599f462997f53f6ee/6bdcf/cluster_repl.png 315w,
/static/c2d36b31b958437599f462997f53f6ee/f058b/cluster_repl.png 630w,
/static/c2d36b31b958437599f462997f53f6ee/40601/cluster_repl.png 945w,
/static/c2d36b31b958437599f462997f53f6ee/78612/cluster_repl.png 1260w,
/static/c2d36b31b958437599f462997f53f6ee/ad1ae/cluster_repl.png 2270w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;regional pool&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2cefe9b0203b378cae685c649dcd73de/50517/share.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.11392405063292%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACWklEQVR42pVU23KbMBDN//9Lm8e2M+lMnpy2k3ET3wDXsU1MbHORkARCgLFPVjjxJA556MNhxdHu0bK74oIXB7BO4IS12GMj9++4c/+EwPUBF3ZTVB0wBtJo5LXBVmSIVd6upckJpjMmsYLcdInV2Oke9sUVZPAV2foScvUFIrjEwfzELu9BlB/jbKafCO5Q6z4KcY1o9R1sc4Vw9QMb/xuMvEad95H+lyBB1cAsiBGwDOs0gx+lZHP8C6J2ryvmU8G0PFBwQQ47qAaI9Q5bWSJrbJ12tGdreICoD0itPReU1QtqK0YdFYY2mxPPaR1n5cmHkejGitLBNlt5LsjKBqxqsFEGj0wi1BWdTLwhng7YkphPPKv27bvNKiIfP5FtzJFv2nG6SPQeMxNhqB/Rixz8YVOMyhWeaDyWJsWA+F+JS/AwKlbwjcBSC4xNgN/E3cQOhsTPTHwcm1g38EjQUQVG1ACPPnegGAKj8FBwjJXEmOeYEJwsw8JwzDTDJBNwuG75aUZWh8dPjqk+bhHBpUIMogwuI6tSBKXCrGAYSxJKDCYWUpMgawWtuJOUGIbU+azCKH8RtI8FZeLkEbw8xijdYCACrLTGXFN2RYJ7scUdX8MlsQVxy1xhKNatr5cnbexCp8ca2qao6ojXrqbURRFsoZ9CzG7v4feHmN7cYt4fQa8juj0hdX5/8n+N7Z5DO7Sart58Afg+GtdFffeX0EfjeS1XP8zbkekcbJumvUZvwQ05xxIy5FCJIMugTmsOQePCy49xcftzePdLeoPyiMR0r8/9k8JeAOAZGH3D3teVo3EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;지역풀&quot;
        title=&quot;&quot;
        src=&quot;/static/2cefe9b0203b378cae685c649dcd73de/f058b/share.png&quot;
        srcset=&quot;/static/2cefe9b0203b378cae685c649dcd73de/c26ae/share.png 158w,
/static/2cefe9b0203b378cae685c649dcd73de/6bdcf/share.png 315w,
/static/2cefe9b0203b378cae685c649dcd73de/f058b/share.png 630w,
/static/2cefe9b0203b378cae685c649dcd73de/40601/share.png 945w,
/static/2cefe9b0203b378cae685c649dcd73de/78612/share.png 1260w,
/static/2cefe9b0203b378cae685c649dcd73de/50517/share.png 2060w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;트레이드오프&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;복제 (Cluster별 Pool):
+ 낮은 지연시간
+ 높은 가용 대역폭 (클러스터 내부)
+ 더 나은 장애 내성
- 더 많은 Memcached 서버 필요

지역화 (Regional Pool):
+ 메모리 효율적
+ 적은 서버 필요
- 더 높은 지연시간 (클러스터 간)
- 40% 낮은 가용 대역폭&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;네트워크 토폴로지 차이&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;클러스터 내부 통신:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;같은 데이터센터, 같은 랙에 위치&lt;/li&gt;
&lt;li&gt;물리적 거리가 가깝고 네트워크 홉이 적음&lt;/li&gt;
&lt;li&gt;높은 대역폭 사용 가능 (예: 10Gbps, 40Gbps 전용)&lt;/li&gt;
&lt;li&gt;빠르고 병목이 적음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;클러스터 경계 넘는 통신:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;다른 랙 또는 다른 데이터센터 간 통신&lt;/li&gt;
&lt;li&gt;여러 스위치를 거쳐야 함 (ToR → Aggregation → Core → Aggregation → ToR)&lt;/li&gt;
&lt;li&gt;물리적 거리가 멀고 네트워크 홉이 많음&lt;/li&gt;
&lt;li&gt;상위 스위치의 대역폭을 여러 클러스터가 공유&lt;/li&gt;
&lt;li&gt;느리고 동시 다량 전송 시 병목 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이러한 이유로 Regional Pool은 메모리는 절약되지만, 네트워크 성능이 저하됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제 사례&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;카테고리 A (Cluster별 복제):
- 중간 사용자 수: 30명
- 초당 GET 수: 3.26M
- 중간 값 크기: 10.7 kB

카테고리 B (Regional Pool):
- 중간 사용자 수: 1명
- 초당 GET 수: 458K
- 중간 값 크기: 4.34 kB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;카테고리 B의 Regional Pool 적합성:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;카테고리 B는 액세스 빈도가 낮아 Regional Pool의 주요 후보입니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클러스터 간 대역폭에 부정적인 영향을 주지 않음 (요청이 적음)&lt;/li&gt;
&lt;li&gt;각 클러스터의 Wildcard Pool(한 클러스터의 Memcached 풀)의 &lt;strong&gt;25%를 차지&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;메모리 절약 효과:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;예를 들어, 클러스터가 4개 있다면:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;복제 방식 (변경 전):
- 각 클러스터가 카테고리 B 데이터를 독립적으로 저장
- 같은 데이터가 4번 중복 저장됨
- Wildcard Pool의 25% × 4개 클러스터 = 전체 메모리의 큰 비중

Regional Pool 방식 (변경 후):
- 카테고리 B 데이터를 Region 전체에서 한 번만 저장
- 각 클러스터의 Wildcard Pool에서 25% 메모리 확보
- 전체 Memcached 메모리 사용량 대폭 감소&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/13dde18cedab5e8ada71fc1a03cdd999/84a90/table1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7ElEQVR42o1Qa2+DMBDj//85oO2AUA0GKyWBBCpGuvJIvOTQ9nknnfKQzz47wD9rnr+glKKepgnLskBKib7voNyptSZcsO8buGhxvzcYlITsewgh3KBE1wlqrWd0guN6zRHHEW63TzweI+qqQpq8IUsTcN4ehMYYsCzD+RQjZ4zucRTioywJVJYFXq9vAgtH6v+N2d3LYt82wnhyX9YaBNYR5jlD4pVYiqJ4R+oUm6ZxI/bP8vOpCReFIdn0NY4DLpezW+aEdV2ODb2SlB3quiKbvG3Jplc+NrPU67oeGbq8fJ6+fBTDoCiuX8IfGrl6j0yzpEIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;클러스터 vs 지역 복제 결정 요인&quot;
        title=&quot;&quot;
        src=&quot;/static/13dde18cedab5e8ada71fc1a03cdd999/f058b/table1.png&quot;
        srcset=&quot;/static/13dde18cedab5e8ada71fc1a03cdd999/c26ae/table1.png 158w,
/static/13dde18cedab5e8ada71fc1a03cdd999/6bdcf/table1.png 315w,
/static/13dde18cedab5e8ada71fc1a03cdd999/f058b/table1.png 630w,
/static/13dde18cedab5e8ada71fc1a03cdd999/40601/table1.png 945w,
/static/13dde18cedab5e8ada71fc1a03cdd999/84a90/table1.png 982w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;의사결정 방식:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;현재 Regional Pool로 데이터를 마이그레이션하는 결정은 &lt;strong&gt;수동 휴리스틱&lt;/strong&gt;에 기반합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;액세스 속도&lt;/strong&gt;: 얼마나 자주 요청되는가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;데이터 세트 크기&lt;/strong&gt;: 데이터가 얼마나 큰가?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;고유 사용자 수&lt;/strong&gt;: 몇 명의 사용자가 접근하는가?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;자동화된 알고리즘이 아닌, 실제 운영 경험과 이러한 기준들을 보고 &lt;strong&gt;운영자가 직접 판단&lt;/strong&gt;하여 결정합니다. 예를 들어, 크고 드물게 접근되며 소수의 사용자만 사용하는 데이터는 Regional Pool에 넣는 것이 효율적입니다.&lt;/p&gt;
&lt;h3&gt;콜드 클러스터 워밍업&lt;/h3&gt;
&lt;p&gt;새 클러스터를 배포하거나, 기존 클러스터가 장애로 재시작되거나, 예정된 유지보수를 수행할 때 캐시는 매우 낮은 히트율을 가지게 되어 백엔드 서비스를 보호하는 능력이 감소합니다.&lt;/p&gt;
&lt;h4&gt;Cold Cluster Warmup 시스템&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Cold Cluster&lt;/strong&gt;(캐시가 비어있는 Frontend Cluster)의 클라이언트가 &lt;strong&gt;DB&lt;/strong&gt;가 아닌 &lt;strong&gt;Warm Cluster&lt;/strong&gt;(정상 히트율을 가진 클러스터)에서 데이터를 검색할 수 있도록 합니다.&lt;/p&gt;
&lt;p&gt;이 시스템을 통해 Cold Cluster는 며칠이 아닌 &lt;strong&gt;몇 시간 만에&lt;/strong&gt; 전체 용량으로 복구될 수 있습니다.&lt;/p&gt;
&lt;h4&gt;Race Condition 방지&lt;/h4&gt;
&lt;p&gt;Cold Cluster Warmup 과정에서 &lt;strong&gt;Region 간 DB 복제 지연&lt;/strong&gt;으로 인한 stale data 문제가 발생할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;전제 조건:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;미국 Region:
- Cold Cluster (캐시 비어있음)
- Storage Cluster (MySQL)

유럽 Region:
- Warm Cluster (정상 캐시)
- Storage Cluster (MySQL)

중요: 미국 MySQL ↔ 유럽 MySQL은 비동기 복제 (수초~수분 지연)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;문제 시나리오:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;사용자 A가 미국에서 프로필 사진을 &quot;old.jpg&quot;에서 &quot;new.jpg&quot;로 변경하는 상황&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[시간 0ms] 미국에서 프로필 사진 변경
- 사용자 A: 미국 MySQL에 업데이트 (user:1 = &quot;new.jpg&quot;)
- 미국 mcsqueal: DELETE 명령을 전세계 모든 캐시에 브로드캐스트

[시간 50ms] 캐시 무효화 완료 (빠름!)
- 미국 Cold Cluster 캐시: 삭제됨 ✓
- 유럽 Warm Cluster 캐시: 삭제됨 ✓

[시간 100ms] 사용자 B가 미국 Cold Cluster에서 프로필 사진 조회
1. 미국 Cold Cluster 캐시 조회 → 미스 (이미 삭제됨)
2. Cold Cluster Warmup 로직 발동
   → Warm Cluster(유럽)에서 데이터 가져오기 시도
3. 유럽 Warm Cluster 캐시 조회 → 미스 (이미 삭제됨)
4. 유럽 MySQL 조회
   → 문제: 아직 미국→유럽 MySQL 복제가 안됨!
   → 유럽 MySQL에는 여전히 &quot;old.jpg&quot;
5. &quot;old.jpg&quot;를 미국 Cold Cluster 캐시에 저장

[시간 3초] MySQL 복제 완료 (느림!)
- 유럽 MySQL: &quot;new.jpg&quot;로 업데이트됨
- 하지만 미국 Cold Cluster 캐시에는 여전히 &quot;old.jpg&quot; (stale data!)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 문제:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;캐시 무효화는 빠름&lt;/strong&gt; (밀리초 단위로 전세계 전파)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL 복제는 느림&lt;/strong&gt; (수초~수분 소요)&lt;/li&gt;
&lt;li&gt;이 시간 차이 때문에 Warm Cluster에서 옛날 데이터를 가져와 Cold Cluster에 저장하는 문제 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Hold-off 메커니즘: Race Condition 해결&lt;/h4&gt;
&lt;p&gt;위에서 설명한 Race Condition 문제를 해결하기 위해 &lt;strong&gt;Hold-off 메커니즘&lt;/strong&gt;을 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;해결 원리:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Memcached DELETE 명령은 &lt;strong&gt;Hold-off 시간&lt;/strong&gt;을 지정할 수 있습니다. Hold-off 시간 동안 해당 키에 대한 &lt;strong&gt;ADD 연산을 거부&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 1. Cold Cluster의 모든 DELETE는 2초 hold-off로 발행&lt;/span&gt;
memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; holdOffSeconds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 2. Cold Cluster에서 미스 감지 시&lt;/span&gt;
value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; coldCluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 3. Warm Cluster에서 재요청&lt;/span&gt;
    value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; warmCluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 4. Cold Cluster에 ADD 시도&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; success &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; coldCluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// ADD 실패 = hold-off 중 = 더 최신 데이터 존재&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 5. DB에서 다시 조회&lt;/span&gt;
        value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Race Condition 방지 과정:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;[0ms]&lt;/strong&gt; 미국에서 프로필 사진 변경 (user:1 = &quot;new.jpg&quot;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[50ms]&lt;/strong&gt; mcsqueal이 DELETE 명령 브로드캐스트 (2초 hold-off 포함)
&lt;ul&gt;
&lt;li&gt;미국 Cold Cluster 캐시 삭제 + 2초간 ADD 금지&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[100ms]&lt;/strong&gt; 사용자 B가 미국 Cold Cluster에서 조회
&lt;ul&gt;
&lt;li&gt;Cold Cluster 미스 → Warm Cluster(유럽) 조회&lt;/li&gt;
&lt;li&gt;유럽 캐시 미스 → 유럽 MySQL 조회 (아직 &quot;old.jpg&quot;)&lt;/li&gt;
&lt;li&gt;Cold Cluster에 ADD 시도 → &lt;strong&gt;실패&lt;/strong&gt; (hold-off 중!)&lt;/li&gt;
&lt;li&gt;DB(미국 MySQL) 직접 조회 → &quot;new.jpg&quot; 획득&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[3초]&lt;/strong&gt; MySQL 복제 완료 (유럽 MySQL도 &quot;new.jpg&quot;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;결과:&lt;/strong&gt; Hold-off 덕분에 stale 데이터(&quot;old.jpg&quot;)가 캐시에 저장되지 않고, 최신 데이터(&quot;new.jpg&quot;)를 DB에서 직접 가져옵니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;트레이드오프:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;DELETE가 2초 이상 지연될 이론적 가능성은 있지만, 대다수의 경우에는 해당되지 않습니다. Cold Cluster Warmup의 운영상 이점이 드문 캐시 일관성 문제의 비용보다 훨씬 큽니다. Cold Cluster의 히트율이 안정화되고 이점이 감소하면 이 기능을 끕니다.&lt;/p&gt;
&lt;h2&gt;지역 간 확장: 일관성&lt;/h2&gt;
&lt;h3&gt;지리적 분산의 이점&lt;/h3&gt;
&lt;p&gt;데이터 센터를 더 넓은 지리적 영역에 배치하면 여러 이점이 있습니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;지연시간 감소&lt;/strong&gt;: 웹서버를 최종 사용자에게 가까이 배치&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;지리적 다양성&lt;/strong&gt;: 자연재해나 대규모 정전 같은 이벤트의 영향 완화&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;경제적 인센티브&lt;/strong&gt;: 더 저렴한 전력 및 기타 경제적 혜택&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Facebook은 여러 Region에 배포하여 이러한 이점을 얻습니다. 각 Region은 Storage Cluster와 여러 Frontend Cluster로 구성됩니다.&lt;/p&gt;
&lt;h3&gt;마스터-복제본 아키텍처&lt;/h3&gt;
&lt;p&gt;하나의 Region을 마스터 데이터베이스를 보유하도록 지정하고, 다른 Region은 읽기 전용 복제본을 포함하도록 합니다. MySQL의 복제 메커니즘을 사용하여 복제 데이터베이스를 마스터와 최신 상태로 유지합니다.&lt;/p&gt;
&lt;p&gt;이 설계에서 웹서버는 로컬 Memcached 서버나 로컬 데이터베이스 복제본에 액세스할 때 낮은 지연시간을 경험합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;주요 기술적 과제&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;여러 Region에 걸쳐 확장할 때, Memcache의 데이터와 DB 간의 &lt;strong&gt;일관성 유지&lt;/strong&gt;가 주요 기술적 과제가 됩니다. 이러한 문제는 &lt;strong&gt;복제 데이터베이스가 마스터 데이터베이스보다 뒤처질 수 있다&lt;/strong&gt;는 단일 문제에서 비롯됩니다.&lt;/p&gt;
&lt;h3&gt;일관성 모델의 철학&lt;/h3&gt;
&lt;p&gt;Facebook의 시스템은 일관성과 성능 트레이드오프 스펙트럼의 한 지점을 나타냅니다. 일관성 모델은 사이트의 규모에 맞게 수년에 걸쳐 진화했습니다.&lt;/p&gt;
&lt;p&gt;시스템이 관리하는 대량의 데이터는 네트워크나 스토리지 요구사항을 증가시키는 사소한 변경도 막대한 비용이 든다는 것을 의미합니다. 더 엄격한 의미론을 제공하는 대부분의 아이디어는 비용이 너무 비싸서 설계 단계를 거의 벗어나지 못합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;설계 목표&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;사용자 대면 또는 운영 문제에 영향을 미치는 변경만 수행&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;일시적으로 stale한 데이터를 읽을 확률&lt;/strong&gt;을 조정 가능한 매개변수로 취급 (응답성과 유사)&lt;/li&gt;
&lt;li&gt;백엔드 스토리지 서비스를 과도한 부하로부터 보호하기 위해 약간 stale한 데이터 노출 허용&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Facebook은 &lt;strong&gt;Best-effort Eventual Consistency&lt;/strong&gt;를 제공하지만 성능과 가용성을 강조합니다.&lt;/p&gt;
&lt;h3&gt;마스터 Region에서의 쓰기 처리&lt;/h3&gt;
&lt;p&gt;Storage Cluster가 데몬을 통해 데이터를 무효화하도록 요구하는 초기 결정은 다중 Region 아키텍처에서 중요한 결과를 가져옵니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Race Condition 방지&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;무효화가 데이터가 마스터 Region에서 복제되기 전에 도착하는 Race Condition을 피합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;문제가 되는 시나리오 (웹서버가 직접 무효화):
1. 마스터 Region 웹서버: DB 수정 완료
2. 웹서버: 복제본 Region에 무효화 전송
3. 복제본 Region: 캐시에서 데이터 삭제
4. 복제본 Region 클라이언트: 데이터 조회 (캐시 미스)
5. 복제본 DB 조회 → 아직 복제 안됨 (stale 데이터)
6. Stale 데이터를 캐시에 저장

안전한 방법 (mcsqueal 사용):
1. 마스터 Region 웹서버: DB 수정 + 무효화 키 포함
2. 마스터 DB: 트랜잭션 커밋 + 로그 기록
3. 복제 스트림: 복제본 Region으로 전파
4. 복제본 DB: 데이터 업데이트
5. mcsqueal: 복제 스트림에서 무효화 추출
6. mcsqueal: 복제본 Region Memcache 무효화&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Lease로 Race Condition 방지:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;문제가 되는 시나리오의 4-6단계에서 발생할 수 있는 Race Condition은 &lt;strong&gt;Lease 메커니즘&lt;/strong&gt;으로 해결됩니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;[단계 4]&lt;/strong&gt; 복제본 Region 클라이언트가 캐시 미스 시 &lt;strong&gt;lease 발급&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;복제본 DB에서 stale 데이터 조회&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[단계 2 이후]&lt;/strong&gt; mcsqueal의 DELETE 명령이 도착하면 &lt;strong&gt;해당 키의 모든 outstanding lease 무효화&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[단계 6]&lt;/strong&gt; 클라이언트가 stale 데이터를 ADD/SET 시도
&lt;ul&gt;
&lt;li&gt;Lease가 무효화되어 있으면 &lt;strong&gt;실패&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;실패 시 다시 DB 조회 (이때는 복제 완료되어 최신 데이터)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이를 통해 복제 타이밍과 무관하게 stale 데이터가 캐시에 저장되는 것을 방지합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;mcsqueal을 사용하는 이유:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Lease만으로도 stale 데이터 캐싱을 방지할 수 있지만, mcsqueal을 사용하는 이유는:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;순서 보장&lt;/strong&gt;: MySQL 복제 스트림에서 무효화를 추출하므로 DB 업데이트 후 무효화 순서 보장&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;웹서버 부하 감소&lt;/strong&gt;: 여러 Region에 무효화 요청을 보내는 오버헤드 제거&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;안정적인 전파&lt;/strong&gt;: 복제 스트림 기반이므로 네트워크 일시 장애에도 결국 무효화 전파 보장&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Lease는 최후의 방어선, mcsqueal은 설계상 안전성을 제공합니다.&lt;/p&gt;
&lt;h3&gt;비마스터 Region에서의 쓰기 처리&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;문제 시나리오:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;사용자가 유럽 Region(비마스터)에서 프로필 사진을 &quot;old.jpg&quot; → &quot;new.jpg&quot;로 변경:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;[0ms]&lt;/strong&gt; 유럽 웹서버가 미국 마스터 DB에 쓰기 (user:1 = &quot;new.jpg&quot;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[100ms]&lt;/strong&gt; 미국 마스터 DB 업데이트 완료 (user:1 = &quot;new.jpg&quot;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[200ms]&lt;/strong&gt; 사용자가 페이지 새로고침 (유럽에서 조회)
&lt;ul&gt;
&lt;li&gt;유럽 캐시 미스 → 유럽 DB 조회&lt;/li&gt;
&lt;li&gt;문제: 미국→유럽 MySQL 복제가 아직 안 됨 (수초 소요)&lt;/li&gt;
&lt;li&gt;유럽 DB에는 여전히 &quot;old.jpg&quot; → 캐시에 &quot;old.jpg&quot; 저장&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;[3초]&lt;/strong&gt; MySQL 복제 완료 (유럽 DB도 &quot;new.jpg&quot;), 하지만 캐시에는 &quot;old.jpg&quot; (stale 데이터)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;핵심 문제:&lt;/strong&gt; 비마스터 Region에서 업데이트 후 즉시 조회하면, 로컬 DB 복제가 완료되기 전에 stale 데이터를 캐싱할 수 있습니다.&lt;/p&gt;
&lt;h4&gt;Remote Marker 메커니즘&lt;/h4&gt;
&lt;p&gt;위 문제를 해결하기 위해 &lt;strong&gt;Remote Marker&lt;/strong&gt;를 사용합니다. 핵심 아이디어는 &lt;strong&gt;&quot;이 데이터를 방금 수정했다&quot;는 표시를 남겨두는 것&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 원리 (구체적 예시):&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;유럽에서 프로필 사진을 &quot;old.jpg&quot; → &quot;new.jpg&quot;로 변경하는 경우:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[쓰기 시]&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Regional Pool에 marker 설정&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;r:user:1 = &quot;1&quot;&lt;/code&gt; (유럽 Region 전체에서 공유)
&lt;ul&gt;
&lt;li&gt;&quot;user:1을 방금 수정했다&quot;는 표시&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;미국 마스터 DB 업데이트&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;user:1 = &quot;new.jpg&quot;&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;무효화 키에 &lt;code class=&quot;language-text&quot;&gt;user:1&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;r:user:1&lt;/code&gt; 포함 (mcsqueal이 나중에 처리)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;유럽 로컬 캐시 삭제&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;user:1&lt;/code&gt; 삭제&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;[200ms 후 조회 시]&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;유럽 로컬 캐시 조회 → 미스 (방금 삭제했으므로)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Regional Pool에서 marker 확인&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;r:user:1&lt;/code&gt; 존재하는가?
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;존재함&lt;/strong&gt; → &quot;아, 방금 수정된 데이터구나. 로컬 DB는 아직 복제 안 됐을 수 있음&quot;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;미국 마스터 Region에 직접 쿼리&lt;/strong&gt; → &quot;new.jpg&quot; 획득 (정확한 데이터!)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Marker가 없었다면 → 유럽 로컬 DB 조회 (stale 위험)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;[3초 후 - 복제 완료 시]&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mcsqueal이 &lt;code class=&quot;language-text&quot;&gt;r:user:1&lt;/code&gt; marker 무효화&lt;/li&gt;
&lt;li&gt;이후 조회는 유럽 로컬 DB에서 안전하게 조회 가능 (복제 완료되었으므로)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;핵심:&lt;/strong&gt; Remote Marker는 &lt;code class=&quot;language-text&quot;&gt;&quot;복제가 완료될 때까지 마스터에 직접 물어보라&quot;&lt;/code&gt;는 임시 신호등 역할을 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;트레이드오프:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;캐시 미스 시 마스터 Region 쿼리로 인한 추가 지연시간 발생, 하지만 stale 데이터 방지.&lt;/p&gt;
&lt;h3&gt;운영상 고려사항&lt;/h3&gt;
&lt;p&gt;지역 간 통신은 데이터가 큰 지리적 거리(예: 미국 대륙 횡단)를 이동해야 하므로 비용이 많이 듭니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;네트워크 효율성:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;DELETE 스트림을 데이터베이스 복제와 동일한 통신 채널로 공유함으로써 낮은 대역폭 연결에서 네트워크 효율성을 얻습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;mcsqueal 배포 위치:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;mcsqueal은 각 Region의 복제 DB와 함께 배포됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;미국 마스터 DB에서 &lt;code class=&quot;language-text&quot;&gt;UPDATE user:1 = &quot;new.jpg&quot;&lt;/code&gt; 실행&lt;/li&gt;
&lt;li&gt;MySQL은 이 변경사항을 &lt;strong&gt;바이너리 로그&lt;/strong&gt;(transaction log)에 기록&lt;/li&gt;
&lt;li&gt;유럽 MySQL 복제본이 이 바이너리 로그를 받아서 자신의 DB에 반영&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;유럽의 mcsqueal&lt;/strong&gt;이 유럽 MySQL 바이너리 로그를 읽음&lt;/li&gt;
&lt;li&gt;무효화 키(&lt;code class=&quot;language-text&quot;&gt;user:1&lt;/code&gt;) 추출 → 유럽 Memcache에 DELETE 전송&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;즉, mcsqueal은 로컬 DB의 변경 로그를 읽어서 로컬 캐시를 무효화합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;장애 시 버퍼링 메커니즘:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Memcache 서버나 네트워크에 일시적 장애가 발생하면:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mcsqueal이 Memcache에 DELETE를 보내려 했지만 Memcache 서버가 다운됨&lt;/li&gt;
&lt;li&gt;DELETE가 전달되지 않음 → 캐시가 무효화되지 않음&lt;/li&gt;
&lt;li&gt;이후 조회 시 stale 데이터를 읽을 위험 증가&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;해결 방법:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mcrouter와 DB가 DELETE 명령을 &lt;strong&gt;메모리에 버퍼링&lt;/strong&gt;(임시 저장)&lt;/li&gt;
&lt;li&gt;Memcache 서버가 복구되면 &lt;strong&gt;버퍼링된 DELETE를 모두 재전송&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;결국 캐시 무효화 보장&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;다른 접근법과 비교:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;클러스터 오프라인 전환&lt;/strong&gt;: 장애 감지 시 클러스터 전체를 중단 → 서비스 중단으로 인한 손실이 더 큼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;과도한 무효화&lt;/strong&gt;: 모든 캐시를 다 삭제 → DB 부하 폭증&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Facebook은 일시적인 stale 데이터 노출을 허용하되, 버퍼링으로 결국 일관성을 보장하는 방식을 선택했습니다.&lt;/p&gt;
&lt;h2&gt;단일 서버 성능 개선&lt;/h2&gt;
&lt;p&gt;All-to-All 통신 패턴은 단일 서버가 클러스터의 병목이 될 수 있음을 의미합니다. 이 섹션에서는 Memcached의 성능 최적화와 메모리 효율성 향상을 설명합니다. 클러스터 내에서 더 나은 확장을 가능하게 합니다.&lt;/p&gt;
&lt;h3&gt;성능 최적화&lt;/h3&gt;
&lt;p&gt;Facebook은 고정 크기 해시 테이블을 사용하는 단일 스레드 Memcached로 시작했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;초기 주요 최적화&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;해시 테이블 자동 확장&lt;/strong&gt;: 조회 시간이 O(n)으로 늘어나는 것 방지&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;멀티스레드 지원&lt;/strong&gt;: 글로벌 락으로 여러 데이터 구조 보호&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스레드별 UDP 포트&lt;/strong&gt;: 응답 전송 시 경합 감소 및 인터럽트 처리 오버헤드 분산&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;처음 두 최적화는 오픈소스 커뮤니티에 기여되었습니다.&lt;/p&gt;
&lt;h4&gt;Fine-grained Locking&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;문제:&lt;/strong&gt; 기존 Memcached는 전체 해시 테이블에 &lt;strong&gt;하나의 락&lt;/strong&gt;(Global Lock)을 사용했습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;여러 스레드가 서로 다른 키에 접근해도 같은 락을 놓고 경쟁&lt;/li&gt;
&lt;li&gt;멀티코어 환경에서 병목 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;해결:&lt;/strong&gt; 해시 테이블을 여러 파티션으로 나누고 &lt;strong&gt;각 파티션마다 독립적인 락&lt;/strong&gt; 부여&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;스레드 A가 &lt;code class=&quot;language-text&quot;&gt;user:1&lt;/code&gt; 접근, 스레드 B가 &lt;code class=&quot;language-text&quot;&gt;user:2&lt;/code&gt; 접근 시 서로 다른 락 사용 가능&lt;/li&gt;
&lt;li&gt;락 경합 감소 → 병렬성 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;성능 테스트 결과&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;테스트 환경:
- Intel Xeon CPU (X5650) @ 2.67GHz
- 12코어 + 12 하이퍼스레드
- Intel 82574L 기가비트 이더넷
- 12GB 메모리
- 15개 클라이언트 → 1개 서버 (24 스레드)

10-key Multiget 성능 (1ms 이하 평균 응답 시간):

히트:
- 원래 멀티스레드: 600K items/초
- Fine-grained locking: 1.8M items/초 (3배 향상)

미스:
- 원래 멀티스레드: 2.7M items/초
- Fine-grained locking: 4.5M items/초&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 캐시 히트가 미스보다 느린가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Multiget 요청: &lt;code class=&quot;language-text&quot;&gt;GET user:1, user:2, user:3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;히트 (600K items/초):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;각 키의 값을 메모리에서 읽기&lt;/li&gt;
&lt;li&gt;각 값을 응답 패킷으로 구성&lt;/li&gt;
&lt;li&gt;네트워크로 전송&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;VALUE user:1 &quot;profile_data_1&quot;
VALUE user:2 &quot;profile_data_2&quot;
VALUE user:3 &quot;profile_data_3&quot;
END&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;미스 (2.7M items/초):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;해시 테이블 조회만 하고 값이 없음을 확인&lt;/li&gt;
&lt;li&gt;간단한 응답 하나만 전송&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;END&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;히트는 실제 데이터를 읽고 전송해야 하므로 더 많은 작업이 필요합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0e2626eff41c0053a6c4cda1114c9eae/cc488/figure7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAklEQVR42pVTTW/TQBDNz+JvwA/okXtVFTU9RIILCKlCqkRBKiCFUw+olXoEtYIWKakrtQXXcRM1dmI7tuM4id04/oqdx+46cRIkDqz17PXszpuZt7MFYAqK6TQloPNsZPP/R4ES0WFZXbTbLYRhwJAkE0wmMcMsxMrzT8J5dnEcEYRoNNv4LdQhigIcx4Hv+zPCdOaEFYKssgw5Yb1+B0G4hec9QO3oUDQDtZpASEX4gZ+TRHGM0dgn2Sd/ZYbVDDnuAtVqBYNBH647RByFSNIJWSKOJHKSJszlhLtHaf8MUsfOSfwggNEbIIwiZinQF8/zUFWFGTzPY19Js1G9VTD2gzyLb5yErfc/0VTt/PCqvIJne2cQ5e6ccIqbm2ucnp5A01RCkJV4+F3E5rtzGNaQ2S6uBJSPOZQ+VghhLyes8Co2984XhFRMmp1t20zYh9GImBMc/bjD9n4FfcdDrdHCoydFrG2X8bx8SUrus33rLz5g680himSf0DQXGdIREC2CYIxrvo7Szme8/vQVb49+wR6OICk61jZ2USTOu1+uoPdc9AcOHj99ifVXB9g5uES9tVTyom0iJnLjXobcVmBaFutD1qOKAt0wYHYtWD0LKTkoqrdpmrBIdely2ywfP70hht6BLEtks465JC3yr3c0orPCLgANlKYpC+a6Tt6rfwBZYDNiD5jkwQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Memcached 버전별 성능 비교&quot;
        title=&quot;&quot;
        src=&quot;/static/0e2626eff41c0053a6c4cda1114c9eae/f058b/figure7.png&quot;
        srcset=&quot;/static/0e2626eff41c0053a6c4cda1114c9eae/c26ae/figure7.png 158w,
/static/0e2626eff41c0053a6c4cda1114c9eae/6bdcf/figure7.png 315w,
/static/0e2626eff41c0053a6c4cda1114c9eae/f058b/figure7.png 630w,
/static/0e2626eff41c0053a6c4cda1114c9eae/cc488/figure7.png 928w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;UDP vs TCP 성능&lt;/h4&gt;
&lt;p&gt;UDP 구현이 TCP 구현보다 성능이 우수합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Single GET&lt;/strong&gt;: 13% 향상&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;10-key Multiget&lt;/strong&gt;: 8% 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1930e6ecbbf86f89215cff09ad855e77/c6bbc/figure8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVR42nWSz2/SYBjH+Zu8eXE3L5rdTMw8ePDHwUQXj3rY0MlAZmJiYjxo2JwjsigZspmQTY2MyIDFihiBbgYXxuhWuvUno4W2X9+3XcEt+iRP8rZP+3me5/t+fbZtwbJM6HoHtm0DoOmF/Z/8V7g1Hz1SYLlchiSJECUZnc6hc+71uifAgG4YkBQViqqhWN1GmvmN7PctaO2OU/fJsoRqtQLTNB1IoVhBlWWRy62Rd70+0CRNaSykvmD4eggjo49wK7wA/0sG/kgWXEt0gTs7DaRSKWcqUdzHdnMP9XodtVoNhqE7MCqLB4wmPuP0hXGcvTyBm+EEwvM/EIyuY1eQXKAgtJDP57CxwToT0vWpll564QFjyTTOjNzDuSsBMmECoVgJwbnCANhq8chkVtHtGtA0lQAtd0kCM4heuq6TWncAXFzF0KX7OH91EqNTCTycLyEU/QvI8zwYhnE0bGsKnswkcWPsOW4/iCAwncbk3Dpm3hedhjRm459wavgOhi6O4drEW/hnv2E8khto6Gkkigc4bKuYfvMBd6eiCD6LI7ZSwuuPFSznN0lD98azX38i8DSOxy/e4dVSAUtrW0hmWIiydhxILeLpR+NgX0CL3z1a3+pbh575PQ7NRh1cs4Ffm6zz7H3nO2la72dVVYjXlCPTHK+rqgpBECArMjiOI5cp9e31B51p0aS+VASUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;GET 성능: TCP vs UDP&quot;
        title=&quot;&quot;
        src=&quot;/static/1930e6ecbbf86f89215cff09ad855e77/f058b/figure8.png&quot;
        srcset=&quot;/static/1930e6ecbbf86f89215cff09ad855e77/c26ae/figure8.png 158w,
/static/1930e6ecbbf86f89215cff09ad855e77/6bdcf/figure8.png 315w,
/static/1930e6ecbbf86f89215cff09ad855e77/f058b/figure8.png 630w,
/static/1930e6ecbbf86f89215cff09ad855e77/c6bbc/figure8.png 910w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;Multiget vs Single GET&lt;/h4&gt;
&lt;p&gt;Multiget은 각 요청에 더 많은 데이터를 포함하므로 동일한 작업에 더 적은 패킷을 사용합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;10-key Multiget&lt;/strong&gt;: Single GET 대비 약 &lt;strong&gt;4배 향상&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;적응형 슬랩 할당자 (Adaptive Slab Allocator)&lt;/h3&gt;
&lt;p&gt;Memcached는 메모리를 관리하기 위해 &lt;strong&gt;Slab Allocator&lt;/strong&gt;를 사용합니다.&lt;/p&gt;
&lt;h4&gt;기본 Slab Allocator&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;비유: 크기별로 나눠진 주차장&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Memcached는 메모리를 &lt;strong&gt;크기별로 미리 나눠진 주차 공간&lt;/strong&gt;(Slab Class)으로 관리합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Slab Class 구성:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Class 1&lt;/strong&gt;: 64 bytes 크기 칸 (작은 오토바이용)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Class 2&lt;/strong&gt;: 68 bytes 크기 칸 (64 × 1.07)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Class 3&lt;/strong&gt;: 73 bytes 크기 칸 (68 × 1.07)&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Class N&lt;/strong&gt;: 1 MB 크기 칸 (대형 트럭용)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;동작 원리:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;저장할 데이터가 50 bytes라면:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;50 bytes를 담을 수 있는 &lt;strong&gt;가장 작은 Class&lt;/strong&gt; 찾기 → Class 1 (64 bytes)&lt;/li&gt;
&lt;li&gt;Class 1의 빈 칸에 저장 (14 bytes는 낭비)&lt;/li&gt;
&lt;li&gt;Class 1의 빈 칸이 없으면 → 1MB 메모리를 새로 요청해서 64 bytes 칸으로 나눔&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;제거 정책 (LRU):&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;전체 메모리가 꽉 차면:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;새 50 bytes 데이터를 저장하려면 &lt;strong&gt;Class 1 내에서만&lt;/strong&gt; 가장 오래된 데이터 제거&lt;/li&gt;
&lt;li&gt;Class 2, 3에 빈 공간이 많아도 사용 불가 (크기가 안 맞음)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;문제점:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;초기에는 작은 데이터가 많아서 Class 1에 메모리를 많이 할당했는데, 나중에 큰 데이터가 많아지면:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Class 1은 빈 공간 많음 (낭비)&lt;/li&gt;
&lt;li&gt;Class N은 공간 부족 (히트율 하락)&lt;/li&gt;
&lt;li&gt;하지만 메모리를 Class 간에 옮길 수 없음!&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;적응형 할당자&lt;/h4&gt;
&lt;p&gt;기본 Slab Allocator의 문제(Class 간 메모리 이동 불가)를 해결하기 위해 &lt;strong&gt;메모리 재균형&lt;/strong&gt; 메커니즘을 추가했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;재할당이 필요한 상황 판단:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;구체적인 예시:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Class 1 (64B)&lt;/strong&gt;: 가장 오래된 데이터가 10분 전에 사용됨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Class N (1MB)&lt;/strong&gt;: 가장 오래된 데이터가 1분 전에 사용됨 (계속 제거 중)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;조건 1&lt;/strong&gt;: Class N이 공간 부족으로 LRU 제거 중
&lt;strong&gt;조건 2&lt;/strong&gt;: Class N의 제거 대상(1분 전)이 Class 1의 LRU(10분 전)보다 &lt;strong&gt;20% 이상 최신&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Class 1: 10분 = 600초&lt;/li&gt;
&lt;li&gt;Class N: 1분 = 60초&lt;/li&gt;
&lt;li&gt;60초는 600초보다 훨씬 최신 (90% 더 최신)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;결론&lt;/strong&gt;: Class N이 더 중요한 데이터를 제거하고 있음 → 메모리 재할당 필요&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;재할당 동작:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Class 1(빈 공간 많음)에서 1MB Slab을 빼앗아 Class N에게 할당&lt;/li&gt;
&lt;li&gt;Class N은 이제 더 많은 공간 확보&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;오픈소스와의 차이&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;오픈소스 커뮤니티는 Slab Class 간 제거율을 균형 잡는 유사한 할당자를 독립적으로 구현했습니다. Facebook의 알고리즘은 &lt;strong&gt;가장 오래된 아이템의 나이&lt;/strong&gt;를 균형 잡는 데 초점을 맞춥니다.&lt;/p&gt;
&lt;p&gt;나이를 균형 잡는 것이 제거율을 조정하는 것보다 전체 서버에 대한 단일 글로벌 LRU 제거 정책을 더 잘 근사합니다.&lt;/p&gt;
&lt;h3&gt;임시 아이템 캐시 (Transient Item Cache)&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;실시간 이벤트(예: 라이브 스포츠 경기, 콘서트)가 있을 때:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;수백만 명이 동시에 &quot;실시간 점수&quot; 데이터 조회&lt;/li&gt;
&lt;li&gt;이 데이터는 30초마다 갱신 (30초 만료 시간 설정)&lt;/li&gt;
&lt;li&gt;이벤트 종료 후에는 아무도 조회하지 않음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;기존 방식의 문제 (Lazy Eviction):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[10:00] 실시간 점수 캐시 (만료: 30초 후)
[10:00:30] 만료됨! 하지만 메모리에는 그대로 남아있음
[10:01] 아무도 조회 안 함 → 만료 확인 안 함 → 메모리 낭비 계속
[10:02] 아무도 조회 안 함 → 여전히 메모리 차지
...
[11:00] LRU 끝에 도달해야 비로소 삭제&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이벤트가 끝났는데도 1시간 동안 메모리의 6%를 낭비!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;해결 방법: Circular Buffer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;시계처럼 돌아가는 원형 버퍼 (예: 3600개 버킷 = 1시간 분량):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;현재 시각: 10:00:00

버킷 인덱스:  [0] [1] [2] [3] ... [30] ... [3599]
               ↑ 헤드 (현재 초)

저장 시:
- 데이터 A (만료: 10초 후) → 버킷[10]에 삽입
- 실시간 점수 (만료: 30초 후) → 버킷[30]에 삽입
- 데이터 B (만료: 100초 후) → 버킷[100]에 삽입

매 초마다:
[10:00:01] 헤드 이동 → 버킷[1] 삭제
[10:00:02] 헤드 이동 → 버킷[2] 삭제
...
[10:00:10] 헤드 이동 → 버킷[10] 삭제 (데이터 A 정확히 10초 후 삭제!)
...
[10:00:30] 헤드 이동 → 버킷[30] 삭제 (실시간 점수 정확히 30초 후 삭제!)
...
[10:01:40] 헤드 이동 → 버킷[100] 삭제 (데이터 B 정확히 100초 후 삭제!)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심&lt;/strong&gt;: 각 버킷은 &quot;몇 초 후 만료&quot;를 나타내며, 헤드가 그 버킷에 도달하면 정확히 만료 시간이 된 것입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;저장 구조:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Memcache 해시 테이블&lt;/strong&gt;: 실제 데이터 저장 (key → value)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Circular Buffer 버킷&lt;/strong&gt;: 해시 테이블 아이템의 &lt;strong&gt;포인터(참조)만&lt;/strong&gt; 저장&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;해시 테이블:
user:1 → &quot;점수 데이터&quot; (메모리 주소: 0x1234)

Circular Buffer 버킷[30]:
→ 0x1234 (포인터만 저장)

삭제 시:
버킷[30] 도달 → 0x1234 주소의 데이터를 해시 테이블에서 삭제&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;효과:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;만료 즉시 메모리 해제 (1시간 기다릴 필요 없음)&lt;/li&gt;
&lt;li&gt;메모리 사용: 6% → 0.3% (20배 개선)&lt;/li&gt;
&lt;li&gt;히트율: 영향 없음 (어차피 만료된 데이터)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;소프트웨어 업그레이드&lt;/h3&gt;
&lt;p&gt;업그레이드, 버그 수정, 임시 진단 또는 성능 테스트를 위해 빈번한 소프트웨어 변경이 필요할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Memcached 서버는 피크 히트율의 90%에 도달하는 데 몇 시간이 걸릴 수 있습니다. 결과적으로 Memcached 서버 세트를 업그레이드하는 데 12시간 이상이 걸릴 수 있으며, 그 결과 발생하는 데이터베이스 부하를 신중하게 관리해야 합니다.&lt;/p&gt;
&lt;h4&gt;공유 메모리 방식&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;일반 메모리 vs 공유 메모리:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;일반 메모리 (프로세스 전용):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;프로세스 A가 할당한 메모리는 프로세스 A만 사용&lt;/li&gt;
&lt;li&gt;프로세스 종료 시 메모리도 함께 삭제됨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;System V 공유 메모리 (OS 관리 영역):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OS가 관리하는 특별한 메모리 영역&lt;/li&gt;
&lt;li&gt;여러 프로세스가 공유 가능&lt;/li&gt;
&lt;li&gt;프로세스 종료해도 메모리는 OS에 남아있음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Memcached 개선:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;각 Memcached 서버에서 데이터를 저장할 때:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;기존 방식 (일반 메모리):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Memcached 프로세스 (PID: 1234)
└─ 일반 메모리 할당
   └─ user:1 → &quot;profile data&quot;
   └─ user:2 → &quot;settings&quot;

프로세스 종료 → 메모리 전부 삭제됨
새 프로세스 시작 → 캐시 비어있음 (워밍업 12시간 필요)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;개선 방식 (공유 메모리):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;OS 공유 메모리 영역 (ID: 9999)
├─ user:1 → &quot;profile data&quot;
├─ user:2 → &quot;settings&quot;
└─ ...

Memcached 프로세스 (PID: 1234) → 공유 메모리 9999에 접근
프로세스 종료 → 공유 메모리는 OS에 유지됨
새 프로세스 (PID: 5678) → 공유 메모리 9999에 접근 (데이터 그대로!)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;업그레이드 절차:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;기존 Memcached 프로세스(PID: 1234) 종료&lt;/li&gt;
&lt;li&gt;OS의 공유 메모리(ID: 9999)는 그대로 유지&lt;/li&gt;
&lt;li&gt;새 버전 Memcached 프로세스(PID: 5678) 시작&lt;/li&gt;
&lt;li&gt;공유 메모리 9999 연결 → 모든 캐시 데이터 즉시 사용 가능&lt;/li&gt;
&lt;li&gt;워밍업 불필요 (히트율 90% 즉시 달성)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Memcache 워크로드 특성 분석&lt;/h2&gt;
&lt;p&gt;프로덕션에서 실행 중인 서버의 데이터를 사용하여 Memcache 워크로드를 특성화합니다.&lt;/p&gt;
&lt;h3&gt;웹 서버에서의 측정&lt;/h3&gt;
&lt;p&gt;소수의 사용자 요청에 대한 모든 Memcache 작업을 기록하고 Fanout, 응답 크기, 지연시간 특성을 분석합니다.&lt;/p&gt;
&lt;h4&gt;Fanout: 서버 접근 패턴&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Fanout이란?&lt;/strong&gt; 하나의 페이지 요청을 처리하기 위해 접촉하는 Memcached 서버 개수&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;전체 페이지 요청&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;56%&lt;/strong&gt;: 20개 미만의 Memcached 서버 접촉&lt;/li&gt;
&lt;li&gt;대부분의 사용자 요청은 적은 양의 캐시된 데이터만 필요&lt;/li&gt;
&lt;li&gt;긴 꼬리 분포 존재&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;인기 있는 특정 페이지 (예: 뉴스피드)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;All-to-All 통신 패턴을 명확히 보여줍니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;대부분의 요청&lt;/strong&gt;: 100개 이상의 서버 액세스&lt;/li&gt;
&lt;li&gt;수백 개의 Memcached 서버 액세스도 드물지 않음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;의미:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;뉴스피드 페이지는 수백 명 친구의 데이터를 조합&lt;/li&gt;
&lt;li&gt;친구들의 데이터가 서로 다른 Memcached 서버에 분산 저장됨&lt;/li&gt;
&lt;li&gt;따라서 한 페이지 요청이 100개 이상의 서버에 접촉 필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;단일 서버 장애도 여러 사용자에게 영향&lt;/strong&gt; → 높은 가용성 필수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8fe0ca963842f4b1b02e9cf3e16b31da/eb2af/figure9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDUlEQVR42o2TW4/aQAyF8/9/TtXXPlRbiUrQ3cISIBAggYTcINcZcoHkdGwIWrRq1ZGOZhjiL/axowEdSF132z+K7lq+/9/VQesDV6sVqqpE215xvV7U3j4eq5sGaS5QFAJCShyTDG6QYL0PlSLYnjq7sYq7Quu6FqQsS5GmCZ9plVWN7T7A4M3AcGJibR8wGK/x5buOrz8WeHmzMF75MJ0YYSKRiYpjtTAM4HkeHGePJEkYttwe8G3wjolhc2aVynC6jaFbCTLZ/MMGVbLrOrBtC3VdQRQZbDfEy3Cugm6Z1pcWP2c+nKh4CqRs2nt1ZFnfAy2KIgSBD9d1kauyf88tJJm8w64K5nFJtMhXBuBzA3tpvu+BVBS5KjmGafv3hnR4M6NHZlzmI5v270AqmURNIeAxzhngn6Ty7cRnIQXK8sxTQNbQfj7LT6IJeXhIwNPpiOiUMWRkBJDVBU1dohASm80Gk8kYo9EQprni0SJw09S4XBoWA4ksRMFALwgQpwUWuxSmmzK4qioFFOqlNl5ffzF0On3HcmlgNptiPp9B16dYLOY3YF+7EMrDNIW+DaFvAvXGmjMg5Xn2JPKbEuh/0/zSHQP7wabUCUw+VqXkRlH2ZAPd0Znu6Dma3b6qKArZV887sA3ac5fAf9R1jd1uxztBKKgsS/aRlmVtIdUnGMex+iAcngrDWDDwDzkE4wrimBJrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Fanout 분포&quot;
        title=&quot;&quot;
        src=&quot;/static/8fe0ca963842f4b1b02e9cf3e16b31da/f058b/figure9.png&quot;
        srcset=&quot;/static/8fe0ca963842f4b1b02e9cf3e16b31da/c26ae/figure9.png 158w,
/static/8fe0ca963842f4b1b02e9cf3e16b31da/6bdcf/figure9.png 315w,
/static/8fe0ca963842f4b1b02e9cf3e16b31da/f058b/figure9.png 630w,
/static/8fe0ca963842f4b1b02e9cf3e16b31da/40601/figure9.png 945w,
/static/8fe0ca963842f4b1b02e9cf3e16b31da/eb2af/figure9.png 954w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;응답 크기 분포&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;통계:
- 중간값: 135 bytes
- 평균: 954 bytes

특징:
- 중간값(135B)과 평균(954B)의 큰 차이 = 아이템 크기가 매우 다양함
- 그래프에서 특정 크기에 데이터가 집중됨:
  - 피크 1: ~100 bytes (작은 단일 값들)
  - 피크 2: ~200 bytes (중간 크기 데이터)
  - 피크 3: ~600 bytes (목록/집합 데이터)

해석 (구체적 예시):

큰 아이템 (평균 954 bytes):
- 친구 목록: [user1, user2, user3, ...] (수십~수백 개)
- 뉴스피드 ID 목록: [post1, post2, ...] (여러 게시물 ID)
- 댓글 목록 데이터

작은 아이템 (중간값 135 bytes):
- 단일 사용자 이름: &quot;John Doe&quot;
- 좋아요 개수: &quot;42&quot;
- 프로필 사진 URL: &quot;https://...&quot;
- 단일 설정 값: {&quot;notifications&quot;: true}

의미:
- Facebook은 두 가지 캐싱 전략을 혼용
- 작은 개별 데이터 캐싱 (빠른 조회)
- 큰 집합 데이터 캐싱 (DB 부하 감소)
- Slab Allocator가 다양한 크기를 효율적으로 처리해야 함&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/585d219cb5528e47a15758bc9192c637/7ae9c/figure10.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUklEQVR42qVUi47CIBDs/3/jqVXPM7lWsS8ebWFk4GhrE8/cucmG3QLD7DI0QzAH5yxSHH0Zp/w3i+syhtaOOBz2kLILMcHTmJx5P/TeBwzetTFoOgmpFIzpMY5jBHTO+WRA09S43cQ0EVk7v0GjlSqMSycgD7HWH8ZDE8Pr9YLj8YCi+AZjLuKE0pGB6Xs4awP4szKXnpVlic3mA13XBoYsr5PaA+ofkL95JsQV5/NXAKsqEfojlXnK4CXg5VLidPpEXdcgOBvPMv8NWBQF9vscSknP8PY+oBAiXEpZFgGQJb8FGPTVG68lDYLzMrSZAaPgZxk95vYhn4TNhdQhyzZeX+xn2zbBefscOb/O+RDWh2YxsNPzItu6rpBe0Ha7CZtp/L7bbScVUm5sUyRll4CzpxakRQQZ/EWRDaVFdsk4x1at3vKrRkcjszzfvfiBONwBgVBMrzuOxcUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;응답 크기 분포&quot;
        title=&quot;&quot;
        src=&quot;/static/585d219cb5528e47a15758bc9192c637/f058b/figure10.png&quot;
        srcset=&quot;/static/585d219cb5528e47a15758bc9192c637/c26ae/figure10.png 158w,
/static/585d219cb5528e47a15758bc9192c637/6bdcf/figure10.png 315w,
/static/585d219cb5528e47a15758bc9192c637/f058b/figure10.png 630w,
/static/585d219cb5528e47a15758bc9192c637/40601/figure10.png 945w,
/static/585d219cb5528e47a15758bc9192c637/7ae9c/figure10.png 972w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;지연시간 특성&lt;/h4&gt;
&lt;p&gt;웹서버가 Memcache에 데이터를 요청하고 받는 데 걸리는 시간을 측정합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7일간 측정 (μs = 마이크로초 = 0.001밀리초)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;프로덕션 부하 (실제 사용자 트래픽):
- 중간값: 333 μs = 0.333 ms
- p75 (75%): 475 μs = 0.475 ms
- p95 (95%): 1.135 ms

유휴 웹서버 (부하 없음):
- 중간값: 178 μs = 0.178 ms
- p75: 219 μs = 0.219 ms
- p95: 374 μs = 0.374 ms&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;차이의 원인:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;p95에서 프로덕션(1.135ms)이 유휴(0.374ms)보다 3배 느린 이유:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;큰 응답 처리&lt;/strong&gt;: 954 bytes 평균 크기 데이터 전송/역직렬화&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;웹서버 부하&lt;/strong&gt;: CPU 바쁠 때 스레드가 스케줄링 대기&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Pool별 통계&lt;/h3&gt;
&lt;p&gt;4개의 Memcache Pool의 사용 패턴을 분석합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Wildcard&lt;/strong&gt;: 기본 풀 (모든 데이터)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;App&lt;/strong&gt;: 특정 앱 전용 풀 (게임, 채팅 등)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replicated&lt;/strong&gt;: 복제 풀 (인기 데이터)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Regional&lt;/strong&gt;: 지역 풀 (공유 데이터)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;측정 결과:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;각 풀의 사용 패턴이 완전히 다릅니다:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/afb3feca92bdc86fea2ba1abb9448e31/bd9eb/table3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVR42j1QWRaCMAzk/gcEQWVxYSlFhNJSkDI24elHXjrJZDJN0MkWTV1h2z54Ph4YxwGtEGiaGkqNjIVoYO2MsnzCuY3xslj0/Ytjng0q3wN2BEWR45zE0HpC4jOR8zxDHJ/4Lf1CwiSc+Nq6LsiylJdR/XJOmBNFIQsHaXpFFIYwxjCBnBit0XUSnTyCnFlruY99/2P6yf1+87Mamddxzh0OaSMVq7LEu+8xKcWCw/DmaFuBaVJ8Bu0zCZJj4kjf+83S2b4O2CyxxOl9zAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Pool별 응답 크기 분포&quot;
        title=&quot;&quot;
        src=&quot;/static/afb3feca92bdc86fea2ba1abb9448e31/f058b/table3.png&quot;
        srcset=&quot;/static/afb3feca92bdc86fea2ba1abb9448e31/c26ae/table3.png 158w,
/static/afb3feca92bdc86fea2ba1abb9448e31/6bdcf/table3.png 315w,
/static/afb3feca92bdc86fea2ba1abb9448e31/f058b/table3.png 630w,
/static/afb3feca92bdc86fea2ba1abb9448e31/40601/table3.png 945w,
/static/afb3feca92bdc86fea2ba1abb9448e31/78612/table3.png 1260w,
/static/afb3feca92bdc86fea2ba1abb9448e31/bd9eb/table3.png 1442w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Replicated Pool (인기 데이터):
- GET 비율: 가장 높음 (다른 풀의 2.7배)
- 아이템 크기: 가장 작음 (단일 값)
- 예: 사용자 이름, 프로필 사진 URL
- 이유: 자주 읽히는 작은 데이터를 여러 서버에 복제

App Pool (앱 전용):
- 데이터 churn: 높음 (자주 변경됨)
- 미스율: 높음
- 예: 게임 점수, 라이브 채팅 메시지
- 이유: 몇 시간만 사용되고 사라지는 데이터

Regional Pool (지역 공유):
- 접근 빈도: 낮음
- 메모리 효율: 높음
- 예: 카테고리 데이터
- 이유: 여러 클러스터가 공유&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;의미:&lt;/strong&gt; 워크로드 특성에 맞춰 Pool을 분리하면 각각 최적화 가능&lt;/p&gt;
&lt;h3&gt;무효화 지연시간&lt;/h3&gt;
&lt;p&gt;데이터 수정 후 캐시 무효화가 전파되는 속도를 측정합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;측정 방법:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[시작] 미국 웹서버가 프로필 사진 변경
  ↓
[1단계] 미국 마스터 DB에 쓰기 (user:1 = &quot;new.jpg&quot;)
  ↓
[2단계] 미국 로컬 Memcache 무효화 (DELETE user:1)
  ↓
[3단계] 다른 Region 웹서버들이 user:1을 1초마다 조회
  ↓
[측정] 캐시 미스 발생 = 무효화 완료 시점 감지&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;결과 (p95 기준):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;마스터 Region (미국 내):
- 같은 클러스터: 수 밀리초 (2~5ms)
- 다른 Frontend Cluster: 수십 밀리초 (20~50ms)
- 이유: 네트워크 홉 수 차이

복제 Region (미국→유럽):
- 수백 밀리초 (200~500ms)
- 이유: MySQL 복제 지연 + mcsqueal 처리 + 네트워크 전송&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ba2f596b7978541f22889272e8bb666e/cc488/figure11.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbElEQVR42q2T22/SYBjG+du80AuTXWjihUu8nHMaY+aNy7wxzsU5I1nEqDOIhx3CPBHcZoa46QQGGxAdG0cZlJYzlMNghdLy+H2t4ESNNzZ50/br8/369H2faoA2/mdpms0GGg0BHMdCklr/2CCTktBuy+TuL0CGYcCyCSSTHCqVsiLuFalrAJcpwutn0DlkWVbqFyAFpVJJ1Gr7qFarRCBBJgD5kIsOMBTP4s3qNlLZPNG1uuDDbjWZTBq5XBbR6DcUiwWyuf1TSK6pgw4wxuXw5K0b2pl1TL+0w2LbgcMTgtgSu2gNy7KgRR3ST/aFGXz2hLEdZlGpHSgySZKU8x6bw9NFD+7M2DCsfYf+0QX0XXiIyzcMKJbKikZD+8cwcaTTKfDE4YojgLtGB0bvv8fNx1bsRriu4y5w1oYruhUMXDfh5CU9jp4ZQyqTU4GFQh60aC8pcM0dxvTrTdwiLoYmljA09gJrzl1FHCXAZ0teaOfsGNFZcHbMhFPDepw4N4l0rqACs9kMGUpKGUi5zCsOp+btuPrgAwbHzTh+Xo++QS3MFjviyTx5mQvjho+4eHsRp0eMODZwD0f6rxGHeRWYSKixiUTCKJWKcO9EYV77ggWLlzTegannqxiZnMW8yQouncXy+le8snphMG1AN/cJE4+WMa4zgi//6GGLTIhGpVTilWmKYhP1+j6Eeg31WhWCUAMNPw09nbogHKjrB/R5BWJTINXo5lfTG2Ba1LVr04VAMIgNpxNJ0hJRFBVomThxuVzY9fux5d5SNI3GH4C9f0gnezzPIxDwIxQKIhbbg8/nU1qkxqn1277vo0iwTA11VLcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;무효화 지연시간 분포&quot;
        title=&quot;&quot;
        src=&quot;/static/ba2f596b7978541f22889272e8bb666e/f058b/figure11.png&quot;
        srcset=&quot;/static/ba2f596b7978541f22889272e8bb666e/c26ae/figure11.png 158w,
/static/ba2f596b7978541f22889272e8bb666e/6bdcf/figure11.png 315w,
/static/ba2f596b7978541f22889272e8bb666e/f058b/figure11.png 630w,
/static/ba2f596b7978541f22889272e8bb666e/cc488/figure11.png 928w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;의미:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;같은 Region 내에서는 매우 빠른 무효화 (밀리초)&lt;/li&gt;
&lt;li&gt;다른 Region은 MySQL 복제 때문에 느림 (수백 밀리초)&lt;/li&gt;
&lt;li&gt;Remote Marker가 이 지연을 보완&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;규모별 우선순위의 변화&lt;/h2&gt;
&lt;p&gt;Facebook의 경험은 특정 규모에서 일부 품질이 다른 것보다 더 많은 노력을 필요로 한다는 것을 보여줍니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;소규모 (단일 클러스터)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;초점: 읽기 중심 워크로드, Wide fan-out&lt;/li&gt;
&lt;li&gt;최적화: 지연시간 감소, 부하 감소&lt;/li&gt;
&lt;li&gt;일관성: 상대적으로 쉬움 (복제 최소)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;중간 규모 (Region 내 여러 클러스터)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;초점: 데이터 복제, 메모리 효율성&lt;/li&gt;
&lt;li&gt;최적화: 무효화 전파, Regional Pool&lt;/li&gt;
&lt;li&gt;문제: 클러스터 간 데이터 일관성&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;대규모 (여러 Region)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;초점: 지리적 분산, 일관성&lt;/li&gt;
&lt;li&gt;최적화: 복제 지연 처리, Remote Marker&lt;/li&gt;
&lt;li&gt;문제: 여러 Region 간 일관성 유지&lt;/li&gt;
&lt;li&gt;서버 수 증가: 통신 스케줄링의 중요성 급증&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;성능, 효율성, 장애 내성, 일관성 모두 모든 규모에서 중요하지만, 각 규모에서 우선순위는 달라집니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Facebook Memcached 아키텍처 (1탄) - 기본 설계와 클러스터 내부 최적화]]></title><description><![CDATA[이 글은 Facebook의 공식 논문 Scaling Memcache at Facebook을 기반으로 작성되었습니다. Facebook이 직면한 도전과제 Facebook…]]></description><link>https://gotobill.github.io/cache-part1/</link><guid isPermaLink="false">https://gotobill.github.io/cache-part1/</guid><pubDate>Wed, 01 Oct 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;이 글은 Facebook의 공식 논문 &lt;a href=&quot;https://research.facebook.com/publications/scaling-memcache-at-facebook/&quot;&gt;Scaling Memcache at Facebook&lt;/a&gt;을 기반으로 작성되었습니다.&lt;/p&gt;
&lt;h2&gt;Facebook이 직면한 도전과제&lt;/h2&gt;
&lt;p&gt;Facebook은 전 세계 수십억 명의 사용자가 실시간으로 소통하는 거대한 소셜 네트워크입니다. 매일 수억 명이 사용하는 이런 규모의 서비스를 운영하려면 전통적인 웹 아키텍처로는 감당할 수 없는 도전과제를 해결해야 했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;핵심 기술적 도전과제&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;실시간 통신 지원&lt;/strong&gt;: 사용자들이 즉각적으로 콘텐츠를 주고받을 수 있어야 함&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;즉석 콘텐츠 집계&lt;/strong&gt;: 뉴스피드, 댓글, 좋아요 등 여러 소스의 데이터를 빠르게 집계해야 함&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;수십억 건의 요청 처리&lt;/strong&gt;: 초당 수십억 개의 요청을 안정적으로 처리할 수 있어야 함&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;지리적 분산&lt;/strong&gt;: 여러 지역에 걸쳐 수조 개의 항목을 저장하고, 장애에도 견딜 수 있어야 함&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Facebook은 오픈소스 Memcached를 채택하고, 이를 단일 클러스터에서 다중 지역 분산 시스템까지 점진적으로 확장했습니다. 현재 Facebook의 Memcache 시스템은 세계 최대 규모로, 초당 10억 개 이상의 요청을 처리하고 수조 개의 아이템을 저장합니다.&lt;/p&gt;
&lt;h2&gt;Memcached를 선택한 이유&lt;/h2&gt;
&lt;h3&gt;단순함의 힘&lt;/h3&gt;
&lt;p&gt;Facebook이 Memcached를 선택한 이유는 &lt;strong&gt;단순함&lt;/strong&gt;에 있습니다. Memcached는 단 3가지 연산만 제공합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 값 저장&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;         &lt;span class=&quot;token comment&quot;&gt;// 값 조회&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;// 값 삭제&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이러한 단순함은 대규모 분산 시스템의 기본 구성요소로 매력적이었습니다. 오픈소스 Memcached는 단일 머신의 메모리 내 해시 테이블로 시작했지만, Facebook은 이를 초당 수십억 건을 처리하는 분산 키-값 저장소로 발전시켰습니다.&lt;/p&gt;
&lt;h3&gt;저지연 접근의 가치&lt;/h3&gt;
&lt;p&gt;Memcached가 제공하는 &lt;strong&gt;저지연 접근&lt;/strong&gt;, &lt;strong&gt;공유 스토리지 풀&lt;/strong&gt;, &lt;strong&gt;저비용&lt;/strong&gt;은 데이터 집약적 기능을 실용적으로 구현할 수 있게 했습니다.&lt;/p&gt;
&lt;p&gt;구체적인 예를 들어보겠습니다. 페이지당 수백 개의 DB 쿼리를 실행하는 기능은 너무 느리고 비용이 많이 들어 프로토타입 단계에서 포기하는 경우가 많았습니다. 하지만 Memcached를 사용하면 페이지당 수천 개의 키-값 쌍을 조회하는 것이 실용적으로 가능해졌습니다.&lt;/p&gt;
&lt;h3&gt;읽기 중심 워크로드&lt;/h3&gt;
&lt;p&gt;Facebook의 워크로드는 &lt;strong&gt;읽기 중심&lt;/strong&gt;입니다. 사용자들은 콘텐츠를 생성하는 것보다 10배 더 많이 소비합니다. 이러한 10:1 비율의 읽기 중심 패턴은 캐싱 전략이 매우 효과적임을 의미합니다.&lt;/p&gt;
&lt;p&gt;또한 데이터는 MySQL 데이터베이스, HDFS, 다양한 백엔드 서비스 등 이질적인 소스에서 가져와야 하므로 유연한 캐싱 전략이 필요했습니다.&lt;/p&gt;
&lt;h2&gt;Facebook의 Memcache 활용 방식&lt;/h2&gt;
&lt;p&gt;Facebook에서는 &lt;strong&gt;Memcached&lt;/strong&gt;를 소스 코드나 바이너리 자체를 의미하는 용어로 사용하고, &lt;strong&gt;Memcache&lt;/strong&gt;는 그 위에 구축된 분산 시스템 전체를 의미합니다.&lt;/p&gt;
&lt;h3&gt;Query Cache: DB 부하 감소&lt;/h3&gt;
&lt;p&gt;Memcache의 핵심 목적은 &lt;strong&gt;데이터베이스에 직접 접근하는 빈도를 줄여 DB 부하를 낮추는 것&lt;/strong&gt;입니다. Look-aside cache 패턴을 사용하여 클라이언트가 먼저 캐시를 확인하고, 없으면 DB에서 조회 후 캐시에 저장합니다.&lt;/p&gt;
&lt;p&gt;데이터베이스에 값이 변경되면 캐시의 해당 키를 &lt;strong&gt;삭제&lt;/strong&gt;해서 다음 요청 시 DB에서 최신 값을 가져오도록 강제합니다. 이 방식은 캐시와 DB 간의 데이터 일관성을 유지하는 데 효과적입니다.&lt;/p&gt;
&lt;h3&gt;Generic Cache: 계산 비용 감소&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;머신러닝 등에서 계산 비용이 큰 결과를 미리 캐시에 저장해둡니다.&lt;/strong&gt; 여러 애플리케이션이 필요할 때 빠르게 접근할 수 있어 성능과 자원 효율이 크게 향상됩니다.&lt;/p&gt;
&lt;h3&gt;전체 아키텍처&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/72aae/figure2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGklEQVR42mVTaU9iQRB8f9rErJ/9YNQvXuy6KIIoKHLLrVyiHCK4Kh6IUdGIJgIm3qDUTvX6EpOdpDPz3lR3V/dUa91uFy8vL2g2m3h4eECr1cL9/T3a7TZeX1/R6XTA1ev18P7+Lljef8fy/Pb2ho+PD2g6aHt7G4eHh2KFQgFHR0cSjPcM9vn5KWf+29nZwcHBAU5OTlAqlXB1dfV1/waNDFutNhKJBNbX15FMJuXMncGfn5+FIbPT6vW63KVSKWxsbCCdTmNzcxNnZ2dgLI3sPB4PxsbGYDAYMDU1JcbzyMgI9vb2oK/b21vMz89jfHxc7icnJ2WfmJgQu7u7g7a7W8bx8bGAmTUajWJ/f1+Y0ZH/9JXJZIRhrVbD2tqaMGW59B0eHka1WoVGZ9L2+/0wGo2SaXFxUf6R4feA7HMkEsHKyoowozmdTmkVAzKRVixuSzaCaXrDvV4v+vv7hZW+mCQUCqFYLAqWD1Iul4XI4OCg6qMKmM/nkM/nJQhfd2trC5VKRTU6IyAG+R6Q2LIKxD2bzUp7QqEghoaGFMNTaJXKAQKBIH4Z5zBrsWHWvAjDtAkOt1+V8X/J1gUbjLNWmBTOZLbh528zHE4vRkdHcXqqAuayWwivpZHK7yMczyEQ20ThTw1ufwx9fX3CRF/xeBxBdR9LFRFNFhBJ5JErVzEzZ8XAwA80Gg1ojZsbrDg9cHpWsaz2ZZXN7Q3C7fGKzihmTgHlxVbYl51wuHyCczh9cPsU1u2WfvZ6n9AeHx+RoUBVaakvE2ErY384Xnw9Tk6z2VJSSahEqqJUUnwSibj0m1PDpFq5XFIyscHn84sGA4GASMPhcMBms0nJuVwO5+fncrZarUpiq4jFYggGg4goH5diSCldXl5CK5V2RKDp9IYInOLkyFEu+hgyCc/UG5MyATHEUkIcPUqvXr/8J+yZmRkZKYqUzOx2Oyzqe85shsViQTgchsvlwvT0NEwmk1S0tLQkrOi3sLAgMTgxWqfzjouLCxnuRuNGXoo7+8Yx46Po6+npSf6zfB13fX0t/btRj9vtdvAX9PwzXuceGgYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;전체 아키텍처&quot;
        title=&quot;&quot;
        src=&quot;/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/f058b/figure2.png&quot;
        srcset=&quot;/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/c26ae/figure2.png 158w,
/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/6bdcf/figure2.png 315w,
/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/f058b/figure2.png 630w,
/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/40601/figure2.png 945w,
/static/6d7e4fd0a7fdf1ce712f76fec71ea76c/72aae/figure2.png 964w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Look-aside Cache 패턴&lt;/h2&gt;
&lt;p&gt;Facebook의 Memcache는 &lt;strong&gt;Look-aside 캐시 패턴&lt;/strong&gt;을 사용합니다. 이는 캐시가 데이터베이스 앞에서 보조 역할을 수행한다는 의미입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/15111adf40d55dcaf45f720ea673b3b3/2c5fd/figure1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABO0lEQVR42q1SXW+CQBD0//80E2siJhghQIEK8iW1cCAg05sFDTz0rZdsIHezszNzt8E/r830GaX6vkOapgiCAEWR4/kc3mescXwKWqkKl8uXVF1Xi7PxRTgBu66DZVnYbrcIw1CDRiwHvghvtwL7/R6HwwFlWU6INSHQtg3yPBOAUrVWWOB6jXG/f69UcjVNo930+qu0owS+/yn/K8tUl2UpqupHdkjEYgxLhcMwCI5EFEHLw9DPbhYKScjc4jgSpQSziZO77jHbgiao5YzDSEInZXmTPWYuhLR2Op1wPBpzyMDj0cIwDOx2H0iSRFR4ngvTNBFFkW6e8mQv8ySWg4UwDAOcz2c4jqMtV+9MXdeVyrJMwLZty6X5vj+/AMir8DxPeiliM1lZ3+YrL6WUDGAcf+F4xhh4kez5BXcauC6jTHmrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Look-aside Cache 패턴&quot;
        title=&quot;&quot;
        src=&quot;/static/15111adf40d55dcaf45f720ea673b3b3/f058b/figure1.png&quot;
        srcset=&quot;/static/15111adf40d55dcaf45f720ea673b3b3/c26ae/figure1.png 158w,
/static/15111adf40d55dcaf45f720ea673b3b3/6bdcf/figure1.png 315w,
/static/15111adf40d55dcaf45f720ea673b3b3/f058b/figure1.png 630w,
/static/15111adf40d55dcaf45f720ea673b3b3/40601/figure1.png 945w,
/static/15111adf40d55dcaf45f720ea673b3b3/2c5fd/figure1.png 1006w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;읽기 경로 (Cache Miss)&lt;/h3&gt;
&lt;p&gt;캐시 미스가 발생했을 때의 흐름입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 1. 먼저 캐시에서 조회&lt;/span&gt;
value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 2. 캐시 미스 시 DB에서 조회&lt;/span&gt;
    value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 3. 다음을 위해 캐시에 저장&lt;/span&gt;
    memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;쓰기 경로&lt;/h3&gt;
&lt;p&gt;데이터를 수정할 때는 캐시를 업데이트하지 않고 &lt;strong&gt;삭제&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 1. DB에 업데이트&lt;/span&gt;
database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 2. 캐시에서 삭제 (업데이트 X)&lt;/span&gt;
memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;왜 업데이트가 아닌 삭제인가?&lt;/h3&gt;
&lt;p&gt;삭제를 사용하는 이유는 &lt;strong&gt;멱등성&lt;/strong&gt; 때문입니다. 같은 삭제 연산을 여러 번 수행해도 결과는 동일합니다. 반면 업데이트는 순서에 따라 결과가 달라질 수 있습니다.&lt;/p&gt;
&lt;p&gt;또한 캐시는 &lt;strong&gt;Non-authoritative&lt;/strong&gt;합니다. 즉, 데이터베이스만이 유일한 진실의 소스(Single Source of Truth)입니다. 캐시는 성능을 위한 보조 수단일 뿐이며, 캐시된 데이터가 제거되어도 문제가 없습니다.&lt;/p&gt;
&lt;h2&gt;전체 시스템 구조&lt;/h2&gt;
&lt;p&gt;Facebook의 Memcache 시스템은 &lt;strong&gt;Region 단위로 분할&lt;/strong&gt;되어 있습니다.&lt;/p&gt;
&lt;h3&gt;Region 구조&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/13c2ceb68e03a098532713ae5a7ebd79/fbfd6/cluster.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnElEQVR42nWS6XKkMAyEef8nzG7VHBWG4bLxfQLTkU0212R/fCWrW5KxTTPJhIMM4R4QHt9QATj1Gy7jBhXx5P+kOd0Z/rYD/rz2GKibhx3cbwdxx0L5ZDNmu354LJD3G+Q197hgyhyd63FiF0zrArYLdFHiFsbqnfgVV9mCP2T1b0mAbwrsB0NWaEbdg01nhDBhpeZMlMipaaBBcnkljVVtXTkCxT5J6N1CEXIzNZacZYOGOQkpBayzcN4dOIc5asyaQykF+0XX3tSBdRghVgOxHcPnMnCQC4ZugDUewSV4l2ucokU73DENM2mpEsgzLuBOX692TQM/Kflcjnw3BoO2GI0D85Eu/GAMASwmLDHXnNO6xJn0PnhMKTwxxoDmfO7w8nJB207QOtMRU6Ws9ftaiAAh44dvqvc7zSYVYDWgJR50/GfoRS/nCpT4T80Cej3kRaDJimOnX2TzVExxDwclR1RIhmG8nTF3V2TLq1a8f3WPL72JNmyiEFRo4SUJdJ/JaEStEZSqefGSLfEd0ooXa62pnqe8eEEqvAHTCEzkuTJwkAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;클러스터 구성&quot;
        title=&quot;&quot;
        src=&quot;/static/13c2ceb68e03a098532713ae5a7ebd79/f058b/cluster.png&quot;
        srcset=&quot;/static/13c2ceb68e03a098532713ae5a7ebd79/c26ae/cluster.png 158w,
/static/13c2ceb68e03a098532713ae5a7ebd79/6bdcf/cluster.png 315w,
/static/13c2ceb68e03a098532713ae5a7ebd79/f058b/cluster.png 630w,
/static/13c2ceb68e03a098532713ae5a7ebd79/40601/cluster.png 945w,
/static/13c2ceb68e03a098532713ae5a7ebd79/78612/cluster.png 1260w,
/static/13c2ceb68e03a098532713ae5a7ebd79/fbfd6/cluster.png 1357w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;각 Region은 다음으로 구성됩니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;여러 Frontend Cluster&lt;/strong&gt;: 웹서버(백엔드 WAS) + Memcached 서버로 구성된 클러스터&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;하나의 Storage Cluster&lt;/strong&gt;: MySQL 데이터베이스 클러스터&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Frontend Cluster&lt;/strong&gt;의 &quot;Frontend&quot;는 사용자와 직접 통신하는 계층을 의미합니다.&lt;/p&gt;
&lt;p&gt;여기서 &lt;strong&gt;웹서버는 Spring, Django 같은 백엔드 애플리케이션 서버&lt;/strong&gt;(WAS)를 말합니다.&lt;/p&gt;
&lt;p&gt;이러한 구조는 지리적으로 분산된 사용자에게 낮은 지연시간을 제공하면서도, 데이터베이스는 한 곳에서 중앙 관리할 수 있게 합니다.&lt;/p&gt;
&lt;h2&gt;클러스터 내 확장: 지연시간과 부하 최적화&lt;/h2&gt;
&lt;p&gt;Facebook은 단일 클러스터 내에서 수천 대의 서버로 확장하면서 &lt;strong&gt;지연시간 감소&lt;/strong&gt;와 &lt;strong&gt;부하 감소&lt;/strong&gt;라는 두 가지 목표에 집중했습니다.&lt;/p&gt;
&lt;h3&gt;지연시간 감소&lt;/h3&gt;
&lt;h4&gt;All-to-All 통신 패턴의 문제&lt;/h4&gt;
&lt;p&gt;Facebook의 인기 페이지를 로딩하면 평균 &lt;strong&gt;521개의 서로 다른 아이템&lt;/strong&gt;을 Memcache에서 가져옵니다. 95 퍼센타일은 무려 1,740개입니다.&lt;/p&gt;
&lt;p&gt;수백 대의 Memcached 서버가 클러스터에 배치되고, 데이터는 &lt;strong&gt;Consistent Hashing&lt;/strong&gt;을 통해 분산됩니다. 따라서 웹서버는 하나의 사용자 요청을 처리하기 위해 수많은 Memcached 서버와 통신해야 합니다.&lt;/p&gt;
&lt;p&gt;이러한 &lt;strong&gt;All-to-All 통신 패턴&lt;/strong&gt;은 다음 문제를 야기합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Incast Congestion&lt;/strong&gt;: 많은 서버의 응답이 동시에 도착하면 네트워크 정체 발생&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;단일 서버 병목&lt;/strong&gt;: 하나의 서버가 많은 웹서버의 병목이 될 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;병렬 요청과 배치 처리&lt;/h4&gt;
&lt;p&gt;Facebook은 웹 애플리케이션 코드를 구조화하여 네트워크 왕복을 최소화합니다. 데이터 간의 의존성을 나타내는 &lt;strong&gt;DAG&lt;/strong&gt;를 구성하고, 이를 통해 동시에 가져올 수 있는 아이템을 최대화합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d697a375ab457a2026f4d67aedad2f5e/c6f66/Dag.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVR42pVRuU5EMQzMd1MgUdBR8AUUlJQ0VHwADQ01QqBlEfuOvNyHkwxOWBAtkUaexNfYEdMicZhXROfRjEHRGqgV/z05ZxARxOcsYVyA3hQsI1gPKSV8iAOam6RcYIyF8wExEYw2bDP7+M05vO32OD2/xNX1DcRhWrApA50slqDgKY1OlVW21v7Ygnbk3V+YU2FbyrgrpWGtg+hdLStM7PQ5IVHm5MaBFZPJeFcRJhJsKlCxQsfvYv3UUbyOWKajmZglj9nl8xha2zFmH7mvYXUJs3LYQsFeBTx/LJCx4eHxCSdnF7i9u+eiGPnxCGG5QCc+xoHB+a0HGVb1o84zNt5ZoIaVV/TyusPEn5mp8I7pF19ttc6gJ35iZAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dag 구조도&quot;
        title=&quot;&quot;
        src=&quot;/static/d697a375ab457a2026f4d67aedad2f5e/f058b/Dag.png&quot;
        srcset=&quot;/static/d697a375ab457a2026f4d67aedad2f5e/c26ae/Dag.png 158w,
/static/d697a375ab457a2026f4d67aedad2f5e/6bdcf/Dag.png 315w,
/static/d697a375ab457a2026f4d67aedad2f5e/f058b/Dag.png 630w,
/static/d697a375ab457a2026f4d67aedad2f5e/40601/Dag.png 945w,
/static/d697a375ab457a2026f4d67aedad2f5e/78612/Dag.png 1260w,
/static/d697a375ab457a2026f4d67aedad2f5e/c6f66/Dag.png 2722w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;평균적으로 &lt;strong&gt;요청당 24개의 키&lt;/strong&gt;로 구성됩니다. 100번의 요청 중 95번은 95개 이하의 키를 사용하며, 나머지 5%의 요청만 그보다 많은 키를 한 번에 조회합니다.&lt;/p&gt;
&lt;h4&gt;UDP와 TCP의 전략적 사용&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;GET 요청: UDP 사용&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;지연시간과 오버헤드를 줄이기 위해 UDP 사용&lt;/li&gt;
&lt;li&gt;UDP는 연결이 없으므로 각 스레드가 직접 Memcached 서버와 통신 가능&lt;/li&gt;
&lt;li&gt;연결 유지 오버헤드 제거&lt;/li&gt;
&lt;li&gt;패킷 손실이나 순서 오류는 캐시 미스로 처리&lt;/li&gt;
&lt;li&gt;피크 로드에서 GET 요청의 0.25%만 손실됨&lt;/li&gt;
&lt;li&gt;UDP 사용 시 TCP 대비 &lt;strong&gt;20% 지연시간 감소&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;SET/DELETE 요청: TCP 사용&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;신뢰성을 위해 TCP 사용&lt;/li&gt;
&lt;li&gt;웹서버와 같은 머신에서 실행되는 &lt;strong&gt;mcrouter&lt;/strong&gt;를 통해 처리&lt;/li&gt;
&lt;li&gt;상태 변경 확인이 필요한 작업에 적합&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;mcrouter란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;mcrouter는 memcached 프로토콜을 지원하는 라우팅 프록시입니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;라우팅&lt;/strong&gt;: 클라이언트 요청을 적절한 Memcached 서버로 전달&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;연결 통합&lt;/strong&gt;: 웹서버의 수많은 스레드가 각각 TCP 연결을 맺는 대신, mcrouter를 통해 연결을 재사용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메모리 효율&lt;/strong&gt;: TCP 연결마다 소켓 버퍼와 상태 정보가 필요한데, 연결 수를 줄여 메모리 절약&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;프로토콜 지원&lt;/strong&gt;: UDP(GET)와 TCP(SET/DELETE) 모두 지원 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/72861477c4cd0f20044ac7c41ea3f0d5/9cab2/mc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACz0lEQVR42n1Ta3ebOhD0//9jPc1te/twGztxYtM4Npi3AIGe01lwHrcfrjhzJFbLaHZWrGAmYOhxeToiudthv7lDsr3Ht3++oD6nwKgB52Cjgw4j8q7Cz/0D7p4OuE0ecLP+gUN6xCSPn7BSjUZ9UaiuyNMOZdbN6zpf5klbtMbh0Pb4rQaix6HpsScSibXLnGsS5n1EY4CaQjsHrBONJLfz+iVe64h2iFAUKxi5tz8Z3P0eoblWI78lKnKt6j7AhzeUZYWu6xFinN+NC2iFkJC1kzzutYoVNc28lpigHgJWFQmtv4LBqm6guoEJcY6NdiFsiMkuebLX8tCqaV+/Nf4dYXinsChLdP1/FTZXQuuWHNlr2hY1Fb7k+ReFuaKq/g1PWYuMxtX0TN6LblGoiJIeSZx9xJGNE8h6yV2w4gE8ZYG3HtP9DtPj/jUmkOFj4LXwC6hGGzZOG5iwxEdCfFzh/RBzj0f4LMXfo7Q9Utvg4lrkXuFbucOnyy0yxxjfU86ZVUIoEiKiNYjDgKj1G7zDsk9C16GNbIRTOHcFtiUvdrlHNpRzTIH30KmrQtYd2aU4GQRem1DViM7zD/GvCjs3obAdioneqQKJuiDpcl7yApdRzRXUVpPQUxVLiWSPQ4Fwpn9ZQnKSsgTYllZMs07pqECe/ZhiOzzTQzcXIR7HKE0Zn+GaDcbzZzi142+wZ7kHmOInxvQrfP+IaIqrzijFzPc1NwNSqjXBz0QvY4Uhgc2/Qh8/wBbfEdtb+HqN6XSD8fQRofmFOGZXPnY0evTeYKAFWmZijG7eE6yiLVn1M2z9yPnE6s4I45mV8qDmMK/FDpgavt1hOH2BKzcIFBKGA1y1hZZYc0+bMiq8Ms9GyMwSXt8FYWmMJPvmFubyL2y1RlAkbTew5XqOealEP/11D/9vTAVVbDEcbzBdaE3/QNJ7TPRZP39ihRtac8If924hKh159NUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;mcrouter 구조도&quot;
        title=&quot;&quot;
        src=&quot;/static/72861477c4cd0f20044ac7c41ea3f0d5/f058b/mc.png&quot;
        srcset=&quot;/static/72861477c4cd0f20044ac7c41ea3f0d5/c26ae/mc.png 158w,
/static/72861477c4cd0f20044ac7c41ea3f0d5/6bdcf/mc.png 315w,
/static/72861477c4cd0f20044ac7c41ea3f0d5/f058b/mc.png 630w,
/static/72861477c4cd0f20044ac7c41ea3f0d5/9cab2/mc.png 864w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;연결 통합이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/70efa34233a348f2eb9f05a478ae2610/97655/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACh0lEQVR42pVTaW/TQBT0//83ID4hPiCQEIVWLQWJtkmby4nt+j6ytz3MbkJpRYuE5dHeb2fmvY022xTLdYztLkOS5qjqBlPfw1UVXFnC1TXGtsXkHA7fhH99UVm1KMoaddMFDMMeYz8wUAPbEAxoGXC0DuM0gT/GcTpiDJg4OboxzEV+UJKJ0RqGEyIv4LZbDJeX6C8uoOdzmDRDLzW0UlgtV+i6DtI4iKpBe32NxckXKM5roRAZ3myP8H2jNOwwwO73hGD/2FLyX9AGVnBNyENrLCJHVm3XQ3HR2BGyaeGKApI3ysUSZreDqWpIrmseKIoSQkpo7lW8TKQp8sUChmcsyUSO2lt6pDjwmyS9c3nOYAvI2zsYyje0RCgGZNCcBwUZK6pRJLLfxMhvZtBZRksY0FN3NPaPDB3oO7LwCFJ8e1x/stfasN8ZczjHcQiY0nR/qzd6SO9hNxv05+foTr9C0XS9S9DTcJ+U5eOksDraqyssPp9A0R5NL0OWfWX5cgglQdkT5Uy0gnTYt3CeBZl5e/z+0A9jlhLXfY16ln4crdcJ5ncrbOIEMYtcGIWdKJCJKrS17vE/X1QwCTlR0eCaL2RvNFo1oNeC7Z5jGQr2N8MHPLB8OhfNhgTfqltclHOc5df42caQlDFaWkHVk5tYXy6UTKjZkJQxjJ9D1GjWkpJIiwyK7CpKrJnZTNW4qdcBuWrRKIF3ySlezd7j9fIjYllgNBPPmKcBeyvDOyxYXz47jREo+UoSevgjmQXcixqVGPCh/4432094W58hVi8EvFcdOrLcVnyv9Csjm16z7szhsY+UbCjZeMnGBbm+1foFyb1V8BiOrYc9Gvy4mB8S8Tghz+AXfl3U6bFBlqsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;연결 통합&quot;
        title=&quot;&quot;
        src=&quot;/static/70efa34233a348f2eb9f05a478ae2610/f058b/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png&quot;
        srcset=&quot;/static/70efa34233a348f2eb9f05a478ae2610/c26ae/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png 158w,
/static/70efa34233a348f2eb9f05a478ae2610/6bdcf/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png 315w,
/static/70efa34233a348f2eb9f05a478ae2610/f058b/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png 630w,
/static/70efa34233a348f2eb9f05a478ae2610/97655/%EC%97%B0%EA%B2%B0%ED%86%B5%ED%95%A9.png 819w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1f279a1e5c204910114a2391bdca1966/587b0/figure3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVUlEQVR42o2Ty27TQBSG8z6s6QMUVWzLigWUN2CFkIpYlQjBAhbpFqmLlksLEpUCVGmFUJU0TSUa0iQ0SXOz49iJr3VudlJy+ZmZYDtpQNTSb8945nznnDlnfMAInv71jP6q0Wha9J+PvobDAWo1CZ1OB8a5iWazgUbDZOr1umy927WJ0ZBpQOZUY8i0Uwbs93+B40pQFAUnP3NIp1NIJH7g8DAKSRKZM01TZzKhdl3isHfRY05doLNJN3SmalUAz3MoFPKoVHg2luU62xOLZ+Bf3SLaxNZOFMdnIsKJAlTDZOs+Sr4gHiik1WqylJzzmTyrwWDADN5s72Pu1mPMLS7jxdoOUpyB8AlHgI0xkKYiCBUmenbsnBhkOCUH+OHLARbuPcXCkh+rG7tIchoBlr0IVVWBKFbZZDLCy3KA7z9HMH/Xj/k7Kwish2aBiiKTgpSh67oboZfqbIT/BRqkCLSKNEo35T+afK4MnDRut1vumAIU3SRqwDCbVweOjfus3wzDQGAtiIfP1rES2MRe7BThJIejVJHtmSnK6z2keB2R5ESVncamQFVVcfv+S1y7+QA3lp4gFMsgkhJwlC65wI2P33B98RHRMp6/CuK4IOPr9zzqmuEBaZr02tGUQ/txvPt0gO3dGM54CXzdgCjr7lFkCgLeBsMMHI1nUVXOUZY0dKyuB/QqOoKuyqhwRWjkWyoWkM2col6XxjdJ11As5lETK1DkGspkLFQ4cps45HJZFpDvcr9ZVgemabKIbdtivUm/zt2l8wbpBsuymGzbJnvbTHT9N3KgRShne9aQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;UDP vs TCP 성능 비교&quot;
        title=&quot;&quot;
        src=&quot;/static/1f279a1e5c204910114a2391bdca1966/f058b/figure3.png&quot;
        srcset=&quot;/static/1f279a1e5c204910114a2391bdca1966/c26ae/figure3.png 158w,
/static/1f279a1e5c204910114a2391bdca1966/6bdcf/figure3.png 315w,
/static/1f279a1e5c204910114a2391bdca1966/f058b/figure3.png 630w,
/static/1f279a1e5c204910114a2391bdca1966/40601/figure3.png 945w,
/static/1f279a1e5c204910114a2391bdca1966/587b0/figure3.png 970w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;Incast Congestion 해결&lt;/h4&gt;
&lt;p&gt;웹서버는 &lt;strong&gt;슬라이딩 윈도우 메커니즘&lt;/strong&gt;을 구현하여 Memcached로 보내는 동시 요청 수를 제한합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aa71d61e1f649560acc59a6db7202999/d4c13/sliding.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACrUlEQVR42p1UW2sTQRTen+I/8cm/oIiCIIo+6pPPgkgVwWItFESfxIciPlhFtFCqFjEVaxs1t8Zcmstmk70ke5mdndndzzPbNI1BrBr4ON9MZs+c851zRlv7JtDpmdjr6Gi2dOiGCcseIkkS/M9Pa1kSUnJEUYiIM8TEpYyQpGl2IFV2ik9DXRrPQOs6EjefC9xflbj3RuD2C4GlNYm23qeIe2hQ1K2OkdnewIZhOjAGTsZHfgAhY0RCTqAVOwKnFgJcfsRw6SHDmcUAVx9zFCs15L/vZiiUa9j+Wka726eLBhhYQ9hDD34QQkw5yxzGMeCFKXyewg0TeGQ9Pk6B/pQUgYzHmElP7akIp6EV/SZc30XIGMKQw6M0AuKMuDowJeHfFeWtmUdft2D0SZORA3PQh21bCOgSKaLxsUOPs4WZheZEHnKjEgIZotBJ8fFHgs1agk/1GO9KEltNic8E22VwveAXvX4H7Zm+gWPvz2LbKeP6cooTcz5OLjCcXmQ4foPhyjLHtZUYuXydClQCp4+4EOCR2LczXNOZjfXBDobcx04jxnpBYKMk8KEioJp+i/a+NFM4oxCeG1CfJhPIMQ7XVJR0SptJAyvN0v1JMbmFHjPQ8gzozESfAlC8TegFJozAJmuh61M7MYcchgwJkrFT0IQcQq1dwbLoR5FPPACLOXza84gr3RVGxA/WGltdRb3ZRqXaQHOvjYFpodXuQO/1s5nmPPq3WZb0QaRGiMQeBRJDP4btS7hMThp31v4JGsttYnjhIkS9hrnXwLklhvMPOO6+Yijv1lCqNpEvVFHcbaBMWRzZNmGxBHd+HlG3iyebCW6thLjzkuNpLswkUI9CtdYi20WjrR/tMCblaZwn85lQddWzlCS0SzY9eBcVp5RjKbMZz+wBn3q+fgLy1gqbZEjXLwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;슬라이딩 윈도우&quot;
        title=&quot;&quot;
        src=&quot;/static/aa71d61e1f649560acc59a6db7202999/f058b/sliding.png&quot;
        srcset=&quot;/static/aa71d61e1f649560acc59a6db7202999/c26ae/sliding.png 158w,
/static/aa71d61e1f649560acc59a6db7202999/6bdcf/sliding.png 315w,
/static/aa71d61e1f649560acc59a6db7202999/f058b/sliding.png 630w,
/static/aa71d61e1f649560acc59a6db7202999/d4c13/sliding.png 825w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;윈도우 크기가 너무 작으면 요청을 순차적으로 보내야 하므로 지연시간이 증가합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;너무 크면 Incast Congestion이 발생합니다.&lt;/strong&gt; Facebook은 실험을 통해 최적의 윈도우 크기를 찾았습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7b89a4c0bb5ca3f65ffa495cd077d205/5caea/figure4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqUlEQVR42qVTa0/DMAzs//9ZwF9gsKndxGAre/T9StKmh+0spRuT9oFIrqzGOd85lwCXNY4jf/HfFTgQB9T3BmmWom0bNE0tkecZ0jRFkpxxPp9wOHzjdDpO+xx1XckZxpkAjTHyMysKYTuOFtYOqOoaYRjh5fkJb28LykNstx+yP4+a6vhc4KSCWCQoy4JAW+i+h29UUfc4jrFYvAo7Y7TUcbNfdaMwZeCAC1hCVZVSqLWCMj0dsFOxb+qZc8zBrgCV6hBFocyhKHIBHAhMa+Ov6wJ6H+gPIEtcrZbCji9A605gOqVnN/84ZgwVdrudzM7dViuAhuaozTXLe2EJRJGaqqrcLfv5sFyOum7QWyszZJbDMNyVyue4odKuZmLoC4ahF9vwTHnxHJXu0VF3jrZTEtyEo6GcVYyWLDdYccPMh5hMyiy9WUuSUZQlcvIm+zPJcmR5LnleuP+8789eGVvmRhI2m7V4jdd6HSKjl8MrSRJ8fW4vdRrL5fusLpKXdPP0nDVYtpuZY+1HEcd7CfbrbR3nHjx4bAngeDwIC35y+/1uAprX+PwHdABFTyx8Kk0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;윈도우 크기에 따른 대기 시간&quot;
        title=&quot;&quot;
        src=&quot;/static/7b89a4c0bb5ca3f65ffa495cd077d205/f058b/figure4.png&quot;
        srcset=&quot;/static/7b89a4c0bb5ca3f65ffa495cd077d205/c26ae/figure4.png 158w,
/static/7b89a4c0bb5ca3f65ffa495cd077d205/6bdcf/figure4.png 315w,
/static/7b89a4c0bb5ca3f65ffa495cd077d205/f058b/figure4.png 630w,
/static/7b89a4c0bb5ca3f65ffa495cd077d205/40601/figure4.png 945w,
/static/7b89a4c0bb5ca3f65ffa495cd077d205/5caea/figure4.png 996w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;부하 감소: Leases 메커니즘&lt;/h3&gt;
&lt;p&gt;Leases는 Facebook이 개발한 핵심 메커니즘으로, 두 가지 주요 문제를 해결합니다.&lt;/p&gt;
&lt;h4&gt;Stale Sets 문제&lt;/h4&gt;
&lt;p&gt;오래된 데이터가 캐시에 저장되는 문제입니다. 동시 업데이트가 재정렬되면 발생합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;웹서버 A가 DB에서 데이터를 조회하는 동안&lt;/strong&gt;, 웹서버 B가 데이터를 업데이트하고 캐시를 삭제합니다. 하지만 웹서버 A는 이미 오래된 값을 가지고 있었고, 나중에 이를 &lt;strong&gt;캐시에 저장하여 최신 데이터를 덮어씁니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e503304c8899f0b72553331bc08d41cb/e5ca1/stale.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 91.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVR42p1UyW7bMBDV/39QLgGKXHzoJUjQxa6LJF5kS5Zk7dyX1yHlJEYABUgJPJEzFB9nZeI94si2Bo8LiaGdFK/6MC2yFRb5Cg4X5WVY67BLM7Td8KZLvMgBU4Gft8iW97DsBOgCXtVvPzEjMVr5gW4axhg4594JHdsSQQ7ZrFGt7+D4jsgOcCJ7N/PD8KQPJP6yH75BDkhAN8MweCtoR5EfIspwGnNDCAUhFbp+xMs2RV5UEEqDc4GEEwcjjNKjZW5aE6SZ5YMkMi4kmq5HWTWo6haMyIIuSWuHgmL6nCvcfj/hUFvkncepc/D4+kgG4RDQjhZZrdExG2Wurun8BZck0V7LgY575I3FeXDoKVIdIZm7KRzXdgJVBxwplJnW55E86D02BZXas8Ryr6NX5eCpbC4EmtI/Mk6zjXKIaThU060/Xwb8eB7iOhwcaM9Rhg2xh9lSdk3Msn+3UGuNgTGqq4kwuFz2Llqz3Iz4RaRhXXQWTJAZZKm/hp2Q/EfcIaibWElxTA3SB4FircAqT81xZWFoo1AO1k4WekP+yYJMr+jwX/DqKa4hT1SqFBoqX0kJlOMETVYbdUWoyOW+76PrkVB18HwPLzMUyzsUv7/RTxkc28Dr7ip1H8pm1i8KjDc8Ao76mOBCB5HlZ93iqM7YjBkeqjX+tPQOkHzSdXgcBAIc5zBk4avslZq9q9EDjqLEdsjw1O7x0h9w5CVK1SIxxyNcVeF8f4/09hb9ahVlWxSzj8OnnWK6DgGaSCSR66aJsh3H2UOO9mzb0itXQOx2kOk+yo7Ofa1sLhbbuoaiy/vHRxQ3N2gWC+jDAaYs8Q89k3tgQMMkbAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Stale Sets 문제&quot;
        title=&quot;&quot;
        src=&quot;/static/e503304c8899f0b72553331bc08d41cb/f058b/stale.png&quot;
        srcset=&quot;/static/e503304c8899f0b72553331bc08d41cb/c26ae/stale.png 158w,
/static/e503304c8899f0b72553331bc08d41cb/6bdcf/stale.png 315w,
/static/e503304c8899f0b72553331bc08d41cb/f058b/stale.png 630w,
/static/e503304c8899f0b72553331bc08d41cb/40601/stale.png 945w,
/static/e503304c8899f0b72553331bc08d41cb/78612/stale.png 1260w,
/static/e503304c8899f0b72553331bc08d41cb/e5ca1/stale.png 1332w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;Thundering Herds 문제&lt;/h4&gt;
&lt;p&gt;특정 키에 대한 읽기와 쓰기 활동이 많을 때 발생합니다. 쓰기 활동이 반복적으로 값을 무효화하면 많은 읽기가 비용이 큰 DB 경로로 가게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/26e8a088cb363593e91ca8c9e7037c3e/10ab7/thunder.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADHklEQVR42o2UWY/cRBSF/Td5QhES4q/wgoTgLUhJhIR4AAmekFg6yyQzk/QkTGaBns4009M905u7vbtcqz+uHUUCwUMsHdtVrjr31j33OGqbhrauQZ5NkrKazrm5vEJtd6BqQlnKN03TWkqvqFvDrsm5Wt9ycXPNIttSBU1ua2qvibTSxOstq+WGLMkIzvVwxmK1wQhZcB5lDCsJcruOidMMExw2eBpnUdZQC7S8R8Z6KmUolaVqFMX2N8rkCUrIlHbUWohdwEmQWk6hZK1Skqmsqba/YrRCyzot6611REEieSdHc3L0INDnBAFyxLZ1PbxkElyLNwEjm7yXsZ7g1QjwtHJv5RZCIHo9bfj0+w2f/bDhy58KvnoYuPfYc3fQyHvDFz8rFjGM1RWfH3zHYPCCp8+PGR6PefHqgucvzxj+fs7h0QnL1ZZoMHJ8+MDyyTeWO/c1d+4pPv5a9c+P7is+uKs4ncGqWfHtcMD+4WueHL7i0f4Rj54d8VDQjR8/e8nNYk2UKyeKKa7jhlnq+SvWXMp4VgTmVWC6ldpqOZbU0daetC5Z5jtW2U4UjtkUKWlVUou4xkgNnda4eINfL6HM8HmKrwrcZIz+46yvT5CadUrOiw2rKunVrY20ksxluiKuMxGtE84TWVGv8VLsTUy+95Tm5JQwvUbvH1CfnaOFsFtoBY0ouWkyhsmfnJZXzH3ML/ERP073JCq9YFEntek27BKMEJjRBWY8xr25xJYVWvqxI3QStFM6tjl76QnD8oJjNeG4mbC2Kc6+DRqZoqCazXCpTErDhqp6C3FIyHNCNyeZaQm8iROWux2JLilcJe6oSE1JZZo+u57QCWE5GlEI7GpFK+NWiHp070lCkIa2kmFZK5Q4Jy9ExGXFdFGR5apvaP2O0Hf2kuw6ePH0fyDZemuluVvZ6MUEnlx5Dt44DgVJ5XsXdQr3ovCeV6do2pT9DyAVu12niqlgJ3YtrSI3tfja/IOw887/XO9mE11wHl9yVdxyo9bELkGKRRpKEsHWF2Tyx3nvDEvbMEnnjLdTFnVM4sp/YWsLCqv4GwEZvE7vaTPXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Thundering Herds 문제&quot;
        title=&quot;&quot;
        src=&quot;/static/26e8a088cb363593e91ca8c9e7037c3e/f058b/thunder.png&quot;
        srcset=&quot;/static/26e8a088cb363593e91ca8c9e7037c3e/c26ae/thunder.png 158w,
/static/26e8a088cb363593e91ca8c9e7037c3e/6bdcf/thunder.png 315w,
/static/26e8a088cb363593e91ca8c9e7037c3e/f058b/thunder.png 630w,
/static/26e8a088cb363593e91ca8c9e7037c3e/40601/thunder.png 945w,
/static/26e8a088cb363593e91ca8c9e7037c3e/78612/thunder.png 1260w,
/static/26e8a088cb363593e91ca8c9e7037c3e/10ab7/thunder.png 1552w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;Leases 동작 방식&lt;/h4&gt;
&lt;p&gt;Memcached 인스턴스는 캐시 미스를 경험한 클라이언트에게 &lt;strong&gt;Lease&lt;/strong&gt;를 제공합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 1. 캐시 조회 (미스 시 lease 토큰 받거나 대기 알림 받음)&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;LeaseToken&lt;/span&gt; lease &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lease&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isMiss&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lease&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 2-1. Token을 받은 경우 (첫 번째 요청만): DB 조회&lt;/span&gt;
        value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 3. lease 토큰과 함께 캐시에 저장&lt;/span&gt;
        memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lease&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 2-2. Token 없는 경우 (나머지 요청들): 잠시 대기 후 재시도&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 수 밀리초 대기&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 캐시에서 재조회 (이미 저장됨)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Lease의 효과&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Memcached는 토큰을 검증하여 데이터 저장 여부를 결정&lt;/li&gt;
&lt;li&gt;해당 키에 대한 delete 요청을 받으면 토큰 무효화&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;10초당 키당 한 번만&lt;/strong&gt; 토큰 발행 (Thundering Herds 방지)&lt;/li&gt;
&lt;li&gt;토큰이 최근에 발행된 경우, 클라이언트에게 잠시 대기하라고 알림&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;실제 효과&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Thundering Herds가 발생하기 쉬운 키들을 1주일간 분석한 결과:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Leases 없이: 피크 DB 쿼리율 &lt;strong&gt;17K/s&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Leases 사용: 피크 DB 쿼리율 &lt;strong&gt;1.3K/s&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이는 DB 프로비저닝 비용을 크게 절감합니다.&lt;/p&gt;
&lt;h4&gt;Stale Values 허용&lt;/h4&gt;
&lt;p&gt;일부 사용 사례에서는 약간 오래된 데이터를 반환하는 것이 허용됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. delete(key) 실행
   ↓
2. 캐시에서 즉시 삭제하지 않고 &quot;최근 삭제된 아이템&quot; 임시 저장소로 이동
   ↓
3. GET 요청 시 선택:
   - Option A: lease token 발급 (DB에서 최신 값 가져오기)
   - Option B: stale로 마크된 오래된 값 즉시 반환
   ↓
4. 짧은 시간 후 임시 저장소에서 완전히 삭제 (flush)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;장점:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;애플리케이션이 stale 데이터로도 작동 가능하면 DB 조회 대기 불필요&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;예: 좋아요 수가 1초 전 데이터여도 사용자 경험에 큰 영향 없음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Memcache Pools&lt;/h3&gt;
&lt;p&gt;범용 캐싱 레이어로 Memcache를 사용하면 서로 다른 특성을 가진 데이터들이 같은 캐시 서버를 공유하게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;같은 Memcached 서버에:
- Low-churn 데이터: 변화 적고 계속 가치 있음 (사용자 프로필)
- High-churn 데이터: 빠르게 변하고 더 이상 접근 안 됨 (오래된 실시간 피드)

메모리가 부족하면?
→ LRU로 오래된 것 삭제
→ 가치 있는 Low-churn 데이터가 삭제됨
→ 더 이상 접근 안 하는 High-churn 데이터가 메모리 차지
→ 히트율 감소 (부정적인 간섭)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이런 &lt;strong&gt;부정적인 간섭&lt;/strong&gt;을 방지하기 위해 churn 특성별로 캐시 서버를 분리합니다.&lt;/p&gt;
&lt;h4&gt;Pool 분리 전략&lt;/h4&gt;
&lt;p&gt;클러스터의 Memcached 서버를 별도의 &lt;strong&gt;Pool&lt;/strong&gt;로 분할합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Wildcard Pool&lt;/strong&gt;: 기본 풀 (대부분의 데이터)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;특수 목적 Pool&lt;/strong&gt;: 문제가 되는 키들을 위한 별도 풀&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Pool 분리 예시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;작은 풀:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;데이터: 온라인 상태 표시 (자주 액세스)&lt;/li&gt;
&lt;li&gt;캐시 미스 시: 간단한 DB 쿼리 (비용 저렴)&lt;/li&gt;
&lt;li&gt;풀 크기: 작게 유지&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;큰 풀:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;데이터: 복잡한 머신러닝 결과 (드물게 액세스)&lt;/li&gt;
&lt;li&gt;캐시 미스 시: 수십 초 걸리는 재계산 (비용 매우 비쌈)&lt;/li&gt;
&lt;li&gt;풀 크기: 크게 할당 (미스 방지)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Churn 특성에 따른 분리&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Churn이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Churn은 데이터의 변동률을 의미합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Low-churn&lt;/strong&gt;: 데이터가 거의 안 바뀜 (사용자 프로필, 설정 등)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;High-churn&lt;/strong&gt;: 데이터가 자주 바뀜 (실시간 피드, 트렌딩 목록 등)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Low-churn 키&lt;/strong&gt;와 &lt;strong&gt;High-churn 키&lt;/strong&gt;를 같은 풀에 두면 문제가 발생합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;문제:
- Low-churn 키(여전히 가치 있음)가 제거됨
- High-churn 키(더 이상 액세스 안 됨)보다 먼저 제거됨&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이들을 다른 풀에 배치하면 이러한 부정적 간섭을 방지하고, High-churn 풀의 크기를 캐시 미스 비용에 적절하게 조정할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4111f4b0d8ab0fcc97081af19f14b3a2/8b69f/figure5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpElEQVR42l2S3WvTUBiH8/8JXgve+Ae464GXwzsFLxxeOfBCRTZBFHbrKEMtGam2SdbUraVps6Rp1jVts7RrPh7POaHTeeBH3nNe3uf9igYllaAoiluVZXnn/r82/jzP77xpElSW0pHh+z5RFOE4DrquU6//wDAMxuMxYRjS7/eZTCY0Gg1qtZr4GthWU/hGBEHAfD5DS5IFnjdUWiwWKst6fUOaXrNcpqxWS5E9J8sy4jhW3Uh/lq3wLkLe7X9l/8sJQXhFkszRRqOAVqspMvhIuAyQ0Or8tSVUViAskWSl3r7rHe49eM7LvWMBnHItgbJUyzJFuxcCmNwGS1XjKMmLTM1KdrDz7CNPnh5gdwKMXz3uP3zBqzffBDCuKkzTlNksVorjK+q6yfuDI+y2y3Q65fPhMZ8O6/jBWMwvYmt7j+2dD5htD+Nnh0ePd3n9tsZgOKoq3Gx502UUXdJsWWKGSzGrNaZp43R+kwlbHpn4/PxM+WQXjtOm1+uqpUqOVsEKpX9/ocHAxbYtut0zvOGQ01Mb1+0rmITIMbmuq5ZVxVecP3ZNUQ865KI4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;High-churn vs Low-churn 워킹셋&quot;
        title=&quot;&quot;
        src=&quot;/static/4111f4b0d8ab0fcc97081af19f14b3a2/f058b/figure5.png&quot;
        srcset=&quot;/static/4111f4b0d8ab0fcc97081af19f14b3a2/c26ae/figure5.png 158w,
/static/4111f4b0d8ab0fcc97081af19f14b3a2/6bdcf/figure5.png 315w,
/static/4111f4b0d8ab0fcc97081af19f14b3a2/f058b/figure5.png 630w,
/static/4111f4b0d8ab0fcc97081af19f14b3a2/8b69f/figure5.png 912w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;워킹셋 그래프 해석&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;워킹셋(Working Set)은 특정 기간 동안 실제로 사용되는 데이터의 총 크기입니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Low-churn 데이터&lt;/strong&gt;: 일일 워킹셋 ≈ 주간 워킹셋 (매일 같은 데이터 재사용)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;High-churn 데이터&lt;/strong&gt;: 일일 워킹셋 &amp;#x3C;&amp;#x3C; 주간 워킹셋 (매일 새로운 데이터 추가)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;일일과 주간 워킹셋의 차이가 클수록 churn rate가 높다는 의미입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;High-churn 데이터는 시간이 지나면 더 이상 접근하지 않지만 메모리를 차지하므로, 별도 풀로 분리하여 관리해야 합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Pool 내 복제&lt;/h3&gt;
&lt;p&gt;일부 풀에서는 Memcached 서버의 지연시간과 효율성을 향상시키기 위해 &lt;strong&gt;복제&lt;/strong&gt;를 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;복제를 선택하는 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;애플리케이션이 정기적으로 많은 키를 동시에 가져옴&lt;/li&gt;
&lt;li&gt;전체 데이터 세트가 1~2개의 Memcached 서버에 들어감&lt;/li&gt;
&lt;li&gt;요청 속도가 단일 서버가 처리할 수 있는 것보다 훨씬 높음&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;복제가 더 효율적인 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;키 분할 방식&lt;/strong&gt;에서는 각 클라이언트가 100개 키를 모두 필요로 하기 때문에 모든 서버에 접근해야 합니다. 서버를 나눠도 각 서버가 받는 총 요청 수는 줄지 않습니다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecd0da684182980d2f7fe9fffa047501/0c3d0/key.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42oWS608TURDF+9f70UQT/aCfiCZKSGokBhVMRMBY0RCLtF3oa7tlu93XvXt3u/RF+3O2ARFJdJKT2dyZPXPPnVMaDAbko4zMaIEiS1Oy0YjRX8iyjIt8jBt4tAc2Pf+ctmujtFrVUvnPFa5SomPsYcZu1WP/JKDlhIwyI40aHYYkzeYqa2MIvYD3pwc8OS7zqLLORu8jYaa4jjCKKBkVcdTW3Fvb4/76N75bHiznLJdLFpeXXM5mq1zEedfh+ZdNyo3XbHxao2x/YGiiVa3oD2VwScUxJp9Qb7tY9hA/SlBxRCoyl1eTJ0IYiSxjUpxwQCd26OlzyX3G08ntG0bRzYTrKL7yXo/o+JjAstCVCvNqFXmoq4ab3j/jn4Qjz8M/OyMW0nR3l5mQImr+S6iVIjY5tY6H1fUZBoriLMsvfkueieQ4STCJwfb71Lwm9UGLU79zV3IiS/nRSXhYrvJ4s8Zh3WUxnzCbzZmOx0wE0+mUxWKB07F5efiGpz/LPNh/xovONkEW316KVjH9MGfrc4Ptr026ruJCfJnIAozvY1otEsmpnMVim51WhbfdHd4dvWLLPbhrG6ffxxSek81quW0iRjXiuRUKmVIrciLIZfM91+GkWcdqNcQZFn4QoKVHyTM5Tp9fd2/rTp95rCMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;키 분할 방식&quot;
        title=&quot;&quot;
        src=&quot;/static/ecd0da684182980d2f7fe9fffa047501/f058b/key.png&quot;
        srcset=&quot;/static/ecd0da684182980d2f7fe9fffa047501/c26ae/key.png 158w,
/static/ecd0da684182980d2f7fe9fffa047501/6bdcf/key.png 315w,
/static/ecd0da684182980d2f7fe9fffa047501/f058b/key.png 630w,
/static/ecd0da684182980d2f7fe9fffa047501/40601/key.png 945w,
/static/ecd0da684182980d2f7fe9fffa047501/78612/key.png 1260w,
/static/ecd0da684182980d2f7fe9fffa047501/0c3d0/key.png 1414w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;반면 &lt;strong&gt;복제 방식&lt;/strong&gt;에서는 모든 서버가 전체 키를 가지고 있어 클라이언트가 아무 서버나 하나만 선택하면 됩니다. 이로 인해 요청이 여러 서버에 고르게 분산되어 각 서버의 부하가 실제로 감소합니다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/257d5063662868cad568656efa40b2b2/92338/replication.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVR42n2S22sTQRjF+8/7Ij4oCoIBbwURBInWVPTFXrVaxZA23SYm2WQ3zWw2e9/ZzXX35+xGKwHpB2duZzhzZuZsjUYj0kSSxKFCQCJjpJQlEpkoLlXjhDiOmU6nWI5NTxiYrmBgXzEQJlEUKT6i0NryPZe+FbHfEByej+mPPLLVkvl8jpxKRCCQqWSxWDCLU/b0U561a9z/tM3jRpWacUye5RTlOI4SdCf86HjcenrAnZffOL0UpDLE9wMFH+EIHM8hiEKsoaDW3KOiV7n95RF36895axySLVel4KQQ9JTDIJ7R7Fxx0RVqnJZkvj70unLWC1Y4oeXodMMhncBAd0z+UGuHRbMWyK/7vyg2zpYztImGZmuki5Sb6kbBLM/KuZu4nJgnHA2OsGJrw+1/BT3Pw4tSWn2L9mCMH8obrzwOHS7HPdqWgt1Hnww3r+y7NvVewIPqGQ93Lvh+OUJGPq7rYauI6JaOrfb4QYAwR+xqB2zr77m3v02l8Zp3w+PNT/HVDxp2ws5Bk93PLUw7KsnVKmOp4iNnKjLLhXqCnGU658j4yQvxkYr2iifdN3wQX8lX2T+HhmkSBIWjCZ7rqKh4ah5cIwzDsi8iJGNJ/2pA/dcZjW6TevccrdcquQKF1m/uZev2jHexcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;복제 방식&quot;
        title=&quot;&quot;
        src=&quot;/static/257d5063662868cad568656efa40b2b2/f058b/replication.png&quot;
        srcset=&quot;/static/257d5063662868cad568656efa40b2b2/c26ae/replication.png 158w,
/static/257d5063662868cad568656efa40b2b2/6bdcf/replication.png 315w,
/static/257d5063662868cad568656efa40b2b2/f058b/replication.png 630w,
/static/257d5063662868cad568656efa40b2b2/40601/replication.png 945w,
/static/257d5063662868cad568656efa40b2b2/78612/replication.png 1260w,
/static/257d5063662868cad568656efa40b2b2/92338/replication.png 1411w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;각 클라이언트는 자신의 IP 주소를 기반으로 복제본을 선택합니다. 일관성 유지를 위해 모든 복제본에 무효화를 전달해야 합니다.&lt;/p&gt;
&lt;h3&gt;장애 처리: Gutter 시스템&lt;/h3&gt;
&lt;p&gt;Memcache에서 데이터를 가져오지 못하면 백엔드 서비스에 과도한 부하가 발생하여 연쇄 장애를 일으킬 수 있습니다.&lt;/p&gt;
&lt;h4&gt;두 가지 규모의 장애&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;소규모 장애&lt;/strong&gt;: 네트워크나 서버 장애로 소수의 호스트에 접근 불가&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;광범위한 장애&lt;/strong&gt;: 클러스터 내 상당 비율의 서버에 영향&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;전체 클러스터를 오프라인으로 전환해야 하는 경우, 사용자 요청을 다른 클러스터로 우회시킵니다.&lt;/p&gt;
&lt;h4&gt;Gutter 메커니즘&lt;/h4&gt;
&lt;p&gt;소규모 장애를 위해 &lt;strong&gt;Gutter&lt;/strong&gt;라는 특수 시스템을 도입했습니다. Gutter는 실패한 몇 개 서버의 책임을 대신 맡는 작은 머신 세트입니다.&lt;/p&gt;
&lt;p&gt;클러스터 내 Memcached 서버의 약 &lt;code class=&quot;language-text&quot;&gt;1%&lt;/code&gt;를 차지합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 1. 일반 Memcached 서버에 요청&lt;/span&gt;
value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; memcache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 2. Gutter 풀에 재시도&lt;/span&gt;
    value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; gutterPool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 3. DB 조회 후 Gutter에 저장&lt;/span&gt;
        value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        gutterPool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; shortExpiration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Gutter의 효과&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Gutter 시스템 도입 후 실제 효과:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;실패를 히트로 전환&lt;/strong&gt;: 원래 Memcached 서버 장애로 실패했을 요청의 10~25%를 Gutter에서 성공적으로 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;장애율 99% 감소&lt;/strong&gt;: 클라이언트가 체감하는 캐시 실패율이 거의 사라짐&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;빠른 복구&lt;/strong&gt;: Memcached 서버가 완전히 다운되어도 4분 이내에 Gutter 히트율이 35% 이상으로 상승 (자주 50%까지 도달)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Gutter의 특징&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;짧은 만료 시간(short expiration)을 사용하여 약간 오래된 데이터를 제공하더라도 DB 부하를 줄임&lt;/li&gt;
&lt;li&gt;빠른 만료로 인해 별도의 무효화(invalidation) 메커니즘이 필요 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Rehashing을 사용하지 않는 이유&lt;/h4&gt;
&lt;p&gt;서버 장애 시 다른 접근 방법도 있습니다. 남은 정상 서버들에게 장애 서버의 키를 재분배(Rehashing)하는 것입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Rehashing의 문제점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;하지만 이 방식은 위험합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;시나리오: 10대 서버 중 1대 장애 발생

문제: 인기 있는 핫 키(예: 유명인 프로필)가 서버 전체 요청의 20%를 차지
→ 장애 서버가 이 핫 키를 담당했다면?
→ Rehashing으로 다른 정상 서버에 핫 키 재배치
→ 해당 서버에 갑자기 20% 추가 부하 발생
→ 그 서버도 과부하로 다운
→ 도미노처럼 연쇄 장애 발생&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Gutter의 장점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Gutter는 유휴 상태의 별도 서버 풀(클러스터의 1%)이므로:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;정상 서버에 추가 부하를 주지 않음&lt;/li&gt;
&lt;li&gt;핫 키 문제와 무관하게 안전하게 장애 처리&lt;/li&gt;
&lt;li&gt;연쇄 장애 위험 차단&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;다음 편에서는 지역 내/지역 간 확장과 성능 최적화를 다룹니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[HTTP, HTTPS 그리고 웹의 동작 원리]]></title><description><![CDATA[HTTP vs HTTPS HTTP는 데이터를 평문으로 전송한다. 즉, 중간에 누군가 패킷을 가로채면 내용을 그대로 볼 수 있다는 뜻이다. 로그인 정보, 결제 정보 같은 민감한 데이터가 그대로 노출될 수 있다. HTTPS…]]></description><link>https://gotobill.github.io/network2/</link><guid isPermaLink="false">https://gotobill.github.io/network2/</guid><pubDate>Tue, 23 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;HTTP vs HTTPS&lt;/h2&gt;
&lt;p&gt;HTTP는 데이터를 평문으로 전송한다. 즉, 중간에 누군가 패킷을 가로채면 내용을 그대로 볼 수 있다는 뜻이다. 로그인 정보, 결제 정보 같은 민감한 데이터가 그대로 노출될 수 있다.&lt;/p&gt;
&lt;p&gt;HTTPS는 이 문제를 해결하기 위해 HTTP에 &lt;strong&gt;보안 계층&lt;/strong&gt;(SSL/TLS)을 추가한 것이다. 데이터가 암호화되어 전송되기 때문에 중간에 패킷을 가로채도 내용을 해독할 수 없다.&lt;/p&gt;
&lt;h3&gt;HTTPS가 사용하는 3가지 보안 메커니즘&lt;/h3&gt;
&lt;p&gt;HTTPS는 단순히 &quot;암호화&quot;만 하는 게 아니다. 3가지 보안 메커니즘을 조합해서 사용한다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메커니즘&lt;/th&gt;
&lt;th&gt;목적&lt;/th&gt;
&lt;th&gt;사용 시점&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;제3자 인증&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;서버가 진짜인지 확인&lt;/td&gt;
&lt;td&gt;인증서 검증&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;공개키 암호화&lt;/strong&gt;(비대칭키)&lt;/td&gt;
&lt;td&gt;비밀키를 안전하게 공유&lt;/td&gt;
&lt;td&gt;핸드셰이크&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;비밀키 암호화&lt;/strong&gt;(대칭키)&lt;/td&gt;
&lt;td&gt;실제 데이터 암호화&lt;/td&gt;
&lt;td&gt;통신 전체&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;왜 공개키 암호화와 비밀키 암호화를 둘 다 쓸까? 공개키 암호화는 안전하지만 느리고, 비밀키 암호화는 빠르지만 키를 어떻게 공유할지가 문제다. 그래서 &lt;strong&gt;처음에 공개키로 비밀키를 안전하게 공유&lt;/strong&gt;하고, &lt;strong&gt;이후 통신은 빠른 비밀키로&lt;/strong&gt; 진행한다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;SSL/TLS Handshake 과정&lt;/h2&gt;
&lt;p&gt;TCP 3-way handshake가 끝나면 SSL Handshake가 시작된다. 이 과정을 통해 클라이언트와 서버는 암호화 통신에 사용할 비밀키를 안전하게 공유한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5ebee2c8c804a0425863b42af599674e/c1b63/tls.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.69620253164558%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3ElEQVR42oVUSXLbMBDUM2ItJMFFIEhwJyVKsuRItpPKwQdX5ZpKzqm8IXl6ZwZcbFkq+9AkMAAas/RgMhU5PtkpXLVBvv6KmShw42TnsHu8svGZhV+j3HyDCNfGxlwT/szcAo5ssEz2ZtNMVliEtYETt/DSrYHQ7Wi34zWmbm5IBrKRkDH3Ciy8EnPaJLMaQdoYhMUautkhrreQNB7sQb7C3C9hB3TpsjFOnRHOek+ZMIwy+LKDjApESW0gVTHa3WVmnHDkyqRrTs6cE7ovhErnCFQHGZcdYVqb8WD3wy4ql/LnRZvLkKci6z0lr+iAJzvwwVDXUElD42K0u3IgbI2HZ4Ts3cKvYC9XlMcCKk4RhC8hK10iJO9kRN6RbVjjcxwyV/mMkIvhqjVV+RYWJXlBFbSTlrCBX+5HiGwHS7dmzS13YyEuqjxoi8PmP9/M4SiSisr20NXR/NP6DrrY9/ke1FGOxGc5ZM9c1ZoN86CCRVr02RPSoYjW9GfJbIxtsaR10uK0v3ggP8sh58KPtobQjhoS7gqWajrwPGrGOa+JtO0I3auEJGoSKZff5FARGeexh9Xj9VxkVFkmo1adXusUJmUyDsEjeQj5AWgPR8Nn7KudwokWLOwMSZaRTN7HUmVGHR6lKdC3mF12ClXLq0xOTKdEPfrOeDv3Vd6naQvn7Wtj8cPgakKEqU1wUvon9GQl3ZhwczFnaEwtRZBkozFFOOFNjn6APv5GdPoLUf1CkN3Ra/JAOBHue5xe5sUDZPkIt3hC9PkP1OkfrOSZLoiIkG6bBfTWFc8Q5Q/Y+gl+eoCr9+/gABHvSEpHeOV3iPon5uEDeZlg4pBI8/qAmGTA/ekEGSyf38bcwKbxdZBefVr3NGxKlRN078FEkOLX+0fUmy/IV/eo2kdkzRFxcUBS3cEjTbphcxViHHd7uEgTi9pMpjtIegiWemP+MtkaqOy2OyjrD+ESLL/Ef7uQbmynjxaUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tls&quot;
        title=&quot;&quot;
        src=&quot;/static/5ebee2c8c804a0425863b42af599674e/f058b/tls.png&quot;
        srcset=&quot;/static/5ebee2c8c804a0425863b42af599674e/c26ae/tls.png 158w,
/static/5ebee2c8c804a0425863b42af599674e/6bdcf/tls.png 315w,
/static/5ebee2c8c804a0425863b42af599674e/f058b/tls.png 630w,
/static/5ebee2c8c804a0425863b42af599674e/40601/tls.png 945w,
/static/5ebee2c8c804a0425863b42af599674e/c1b63/tls.png 1200w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;단계별 설명&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. Client Hello&lt;/strong&gt;
클라이언트가 지원하는 암호화 방식 목록과 &lt;strong&gt;Client Random&lt;/strong&gt;(랜덤 데이터)을 서버에 전송한다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Server Hello + 인증서 전송&lt;/strong&gt;
서버가 암호화 방식을 선택하고, &lt;strong&gt;Server Random&lt;/strong&gt;과 함께 자신의 인증서를 보낸다. 이 인증서 안에 서버의 공개키가 들어있다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. 인증서 검증&lt;/strong&gt;
클라이언트는 받은 인증서가 신뢰할 수 있는 &lt;strong&gt;CA&lt;/strong&gt;(인증기관)가 발급한 것인지 확인한다. 브라우저에는 주요 CA들의 공개키가 미리 내장되어 있어서, CA의 서명을 검증할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Pre-Master Secret 전송&lt;/strong&gt;
클라이언트가 &lt;strong&gt;Pre-Master Secret&lt;/strong&gt;을 생성하고, &lt;strong&gt;서버의 공개키로 암호화&lt;/strong&gt;해서 전송한다. 서버만 자신의 개인키로 이를 복호화할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Session Key 생성&lt;/strong&gt;
양쪽 모두 &lt;strong&gt;Client Random + Server Random + Pre-Master Secret&lt;/strong&gt;을 조합해서 동일한 &lt;strong&gt;세션 키&lt;/strong&gt;(대칭키)를 생성한다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6. 암호화 통신 시작&lt;/strong&gt;
이후 모든 HTTP 데이터는 이 세션 키로 암호화되어 전송된다.&lt;/p&gt;
&lt;h3&gt;왜 Random 데이터가 필요한가?&lt;/h3&gt;
&lt;p&gt;Pre-Master Secret만 사용하면 같은 값을 재사용할 경우 동일한 Session Key가 생성된다. 매 연결마다 다른 Random 값을 사용하면:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;재생 공격 방지&lt;/strong&gt;: 공격자가 이전 통신을 녹화해서 재전송해도, Random 값이 다르므로 Session Key가 달라진다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;세션 고유성&lt;/strong&gt;: 같은 서버에 여러 번 연결해도 각 세션이 독립적으로 동작한다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;예측 불가능&lt;/strong&gt;: 공격자가 Session Key를 추측할 수 없다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;핵심 포인트&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;인증서는 &lt;strong&gt;CA의 개인키로 서명&lt;/strong&gt;되어 있고, &lt;strong&gt;CA의 공개키로 검증&lt;/strong&gt;한다&lt;/li&gt;
&lt;li&gt;Pre-Master Secret은 &lt;strong&gt;서버의 공개키로 암호화&lt;/strong&gt;하고, &lt;strong&gt;서버의 개인키로 복호화&lt;/strong&gt;한다&lt;/li&gt;
&lt;li&gt;실제 통신은 &lt;strong&gt;세션 키&lt;/strong&gt;(대칭키)로 암호화한다&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;HTTP 메서드&lt;/h2&gt;
&lt;p&gt;HTTP 메서드는 클라이언트가 서버에 &lt;strong&gt;어떤 동작을 요청하는지&lt;/strong&gt;를 나타낸다.&lt;/p&gt;
&lt;h3&gt;주요 메서드&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;메서드&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;th&gt;CRUD&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GET&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;리소스 조회&lt;/td&gt;
&lt;td&gt;R&lt;/td&gt;
&lt;td&gt;캐싱 가능, Body 없음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;POST&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;리소스 생성&lt;/td&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;멱등성 없음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;PUT&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;리소스 전체 수정/생성&lt;/td&gt;
&lt;td&gt;C, U&lt;/td&gt;
&lt;td&gt;리소스 없으면 생성&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;PATCH&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;리소스 부분 수정&lt;/td&gt;
&lt;td&gt;U&lt;/td&gt;
&lt;td&gt;일부 필드만 수정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;DELETE&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;리소스 삭제&lt;/td&gt;
&lt;td&gt;D&lt;/td&gt;
&lt;td&gt;리소스 없어도 동일 동작&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;GET vs POST 차이&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;GET 요청&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버에 존재하는 정보를 &lt;strong&gt;조회&lt;/strong&gt;한다&lt;/li&gt;
&lt;li&gt;Request Body를 사용하지 않는 것이 관례. 레거시 시스템은 Body가 있으면 거부하기도 함&lt;/li&gt;
&lt;li&gt;응답이 &lt;strong&gt;캐싱&lt;/strong&gt;될 수 있음&lt;/li&gt;
&lt;li&gt;같은 요청을 여러 번 해도 결과가 같다. 멱등성&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;POST 요청&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버에 새로운 리소스를 &lt;strong&gt;생성&lt;/strong&gt;한다&lt;/li&gt;
&lt;li&gt;Request Body에 데이터를 담아 전송&lt;/li&gt;
&lt;li&gt;서버 상태를 변경하므로 &lt;strong&gt;멱등성이 없음&lt;/strong&gt;. 같은 요청을 두 번 하면 두 개가 생성됨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;알아두면 좋은 메서드&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;OPTIONS&lt;/strong&gt;: 해당 URI에서 서버가 허용하는 메서드 목록 확인. CORS preflight에서 사용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HEAD&lt;/strong&gt;: GET과 동일하지만 Body 없이 헤더만 반환&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;보안 관점&lt;/h3&gt;
&lt;p&gt;불필요한 HTTP 메서드는 비활성화하는 것이 좋다. 예를 들어 PUT, DELETE가 필요 없는 API라면 해당 메서드를 허용하지 않는 &lt;strong&gt;Whitelist 방식&lt;/strong&gt;으로 관리한다. HTTP Method 취약점으로 검색하면 관련 보안 이슈를 확인할 수 있다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;REST API&lt;/h2&gt;
&lt;p&gt;REST는 HTTP URI로 &lt;strong&gt;자원을 표현&lt;/strong&gt;하고, HTTP Method로 &lt;strong&gt;자원에 대한 행위를 표현&lt;/strong&gt;하는 아키텍처 스타일이다.&lt;/p&gt;
&lt;h3&gt;특징&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;사람이 읽을 수 있는 API&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;/users/123&lt;/code&gt;을 보면 &quot;123번 유저&quot;라는 것을 직관적으로 알 수 있다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP 활용&lt;/strong&gt;: HTTP의 특성인 캐싱, 상태 코드 등을 그대로 사용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;별도 인프라 불필요&lt;/strong&gt;: HTTP만 있으면 됨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;단점&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;명확한 표준이 없음&lt;/strong&gt;: 회사마다, 개발자마다 구현이 다름&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;완전한 REST 구현이 어려움&lt;/strong&gt;: Roy Fielding이 정의한 REST의 모든 조건을 만족시키기는 매우 어렵다 (&quot;그런 REST API로 괜찮은가&quot; 발표 참고)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;HATEOAS&lt;/h3&gt;
&lt;p&gt;REST의 제약 조건 중 하나로, 응답에 &lt;strong&gt;관련 동작의 URI를 함께 제공&lt;/strong&gt;하는 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;John&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;links&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;rel&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;self&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;href&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/users/123&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;rel&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;orders&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;href&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/users/123/orders&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;rel&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;delete&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;href&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/users/123&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;method&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;DELETE&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;클라이언트는 하드코딩된 URI 대신 응답에 포함된 링크를 따라가면 되므로, API 변경에 유연하게 대응할 수 있다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;CORS (Cross-Origin Resource Sharing)&lt;/h2&gt;
&lt;p&gt;CORS는 &lt;strong&gt;서로 다른 출처(Origin) 간에 리소스를 공유&lt;/strong&gt;하는 메커니즘이다.&lt;/p&gt;
&lt;h3&gt;왜 기본적으로 차단하는가?&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;CSRF&lt;/strong&gt;(Cross-Site Request Forgery) 공격을 막기 위해서다.&lt;/p&gt;
&lt;p&gt;예를 들어, 사용자가 &lt;code class=&quot;language-text&quot;&gt;bank.com&lt;/code&gt;에 로그인한 상태에서 악성 사이트 &lt;code class=&quot;language-text&quot;&gt;evil.com&lt;/code&gt;을 방문했다고 하자.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;evil.com&lt;/code&gt;의 스크립트가 &lt;code class=&quot;language-text&quot;&gt;bank.com/transfer?to=hacker&amp;amp;amount=1000000&lt;/code&gt; 같은 요청을 보낸다면?&lt;/p&gt;
&lt;p&gt;브라우저는 &lt;strong&gt;요청의 목적지 도메인을 보고 해당 도메인의 쿠키를 자동으로 첨부&lt;/strong&gt;한다. &lt;code class=&quot;language-text&quot;&gt;evil.com&lt;/code&gt;이 쿠키를 &quot;읽는&quot; 게 아니라, 브라우저가 &lt;code class=&quot;language-text&quot;&gt;bank.com&lt;/code&gt;으로 가는 요청에 &lt;code class=&quot;language-text&quot;&gt;bank.com&lt;/code&gt; 쿠키를 알아서 붙이는 것이다. 그래서 사용자 모르게 인증된 요청이 실행될 수 있다.&lt;/p&gt;
&lt;p&gt;Same-Origin Policy는 이런 공격을 방어한다. &lt;code class=&quot;language-text&quot;&gt;evil.com&lt;/code&gt;에서 &lt;code class=&quot;language-text&quot;&gt;bank.com&lt;/code&gt;으로 요청을 보내면, 브라우저가 &lt;strong&gt;응답을 차단&lt;/strong&gt;해버린다. 다만 요청 자체는 서버에 도달할 수 있어서, 추가로 CSRF 토큰 같은 방어가 필요하다.&lt;/p&gt;
&lt;h3&gt;정상 요청&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b9fcaae02e3bb25c85607a8330ab6ffc/efa1a/csrf_normal.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACS0lEQVR42nWS227TQBCG/QaAmsTxIbbj0/oUe+3EsR2nIW1AgqpVbyuhcrgBCYk3oUL0hsf9md0kKKBy8Wl2dmf+nZldZWTNMLJyqPae4SSDn/VoXt6iWl1hublFfX4jWayvJel8B5F3zDlF0aYcp4hAmy2RVJdgxUbaI3F5gVn9Wl74X0Ev7RBQgJt0cEho7BQYUvDATCVnRnKA1gdfdCHinkIZ6AxDI5IMDIaRGUOzM6hWijGhOxn5KQyyupNKxLmIO+YdGZkJlGcDG8+HDl6MppKzsQfdjsEihjRhyGcR2RAlT8DzCAntaVYk4445EtI400Iok6CC6Zc0kwz7B5pRS1SdqFJUQlWq1t7uyeT5abx6sALFjVdwox66W5MIzYEGK6wq18Vfe3JOp3v0O8Se6tKDeLm0ShC9x7p7QFs/YuJfQqUZjem1x9NC4kRLTOnBxKPZtFad4s+Z5nCoaYHg3RbR1zfQrxooUfIRffuAZv4TVriDHhTEHBqNwYpJLK3B8hJRUUmcuKKzimIqGCIuKzG9W8P7stsLsuQDCX4nwR9SUAtyaF6FscdhhnOqrgWblYhzjmjGMQm47ECjc1lhXMC928D/TIJvSTAMP2HdPqKtfsF0L6BOU9mWQHM57LiBG5cIMw5GGF5J+3sMly5OOfz7Ldg3avlatHz+CunmBsn5NYJ+A7ftwNZ042pN9NK36gZ6OYdeLWDO/6FeYNIvYW1bGOQrASUFXQefEv2uh9eswEg46HqJ8J1FA4PT9yLRpzAKgtOFSYnfMUmBPVbmWgMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;csrf 정상&quot;
        title=&quot;&quot;
        src=&quot;/static/b9fcaae02e3bb25c85607a8330ab6ffc/f058b/csrf_normal.png&quot;
        srcset=&quot;/static/b9fcaae02e3bb25c85607a8330ab6ffc/c26ae/csrf_normal.png 158w,
/static/b9fcaae02e3bb25c85607a8330ab6ffc/6bdcf/csrf_normal.png 315w,
/static/b9fcaae02e3bb25c85607a8330ab6ffc/f058b/csrf_normal.png 630w,
/static/b9fcaae02e3bb25c85607a8330ab6ffc/40601/csrf_normal.png 945w,
/static/b9fcaae02e3bb25c85607a8330ab6ffc/78612/csrf_normal.png 1260w,
/static/b9fcaae02e3bb25c85607a8330ab6ffc/efa1a/csrf_normal.png 2040w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;csrf 토큰을 통한 방어&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/895c70e53353f14c62931037a2fcb559/ac307/csrf_defense.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACyElEQVR42o1Ty3LTQBBUUVw4EAhxbMmWVtJq9bBl+SXL7yR2SIpQqaKgCOEDyIEDV258Ale+t+ld2YEbHFqzOzvTOz2zspqigEbLHxjrqhJFdY3z63ssdx9Qrm8NNlefsH59h9XlR7NebN/DDkYm729YbTlGJxqjHfKQhHY4hBdXkL0VsUSQzQ1Uf40oXxl/lK/NmR0M/5AFNSw/ncHrLtAIx3gp6sNTr2/QcPNHnHR6j9D7Uy83sbYmc6my3UerU8ByRR8PcR8/yyW+xwUaDGjz5jatoHzFSlRvYazszhERXjQxRDrO9gsEtyv0Hm4g7jawOnTchj18IdldmMOmbI++ju4nk3w5gs+WaOuFe1CazvP2sFcTuDdzOBdTWMd2jCenEtZJiKdNieOWRLOTwPF7JO+i5WVoul1IpaBUiFCGSBIJEUR4sY8/Pgpw9MzDq+fkcSh5ywrvkwHessIG91qGwyo8NYGflMQUfjxBmE4gM70eM4Y9EzWcagxvN4OzKjkUyvoW5/g1nuOHYqM5GEGfS8khpUZxiTitoJIKEaE4RBlPKXuEgPJFOED4bo386w38z2ewZt0KV+UFtqMNdrSXww2uad9UO1xNzrEdrLBgdXM1xjyusTCYGCwTnvHiuRxiwj5bkp+E0g6IeahtRqkpqzM+xqh/QMdIvmFLUEYy2CAdnhmbsEKRTuEwoB3Vj77DZ6Kh9/WPsF/v4Uht6xhLsIqMJPqN+VwHHIBgVR4DDzjsZTZD0l+afZwvTaxiXlqszJnLGEtPMqEjZqC2h7XK6302WJtJe+yXpA1YvWDf/KwyftHl1JN67SpNqPvExLRYI2WyrrY7OjMI0so8GUEyfbFIy9oSAX0ubUoiFZdmrVFL1j0sNBmJiJDlayKdbAgYY5Dp6krTGhnrqkvkrDjVsXF9mdVhQ8V+c0jUvfhfiP2l7n6AvwGDy9l9nPAtDgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;csrf 방어&quot;
        title=&quot;&quot;
        src=&quot;/static/895c70e53353f14c62931037a2fcb559/f058b/csrf_defense.png&quot;
        srcset=&quot;/static/895c70e53353f14c62931037a2fcb559/c26ae/csrf_defense.png 158w,
/static/895c70e53353f14c62931037a2fcb559/6bdcf/csrf_defense.png 315w,
/static/895c70e53353f14c62931037a2fcb559/f058b/csrf_defense.png 630w,
/static/895c70e53353f14c62931037a2fcb559/40601/csrf_defense.png 945w,
/static/895c70e53353f14c62931037a2fcb559/78612/csrf_defense.png 1260w,
/static/895c70e53353f14c62931037a2fcb559/ac307/csrf_defense.png 2058w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;그럼 CORS는 언제 필요한가?&lt;/h3&gt;
&lt;p&gt;프론트엔드(&lt;code class=&quot;language-text&quot;&gt;localhost:3000&lt;/code&gt;)에서 백엔드 API(&lt;code class=&quot;language-text&quot;&gt;localhost:8080&lt;/code&gt;)를 호출하는 건 일상적인 일이다. 하지만 포트가 다르면 다른 출처로 간주되어 Same-Origin Policy에 걸린다.&lt;/p&gt;
&lt;p&gt;CORS는 서버가 &quot;이 출처는 접근을 허용해&quot;라고 명시적으로 알려주는 방법이다. 신뢰할 수 있는 출처만 허용 목록에 추가하면, 보안을 유지하면서 필요한 크로스 오리진 요청을 허용할 수 있다.&lt;/p&gt;
&lt;h3&gt;Preflight Request&lt;/h3&gt;
&lt;p&gt;브라우저는 실제 요청을 보내기 전에 &lt;strong&gt;OPTIONS 메서드로 사전 요청&lt;/strong&gt;을 보낸다. 이를 &lt;strong&gt;Preflight Request&lt;/strong&gt;라고 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;OPTIONS /api/users HTTP/1.1
Origin: https://frontend.com
Access-Control-Request-Method: POST&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;서버가 CORS를 허용하면 아래와 같이 응답한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://frontend.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 응답을 받은 후에야 브라우저는 실제 요청을 보낸다.&lt;/p&gt;
&lt;h3&gt;Simple Request vs Preflight&lt;/h3&gt;
&lt;p&gt;모든 cross-origin 요청에 Preflight가 발생하는 건 아니다. &lt;strong&gt;Simple Request&lt;/strong&gt; 조건을 만족하면 Preflight 없이 바로 요청이 간다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Simple Request 조건&lt;/strong&gt; (모두 만족해야 함)&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;조건&lt;/th&gt;
&lt;th&gt;허용 값&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;메서드&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;GET, HEAD, POST만&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Content-Type&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;application/x-www-form-urlencoded&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;multipart/form-data&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;text/plain&lt;/code&gt;만&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;헤더&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Accept, Accept-Language, Content-Language, Content-Type만&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Preflight가 필요한 경우&lt;/strong&gt; (위 조건 중 하나라도 벗어나면)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Content-Type: application/json&lt;/code&gt; 사용&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 헤더 사용&lt;/li&gt;
&lt;li&gt;커스텀 헤더 사용 (예: &lt;code class=&quot;language-text&quot;&gt;X-Custom-Header&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;PUT, DELETE, PATCH 메서드 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;왜 이렇게 나눴을까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HTML &lt;code class=&quot;language-text&quot;&gt;&amp;lt;form&gt;&lt;/code&gt; 태그는 Same-Origin Policy 이전부터 cross-origin 요청이 가능했다. 하위 호환성을 위해 이 범위의 요청은 Simple Request로 허용한다.&lt;/p&gt;
&lt;p&gt;반면 &lt;code class=&quot;language-text&quot;&gt;fetch()&lt;/code&gt;로 JSON을 보내거나 커스텀 헤더를 붙이는 건 JavaScript에서만 가능한 동작이므로, Preflight로 서버 허락을 먼저 받아야 한다.&lt;/p&gt;
&lt;h3&gt;주요 CORS 헤더&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;헤더&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Access-Control-Allow-Origin&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;허용할 출처 (&lt;code class=&quot;language-text&quot;&gt;*&lt;/code&gt;는 모든 출처)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Access-Control-Allow-Methods&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;허용할 HTTP 메서드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Access-Control-Allow-Headers&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;허용할 요청 헤더&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Access-Control-Allow-Credentials&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;인증 정보(쿠키 등) 포함 허용 여부&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;OSI 7계층과 TCP/IP 4계층&lt;/h2&gt;
&lt;p&gt;네트워크 통신을 이해하려면 계층 구조를 알아야 한다. OSI 7계층은 이론적 표준이고, 실제로는 TCP/IP 4계층을 많이 사용한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aa20b91b83331a44d433c260b6470d0a/5eb90/osi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAENElEQVR42pWUWYxTZRTHb4z6RAYzDO107+2+3tv2drpM92VmnA62BWZfpCKMoqIhhgdQI9G4oQkhGIgIguJIkAQd0BglYnwwPhhjYkzQN5cnffb959feBhU1wYeT3O373XPO/3+OZHREGLL5sPk1vGoJj5Jns93Xe2Z0KP8aQzY/Fk+coFbvfS+HM2yyeTA4wkgWVw6PfxZvYBl/aCf+4C4CwVVxv9IHRP8CizLsiOHytfAFlsT39/XOBEK7xbndWF0FJI9/hnTsdSr5NWbaH7G1cZVq5nMKqfUeZNgZwySLcMZ79yZnEk19gWzyJK3Gu0y3rlDLr1NKXRWJLSC5fE2S6hFy6ePUi29RK5ynmH6PTOJ0D2CwR7H70ti8KQFXdWDsFfKpM4yVLjBRWRdnPqSSuSaqWkKSvW1S8ROkEq+RSZ5hdORtStn3yaZP6WU6FQHM9OERHagcJq2eIq2cIaueJx+/RDn5MR7vPJI/eD/FkWtsqX/BjvnvWJn9gXtqPzFe+kpA1F5WFndSh9tFuBTMY1kszSLmdhHLTBnLQg3rjnFM8WS35G0iszfIZ89SFuXWShdFfEBu9LQuQrdMOYFRVjG7RR/dCoPLMQZWVfxPNIg/P8PggVE2HspiKGpIwfAqk9VvmRr7hsW568xNf8/c3C+0t3+pi9AVRI5jFjbpwo2ygquh4plRCC1qqDtGCHQ0grs0rFoMKRzZS6v+M3PNH3l09VdWO7/RWfyd+ZnrN+xicgmoOyZ8pmCVozxcNHCwfhfPNK28NOvixeYAR6c3kFc9woeRHN7GAt4tC3iaS3i3rxBc2olv23zfNgIosrOI3llcKjY5wsGJAV7ecjvH7zVxdo+bk4u3sdaRqGlOJEMmysadAYYeVFCevhv3U2UGDihs2pfQgSK7LtTqivYsZBJlp9JlcvkJRnOT5AtNipUFqmMd3KE8kjERxzSfxLycwvdABdeeEuaHspg72b5VhG08MazeZK+Hw7LGcG4/rsmjKNNrRGaviGo+xdD4muFoBykZ9vFI1cDeuoHHJ43sbwxxqD3IvoaxPxlR5FBaKKzpGQvF7Zm9eGrPkmi9Sqx1msDUOzjG1zGHZ5EqMZnDU3dwZNsG1h6L8eaqhXPLEsfm7xRzKwDCOjZ/Wle4P9ddqNGpsdkhQhjdII+I1qR6vpWCIZV2OU67kmJrbZTp8QJLjTLterGvshBCjN7fNo7oZS96P4joYY/03knDoUmMhSexVg+jTp/D27yIYewTjNVLfcsIhcUc64CbV5l6Uyhd20xhrzyHd+IYybkLRLdfxjH1mejJ5RvGNrsS/wH8Z0hm0Q+nr4DDVxJRweEXSzPSEBYY00evOyn/B2gVzZbFhc+jUSm3SKdqBMX2DgVTfQH6I3cLML1kkYEsLOH2jqAmqoSVotjGGbHbMn8KcIuwLvAPmzWZQyNUUnoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;osi&quot;
        title=&quot;&quot;
        src=&quot;/static/aa20b91b83331a44d433c260b6470d0a/f058b/osi.png&quot;
        srcset=&quot;/static/aa20b91b83331a44d433c260b6470d0a/c26ae/osi.png 158w,
/static/aa20b91b83331a44d433c260b6470d0a/6bdcf/osi.png 315w,
/static/aa20b91b83331a44d433c260b6470d0a/f058b/osi.png 630w,
/static/aa20b91b83331a44d433c260b6470d0a/40601/osi.png 945w,
/static/aa20b91b83331a44d433c260b6470d0a/78612/osi.png 1260w,
/static/aa20b91b83331a44d433c260b6470d0a/5eb90/osi.png 1612w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;계층별 역할과 헤더 구조&lt;/h3&gt;
&lt;p&gt;각 계층은 &lt;strong&gt;자신만의 헤더&lt;/strong&gt;를 가진다. 데이터가 전송될 때 위에서 아래로 내려가면서 각 계층의 헤더가 추가된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Ethernet Header] + [IP Header] + [TCP Header] + [HTTP Data]
      L2              L3            L4             L7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;헤더&lt;/th&gt;
&lt;th&gt;핵심 정보&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Ethernet Header&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;MAC 주소&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;같은 네트워크 내에서 다음 장비까지 전달&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L3&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;IP Header&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;IP 주소&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;최종 목적지까지 경로 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;TCP/UDP Header&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;포트 번호&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;어떤 프로세스에 전달할지 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L7&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;HTTP 데이터&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;애플리케이션이 실제로 사용하는 데이터&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;각 계층이 하는 일&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;L2 Data Link&lt;/strong&gt; - &quot;다음 장비로 전달&quot;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MAC 주소&lt;/strong&gt;로 같은 네트워크 내의 다음 장비를 찾는다&lt;/li&gt;
&lt;li&gt;라우터를 거칠 때마다 &lt;strong&gt;MAC 주소가 바뀐다&lt;/strong&gt; (다음 hop의 MAC으로 변경)&lt;/li&gt;
&lt;li&gt;스위치가 이 계층에서 동작&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;L3 Network&lt;/strong&gt; - &quot;최종 목적지까지 경로 결정&quot;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IP 주소&lt;/strong&gt;는 출발지부터 목적지까지 &lt;strong&gt;변하지 않는다&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;라우터가 IP 주소를 보고 어느 방향으로 보낼지 결정&lt;/li&gt;
&lt;li&gt;라우터가 이 계층에서 동작&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;L4 Transport&lt;/strong&gt; - &quot;어떤 프로세스로 전달?&quot;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;포트 번호&lt;/strong&gt;로 같은 IP의 여러 프로세스 중 어디로 보낼지 결정&lt;/li&gt;
&lt;li&gt;TCP: 신뢰성 보장 (순서, 재전송)&lt;/li&gt;
&lt;li&gt;UDP: 빠르지만 신뢰성 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;L7 Application&lt;/strong&gt; - &quot;실제 데이터 처리&quot;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP, FTP, SMTP 등 애플리케이션 프로토콜이 동작&lt;/li&gt;
&lt;li&gt;사용자가 실제로 주고받는 데이터를 처리&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;택배 비유로 이해하기&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;택배 비유&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L7&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;택배 박스 안의 &lt;strong&gt;실제 물건&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;아파트 &lt;strong&gt;동/호수&lt;/strong&gt; (같은 주소지만 어느 집인지)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L3&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;배송 &lt;strong&gt;주소&lt;/strong&gt; (목적지까지 변하지 않음)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;중간 경유지&lt;/strong&gt; 주소 (물류센터 → 허브 → 대리점, 계속 바뀜)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;핵심&lt;/strong&gt;: IP 주소는 &quot;최종 목적지&quot;라서 변하지 않고, MAC 주소는 &quot;다음 경유지&quot;라서 라우터를 거칠 때마다 바뀐다.&lt;/p&gt;
&lt;h3&gt;라우터의 동작 원리&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a797e09682202fca812238db14e25299/8deec/router.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYklEQVR42j2S227TQBCG/Qhp4tjx2Y0bJ7bXxyZOnLhJD0BPaSmFqqWIUgrtDUKiQlxwyRsgXoEH/Zm1Sy5+jb0z37+zsytIFoNiD+G6t9C7C0imj44drySaMQrmYJHYaFsxZCta5WQzguxGaC/ou08yIgjcQOuWKEd/4fQvIBoulPUMmrNJMcGaHuN+V8PjoYyWURupTgrFSSDrZJ4kUL9O0clSyFrIDSMo3Qzx+BhGLwf/513IZlhF0QjhpwsE2Tbaq1wtXqs6GaJiv/KQ6QSCbAbomB70dY+iS20Paui/DA+K5UO1A0i6u9qoNq5ZjfKK0atqhaaRoNHdgeQt0eyfoWFtUzGrdpNMBskpoAUHUP0lxN6S1uInM4amkaHZewbZP0XDvcCaNYfgeUOcH1zi6uQD7t48YDJ+BVH3K0PVZjh5cYSby3vcXT/g3cUXGE5WGbb0ABEb43J5javTT3j/+juGm0sIbrqBkxuG888prr6FyPcdiBp1QMPnR53nJo53u3j5fB3LPRWaPahyLarxcwdnH0NiE1w/Bkh3NiCo/T248x+Ij34hXP6Gmd1CollwiB+5YQzRtEu0aCwNi54VXRK/aUkfQPMP0d/9WbPHf2DEbyF0jBS6PoVpzmDqC3S0EdoGXQANX9QCtBX65h1rNDs1qtfItE2bdTTOEmeWFavqIwg9L0IQhfAYA4sjTGYzFNMtjMZTFLM5thY7mJZzTKZlFfnauCgxzAuqKRDSO+RsEDG4Pj3sjUGMgCXwg1osyhCEKZIsJ2BG8FYVN0dFpXxSVjmfGF7nP7EBqTeI8Q+C8E9T2xi2SwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;router&quot;
        title=&quot;&quot;
        src=&quot;/static/a797e09682202fca812238db14e25299/f058b/router.png&quot;
        srcset=&quot;/static/a797e09682202fca812238db14e25299/c26ae/router.png 158w,
/static/a797e09682202fca812238db14e25299/6bdcf/router.png 315w,
/static/a797e09682202fca812238db14e25299/f058b/router.png 630w,
/static/a797e09682202fca812238db14e25299/40601/router.png 945w,
/static/a797e09682202fca812238db14e25299/78612/router.png 1260w,
/static/a797e09682202fca812238db14e25299/8deec/router.png 2136w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;라우터는 &lt;strong&gt;L3까지만&lt;/strong&gt; 본다. IP 주소를 확인해서 &quot;이 패킷을 어느 방향으로 보낼지&quot;만 결정하고, 포트 번호(L4)나 HTTP 데이터(L7)는 확인하지 않는다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;스위치 vs 라우터의 차이&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;스위치&lt;/strong&gt;(L2): MAC 주소를 보고 &lt;strong&gt;같은 네트워크 내&lt;/strong&gt;에서 전달. 아파트 내 우편함 분류.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;라우터&lt;/strong&gt;(L3): IP 주소를 보고 &lt;strong&gt;다른 네트워크로&lt;/strong&gt; 전달. 다른 도시로 택배 발송.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;OSI vs TCP/IP 매핑&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;OSI L5, L6, L7 → TCP/IP Application Layer&lt;/li&gt;
&lt;li&gt;OSI L4 → TCP/IP Transport Layer&lt;/li&gt;
&lt;li&gt;OSI L3 → TCP/IP Internet Layer&lt;/li&gt;
&lt;li&gt;OSI L1, L2 → TCP/IP Network Access Layer&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;웹 서버(Apache, Nginx)는 어느 계층에서 동작하는가?&lt;/h2&gt;
&lt;p&gt;Apache, Nginx 같은 웹 서버는 &lt;strong&gt;L7&lt;/strong&gt;(Application Layer)에서 동작한다. HTTP 프로토콜을 처리하기 때문이다.&lt;/p&gt;
&lt;p&gt;하지만 웹 서버가 제공하는 &lt;strong&gt;로드 밸런싱&lt;/strong&gt; 기능은 계층에 따라 다르게 동작한다.&lt;/p&gt;
&lt;h3&gt;계층별로 볼 수 있는 정보&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;볼 수 있는 정보&lt;/th&gt;
&lt;th&gt;예시&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;IP 주소, 포트 번호&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;192.168.1.1:8080&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;L7&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;L4 정보 + HTTP 헤더, URI, 쿠키, 바디&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;GET /api/users&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Host: example.com&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;L4 장비는 패킷의 &lt;strong&gt;헤더 부분만&lt;/strong&gt; 본다. TCP 헤더에는 출발지/목적지 포트, IP 헤더에는 출발지/목적지 IP가 있다.&lt;/p&gt;
&lt;p&gt;L7 장비는 &lt;strong&gt;패킷 내용&lt;/strong&gt;(페이로드)까지 열어본다. HTTP 요청을 파싱해서 URI, 헤더 등을 분석한 후 라우팅을 결정한다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;비유&lt;/strong&gt;: L4는 택배 기사가 &lt;strong&gt;주소&lt;/strong&gt;(IP)와 &lt;strong&gt;호수&lt;/strong&gt;(포트)만 보고 배달하는 것이고, L7은 택배 기사가 &lt;strong&gt;박스를 열어서 내용물&lt;/strong&gt;을 확인한 후 배달 경로를 결정하는 것이다. L4가 빠른 이유는 박스를 안 열기 때문이다.&lt;/p&gt;
&lt;h3&gt;L4 로드 밸런싱&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;TCP/UDP 포트 정보&lt;/strong&gt;만 보고 분산한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;stream&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;upstream&lt;/span&gt; backend&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; 192.168.1.1:8080&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; 192.168.1.2:8080&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;요청의 내용(URI, 헤더)을 보지 않고, 단순히 연결을 분산시킨다. HTTP가 아닌 프로토콜(MySQL, Redis)도 로드밸런싱할 수 있다.&lt;/p&gt;
&lt;h3&gt;L7 로드 밸런싱&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;HTTP URI, 헤더&lt;/strong&gt; 등을 분석해서 분산한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;http&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; /api/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; http://api-server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; /static/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; http://static-server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/api/&lt;/code&gt;로 시작하는 요청은 API 서버로, &lt;code class=&quot;language-text&quot;&gt;/static/&lt;/code&gt;으로 시작하는 요청은 정적 파일 서버로 보낼 수 있다. 더 세밀한 제어가 가능하지만, 패킷 내용을 분석해야 하므로 L4보다 느리다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;REST vs gRPC&lt;/h2&gt;
&lt;p&gt;마이크로서비스 아키텍처가 확산되면서, 서비스 간 통신 방식도 진화했다.&lt;/p&gt;
&lt;h3&gt;아키텍처 진화와 gRPC의 등장&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a2ac9d53796ba299c1bb83192f8325e0/5e1f2/rest-grpc-timeline1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 13.29113924050633%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAg0lEQVR42nXO3Q6CMAwF4D2FjkE2mAgaWQv4EzLjnV75/s9zrNMYueDiS9rTNqnSJWPtaNHKElzdwVQh1SmbCR82oOUHVHWYoGU58/xjEkImebHpcYp37DhKT8hllvv+axCj7A6wzRljfEK59gJd0iIjh024we+nv5xn3l8X9RHb7ooXE2BVnnKAucYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rest-grpc-timeline&quot;
        title=&quot;&quot;
        src=&quot;/static/a2ac9d53796ba299c1bb83192f8325e0/f058b/rest-grpc-timeline1.png&quot;
        srcset=&quot;/static/a2ac9d53796ba299c1bb83192f8325e0/c26ae/rest-grpc-timeline1.png 158w,
/static/a2ac9d53796ba299c1bb83192f8325e0/6bdcf/rest-grpc-timeline1.png 315w,
/static/a2ac9d53796ba299c1bb83192f8325e0/f058b/rest-grpc-timeline1.png 630w,
/static/a2ac9d53796ba299c1bb83192f8325e0/40601/rest-grpc-timeline1.png 945w,
/static/a2ac9d53796ba299c1bb83192f8325e0/78612/rest-grpc-timeline1.png 1260w,
/static/a2ac9d53796ba299c1bb83192f8325e0/5e1f2/rest-grpc-timeline1.png 2134w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;모놀리스 시대에는 REST API로 충분했다. 하지만 마이크로서비스로 전환되면서 서비스 간 통신이 폭발적으로 증가했고, JSON 직렬화/역직렬화 오버헤드가 문제가 됐다.&lt;/p&gt;
&lt;p&gt;gRPC는 이 문제를 해결하기 위해 등장했다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a9117968a92c2162c170ecdc7eceaae4/203d3/rest-grpc-flow1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVR42hWQzU4aYRhGuQSVgmiZGZjhT8bhG4bhRxlRQaTaaLWogSZNJFFoUm03RmNcaHTRhYkmXbjApDUkLtpNFzZpu/ICvKjTz8WbZ3ee5z2+8YhAi9rEUyVSZhkjkScSy+FXBWXLoDOrsl012KlF+bgY5k1JJaCaxJJNhHVI3j3BzZ2Ss7+QmujhUyI2ejSLN7NKrb6FOekRl1C/lmWjGOK6rXHTc+l/sPm2o3K0PEJQMzHTn/Dc72yt/2Jj9YGF8j+czJUESpgVyzMtKnjOHCXLI5ksENRzbE4pXK6McNUM87WlcPsuwMGSnzEjI4s/M1u5o14f0Gj8oLHwB8e+xKfqDkX57srUK9Yqr1l05jEnSgyrNu+9EIP2KPedBD+7KR66Yc7XhghoaSzrmKXl32y2/tJqP/J2/YmC08f3UrcxYi669PacCbnu2aNfEVRs6W4uREfebnWU/UaQpqfxQjGJJ9sIcYbInJIVF7jZa9LmHv8BS2ewpRwHsdwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rest-grpc-flow&quot;
        title=&quot;&quot;
        src=&quot;/static/a9117968a92c2162c170ecdc7eceaae4/f058b/rest-grpc-flow1.png&quot;
        srcset=&quot;/static/a9117968a92c2162c170ecdc7eceaae4/c26ae/rest-grpc-flow1.png 158w,
/static/a9117968a92c2162c170ecdc7eceaae4/6bdcf/rest-grpc-flow1.png 315w,
/static/a9117968a92c2162c170ecdc7eceaae4/f058b/rest-grpc-flow1.png 630w,
/static/a9117968a92c2162c170ecdc7eceaae4/40601/rest-grpc-flow1.png 945w,
/static/a9117968a92c2162c170ecdc7eceaae4/78612/rest-grpc-flow1.png 1260w,
/static/a9117968a92c2162c170ecdc7eceaae4/203d3/rest-grpc-flow1.png 1322w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;REST vs gRPC 비교&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ad885e3543b8ae8b76409e2ddaa3e9ac/8c48a/rest-grpc-compare1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVR42mWSPW/TUBhG8xca243tJLbjr+s4juPEdj6BlpYKiYEJJjogVHVCbSU2ZhADE2JAogMsLEggfgF/7fDagYnhke71PffReW13jOMc40mBLrHOlxRXj5lcPcK+3KJfLjGuNxhPS5R6wWL2RvJW8p6z08+cnXxhOb9lvfjKrvpBkb+joz/M0Z7N0M4Lehc14fUJ4atT7Jsd+s0a4/UW43lFmrykmn2gLj6yW97y4OgbZ0ffub/9yd36F8er33L2iU5vNKGvxNJPsNQMZ1pyGKV0vQjdV+iBZDTGcue4wQpzuMDxN3jhDj++h+0u6fVLzEFFb1jSsdyM4WhK14yI4xSV1oziGl32Wu9vLCWFEwb+RDgfNyuIyhXBuOJwqDgwR3QtH82O6JgtmHPQC/GTjDCtiLItTjiXorCFtH5TOG25rnBeWhIWa9R0i+VkrYxmxeh2IiM7E9ywwJBLI1nHSY3Kd9jeVKBoH1th/uNk3VcF4XTDOL+DMUikMGw5Xc46DegEuWxigigjkjG8uBLj4L/ChtOEi5IcNS5lorq1bmSaUr3fGA5TgdP2oikfZxDJ7yPvdV8Ut2nAZpKG68rzQKx8L2MQFHjRYm/ZGPYT/gAC//EwORAZPwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rest-grpc-compare&quot;
        title=&quot;&quot;
        src=&quot;/static/ad885e3543b8ae8b76409e2ddaa3e9ac/f058b/rest-grpc-compare1.png&quot;
        srcset=&quot;/static/ad885e3543b8ae8b76409e2ddaa3e9ac/c26ae/rest-grpc-compare1.png 158w,
/static/ad885e3543b8ae8b76409e2ddaa3e9ac/6bdcf/rest-grpc-compare1.png 315w,
/static/ad885e3543b8ae8b76409e2ddaa3e9ac/f058b/rest-grpc-compare1.png 630w,
/static/ad885e3543b8ae8b76409e2ddaa3e9ac/40601/rest-grpc-compare1.png 945w,
/static/ad885e3543b8ae8b76409e2ddaa3e9ac/78612/rest-grpc-compare1.png 1260w,
/static/ad885e3543b8ae8b76409e2ddaa3e9ac/8c48a/rest-grpc-compare1.png 2096w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;언제 무엇을 쓸까?&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;REST가 적합한 경우&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;브라우저 - 서버 통신&lt;/li&gt;
&lt;li&gt;외부 공개 API&lt;/li&gt;
&lt;li&gt;디버깅 편의성이 중요할 때&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;gRPC가 적합한 경우&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버 - 서버 내부 통신&lt;/li&gt;
&lt;li&gt;마이크로서비스 간 통신&lt;/li&gt;
&lt;li&gt;실시간 스트리밍&lt;/li&gt;
&lt;li&gt;고성능, 낮은 지연이 필요할 때&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;외부는 &lt;strong&gt;REST&lt;/strong&gt;, 내부는 &lt;strong&gt;gRPC&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;브라우저 → API Gateway(REST) → 마이크로서비스들(gRPC) 구조가 일반적이다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[비동기 처리: 메시지 큐부터 CDC까지 5가지 구현 방법]]></title><description><![CDATA[…]]></description><link>https://gotobill.github.io/async/</link><guid isPermaLink="false">https://gotobill.github.io/async/</guid><pubDate>Mon, 22 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;이 글은 주니어 백엔드 개발자가 반드시 알아야 할 핵심 지식을 기반으로 작성되었습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Optional&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; opt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 1. User 조회&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 2. User가 없으면 false 리턴&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; u &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;u&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;matchPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 3. 암호가 일치하지 않으면 false 리턴&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;PointResult&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pointClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;giveLoginPoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 4. 포인트 지급 서비스 호출&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isFailed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 5. 포인트 지급에 실패하면 익셉션 발생&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PointException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;appendLoginHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 6. 로그인 내역 추가&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;위의 코드는 &lt;strong&gt;전형적인 동기 방식을 따릅니다.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVR42o2TiY6DMAxE+/+fWfWgDYhwFHLi5RmlAqm7W0tDjBOPk4lziilIylERFUEOsdXX2IqQ/GEEKSddR4zx5KOTJS9iGiM+eMFsZ+V2u8n1epW+7zWWc5ZhGKRtWxnHUf/rupZ7dVeQS4ETH+ecnM9neb1emjzPs0zTpAghSDF85mKMsiyLeO81hxgFlJAdYlSnMlWBtVYTy+4gAPh7Sym9feTZEfaHScgpAnFVVWKMka7r3qf4gnA4VOe4xNglR22aRp5Po9JQhLWQse5rwiI+pOiF1sQZiQEuCSn+JURosLdPGlL0K0J2UvQigX90fDweGi/k5P1JWCZJGsZBR/RDN3wuBk3LrXN8WT5oaNutTTgmYivhWoSdQcKIjmi2t9Jab0IXJn1y/diJC7P4uIrvV/08vtueY9oQot890Q1Bn2bxvZw6Z6UZzdYW5imXy2Xtu7vUTa3gWZU+bG0recm/YhVBfgBMFvhZmQxFPgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;동기 방식 플로우&quot;
        title=&quot;&quot;
        src=&quot;/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png&quot;
        srcset=&quot;/static/d9c84d53066b847c3c9b65b61f6ed9ed/c26ae/1.png 158w,
/static/d9c84d53066b847c3c9b65b61f6ed9ed/6bdcf/1.png 315w,
/static/d9c84d53066b847c3c9b65b61f6ed9ed/7c1cd/1.png 582w&quot;
        sizes=&quot;(max-width: 582px) 100vw, 582px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;동기 방식의 외부 연동 고려사항&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;동기 방식에서 &lt;strong&gt;외부 연동 실패가 전체 기능의 실패인지&lt;/strong&gt; 확인 필요&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;문제 상황&lt;/h4&gt;
&lt;p&gt;앞선 예에서는 포인트 지급 서비스 연동에 실패하면 로그인에도 실패한다고 가정했습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;포인트 서비스 장애 시 로그인까지 막힐 필요가 있을까요?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;해결 방안&lt;/h4&gt;
&lt;p&gt;아마도 그렇지 않을 것입니다. 포인트 지급에 실패하더라도:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;로그인 자체는 정상적으로 동작&lt;/strong&gt;해야 합니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;나머지 기능을 사용할 수 있어야&lt;/strong&gt; 합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;포인트 지급 실패 시 &lt;strong&gt;후처리용 로그를 남기고 로그인은 성공 처리&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;개선된 로그인 코드&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Optional&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; opt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 1. User 조회&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 2. User가 없으면 false 리턴&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; u &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;u&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;matchPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 3. 암호가 일치하지 않으면 false 리턴&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;PointResult&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pointClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;giveLoginPoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 4. 포인트 지급 서비스 호출&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isFailed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 5. 포인트 지급에 실패하면 후처리 위해 내역 남김&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;recordPointFailure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;appendLoginHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 6. 로그인 내역 추가&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;외부 서비스 응답 시간 고려사항&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;외부 서비스 응답이 느리면 &lt;strong&gt;전체 응답도 느려짐&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;비동기 방식 도입의 필요성&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;외부 연동 결과가 &lt;strong&gt;즉시 필요하지 않다면 비동기 처리 고려&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;비동기(Asynchronous) 방식의 특징&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;한 작업이 끝날 때까지 기다리지 않고&lt;/strong&gt; 바로 다음 작업을 처리&lt;/li&gt;
&lt;li&gt;비동기 방식을 사용하면 &lt;strong&gt;외부 연동이 끝날 때까지 기다리지 않고&lt;/strong&gt; 바로 다음 작업을 진행할 수 있습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;포인트 지급을 기다리지 않고 &lt;strong&gt;로그인 즉시 성공 응답&lt;/strong&gt; → 사용자 응답 속도 향상&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVR42o2T25KDIBBE8/8/ueYpiUYTb4Bc7PXgkjKVPGxbUyAz9DQzcArJa7eQR+etjJvz6LxT8S/ByTojt9jXmluM7GbE4o9r1CmEoLqutSyLwDgOappGdVOr73ullLSuq5xzGoZ+8495DWu7doutdb/fZazJok7GGFVVpWmapFWy1ubNGMkKICjrBYiYp3mPjWEnJDtK5nnW7XbLah+PRw723udE+EoCiAH7ADHlnzJshEnP5/N1DABB27bquk7n81nVT6XL5fIqwRFfCHeFR6CONRRRT8hQTiKSY4WcEv2LkOJDeCTn+DSAkkCKOuZrWsX3RkhzcKKEjSijptj1es01LKU5AoUxxndCiMiGmtLJYzepJUTEfCdMnwqPKHevgAaVa8O8HBtwsg+F3wiPSoZhyJs4AQTW2KysNAWO3JS4Efq05OfDD+bjdv/+xvzE8nw3/mOKStsT45lxkcs68TEF/QLlKKk3h/grKAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;비동기 방식 플로우&quot;
        title=&quot;&quot;
        src=&quot;/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png&quot;
        srcset=&quot;/static/61f06c7e3588dd8b0ffeebcca87206f5/c26ae/2.png 158w,
/static/61f06c7e3588dd8b0ffeebcca87206f5/6bdcf/2.png 315w,
/static/61f06c7e3588dd8b0ffeebcca87206f5/92d15/2.png 581w&quot;
        sizes=&quot;(max-width: 581px) 100vw, 581px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;비동기 방식의 장점&lt;/h3&gt;
&lt;p&gt;포인트 서비스에 일시적으로 문제가 생겨 포인트 지급 처리에 시간이 오래 걸려도 &lt;strong&gt;로그인 서비스의 응답 시간은 증가하지 않습니다.&lt;/strong&gt; 사용자는 평소처럼 로그인에 성공하고 서비스를 사용할 수 있습니다. 단지 포인트가 평소보다 조금 늦게 지급될 뿐입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;사용자는 &lt;strong&gt;빠른 로그인 후 서비스 사용&lt;/strong&gt;을 선호&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;비동기 방식 적용 가능한 연동 예시&lt;/h3&gt;
&lt;p&gt;생각보다 많은 연동에서 비동기 방식을 사용해도 됩니다. 다음은 비동기 방식으로 연동해도 크게 문제가 되지 않는 몇 가지 예입니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;쇼핑몰에서 주문이 들어오면 판매자에게 푸시 보내기&lt;/strong&gt; (푸시 서비스 연동)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;학습을 완료하면 학생에게 포인트 지급&lt;/strong&gt; (포인트 서비스 연동)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;컨텐츠를 등록할 때 검색 서비스에도 등록&lt;/strong&gt; (검색 서비스 연동)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인증번호를 요청하면 SMS로 인증 메시지 발송&lt;/strong&gt; (SMS 발송 서비스 연동)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;비동기 연동 가능 조건 - 4가지 특징&lt;/h3&gt;
&lt;p&gt;이 예시들에는 몇 가지 공통적인 특징이 있다:&lt;/p&gt;
&lt;h4&gt;1. 시차가 허용되는 경우&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;시차 허용&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;주문 후 1분 뒤 푸시 발송 → 판매 지장 없음&lt;/li&gt;
&lt;li&gt;컨텐츠 등록 후 10초 뒤 검색 노출 → 문제 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h4&gt;2. 재시도가 가능한 경우&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;재시도 가능&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;푸시 실패 → 재시도로 해결&lt;/li&gt;
&lt;li&gt;포인트 지급 실패 → 몇 초 후 재시도&lt;/li&gt;
&lt;li&gt;SMS 미수신 → &quot;다시 받기&quot; 기능&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h4&gt;3. 수동 처리가 가능한 경우&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;수동 처리&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;검색 연동 실패 → 관리자가 수동으로 재등록&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h4&gt;4. 실패를 무시할 수 있는 경우&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;실패 무시 가능&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;주문 알림 푸시 실패 → 판매 지장 없음&lt;/li&gt;
&lt;li&gt;일부 컨텐츠 검색 불가 → 서비스 계속 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3&gt;실제 적용 사례&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;4가지 특징 중 하나라도 해당 → 비동기 처리 검토&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;실제 비동기로 외부 연동을 처리한 사례:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;포인트 지급&lt;/strong&gt;: 사용자가 미션을 달성하면 포인트를 지급하는데 포인트 서비스와의 연동을 비동기로 처리했다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;주문 정보 동기화&lt;/strong&gt;: 주문 시스템에 생성된 주문 정보를 회원 관리 시스템에 반영할 때 비동기로 동기화했다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;택배사에 집하 요청&lt;/strong&gt;: 회원이 쇼핑몰에서 물건을 주문하면 택배사에 집하 요청을 하는데 비동기로 집하 요청 데이터를 전송했다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;비동기 연동 구현 방식&lt;/h3&gt;
&lt;p&gt;비동기 연동은 다양한 방식으로 구현할 수 있다. 이 책에서는 다음의 &lt;strong&gt;5가지 방식&lt;/strong&gt;에 대해 살펴볼 것이다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;별도 스레드&lt;/strong&gt;로 실행하기&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시징 시스템 이용하기&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;트랜잭션 아웃박스 패턴&lt;/strong&gt; 사용하기&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;배치&lt;/strong&gt;로 연동하기&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CDC&lt;/strong&gt; 이용하기&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;이 5가지 방식만 알아도 대부분의 비동기 연동 구현 가능&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;1. 별도 스레드로 실행&lt;/h2&gt;
&lt;h3&gt;1. new Thread() 사용&lt;/h3&gt;
&lt;p&gt;가장 간단한 방법으로 새로운 스레드를 생성하여 비동기로 실행하는 방법입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PushClient&lt;/span&gt; pushClient&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderResult&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;placeOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrderRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 주문 생성 처리&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt; order &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 별도 스레드에서 푸시 발송&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            pushClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 푸시 발송을 기다리지 않고 리턴&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. ThreadPool 사용&lt;/h3&gt;
&lt;p&gt;매번 새로운 스레드를 생성하는 대신 스레드 풀을 사용하여 성능을 개선할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PushClient&lt;/span&gt; pushClient&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExecutorService&lt;/span&gt; executor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newFixedThreadPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderResult&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;placeOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrderRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 주문 생성 처리&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt; order &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 스레드 풀에 푸시 발송 작업 제출&lt;/span&gt;
        executor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            pushClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 푸시 발송을 기다리지 않고 리턴&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3. @Async 어노테이션 사용&lt;/h3&gt;
&lt;p&gt;Spring Framework에서 제공하는 &lt;code class=&quot;language-text&quot;&gt;@Async&lt;/code&gt; 어노테이션을 사용하여 더 간편하게 비동기 실행할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PushService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Async&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sendPushAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PushData&lt;/span&gt; pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        pushClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	        &lt;span class=&quot;token comment&quot;&gt;// ... 기타 코드&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PushService&lt;/span&gt; pushService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderResult&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;placeOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrderRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 주문 생성 처리&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Order&lt;/span&gt; order &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 비동기로 푸시 발송&lt;/span&gt;
        pushService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPushAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 푸시 발송을 기다리지 않고 리턴&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Async 주의사항&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;@Async&lt;/strong&gt; 사용 시 메서드명에 &quot;Async&quot; 포함 권장&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;pushService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPushAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;비동기 메서드는 호출 측 try-catch 블록이 작동 안 함&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 잘못된 예외 처리&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OrderResult&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;placeOrder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrderRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        pushService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPushAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 비동기 실행&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// sendPushAsync()가 비동기로 실행되므로 catch 블록은 동작하지 않는다.&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 에러 처리 코드&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 올바른 예외 처리&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Async&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sendPushAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PushData&lt;/span&gt; pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        pushClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 재시도 로직&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            pushClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendPush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pushData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 재시도&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 실패를 로그로 남기거나&lt;/span&gt;
            log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Push 발송 실패&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;비동기 메서드 예외는 트랜잭션 롤백에 영향 없음&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;스레드와 메모리 고려사항&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;각 스레드는 메모리를 소모합니다 &lt;strong&gt;(예: 256KB)&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;100,000개의 스레드를 생성하면 &lt;strong&gt;약 24GB의 메모리&lt;/strong&gt;가 필요할 수 있습니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스레드 생성 시간과 스케줄링으로 인한 CPU 시간 소모가 큽니다&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스레드 풀&lt;/strong&gt;을 사용하여 고정된 수의 스레드를 유지하는 것이 좋습니다&lt;/li&gt;
&lt;li&gt;네트워크 I/O 작업의 경우 &lt;strong&gt;가상 스레드&lt;/strong&gt;(Java) 또는 &lt;strong&gt;고루틴&lt;/strong&gt;(Go) 사용을 권장합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;2. 메시징 시스템 이용&lt;/h2&gt;
&lt;h3&gt;메시징 시스템의 개념과 장점&lt;/h3&gt;
&lt;p&gt;메시징 시스템은 시스템 간 직접 호출 대신 중간에 메시징 시스템을 두어 데이터를 전달하는 방식입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 574px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.949367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42lVQ2W7DMAzL/3/j1g5D5iKp7dmJbzllLRUN0AdCEql7ooNQqaJ1RhO/P/oJ5mnw77xPrX3UsZ3oGEGp2LZNkHNGrSOxDQybUoIxBkoplFJefBvNa0UIATFFeO+QU0apGVN/kCRwM++9NLm7Bb/rBTc7I8aIfd+htZbBxt9FU2YWnnXnnAyrVHhDwtEPmUxE6NSx2gU/6htqnYWTraih9w4X/nH9+8Jib2cdgzW+dnr/gAMG+9ZZaGugjUZpRf7HGl8TUhDe7/7kXyDZ8Aml94Qpft+F2QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메시징 시스템 디커플링&quot;
        title=&quot;&quot;
        src=&quot;/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png&quot;
        srcset=&quot;/static/c5d2f63fd099e487f40c299365f72e91/c26ae/3.png 158w,
/static/c5d2f63fd099e487f40c299365f72e91/6bdcf/3.png 315w,
/static/c5d2f63fd099e487f40c299365f72e91/86389/3.png 574w&quot;
        sizes=&quot;(max-width: 574px) 100vw, 574px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;디커플링&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;시스템 A와 시스템 B가 직접 연결되지 않음&lt;/li&gt;
&lt;li&gt;시스템 B의 성능 저하가 시스템 A에 영향을 주지 않음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시징 시스템이 버퍼 역할을 하여 시스템 B가 자신의 속도로 메시지를 처리할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 587px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVR42pVS0W7DIAzs///jpkyVpmZqE6CBgm242U7bvfRhNbKMjLmzDw7cGxpVNP5zGexO0lDpBhZ6Run3M25eazWPyJ1w6KMjl4w1rEgp+b61BmFBzhkxRUxfE9I1eZ5ZwYiwbRtCDFjWBaUUJyMDHGN4YYzRi+qt4jhPWNIZJRfUWjGfZgenRk44nT4U6IK8ZYQQdiJh7ZAVEMNZReTuHef4g+stQo9UjuZ568rM4hy+Hbhrrd/RaQzn2eE7ZuR2x4CtM3Pbm3Q29kvAcV+vjBRwCQuuqqnrqCMboBHtI7/ZYe8dx8unPsjqmprmFqXL/sr7c/O/nXSsVKJ+o8eXaZ4z/Sz+Ap3dcymZeW/2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메시징 시스템 확장성&quot;
        title=&quot;&quot;
        src=&quot;/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png&quot;
        srcset=&quot;/static/fbf45aed4cc272f61fdcfe6a6f2be08e/c26ae/4.png 158w,
/static/fbf45aed4cc272f61fdcfe6a6f2be08e/6bdcf/4.png 315w,
/static/fbf45aed4cc272f61fdcfe6a6f2be08e/d72eb/4.png 587w&quot;
        sizes=&quot;(max-width: 587px) 100vw, 587px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;확장성&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;새로운 시스템 추가 시 기존 시스템 수정 없이 메시징 시스템에만 연결&lt;/li&gt;
&lt;li&gt;예: 시스템 A가 시스템 C에도 데이터를 전송해야 할 때, 시스템 A 코드 수정 없이 시스템 C만 메시징 시스템에 연결&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;메시징 시스템 기술 비교&lt;/h3&gt;
&lt;p&gt;이 책을 쓰는 시점을 기준으로 메시징 시스템 용도로 많이 사용되는 기술은 &lt;strong&gt;카프카&lt;/strong&gt;, &lt;strong&gt;래빗MQ&lt;/strong&gt;, &lt;strong&gt;레디스 pub/sub&lt;/strong&gt; 등이 있음. 각 기술은 서로 다른 특징을 가지고 있으므로, 사용 목적에 맞는 기술을 선택해야 함.&lt;/p&gt;
&lt;h4&gt;Kafka 특징&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 522px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVR42n1S2Y6bQBDk/38neUystczaGwy7BsJ93zYYX/i+KtMjrbVyooxUmtFQU13VtHC/3/EVn2u1WsH1PIRRDFlWoOk64iSB4zjouo5znt8ShNlsBtu24bHHQRBgvV5jv9/Bsh3IowHqQMeH+BPqsIepp0JTJJRV9RB8XsJut0Nd15jP51wwz3NcLhcoyjtMXUVbJkg8CzFDk0ewDR2GaXKX2+32sZPO8XiE8FWdKqZpCt/3uWOKmKQZbMeFz4pleYEwjFAxh5SEuKPRCJZlwTAMUFphuVwijmP+kZAwkTAMoWoa5PEvJIGD134P8pvIXNrQJh+cU5YliqLA+XzG6XTi7m63G4TFYvEQjKKIk4MghK6pGIwVjIIMvYmBH4oO0YkhqToyxiGXWZb93cPnCxL8jFxWU9Tzlkelc9MukDNXJEZTQCYkSeJ8QtM0EA6HAzabDWinihTlzCKMZRkKi1zFPsbDAVT5DWXsYfIuwzQtdNuOv2vblhcg0I/hY0NNpdFxXZcTdvs9PNdB73WIvm7h24uI730RL5PfGLKZnP5vbGhEyB019Xq9Pkjr9Qp+GMNLCoYcfprDy9iZ9bfrNv8cbBL8A6em5RwzDcPoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Kafka 특징&quot;
        title=&quot;&quot;
        src=&quot;/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png&quot;
        srcset=&quot;/static/70be607d8ee5704786ca85d87c0c03c2/c26ae/5.png 158w,
/static/70be607d8ee5704786ca85d87c0c03c2/6bdcf/5.png 315w,
/static/70be607d8ee5704786ca85d87c0c03c2/29492/5.png 522w&quot;
        sizes=&quot;(max-width: 522px) 100vw, 522px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;높은 처리량을 자랑함&lt;/strong&gt; - &lt;strong&gt;초당 백만 개 이상&lt;/strong&gt;의 메시지를 처리할 수 있음&lt;/li&gt;
&lt;li&gt;수평 확장이 용이함 - 서버(브로커), 파티션, 소비자를 늘리면 됨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시지를 파일에 보관해서 메시지가 유실되지 않음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;파티션 단위로 순서를 보장함 - &lt;strong&gt;하지만 토픽 수준에서는 순서를 보장할 수 없음&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;예: &quot;주문&quot; 토픽에 파티션 2개가 있고, A고객이 주문 3개(1→2→3)를 연속으로 넣었을 때
&lt;ul&gt;
&lt;li&gt;파티션0: 주문1, 주문3 (순서 보장됨)&lt;/li&gt;
&lt;li&gt;파티션1: 주문2 (순서 보장됨)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;소비자가 받는 순서: 주문2 → 주문1 → 주문3 (순서가 뒤바뀔 수 있음)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;소비자는 메시지를 언제든지 재처리할 수 있음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pull 모델을 사용함&lt;/strong&gt; - 소비자가 카프카 브로커에서 메시지를 읽어가는 방식&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;RabbitMQ 특징&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/31a1ee18bc60b0b58cbe65be9a81ee7c/23266/6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42oWSS2/TQBDH8z0rcaVcQPAd4AJX4IBAqgLkQQs0EScoSUTa0gsib9d2nIcTO7bXXidxvPbu2mGcByEFidVodq2dv+fx29RyuYzj2DRNw5jAGo/Huq5blqVpY4QsuPJISHm0/NdKrTcIiiKwXRAcOaVmp1r7nOl9L+JeLQgCfeK0xcls7q8kWzHIQE4IMQxDHQ2DkAyHnix0lbcPtOw9NX2oFJ9gF5fPm7lCXe5N1vlS660nla6bx7Mp6g7kzJdXH7/lXHca8Wjhzf2VET/JRoLQxh7nfFc2FKBIpebPPHZMeSDnS0cnldeabjgo4CHkb5njYcxCiAxD5rgLvu0udXMIceKIzyTRkDrtxovD1vNb7acHwvEjZNtnlVrutC5Io6TTbdkbSxqP45WYI4tibCPhEouXjlDF/QYkNKypIJtzj+wGBhrOIzBQQgSDnpJzMsS9muLfZOJo9bEpG9looutgwFnTNGQhVVVt24armeeHlP2Hc5KW83jz/xV2xizhon6W7119wv0mZcww3ZtlbznHhATw1NSRGoSBOlgAZ/nN/XH2rpq+rRQfO9gpVRvZ05rc0/c497tlqf1hNrWVYTdfPiqcv3NdlzPuz6fEmyV+4SWDJCFyPMb2OXfFr40f2RVn6biSfl/JIORQymiQcDY0NeYUIinleOpHf3NedwueJSI2UheKqLRe3gHOnWcHnZOHFkLAOVsAzuqO85/67cCSxRl1xCtXvMDAedAAQBaaXXctbxGsB/YLzJM+z0Nd7NMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;RabbitMQ 특징&quot;
        title=&quot;&quot;
        src=&quot;/static/31a1ee18bc60b0b58cbe65be9a81ee7c/f058b/6.png&quot;
        srcset=&quot;/static/31a1ee18bc60b0b58cbe65be9a81ee7c/c26ae/6.png 158w,
/static/31a1ee18bc60b0b58cbe65be9a81ee7c/6bdcf/6.png 315w,
/static/31a1ee18bc60b0b58cbe65be9a81ee7c/f058b/6.png 630w,
/static/31a1ee18bc60b0b58cbe65be9a81ee7c/23266/6.png 923w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클러스터를 통해 처리량을 높일 수 있음 - 단, 카프카보다 더 많은 자원을 필요로 함&lt;/li&gt;
&lt;li&gt;메모리에만 메시지를 보관하는 큐 설정을 사용하면 &lt;strong&gt;장애 상황 시 메시지가 유실될 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시지는 큐에 등록된 순서대로 소비자에 전송됨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;메시지가 소비자에 전달됐는지 확인하는 기능을 제공함&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Push 모델을 사용함&lt;/strong&gt; - 래빗MQ 브로커가 소비자에 메시지를 전송함. &lt;strong&gt;소비자의 성능이 느려지면 큐에 과부하가 걸려 전반적으로 성능 저하가 발생할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;다재다능함 - AMQP, STOMP 등 여러 프로토콜을 지원하고, 게시/구독 패턴뿐만 아니라 요청/응답, 점대점(point-to-point) 패턴을 지원함. 또한 우선순위를 지정해서 처리 순서를 변경할 수도 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Redis pub/sub 특징&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;메모리를 사용하므로 지연 시간이 짧고, 래빗MQ 대비 처리량이 높음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;구독자가 없으면 메시지가 유실됨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;기본적으로 영구 메시지를 지원하지 않음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;모델이 단순해서 사용하기 쉬움&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;기술 선택 가이드&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;메시지가 유실되어도 상관없다면 레디스 pub/sub&lt;/strong&gt; 기능을 고려함 - 카프카나 래빗MQ에 비해 사용법이 간단하고, 적은 장비로 높은 성능을 낼 수 있음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;트래픽이 대량으로 발생한다면 카프카&lt;/strong&gt;를 고려함 - 여기서 말하는 대량 트래픽은 &lt;strong&gt;초당 수십만에서 수백만 이상&lt;/strong&gt;의 메시지를 말함&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;트래픽 규모가 크지 않고 메시지를 정확하게 순서대로&lt;/strong&gt; 소비자에 전달해야 하거나 AMQP나 STOMP 프로토콜로 연동해야 한다면 &lt;strong&gt;래빗MQ&lt;/strong&gt;를 고려함&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;메시지 생성 측 고려 사항&lt;/h3&gt;
&lt;h4&gt;메시지 유실 처리 방법&lt;/h4&gt;
&lt;p&gt;메시지를 생성할 때 고려할 점은 &lt;strong&gt;메시지 유실&lt;/strong&gt;에 대한 것임. 예를 들어 메시지 전송 과정에서 타임아웃이 발생할 수 있음. &lt;strong&gt;타임아웃 문제는 생산자와 메시징 시스템 간의 네트워크 연결이 불안정하면 언제든지 발생할 수 있음.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;오류 처리를 위해 선택할 수 있는 방법 &lt;strong&gt;3가지&lt;/strong&gt;:&lt;/p&gt;
&lt;h5&gt;1. 무시함&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;오류를 무시.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시지의 용도에 따라 유실이 일부 허용될 수 있음&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;단순 로그 메시지&lt;/strong&gt;: 유실되어도 괜찮음. 나중에 로그를 조회할 때 로그가 없으면 아쉬울 수 있지만 기능 동작에 문제는 없음
&lt;strong&gt;-&gt; 무시해도 기능상 이상이 없으면 무시 가능&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;2. 재시도함&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;일시적인 네트워크 불안정과 같은 오류는 재시도를 통해 해결될 수 있음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;주의사항&lt;/strong&gt;: 메시지 전송을 재시도하는 과정에서 &lt;strong&gt;중복된 메시지가 전송될 수 있음&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;실제로는 전송에 성공했는데&lt;/strong&gt; 일시적인 네트워크 오류로 &lt;strong&gt;전송에 실패한 것으로 인지하고 재시도할 수 있기 때문&lt;/strong&gt;
&lt;strong&gt;-&gt;  메시지마다 고유 식별자를 사용&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;3. 실패 로그를 남김&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;단순히 실패 로그를 남기는 것임. 로그는 나중에 후처리를 하는 데 사용됨&lt;/li&gt;
&lt;li&gt;실패 로그는 DB에 저장할 수도 있고 파일에 남길 수도 있음&lt;/li&gt;
&lt;li&gt;실패 로그는 &lt;strong&gt;후처리에 필요한 데이터를 담고 있어야 함&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;DB 트랜잭션 연동 고려&lt;/h4&gt;
&lt;p&gt;메시지 생산자는 &lt;strong&gt;DB 트랜잭션과의 연동도 고려해야 함&lt;/strong&gt;.
&lt;strong&gt;DB 트랜잭션에 실패했는데&lt;/strong&gt; 메시지가 발송되면 &lt;strong&gt;잘못된 데이터가 전달될 수 있기 때문임&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmklEQVR42n2T6ZaCMAxGff/n9IeCLC1l6UaGGyYzjkcnnAiW5CZfWi4xbRLWIGUvEnOUfuileTTig9e1XJL4ycvoRglLkLZr1Uc/Sj2ueZmlaRvphk6WbZHLevy0bStYKUWGYZCmaSSEoGv7vss0TTKOoyzLGYt77/X9uq5yv9+l6zqZ1/kAxkX/pJT0JUnAcs56Z63Wqm4F8GcrhfdFSs1yoU3n3U8wiVSnq8fjIc45LQgYe4b/AosCswGZkRnQeZ4lxqggk2rA5w7tXl87fAZidAgQCDO9Xq8KxhgFHf0r+RWIXJK2bVPJzBJHqj3TNcUoRFz5BEQGCcims9vtph2ThLF5BqQwcX3fq6J6HLM/QDoASFcEEAjMdvvTpgB/CzQDgBTOF440Ej5tigJT1A/hBH5LItlmZJti5/Md8E+HBlzjqueNBZPGXGxe9pVwhCjMZp3n7le6NVBP4KKfWslFPaX8MxPAQNzoVLZ3KInqKaYjJkk+4qcpaPGyH7sc8yZAobPteK7pfD7Wql3fzxZDsjnxsRxFSpIvtsFEj6BKGZ0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;트랜잭션 롤백 문제&quot;
        title=&quot;&quot;
        src=&quot;/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png&quot;
        srcset=&quot;/static/7b82af593f70b85c0480b8c7f31b47a6/c26ae/7.png 158w,
/static/7b82af593f70b85c0480b8c7f31b47a6/6bdcf/7.png 315w,
/static/7b82af593f70b85c0480b8c7f31b47a6/9bbaf/7.png 588w&quot;
        sizes=&quot;(max-width: 588px) 100vw, 588px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;주문이 완료&lt;/strong&gt; 됐다는 푸시 알림 발송&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;변경 실패 -&gt; 트랜잭션 롤백&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;고객은 &lt;strong&gt;실패 화면을 보는데&lt;/strong&gt; 주문 알림 &lt;strong&gt;푸시 알림을 받게됨&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVR42p2TiW6DMAyG+/6vWY5Cy32EHODxmaVjk7pKDbIcbOf3H9u5OG/FBSt+dSpx74L7bQvuT9yP/xx36YZW2r4Vlg9eyrKQNEulaRvZ+LZV6rqWx+Mhi1kkyzK53W6q13UVY4ykaSJZnkndVnLpx34/3O4HN/HeyzzPMgyD7uOy1qoAsCyLxqBZCroYmafdZo1cxnl4AiDTNEnf96phAbNxHJ8JYuLzwhZCkLD6A5CMceEgAbaqqqTrOmn3G5DkI0CCYURtyrJUUMCw/QeI7SXD839M8u7KLwFxwM45J/f7XZqm0f3HgDDkegBdr1cpikIbQ13P9XpbQ9ofxwNANHbAkiTRenIQtnGEYMW/gvlvwGHqtZNInueqGRkN2oV5IwE2AAGDPXGwpywkZQ7XLRwMzx2MTONhWMYuc+2YJMZG1vgUkJfCnBGIAzHz0RRY4ePpwQoNWGxaFGx6KwCNm8U4oz9+rwFyPHyvtrOs+7s++8+CzQYrX+doRYZszU1XAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;트랜잭션 완료 후 전송&quot;
        title=&quot;&quot;
        src=&quot;/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png&quot;
        srcset=&quot;/static/2d2ff6e428af32c7d041f64fce82f895/c26ae/8.png 158w,
/static/2d2ff6e428af32c7d041f64fce82f895/6bdcf/8.png 315w,
/static/2d2ff6e428af32c7d041f64fce82f895/065e2/8.png 577w&quot;
        sizes=&quot;(max-width: 577px) 100vw, 577px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-&gt; 트랜잭션이 끝난 뒤에 메시지를 전송&lt;/strong&gt;&lt;/p&gt;
&lt;h4&gt;글로벌 트랜잭션&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;개념&lt;/strong&gt;: 여러 데이터베이스를 하나의 트랜잭션으로 처리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;알고리즘&lt;/strong&gt;: 2-Phase Commit (2PC)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;장단점&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;장점: DB 변경과 메시지 전송을 하나의 트랜잭션으로 묶음&lt;/li&gt;
&lt;li&gt;단점: 성능 저하, 모든 메시징 시스템이 지원하지 않음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;메시지 소비 측 고려사항&lt;/h3&gt;
&lt;h4&gt;1. 중복 메시지 처리&lt;/h4&gt;
&lt;h5&gt;고유 메시지 ID 활용&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Message&lt;/span&gt; m &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; messageConverter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;checkAlreadyHandled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 이미 처리했는지 확인&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 처리하지 않고 무시함&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;recordHandledLog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 처리 여부 기록&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;2. 멱등성 보장&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;메시지 처리 실패 후 재수신 시 중복 처리 가능성 주의&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;외부 API를 호출했을 때 &lt;strong&gt;읽기 타임아웃이 발생하면 성공했을 가능성이 있음&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;실제로 성공했다면 수신자는 &lt;strong&gt;외부 API를 중복해서 두 번 호출하게 됨&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;-&gt; &lt;strong&gt;멱등성을 갖도록 API를 구현&lt;/strong&gt;&lt;/p&gt;
&lt;h4&gt;3. 모니터링의 중요성&lt;/h4&gt;
&lt;p&gt;중복 메시지 처리와 함께 메시지 소비자를 구현할 때 고려할 점은 &lt;strong&gt;메시지를 잘 소비하고 있는지 모니터링하는 것임&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;문제 상황:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메시지 소비자의 처리 속도가 갑자기 느려지면 &lt;strong&gt;큐에 메시지가 계속 쌓이게 됨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;메시징 시스템에 따라 &lt;strong&gt;큐가 가득 차면 생산자가 메시지를 큐에 넣지 못하게 막는 상황도 발생할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;메세지 종류&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;이벤트&lt;/th&gt;
&lt;th&gt;커맨드&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;주문함&lt;/td&gt;
&lt;td&gt;포인트 지급하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;로그인에 실패함&lt;/td&gt;
&lt;td&gt;로그인 차단하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;상품 정보를 조회함&lt;/td&gt;
&lt;td&gt;배송 완료 문자 발송하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;배송을 완료함&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;이벤트 특징:&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVR42o2Q22rDMAyG+/4vNhjdgd2MjsFu1tB4abLGR1m2/1pOM9qLwgRC6Lf0WdImJgLnCOctQvRwwUK0VLi5Dw4UAwL5FlddaqRHNInCEN9EJpRcEGPE8DPA+wp1DiklGGMQadFPvyeEEFqdRGMsvPNQvQLVmlLKBVh/ksRaC6UUtNawzuBl94iv/Sc4ctPH4wg1HbB9f4AaD2BOmOcZfd+3ARYgL0AxEVajOvXbxzM69X3zNukRr7snHKeh5cyMnDM48ZKvK692Db1nUkOR6pp0Wd20KK0NSFfA28Z7xGUyOZF413UN/ndD4oBccvX0by/I7SzazjD13trqpgvwDFDRIqxFIsvwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메시지큐&quot;
        title=&quot;&quot;
        src=&quot;/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png&quot;
        srcset=&quot;/static/d0400e8ac891f329b315bc3bf4bfbff1/c26ae/10.png 158w,
/static/d0400e8ac891f329b315bc3bf4bfbff1/6bdcf/10.png 315w,
/static/d0400e8ac891f329b315bc3bf4bfbff1/065e2/10.png 577w&quot;
        sizes=&quot;(max-width: 577px) 100vw, 577px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;과거에 일어난 일을 나타냄 (과거형 표현)&lt;/li&gt;
&lt;li&gt;&quot;~했다&quot;, &quot;~됐다&quot; 형태&lt;/li&gt;
&lt;li&gt;시스템에서 발생한 사실을 알림&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;여러 시스템이 구독하여 반응할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;커맨드 특징:&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.68354430379747%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR42kVQ62rGIAzt+z/TYDDYn8EusB+DvcC+rxetbacm0Z4ltnTC0ZiTc4zpuDBijkiULkgVBbfzyEVkPrn95Ha56rPCPMyrE92YGSGEBotFBKWUFscYW36appYnItRaQZmQUoL3Hs65Vkuc1VC7YC0y0bIsEBaM84CP71cM/o6sQsubqJaKKYx4+3pB725qfjQyz/NhKHQYWjdFSjv3usOtA54/H9H7G7Dj4lCBJXk8vT8o9wNbjVPYY/bbjgtd87K5FMVv3jCEO7a46r2cMxVUjSNtGEOPNS7q/8+ZjgrhDwCUg84+tzVJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메세지&quot;
        title=&quot;&quot;
        src=&quot;/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png&quot;
        srcset=&quot;/static/9b9e184b99a87a10365c7462019b3e22/c26ae/12.png 158w,
/static/9b9e184b99a87a10365c7462019b3e22/6bdcf/12.png 315w,
/static/9b9e184b99a87a10365c7462019b3e22/b6272/12.png 580w&quot;
        sizes=&quot;(max-width: 580px) 100vw, 580px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;앞으로 실행할 작업을 나타냄 (명령형 표현)&lt;/li&gt;
&lt;li&gt;&quot;~하기&quot;, &quot;~하라&quot; 형태&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;특정 작업의 수행을 요청&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;보통 하나의 시스템이 처리함&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;궁극적 일관성&lt;/h3&gt;
&lt;h4&gt;개념&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;분산 시스템에서 데이터 복제를 다루는 일관성 모델&lt;/li&gt;
&lt;li&gt;두 데이터 저장소 간 일관성을 보장하지만 즉시는 아님&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&quot;일정 시간 후에&quot; 일관성 달성&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;예시&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;배송기사: &lt;strong&gt;&quot;배송 완료!&quot;&lt;/strong&gt; (배송 시스템에 기록)&lt;/li&gt;
&lt;li&gt;고객 앱: &lt;strong&gt;아직 &quot;배송 중&quot;으로 표시&lt;/strong&gt; (몇 분 지연)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;최종&lt;/strong&gt;: 메시지 전달 후 고객 앱도 &quot;배송 완료&quot;로 변경&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;3. 트랜잭션 아웃박스 패턴 사용&lt;/h2&gt;
&lt;h3&gt;트랜잭션 아웃박스 패턴의 개념&lt;/h3&gt;
&lt;p&gt;트랜잭션 완료 후 메시지 전송 방식도 완벽하지 않음.
**재시도와 에러 처리 로직을 구현해도 메시징 시스템 연동 자체가 실패할 수 있기 때문&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;트랜잭션 아웃박스 패턴의 핵심 아이디어&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메시지 데이터를 먼저 &lt;strong&gt;데이터베이스에 안전하게 저장&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;별도 메세지 중계 프로세스&lt;/strong&gt;가 저장된 메시지를 읽어서 메시징 시스템에 전송&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; 주문처리&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 1. 주문 데이터 저장&lt;/span&gt;
        orderRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 2. 메시지도 DB에 함께 저장 (같은 트랜잭션)&lt;/span&gt;
        outboxRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OutboxMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;주문완료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; orderData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 3. 둘 다 성공하면 커밋&lt;/span&gt;
        transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;rollback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 둘 다 실패하면 롤백&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42o2TiW6DMBBE8///GCUROQgNJICxja+tZ6gRqaqoiwawvbw9bHYhBpnDLO5NjvJZs7eUj45r1hmK46xlbLkWopedz7eQgjRfjdzqm3jvZWvD0EvbtvRB8Kqq5Hq7SkyROp8rOZ1O4rxjEAJTSmKtlWmaxDknTdNQxhjOQTD4qVGJ0YbvMKVUDjpwvAJhAA3jIPM8E3a5XAh6Pp8yjuOaMSooMFiMkeJa+AXUWkvf93I8HmW/3+dyzpxDpp+AIYS/gcgEJRwOB/bl8XiwnFIyDB//K0NEBhAld11HoVcFWnqIwPAtIIyhN2DClZ1L6ltDL9FTtAK7jaAAYhMRvLTqIxDv210E6H6/S13X3CRkjMxx1FAJfDZAtwJLL7aGjADBh23bSf965Z7q7JsoY+wKdASG5Q9YTv7y3EpNo0wmn71ZU9rkc0mpH02i9Lj+Sd8srlo2TBk86QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;트랜잭션 아웃박스 패턴&quot;
        title=&quot;&quot;
        src=&quot;/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png&quot;
        srcset=&quot;/static/a6806f9f22f3acf246dd005c2ac0ec4d/c26ae/13.png 158w,
/static/a6806f9f22f3acf246dd005c2ac0ec4d/6bdcf/13.png 315w,
/static/a6806f9f22f3acf246dd005c2ac0ec4d/9fc4b/13.png 583w&quot;
        sizes=&quot;(max-width: 583px) 100vw, 583px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;메시지 중계 서비스 구현&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processMessages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 이 메서드를 주기적으로 호출해서 메시지를 전송&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 아웃박스 테이블에서 대기 메시지 데이터를 순서대로 조회함&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MessageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; waitingMessages &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectWaitingMessages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MessageData&lt;/span&gt; m&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; waitingMessages&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;sendMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 메시지를 전송함&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;markDone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 발송 완료 표시함&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;handleError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 메시지 발송에 실패한 경우 후속 처리함&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 에러가 났을 때 멈춤. 이유는 순서대로 발송하기 위함&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;에러 발생 시 루프 종료 이유&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;예를 들어 10개의 대기 메시지를 읽고 5번째 메시지 전송 중 에러가 발생&lt;/li&gt;
&lt;li&gt;6번째부터 계속 전송하면 메시지가 생성된 순서와 다른 순서로 전송됨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;메시지 전송 순서가 중요한 경우 이 점이 매우 중요&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;아웃박스 테이블 구조&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;칼럼&lt;/th&gt;
&lt;th&gt;타입&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;단순 증가 값(PK). 저장된 순서대로 증가하는 값을 사용한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;messageId&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;메시지 고유 ID(고유키)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;messageType&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;LoginFailed&lt;br&gt;OrderPlaced&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;payload&lt;/td&gt;
&lt;td&gt;clob&lt;/td&gt;
&lt;td&gt;메시지 데이터&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;status&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;WAITING(대기)&lt;br&gt;DONE(완료)&lt;br&gt;FAILED(실패함)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;failCount&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;실패 횟수&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;occuredAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;메시지 발생 시간&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;processedAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;메시지 처리 시간&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;failedAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;마지막 실패 시간&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;payload&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;JSON, XML 등&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;실패 상태 변경 기준&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;자동 변경&lt;/strong&gt;: 실패 횟수 기반 (예: 5회 실패 시 FAILED로 변경)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;수동 변경/모니터링&lt;/strong&gt;: 실패 횟수 10회 초과 시 운영팀 알림, 수동으로 FAILED 변경&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;후속 조치&lt;/strong&gt;: FAILED 상태 메시지는 시스템 간 데이터 불일치 방지를 위한 적절한 후속 조치 필요&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;디버깅&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;memo&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;remark&lt;/code&gt; 컬럼 추가하여 실패 원인 기록&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;메시지 전송 실패 시 즉시 FAILED로 변경하지 말 것&lt;/li&gt;
&lt;li&gt;일시적 문제인 경우 몇 번 재시도 후 성공할 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;status&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;EXCLUDED&lt;/code&gt; &lt;strong&gt;상태 추가 가능&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;실패가 아닌 특정 메시지를 수동으로 전송 방지할 때 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;4. 배치로 연동&lt;/h2&gt;
&lt;h3&gt;배치 전송 개념 및 전형적 처리 방식&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;대량 데이터(10만 건)는 파일로 모아서 전송이 효율적&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;배치 전송은 &lt;strong&gt;데이터를 비동기로 연동하는 가장 전통적인 방법&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;메시징 시스템이 거의 &lt;strong&gt;실시간으로 데이터를 연동&lt;/strong&gt;했다면, 배치는 &lt;strong&gt;일정 간격으로 데이터를 전송&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ex) 결제 승인 데이터를 모아서 다음날 아침에 보낸다던가&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;배치 처리의 전형적 과정&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;DB에서 전송할 데이터를 조회.&lt;/li&gt;
&lt;li&gt;조회한 결과를 파일로 기록.&lt;/li&gt;
&lt;li&gt;파일을 연동 시스템에 전송.&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;파일 전송은 FTP, SFTP 같은 파일 전송 프로토콜 또는 SCP 명령어를 사용.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;많이 사용한 파일 형식&lt;/h4&gt;
&lt;h5&gt;구분자 기준&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;홍길동,25,개발자,서울 
김철수,30,디자이너,부산 
이영희,28,기획자,대구&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;key-value&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;name=홍길동 age=25 job=개발자 city=서울
name=김철수 age=30 job=디자이너 city=부산  
name=이영희 age=28 job=기획자 city=대구&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Json&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{&quot;name&quot;:&quot;홍길동&quot;,&quot;age&quot;:25,&quot;job&quot;:&quot;개발자&quot;,&quot;city&quot;:&quot;서울&quot;}
{&quot;name&quot;:&quot;김철수&quot;,&quot;age&quot;:30,&quot;job&quot;:&quot;디자이너&quot;,&quot;city&quot;:&quot;부산&quot;}
{&quot;name&quot;:&quot;이영희&quot;,&quot;age&quot;:28,&quot;job&quot;:&quot;기획자&quot;,&quot;city&quot;:&quot;대구&quot;}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;파일 시스템 연동 시 정해야 할 항목&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;송수신 주체&lt;/li&gt;
&lt;li&gt;전송 주기/시점&lt;/li&gt;
&lt;li&gt;파일 전송 경로/파일명 규칙&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;송수신 주체 예시&lt;/h5&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 299px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVR42mWSbauDMAyF/f8/TRCG7oMIuumY6NQ51PnuMp5AxbtbCE3Tk5OTtNY8z9I0jfR9L8Mw7Na2rSzLImZ9Ph/dp2lS/BGLEQNvcdi2TcqylCRJJIoi9SEgmdjpdBLf9+WW3LTwuq6SZZneFUUhz+dTsdhOCDAIAnEcR16vl6oBiM9e17X61+tVlbzfb8W7rqvq6HQnxDGkJJKAjeP4r2XwxDmDpxiKDY9FYp7nUlWVkmG0TOw4Q7NIejweOx5C8LQOsSpELnvXdWokcYkSki+Xi6RpKvf7XVulkMGDAW92JUQ+Vc7ns9i2rQOHkKFDFIahxHGshirGQwee5+ljoe7PDDkAQg1DNwr5Or8Lhdwjwqgnf1fIgUTzDwniE+POPAgFWST+4o//9gt6NrN9YcvmIgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;송수신 주체&quot;
        title=&quot;&quot;
        src=&quot;/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png&quot;
        srcset=&quot;/static/e8b85a166a2726a08b448ab74e5dcc23/c26ae/15.png 158w,
/static/e8b85a166a2726a08b448ab74e5dcc23/aeb78/15.png 299w&quot;
        sizes=&quot;(max-width: 299px) 100vw, 299px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;확장하는 서비스는 &lt;strong&gt;소비자에 맞춰 업로드해주는 경우가 많았음.&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;고객 시스템에 업로드해 준다.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;보안을 이유로 시스템을 외부에 노출시키기 어려운 조직은 &lt;strong&gt;다운로드 방식을 택하기도 했음.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;시간의 중요성&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;소비자는 특정 시점까지 데이터를 받아야 함.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;배치 파일은 에러나 누락을 확인할 수 있는 여유시간을 확보하려고 근무가 시작되는 시간대에 전송하는 경우가 많았음.&lt;/li&gt;
&lt;li&gt;경로, 파일명 충돌을 피하기 위해 규칙을 정했음.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;파일 소비 프로세스 (생산자가 업로드해 줄 경우 소비자는 뭐 하냐?)&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;지정 경로에 파일 존재 확인함.&lt;/li&gt;
&lt;li&gt;파일이 있으면 데이터 읽음.&lt;/li&gt;
&lt;li&gt;파일 없으면 후처리.&lt;/li&gt;
&lt;li&gt;읽어온 데이터를 시스템에 반영.&lt;/li&gt;
&lt;li&gt;완료된 파일은 다른 폴더로 이동&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;파일 대신 API/DB 연동&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;데이터가 적거나 처리 항목이 적으면 API로 일괄 전송하는 방식을 쓰기도 함.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;같은 조직 내에는 &lt;strong&gt;DB 읽기 전용권한&lt;/strong&gt;을 주고 직접 접근하게 하기도 함.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;재처리, 빈 파일 처리&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;파일 전송 실패 시 일정 시간 뒤 &lt;strong&gt;재전송 기능을 구현&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;수동 배치 실행 명령어나 API도 준비&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;전송할 데이터가 없을 때 파일을 생성하지 않으면, &lt;strong&gt;고객사는 파일이 없는 원인을 혼란스러워하므로&lt;/strong&gt; 빈 파일도 전송하게 개선했음.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;5. CDC 이용하기&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;데이터베이스는 데이터가 변경되면 그 변경 내용을 통지하는 기능을 가진다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;모든 현대적인 데이터베이스(Oracle, MySQL 등)는 데이터의 변경 이력을 안정적으로 기록하고 관리하기 위한 &lt;strong&gt;트랜잭션 로그&lt;/strong&gt;를 가지고 있음.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-&gt; CDC는 바로 이 데이터베이스의 핵심 기능을 활용&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVR42pVQ26rDMAzr/39lCy30pfSWixMn0WyPlB0ODGYQJrKiKB5ySeCSDVlQWkEVdO4b8r9zwqBkr5QSQgi4rgulFPxaajpwZbTWzMB7j/M8cRzHY1hr/YPPUo1yXctVDEtjMLMlUzNNqeduprxzzlLHGJ8ZEdlMH9ees6xLwllCFfXvat/3HeM4YZom3Ndtl7Zts0vLsshsxLquoiXM82yPPYa6yMQEF25J4OGDQ2bhMlknisYpIgVbPMlM92V8dHD+futLwguj89VN29ZFkwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 동작 방식&quot;
        title=&quot;&quot;
        src=&quot;/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png&quot;
        srcset=&quot;/static/7b96041118acdbe715283e31dc0fd466/c26ae/16.png 158w,
/static/7b96041118acdbe715283e31dc0fd466/6bdcf/16.png 315w,
/static/7b96041118acdbe715283e31dc0fd466/7c1cd/16.png 582w&quot;
        sizes=&quot;(max-width: 582px) 100vw, 582px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CDC는 애플리케이션과 완전히 분리되어&lt;/strong&gt;, 데이터베이스의 &lt;strong&gt;트랜잭션 로그를 직접 읽는 방식으로 동작&lt;/strong&gt;&lt;/p&gt;
&lt;h4&gt;전파 방법&lt;/h4&gt;
&lt;h5&gt;1. 변경 데이터를 그대로 대상 시스템에 전파&lt;/h5&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 573px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVR42kWQ4W6DMAyEef9Xm6ZJ+zfWso6ihkoUCA0ksQ3XxHQd0uminM9BX0FCCBQQOenpxPElXimJ1Un+72MW7bPak5wTCmaGc3f0/Q1udggh4O/LmfcePiT5BUT0yvJ5GAfU5xqjHSEiYF1IjJM54vPwjh/znRb3sNaqru0VMUY0TaOes2makg+4mAtO7REfX2+pd9DHZRMUwoJ+vGGwadhZtG2LsixR/9a6wLkZXddhnmcYYzSrqkrv8vx477XPaY8kNEXmsoRFOfrolaFsrNzWbVVu+ay+7Tzzn2ReS9x7ua98JeIBqFqBhcpM3d4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 직접 전파&quot;
        title=&quot;&quot;
        src=&quot;/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png&quot;
        srcset=&quot;/static/5621a3eb3b655dfc1af7e00698ce9ace/c26ae/17.png 158w,
/static/5621a3eb3b655dfc1af7e00698ce9ace/6bdcf/17.png 315w,
/static/5621a3eb3b655dfc1af7e00698ce9ace/3c024/17.png 573w&quot;
        sizes=&quot;(max-width: 573px) 100vw, 573px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h5&gt;2. 변경 데이터를 가공/변환해서 전파&lt;/h5&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 585px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR42lWPWQ7DMAhEc/97OlKt1ImU2IC3KdBUbT+eBobFeGmjojZB66o3bTTHYrGaxh/9rf3PVIw5sIzZUUrBeZ3IJYOooI/umG9eSglXviDCPmQ16zfMtxlb3vWhBXOCmZGeCTlnj0MIWMOK4zi0mRAfEcSEbdsQY/R83w9ld2Xi+whdWLsgk14mhMJv5crgxq6Z9AIpru4r9n3zvhBE9/TZ8QKKtTdapwAkGAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 변환 전파&quot;
        title=&quot;&quot;
        src=&quot;/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png&quot;
        srcset=&quot;/static/5d55ecd3b1062717b9301afeb09f71e4/c26ae/18.png 158w,
/static/5d55ecd3b1062717b9301afeb09f71e4/6bdcf/18.png 315w,
/static/5d55ecd3b1062717b9301afeb09f71e4/78a22/18.png 585w&quot;
        sizes=&quot;(max-width: 585px) 100vw, 585px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;새로운 주문 데이터가 생성되거나 주문 상태가 &apos;배송 중&apos;으로 변경&lt;/strong&gt;되면 통지 시스템에 전부 보낼 필요 없음.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;주문ID랑 주문 상태만 보내면 됨.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;전파 대상&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;목적에 따라 DB, 메시징 시스템, API 등 선택 가능&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApUlEQVR42jVPSQ6EMAzr/7+JRDmBmNJma/E0AQ5WEtvZ0rg7bChEGWIMNoq6DwuoSfCue/7xDveGNuE9Y3Qkm4KZgaih1gut1dksuO8RfJ31dRWUUkBM6N1C+/yue+5en5V8k02TioIaRSy/gmVZsOVtLiDs+4HjOELLOWNdV5znCWYJ3aMP9Fkp3u08tzewPlG7vNB4h6QFWCm4B/JyT4/M2i/8A97LOCnEtNbUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;전파 대상 1&quot;
        title=&quot;&quot;
        src=&quot;/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png&quot;
        srcset=&quot;/static/11494b74d1e631853d342f86f3c1827b/c26ae/19.png 158w,
/static/11494b74d1e631853d342f86f3c1827b/6bdcf/19.png 315w,
/static/11494b74d1e631853d342f86f3c1827b/9bbaf/19.png 588w&quot;
        sizes=&quot;(max-width: 588px) 100vw, 588px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR42mVQ7Y7DIAzb+79lf3Q99aZCy0chSfGRMHUnDWRhBzuK8uCLQVzBF30gBJL6reWfp+cqFxQ+UamMv46HfrZ+hQW1VkNrDXqUl9LNzKZF5NYpJazrinmejeuh0ZBHw27OOVtg33ds2wbvvYU0oFzrqhXK1asgIms4JhQVDVQJMUaball+sDwXpJjw+n1ZaJomhBDgnYdzDsdxDL45nPn8TKi7sR3qnvjN+9RyidWk8/Gq5rumvpgCQjyQz2R13ekf3DiFnUet5VQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;전파 대상 2&quot;
        title=&quot;&quot;
        src=&quot;/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png&quot;
        srcset=&quot;/static/0a488d6c641a011e5b4b0d56f9e2855f/c26ae/20.png 158w,
/static/0a488d6c641a011e5b4b0d56f9e2855f/6bdcf/20.png 315w,
/static/0a488d6c641a011e5b4b0d56f9e2855f/9fc4b/20.png 583w&quot;
        sizes=&quot;(max-width: 583px) 100vw, 583px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;에러 상황&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dea97f9b3b148309587add5e4cb47258/d7542/22.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVR42n1UyY7bOBDV/39NjplcEsxcAswhE6TtbrTTXuW2rH2XiiL18oqyG0gmMwQeqlhkLaxXUjBZB+dmqBxGgZms399hiVEM7dNPdoWYyZ/Z236ib+Ccgy5rLXb7I+qmxa9ruz8gPL96fZ5nD13nS4TNy+7tnhYVmMn5CxqwH0YYZtX7iyN85n4Y0PfDvyrU+23Xe9+3Cp/OFo+7HGF4QtN0t4PJw9ykOtyr+r/lA55SQZpX2B1OiNMMVdMgL2vaahRlhapucI4Sb2PNmNiiwTj/PMckgwiyqvC69j/IGqud8Y6+8TMdxKLqHZut7XAoGkMILM+ViKQyJJCVM0A79nitYkzG+rPgdL7g+3aPwzFEHKfsoWHpZNUIGRQ6jj6QVqAJ7knuunM3Dii1oCDic5IkQ0xkWe5Z1kbXdet1rbzrezraN4a1z3fd7+clqH9yQQfne8Ms7Lthb7R0UUJIRlF3SOMnNNnfGLuQZ3pulju/wFfYn3jp9YI+TtCdThjzApbjMLGqiaMibQfTtbB9g6lTdP8JoV8gqxXkn6/oKNsvXyCbDVwULbhcPGwYEme4awzO1u9R1zAsIhASMTPyzAzgANuqgi1YZVkuUtnf7mD4tVg6Ojra34F+wt4HJlwj2jxgsz3ihZ/RwOALBs+wUJq+w9gv+1H3I6dA7pA3XYhAou9IXk+4Kstpzuobz2ypQ80vZyxSuCJC19JW1f5Mh3r20wtP5l33LJvqCh1tnbNzXODCoeWAQJRtBS9JlUDyC6TOFkZvdhKO8vqN88p/gLuNzXAJMSQp+pQspymaa4Ihz2FY6dS2i6yrBU1NsKdKgPaMMGVCvVz2bEuQ/fkXknfvEH/4gPLjR+R/vEf56ROm9Rry8ADzuIZZL9C9wr68wO342zoeiRBuv4ejzWQZgna1hj0cYI782zxvsP/8GenqEe2WNjpNPJvoKM/PMHSS7RZzHMNlKcKnFcL1CjZJAL7OcDKCVoPlGToaI2YLOSIhGY/OfAqfLswqlOP1CqGT1ym7+Ioo3CMOD2ipC5MMZYUf0Qm2s53DeAAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 에러 상황&quot;
        title=&quot;&quot;
        src=&quot;/static/dea97f9b3b148309587add5e4cb47258/f058b/22.png&quot;
        srcset=&quot;/static/dea97f9b3b148309587add5e4cb47258/c26ae/22.png 158w,
/static/dea97f9b3b148309587add5e4cb47258/6bdcf/22.png 315w,
/static/dea97f9b3b148309587add5e4cb47258/f058b/22.png 630w,
/static/dea97f9b3b148309587add5e4cb47258/d7542/22.png 810w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;잘 처리된 상황&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3b54b60ad45314c997c0ab99f487d975/d2c2a/24.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACf0lEQVR42mVS2W7bMBDU/39PH9K3Am0RNEDRxolz2IkvybZOSyLFm9J0ScdG0VIYaC9yZ4/EOY9xnKC0gbEuygHej9F28U8EaSeUfIJxZz3YLd3Rxl7lxI8jwimrGl3PcDnhofV2h2EQV1vVKdzNcwjtr7bm1GKbZlEOJJJWjBDKgnEeLyul4TyxmibKbBASThQcdevBRPCfbWQitpYq0dEf7MnL3mK5KbB8W2GzTbF4WyPdHyClwiBkTBSSTHQh4MJe0yOOHruc4IsMSxbYeBhSJPWsoNJfF0sc+zrqUhkoc+6vtjbGlXVDid/x/L6L9gjnYAkJz3KYsoTMC4hjDisEvFIwYoALMsFJeUaQLyBdD3/pFG+pqsQ9PcE+ziFnD1DzOcbjEZ5KHvdHTH2PiRFOJ0x1DTAaGtkCpo//FV0HT+1JRFVCcwZNBss4HDntBxwFhOy2KKDTNLKPPnr4P5DdEONkzjZ4O6ZYbTO8Hba0ElSupl6Z8/RkKN+emz99fNdB/PPFoeyHBpIPqOsMJ8nBiUXOGmR9CUYZpVBoO45Ty84L70Z0ZkCjiVVYej/F5GGpPa1bUioqwSmI4UCTGqGdQW9FvKQ8BY4OjFhWbIg+YTRazdEohsGoCK4kuJZQ1iD5mv3Gp9133Ozu8CX/hZv0Dp93t/jZL/CoNpjJFR7UmuQ1nk2KpT9EvPsc66nEaqQd9ke8+D32tkFyXy/xzDd45SlmxRy3q2+YnTZYDDsCPUB44VvM+zUyW6GYOpSE1FX4kc1wX70iJz2gcB2StCtwon5Usseh3iArHrFrWyqpRy27iEq2KANEi1w08b9lORFY4Kla4TDUKMSJYnv8AdnrMQ+yS5lwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 잘 처리된 상황&quot;
        title=&quot;&quot;
        src=&quot;/static/3b54b60ad45314c997c0ab99f487d975/f058b/24.png&quot;
        srcset=&quot;/static/3b54b60ad45314c997c0ab99f487d975/c26ae/24.png 158w,
/static/3b54b60ad45314c997c0ab99f487d975/6bdcf/24.png 315w,
/static/3b54b60ad45314c997c0ab99f487d975/f058b/24.png 630w,
/static/3b54b60ad45314c997c0ab99f487d975/d2c2a/24.png 929w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;실제 사례&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR42p1S2XKDMAzM/39j8wpkoDY2PsDX1itCZjJtX2JmZyUkrxfkWy4JqaPU3PkA809Ra8ENaDDWYBwHhBhQW5VC6/wX6r8oYqgLAt55PB4P7PuOT1frT6rpFDyOA0opzPOMZVmwruvZ1NovxBjhnEMIQWL2krlegnRmjJEC423bhHPOAr4nKEIBHk5YazFNE7z374LXBuedNNDpMAzQWgnTEYV4KDcTl0OttcRvgin1CZWKGCLUt5K85CLC4zDKp9JpOhK00vJbCIrdv+6wxp6CHEpuGeWFIhO74tyvEq/TVWcedo8tbHDRwffY9Zicn/Uflmhw4KPFGewAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CDC 실제 사례&quot;
        title=&quot;&quot;
        src=&quot;/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png&quot;
        srcset=&quot;/static/1e3b942677f80a80d330bfb04af9c9d5/c26ae/21.png 158w,
/static/1e3b942677f80a80d330bfb04af9c9d5/6bdcf/21.png 315w,
/static/1e3b942677f80a80d330bfb04af9c9d5/065e2/21.png 577w&quot;
        sizes=&quot;(max-width: 577px) 100vw, 577px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;신규 주문 시스템&lt;/code&gt;이 평소처럼 주문을 처리하고 DB에 데이터를 저장/수정&lt;/li&gt;
&lt;li&gt;CDC가 &lt;strong&gt;DB의 변경 내역을 실시간으로 감지합니다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;CDC가 이 변경 데이터를 &lt;code class=&quot;language-text&quot;&gt;기존 주문 시스템&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;콘텐츠 서비스&lt;/code&gt;가 이해할 수 있는 형태로 &lt;strong&gt;가공하여 메시지 큐(카프카)로 전달합니다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;기존 주문 시스템&lt;/code&gt; 등은 메시지 큐에서 데이터를 가져가서 자신들의 시스템에 반영&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;구현&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Debezium&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;역할&lt;/strong&gt;: &lt;strong&gt;실제 CDC의 핵심&lt;/strong&gt;. 데이터베이스의 &apos;가짜 복제본(replica)&apos;처럼 위장하여
트랜잭션 로그를 읽어 들이는 커넥터&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;특징&lt;/strong&gt;: &lt;strong&gt;MySQL, PostgreSQL, MongoDB, SQL Server&lt;/strong&gt; 등 거의 모든 주요 데이터베이스를 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Kafka Connect&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;역할&lt;/strong&gt;: &lt;strong&gt;Debezium 커넥터&lt;/strong&gt;를 실행하고 관리하는 &lt;strong&gt;&apos;실행 환경&apos;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;특징&lt;/strong&gt;: Debezium을 안정적으로 실행하고, 장애가 발생하면 자동으로 재시작해줌.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Apache Kafka&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;역할&lt;/strong&gt;: Debezium이 읽어 들인 변경 데이터를 저장하고 다른 시스템으로 전파&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[JPA @OneToOne 양방향 관계에서 발생하는 N+1 문제 해결 방법]]></title><description><![CDATA[문제 상황 User와 UserProfile이 양방향 @OneToOne 관계로 매핑되어 있을 때, User를 조회하면 UserProfile에 대한 추가 쿼리가 발생하는 N+1 문제를 겪었습니다. 문제 발생 원인 1. @OneToOne…]]></description><link>https://gotobill.github.io/oneToone/</link><guid isPermaLink="false">https://gotobill.github.io/oneToone/</guid><pubDate>Sun, 21 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;문제 상황&lt;/h2&gt;
&lt;p&gt;User와 UserProfile이 양방향 @OneToOne 관계로 매핑되어 있을 때, User를 조회하면 UserProfile에 대한 추가 쿼리가 발생하는 N+1 문제를 겪었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// User 엔티티&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToOne&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fetch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FetchType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LAZY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; userProfile&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// UserProfile 엔티티&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToOne&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;문제 발생 원인&lt;/h2&gt;
&lt;h3&gt;1. @OneToOne 연관관계 주인이 아닌 쪽의 프록시 생성 불가&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;핵심 문제&lt;/strong&gt;
JPA는 @OneToOne 관계에서 연관관계 주인이 아닌 쪽(mappedBy를 사용하는 쪽)은 프록시 객체를 생성할 수 없습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;User 엔티티가 로드될 때:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JPA는 UserProfile이 존재하는지 확인하기 위해 무조건 쿼리를 실행&lt;/li&gt;
&lt;li&gt;FetchType.LAZY를 설정해도 프록시 생성이 불가능하므로 의미가 없음&lt;/li&gt;
&lt;li&gt;존재하면 프록시 객체, 존재하지 않으면 null을 설정해야 하는데 이를 확인하려면 쿼리가 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. @Data 어노테이션의 부작용&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Data&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 모든 필드에 대한 getter/setter 자동 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; userProfile&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;주의사항&lt;/strong&gt;
@Data 어노테이션은 모든 필드에 대한 getter를 생성하므로, JSON 직렬화나 toString() 호출 시 의도치 않게 UserProfile에 접근하게 됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;실제 발생한 쿼리&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- 1. CustomerFeedback 조회 (User JOIN FETCH 포함)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; u&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; su&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; feedback cf
&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; users u &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; u&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id
&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; food_item fi &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;food_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;food_id
&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; store s &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store_id
&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; survey su &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;survey_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; su&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;survey_id
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; cf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_active &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- 2. 각 User마다 UserProfile 조회 (N개)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; user_profile up &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; user_profile up &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; user_profile up &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; up&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- ... (N번 반복)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;해결 방법&lt;/h2&gt;
&lt;h3&gt;방법 1: Fetch Join에 UserProfile 포함&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;
    SELECT cf FROM CustomerFeedback cf
    LEFT JOIN FETCH cf.user u
    LEFT JOIN FETCH u.userProfile
    WHERE cf.store.id = :storeId
    &quot;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Page&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CustomerFeedback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findByStoreIdWithDetails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;storeId&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; storeId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Pageable&lt;/span&gt; pageable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;방법 2: 단방향 관계로 변경&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Best Practice&lt;/strong&gt;
양방향 관계가 꼭 필요하지 않다면 단방향으로 변경하는 것이 가장 깨끗한 해결책입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// UserProfile 참조 제거&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToOne&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 단방향 관계만 유지&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;방법 3: @JsonIgnore 또는 @ToString.Exclude 사용&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Getter&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Setter&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@ToString.Exclude&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// toString()에서 UserProfile 제외&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToOne&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JsonIgnore&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// JSON 직렬화에서 제외&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; userProfile&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;방법 4: @OneToOne 대신 @ManyToOne 사용&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserProfile&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@ManyToOne&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 실제로는 1:1이지만 ManyToOne으로 매핑&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; unique &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// unique 제약조건으로 1:1 보장&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;성능 비교&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;방법&lt;/th&gt;
&lt;th&gt;쿼리 수&lt;/th&gt;
&lt;th&gt;장점&lt;/th&gt;
&lt;th&gt;단점&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Fetch Join&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;한 번의 쿼리로 모든 데이터 조회&lt;/td&gt;
&lt;td&gt;페이징 시 메모리에서 처리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;단방향 관계&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;N+1 문제 원천 차단&lt;/td&gt;
&lt;td&gt;양방향 탐색 불가&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@JsonIgnore&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;N+1&lt;/td&gt;
&lt;td&gt;구현이 간단&lt;/td&gt;
&lt;td&gt;근본적 해결책이 아님&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@ManyToOne&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Lazy Loading 정상 작동&lt;/td&gt;
&lt;td&gt;의미적으로 부정확&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;결론&lt;/h2&gt;
&lt;h3&gt;권장 사항&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;@OneToOne 양방향 관계는 가능한 피하고 단방향으로 설계&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;양방향이 필요하다면 Fetch Join 사용&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Data 어노테이션 대신 필요한 어노테이션만 선택적으로 사용&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DTO 변환 시 필요한 필드만 명시적으로 접근&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;핵심 정리&lt;/strong&gt;
@OneToOne 양방향 관계는 JPA의 구조적 한계로 인해 N+1 문제가 발생하기 쉽습니다. 설계 단계에서부터 이를 고려하여 단방향 관계로 설계하거나, 불가피한 경우 Fetch Join을 통해 해결하는 것이 좋습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;추가 고려사항&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;캐싱 전략&lt;/strong&gt;: 자주 조회되는 UserProfile의 경우 2차 캐시 활용 고려&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;배치 페치 사이즈&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;@BatchSize&lt;/code&gt; 어노테이션으로 N+1 쿼리 수 감소&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;프로젝션&lt;/strong&gt;: 필요한 필드만 조회하는 DTO 프로젝션 활용&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[네트워크 기초 정리]]></title><description><![CDATA[네트워크 서버에는 2개의 공인 IP가 있었습니다: 인바운드 IP: 외부에서 서버로 들어올 때 쓰는 IP 아웃바운드 IP: 서버에서 외부로 나갈 때 쓰는 IP…]]></description><link>https://gotobill.github.io/TCP/</link><guid isPermaLink="false">https://gotobill.github.io/TCP/</guid><pubDate>Wed, 17 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;네트워크&lt;/h2&gt;
&lt;p&gt;서버에는 2개의 공인 IP가 있었습니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;인바운드 IP&lt;/strong&gt;: 외부에서 서버로 들어올 때 쓰는 IP&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;아웃바운드 IP&lt;/strong&gt;: 서버에서 외부로 나갈 때 쓰는 IP&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;노드, 네트워크, 라우터&lt;/h2&gt;
&lt;p&gt;데이터를 송수신하는 모든 장치를 &lt;strong&gt;노드&lt;/strong&gt;라고 부릅니다. 우리가 쓰는 휴대폰, 노트북, 서버 장비 등이 모두 노드에 해당합니다. 이런 각 노드가 서로 데이터를 주고받기 위해 연결된 시스템을 &lt;strong&gt;네트워크&lt;/strong&gt;라고 합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 326px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bb40e9042d33fa7156d113367c4fd2fb/ce9b1/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVR42qVUy4rCQBD0w/wxr4JnTwHFg1cRPAuKV0HworCKRqJGD74RTXyb2q2WljGr4rINTaZnaqqfk0gQBDgcDrhcLjifz9jv99jtdvI11dzTNfHU4/EoNrki+JFutwvLspDP52XzEz2dThiNRnAcB7PZTGyqEDabTTmoVqvwPA9hIYHK9XqVr+u6KBQKSCaTKBaLsvdAOJ1OUa/XsVqt8E6UnFlls1mkUinkcjkhY/pC2G63EY/Hkclk4Hu+KAEUOqCzxWIhNuvn+77YjUZDgiA5M2MfIkyBoMFggOVyKZd4QACbxTrxkm3bQqTFVxwbQuFXIuQmQeFaKYjeO52OEOplxSpeJ+UXoSmMnEBGNZ/P75GFnar9NMJnQqAZ2Tvcy5QZXb/fF2UNWeN/EY7HY1QqFZnNWCyGcrn8tMYfE67Xa6TTaZRKJUSjUSQSiXtX/0RokvZ6PdRqNenyZDJ5OQWbzebhbQuh1sh8qzrE2hDzTJ8f57b11cLQHWK73d4GmwDzT8J5Cq/1PHymE8A1lY6+AbtUfhM60tHPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;네트워크 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/bb40e9042d33fa7156d113367c4fd2fb/ce9b1/1.png&quot;
        srcset=&quot;/static/bb40e9042d33fa7156d113367c4fd2fb/c26ae/1.png 158w,
/static/bb40e9042d33fa7156d113367c4fd2fb/6bdcf/1.png 315w,
/static/bb40e9042d33fa7156d113367c4fd2fb/ce9b1/1.png 326w&quot;
        sizes=&quot;(max-width: 326px) 100vw, 326px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;패킷(Packet)&lt;/h3&gt;
&lt;p&gt;노드가 네트워크를 통해 전송하는 데이터의 단위를 패킷이라고 합니다. 패킷은 헤더와 페이로드로 구성됩니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;헤더&lt;/strong&gt;: 패킷의 발신자와 수신자 정보가 들어있습니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;페이로드&lt;/strong&gt;: 실제 전송되는 데이터가 들어있습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;데이터는 일정 크기를 가진 여러 패킷으로 나뉘어 전송됩니다.&lt;/p&gt;
&lt;p&gt;네트워크의 예로 집에서 쓰는 공유기에 연결된 장치들을 들 수 있습니다. 공유기에 연결된 휴대폰이나 컴퓨터가 하나의 네트워크를 구성하죠. 마찬가지로 사무실에서 사용하는 컴퓨터들도 하나의 네트워크를 구성합니다.&lt;/p&gt;
&lt;p&gt;서로 다른 네트워크에 속한 노드는 직접 연결해서 패킷을 송수신할 수 없습니다.&lt;/p&gt;
&lt;p&gt;이때 사용되는 것이 &lt;strong&gt;라우터&lt;/strong&gt;입니다. 라우터는 네트워크 간에 패킷을 전송하는 역할을 합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 452px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ff661b761b1304066995c38c7f19de5a/fcb94/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1klEQVR42mWQ206DQBCGeSLqBfb9Q7g2mmJRRIlE3Q0Q7C5YTmU/OxiunMkm/2y+OXrGGJIkoe975nlmmibGccRdfXEL7vrERC/LnxZOeOFEW2uROpLrpWlKGIbUdU3TNGRZxjiMtD+W58+Yonxb4/fqlaePA925oz6VPBb31G2JVprdzQ7f91FK4UmBKIqoqmr9kAZd12Hab47FA7nO6M89uXpZY9saykZzyO8oTwr1pdjvbwmCAK01nowaxzHDMKwjbytv5pz7py/zZWWElZXlFNu5fgF70Sc47UttLAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;라우터를 통한 네트워크 연결&quot;
        title=&quot;&quot;
        src=&quot;/static/ff661b761b1304066995c38c7f19de5a/fcb94/2.png&quot;
        srcset=&quot;/static/ff661b761b1304066995c38c7f19de5a/c26ae/2.png 158w,
/static/ff661b761b1304066995c38c7f19de5a/6bdcf/2.png 315w,
/static/ff661b761b1304066995c38c7f19de5a/fcb94/2.png 452w&quot;
        sizes=&quot;(max-width: 452px) 100vw, 452px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;도메인과 IP 주소&lt;/h2&gt;
&lt;p&gt;각 노드의 IP 주소를 외우기는 쉽지 않습니다. 그래서 IP 주소에 기억하기 쉬운 이름을 붙이는데, 그게 바로 &lt;strong&gt;도메인 이름&lt;/strong&gt;입니다. 도메인 이름을 IP 주소로 변환하는 체계가 &lt;strong&gt;DNS&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;DNS를 인터넷 전화번호부라고 생각하시면 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;도메인 이름은 계층 구조를 갖습니다. 각 계층은 점(.)으로 구분되며, 오른쪽이 상위 계층이고 왼쪽이 하위 계층입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;도메인 계층 구조&lt;/h3&gt;
&lt;p&gt;가장 오른쪽이 &lt;strong&gt;최상위 계층&lt;/strong&gt;입니다. 최상위 계층에는 두 가지 종류가 있습니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;일반 최상위 도메인&lt;/strong&gt;: com, org, net, gov, app, biz, tech 등&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;국가 최상위 도메인&lt;/strong&gt;: kr, jp, au, cn 등&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;일반 최상위 도메인 (예: .com)&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;2차 도메인이 주요 이름이 됩니다&lt;/strong&gt; (회사나 브랜드 이름)&lt;/li&gt;
&lt;li&gt;예: naver.com → naver가 2차 도메인&lt;/li&gt;
&lt;li&gt;3차부터는 용도별로 사용: cafe.naver.com, &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;국가 최상위 도메인 (예: .kr)&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;2차 계층&lt;/strong&gt;까지 미리 정의되어 있습니다
&lt;ul&gt;
&lt;li&gt;ac.kr: 대학 등 교육 기관용&lt;/li&gt;
&lt;li&gt;co.kr: 기업용&lt;/li&gt;
&lt;li&gt;go.kr: 정부 기관용&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;3차 계층이 주요 이름이 됩니다&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;예: gasapp.co.kr → gasapp이 주요 이름&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;DNS 작동 방식&lt;/h3&gt;
&lt;p&gt;도메인 이름에 해당하는 IP 주소는 DNS 서버를 통해 알아냅니다.&lt;/p&gt;
&lt;h4&gt;간단한 설명&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;http://www.naver.com%EC%9D%84&quot;&gt;www.naver.com을&lt;/a&gt; 브라우저에 입력하면, 브라우저가 DNS 서버한테 &quot;&lt;a href=&quot;http://www.naver.com%EC%9D%98&quot;&gt;www.naver.com의&lt;/a&gt; IP 주소가 뭐예요?&quot;라고 물어봅니다. DNS 서버는 해당 IP 주소를 알려주고, 브라우저는 그 IP 주소로 데이터를 보냅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. www.naver.com의 IP 주소 요청
2. 223.130.192.248 응답
3. 데이터 전송&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;실제 DNS 조회 과정 (상세)&lt;/h4&gt;
&lt;p&gt;실제로는 여러 DNS 서버를 거쳐가며 IP 주소를 찾습니다. &lt;strong&gt;구글&lt;/strong&gt;에 접속하는 과정을 예로 들어보겠습니다:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 482px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a582629e39a7beedfb929d27de7ec9c4/37e0d/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 201.8987341772152%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXElEQVR42p1XaXfiRhAk6wNzSUInutGJACFO23iTteO3m+Qlb///36l0j4FgO7aRP/Sb0SCVqrv6EA0vGuGlBVmFYLSEl83h5wv4tB7vA1qDfI7/e7bx7GCYI0hLaMEMPdWF5Y+gWENoTgLTz6HaCXQnhWKGUL0SfjKh5/K3Ad1hhpDe3NUDXDUvkSQZ1L4Gz/EQRTEsawCX9rLUQ1t14KdTQeJthvQ2Px7DSdcwwhn0sBSrMZzBiiroQSnOeLWzDby4+MDlnfl0Y0DuBOlEvCAuKhSztQDgs6fz4oQYHsVyby5ZlJcYTVdiL2L2ws2PAY+YMqvLqx7OL1oESGfJGO898y4gM+prNmzHx8D2aD+AE2ZvuvuuyyHFqW84aLe7WCyvsdrcQlFU9BSDfpvu3K/JkN3t6zYkqY8eGTP0oqKey+wOGzNIRjMkxRytbl/EMabrbDIXv+3v+xCQYzTwU4TZlMBm4uF9Crn0e0yKs+oDPxH2DmABh1ScVmvMlxtUFDf3DaGWFM/F6hrr6+0rlv8BDlO6OUUxmWG5XNFaijNh+3qlJA8obSazJba/3mNz8/UpyY9SqbFn5482VE4rUWZJ9ZvY2yl1nNFGAPF9lhtDM6mWNQcOhUXVXXFt2uGBaYNTxKcO0xk9Qhk/YLD4E/byL7HydSu9p5et4BNLFqYnKUhSEi+IEA4TqJqJxi+XokSfATbTB8jFPZz13zCqH/A3/6A/fcRF9A1BQSypE111ZBiGjSgmocJYmE7XX86bRwx3+eaOtzDTaxjUaUzqJGa6EatTbOGRyj7dp5k+FNWCZrjQTTLLE5WkqIMjhgdRMgQRW75bqcTY6HwvCgsS7kTg7jOk1OKz4LUoH5u/qxDLi2HYQ2TjCjbloelGz8rwJEB+gBNdJtdkRadmEcBxQ2oYvriWFPNFDE8AHGYlupKOTkdCnk8wLeeYTCtopPJVWzm4fTpDip1KOXfZ7JIojhDFoOt2VxHMX4tyonGT5RpmRk6QUe3nzzpQLUBmybFkNuXyFhF1H1acz2oDMiOFcq5Fyd2TdQycUOSk3Dcptpp4GadXDcAJBV+GJKskxhyjYirMptFwdn61Y5nXY9imRntx2aJaLmANPIRhgm5PxpczBizrAYouTgJYlMj6IBSCmE4kzKbO4yefUJlBudw4XiwKjwTeixzcVUstQE4RlRqDTMPKDVJou+Zg075WpexjqFk+ms0O0qwQvZB7YqvVFYm9H62nx5AAOXZfzi6R5WPko4kAbjTOxfxm12sB7iei1LcgESN2ndeebIiu88nSK5DTXC7KBWY0FafVij6iFgewmv2QGPoxylmF7e0Nvt7dkW2xXtN4CJNPAHIeFjfQaUwo4QLR4lHs1XhN4+Pu0CBOb1/5DN3sHp38HuHNT1g0FYPbn5Anv6OVfyfRnj6Pa/TDEsroAd38G8zqD2jld7FKxQOk8Y/DB3y9SqG/FE62gJ1UB3NS/ruxPMTwXzqpUAzdL4adAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;머메이드&quot;
        title=&quot;&quot;
        src=&quot;/static/a582629e39a7beedfb929d27de7ec9c4/37e0d/3.png&quot;
        srcset=&quot;/static/a582629e39a7beedfb929d27de7ec9c4/c26ae/3.png 158w,
/static/a582629e39a7beedfb929d27de7ec9c4/6bdcf/3.png 315w,
/static/a582629e39a7beedfb929d27de7ec9c4/37e0d/3.png 482w&quot;
        sizes=&quot;(max-width: 482px) 100vw, 482px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이 과정이 복잡해 보이지만 실제로는 1초도 안 걸립니다. 한 번 조회한 결과는 캐시에 저장되어 다음에 더 빠르게 접속할 수 있습니다.&lt;/p&gt;
&lt;p&gt;로컬에서 개발할 때 쓰는 localhost는 특별한 주소입니다. localhost의 IP 주소는 127.0.0.1입니다.&lt;/p&gt;
&lt;p&gt;이건 &lt;strong&gt;루프백 주소&lt;/strong&gt;라고 해서 자기 자신을 가리킬 때 쓰는 IP 주소입니다.&lt;/p&gt;
&lt;h3&gt;hosts 파일&lt;/h3&gt;
&lt;p&gt;모든 컴퓨터는 hosts 파일을 가지고 있습니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;리눅스&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;/etc&lt;/code&gt; 디렉토리에 있습니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;윈도우&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;C:\Windows\System32\drivers\etc&lt;/code&gt; 디렉토리에 있습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;도메인 이름과 IP 주소 개수&lt;/h3&gt;
&lt;p&gt;하나의 도메인에 여러 IP 주소가 매핑될 수 있습니다. nslookup 명령어로 확인해볼 수 있습니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;nslookup&lt;/span&gt; www.naver.com
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Address: &lt;span class=&quot;token number&quot;&gt;223.130&lt;/span&gt;.192.248
Address: &lt;span class=&quot;token number&quot;&gt;223.130&lt;/span&gt;.192.247
Address: &lt;span class=&quot;token number&quot;&gt;223.130&lt;/span&gt;.200.219
Address: &lt;span class=&quot;token number&quot;&gt;223.130&lt;/span&gt;.200.236&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;한 도메인에 IP 주소를 여러 개 매핑하는 이유 중 하나는 &lt;strong&gt;부하 분산&lt;/strong&gt; 때문입니다.&lt;/p&gt;
&lt;h2&gt;고정 IP와 동적 IP&lt;/h2&gt;
&lt;p&gt;같은 네트워크에서 각 노드는 서로 다른 IP 주소를 가져야 합니다. IP 주소로 패킷을 보낼 노드를 구분하기 때문에, 같은 IP 주소를 가진 노드가 있으면 IP 충돌이 일어납니다.&lt;/p&gt;
&lt;p&gt;노드의 IP 주소는 2가지 방식으로 지정합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;고정 IP&lt;/strong&gt;: 노드가 고정된 IP를 갖습니다. 서버 IP가 대표적이죠.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;동적 IP&lt;/strong&gt;: 노드가 네트워크에 연결할 때마다 IP를 할당받습니다. DHCP(Dynamic Host Configuration Protocol) 서버가 이걸 담당합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;DHCP 서버&lt;/h2&gt;
&lt;h4&gt;DHCP 동작 과정 (DORA)&lt;/h4&gt;
&lt;p&gt;DHCP는 &lt;strong&gt;브로드캐스팅&lt;/strong&gt;을 통해 IP를 할당받습니다. 이 과정을 &lt;strong&gt;DORA&lt;/strong&gt;라고 부르는데, 각 단계의 앞글자를 딴 것입니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;D - Discover (발견)
O - Offer (제안)
R - Request (요청)
A - Acknowledgment (확인)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;상세한 DHCP 과정&lt;/h4&gt;
&lt;p&gt;노트북을 WiFi에 연결하는 상황을 예로 들어보겠습니다:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;① DHCP Discover - &quot;DHCP 서버 어디있어요?&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;노트북: &quot;저 IP가 없는데 누가 좀 줘요!&quot; (브로드캐스트)
발신: 0.0.0.0 (아직 IP가 없음)
수신: 255.255.255.255 (네트워크 전체에 외침)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;② DHCP Offer - &quot;내가 줄 수 있어&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;공유기(DHCP 서버): &quot;192.168.0.105 쓸래?&quot;
제안 내용:
- IP 주소: 192.168.0.105
- 서브넷 마스크: 255.255.255.0
- 게이트웨이: 192.168.0.1
- DNS: 8.8.8.8
- 임대 시간: 24시간&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;③ DHCP Request - &quot;그거 주세요!&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;노트북: &quot;네, 192.168.0.105 주세요!&quot; (브로드캐스트)
→ 여러 DHCP 서버가 있을 수 있어서 가장 먼저 응답을 주는 DHCP 서버를 선택
→ 브로드 캐스팅으로 알림

메시지 내용:
- Transaction ID: 이전 DHCP 메시지와 동일한 ID
- DHCP Message Type: REQUEST
- Requested IP Address (Option 50): 192.168.0.105
- DHCP Server Identifier (Option 54): 선택한 서버의 IP&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;④ DHCP ACK - &quot;자, 여기 있어&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;공유기: &quot;확인! 192.168.0.105는 24시간 동안 네 거야&quot;
→ 이제 노트북은 정식으로 IP를 받음&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;브로드캐스팅이란?&lt;/h4&gt;
&lt;p&gt;브로드캐스팅은 네트워크의 모든 기기에게 동시에 메시지를 보내는 방식입니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;유니캐스트&lt;/strong&gt;: 1:1 통신 (특정 IP로 전송)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;브로드캐스트&lt;/strong&gt;: 1:전체 통신 (255.255.255.255로 전송)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;멀티캐스트&lt;/strong&gt;: 1:그룹 통신 (특정 그룹에만 전송)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;애니캐스트&lt;/strong&gt;: 1:가장 가까운 1개 (같은 IP를 가진 여러 서버 중 가장 가까운 곳으로)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;애니캐스트 예시:&lt;/strong&gt;
CDN이나 DNS 루트 서버가 애니캐스트를 사용합니다. 예를 들어 구글 DNS(8.8.8.8)는 전 세계에 수백 개 서버가 있는데, 모두 같은 IP를 갖습니다. 한국에서 8.8.8.8에 접속하면 한국에서 가장 가까운 서버로 자동 연결됩니다.&lt;/p&gt;
&lt;p&gt;DHCP가 브로드캐스트를 쓰는 이유는 간단합니다. &lt;strong&gt;아직 IP가 없는 기기는 DHCP 서버가 어디 있는지 모르기 때문입니다&lt;/strong&gt;. 그래서 &quot;야! 다들 들어봐! 나 IP 필요해!&quot;라고 네트워크 전체에 외치는 거죠.&lt;/p&gt;
&lt;h4&gt;IP 임대 시간과 갱신&lt;/h4&gt;
&lt;p&gt;DHCP로 받은 IP는 영구적이지 않습니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;임대 시간&lt;/strong&gt;: 보통 24시간 (설정 가능)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;50% 시점&lt;/strong&gt;: 12시간 지나면 갱신 시도&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;87.5% 시점&lt;/strong&gt;: 갱신 실패 시 다시 시도&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;만료&lt;/strong&gt;: 새로 DHCP Discover부터 다시 시작&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이렇게 임대 방식을 쓰는 이유는 한정된 IP 주소를 효율적으로 관리하기 위해서입니다.&lt;/p&gt;
&lt;h2&gt;공인 IP와 사설 IP&lt;/h2&gt;
&lt;p&gt;웹 브라우저에 &lt;a href=&quot;http://www.google.com%EC%9D%B4%EB%82%98&quot;&gt;www.google.com이나&lt;/a&gt; &lt;a href=&quot;http://www.daum.net&quot;&gt;www.daum.net&lt;/a&gt; 같은 도메인을 입력하면 DNS 서버에서 IP 주소를 받아와서 접속합니다. 이때 사용하는 IP 주소는 인터넷 어디서든 접근 가능한 &lt;strong&gt;공인(public) IP&lt;/strong&gt; 주소입니다.&lt;/p&gt;
&lt;p&gt;모든 네트워크에서 쓸 수 있는 공인 IP와 달리, 네트워크 내부에서만 쓰는 &lt;strong&gt;사설(private) IP&lt;/strong&gt; 주소도 있습니다. 사설 IP는 특정 네트워크 안에서만 유효하고 외부에서는 접근할 수 없습니다.&lt;/p&gt;
&lt;p&gt;사설 IP로 쓸 수 있는 주소 범위입니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;192.168.x.x&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;10.x.x.x&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;172.16.x.x ~ 172.31.x.x&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;공인 IP 알아내기&lt;/h3&gt;
&lt;p&gt;간단한 방법은 &lt;a href=&quot;https://ifconfig.me&quot;&gt;https://ifconfig.me&lt;/a&gt; 같은 사이트에 접속해서 확인하는 겁니다.&lt;/p&gt;
&lt;p&gt;리눅스에서도 아래 명령어로 공인 IP 주소를 확인할 수 있습니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; ifconfig.me&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;NAT&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;NAT&lt;/strong&gt;(Network Address Translation, 네트워크 주소 변환)는 네트워크 주소를 변환하는 기술입니다. 인터넷에 연결하려면 내부의 사설 IP와 인터넷의 공인 IP 간 변환이 필요한데, NAT가 이걸 처리합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SNAT(Source NAT)&lt;/strong&gt;: 나가는 패킷의 출발지 변경 (AWS NAT Gateway)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/188f0abb2526b60722a87f39da470064/76aed/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArklEQVR42n1PSwqFMAzs/W/iPYQiupVurYiKFrX+6n8kActbvcDQpDNJJkJKiSAIcF0XfuM8TyzLwu+/IH7fd9z3zbVQSiGKIgzDgHVdMc8zoyxLxHEMYww30HDnnMc4jpimibVt26LvezYlwjBkh9ZaHpLnObquQ13XSNOUc2rSWqNpGlRVxRrS0iLi6I8WbNsGkWUZkiRhu8/zeOvkoigKf/LHESj/cByHP5vqF1oVMOfdhmVmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;snat&quot;
        title=&quot;&quot;
        src=&quot;/static/188f0abb2526b60722a87f39da470064/76aed/4.png&quot;
        srcset=&quot;/static/188f0abb2526b60722a87f39da470064/c26ae/4.png 158w,
/static/188f0abb2526b60722a87f39da470064/6bdcf/4.png 315w,
/static/188f0abb2526b60722a87f39da470064/76aed/4.png 546w&quot;
        sizes=&quot;(max-width: 546px) 100vw, 546px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;DNAT(Destination NAT)&lt;/strong&gt;: 들어오는 패킷의 목적지 변경 (AWS ALB/NLB)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 585px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a4481de1170d3cb90af544093f05083a/78a22/5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42m2QO0vDYBSG8y/FzcnB0sWli876A6qT4g2hZlAkBLEQbAdBx1iNRggkqIm532+E5LXfgXZQH3j5DnzwnJfDFUWBqqrA6Lpumd/UdQ3P8yi6rsP8svDwMcVIOcCtdo2rt3NcqmfgBEGAJEl/JGxJkiQIwxBZlpGwaRqaXc9F7McYPu5iY7yC7Wkfg7t19Mar4DRNg6qqsG0bQRAgiiLEcUwi13UhyzKJ0zQlaZ7nJGZ8p59QXBnvvgLVf6ZwPM9DFEXabFkWSVg7dgomNwyD5rIs0bbtMozT2T7681Y79wNsTXrYlNbAmaYJx3HwH2wJ+1s0WjC/Mr0T4wbHT0OMXg5x8XqEk9kefgCC/Wt7WiNwEgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;snat&quot;
        title=&quot;&quot;
        src=&quot;/static/a4481de1170d3cb90af544093f05083a/78a22/5.png&quot;
        srcset=&quot;/static/a4481de1170d3cb90af544093f05083a/c26ae/5.png 158w,
/static/a4481de1170d3cb90af544093f05083a/6bdcf/5.png 315w,
/static/a4481de1170d3cb90af544093f05083a/78a22/5.png 585w&quot;
        sizes=&quot;(max-width: 585px) 100vw, 585px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;DNAT는 서버 구성할 때 많이 씁니다. 보통 보안이나 이중화를 위해 서버는 사설 IP를 쓰고, 공인 IP는 라우터나 방화벽 같은 네트워크 장비에 할당합니다.&lt;/p&gt;
&lt;h2&gt;VPN&lt;/h2&gt;
&lt;p&gt;백엔드 서버를 개발하고 운영하다 보면 서버나 DB에 접속할 일이 많습니다. SSH로 서버에 접속해서 프로세스를 확인하거나 OS 설정을 바꿔야 할 때도 있고, DB에 접속해서 SQL을 실행해야 할 때도 있죠.&lt;/p&gt;
&lt;p&gt;서버 네트워크의 노드에 안전하게 접근하려면 &lt;strong&gt;VPN&lt;/strong&gt;(Virtual Private Network, 가상 사설 네트워크)을 사용합니다. VPN은 인터넷 같은 공용 네트워크에서 서로 다른 네트워크 간에 암호화된 연결을 제공합니다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1a31889900d9f6791e839395c7e1c624/084e2/6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABbklEQVR42pWRzU/bQBDF898iOCCOqEVCOfeAeoRDb0gVl0oETkCBEFBBlUyRFSikxCSQKCTGGyfO2t71/vCazwOXjjSat6vRm3lvSsYYXjLLMrJn/FHY/yRJMNpwJ9octnZxOscc5bXR/0umMkpKKXq9Ho1GAxEIxpMRnf4tD0MfOZFIKYnjmCiKCEKfrn+HSQ1Vb4v5vSmWTsp82p/mx8UqZFCykx3HYXNzg+t/TUIpODzb5bzp4jU96vU6rptj74aLG5eD023EUPD79ogvvz7zzfma1wW2ritPhFprWq0W1WoVIUQuW+MHAyYywm4fhiFBEGD7ZDzBHw5AQc3bYfFglqXjMuXaHJXLtSdC69t4PC5kt9ttup0uWulXX9/7Z3tTlRbvmvezkGolL+zPULlae5NsG+02NgsyLNHbsV6IjclyP2WB6/0/rLrLrF9+z+tKcRj0M+H/hB2apgkjMaLfHdDr3BNHCTrVKK14BN1nBmPVDY7wAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;snat&quot;
        title=&quot;&quot;
        src=&quot;/static/1a31889900d9f6791e839395c7e1c624/f058b/6.png&quot;
        srcset=&quot;/static/1a31889900d9f6791e839395c7e1c624/c26ae/6.png 158w,
/static/1a31889900d9f6791e839395c7e1c624/6bdcf/6.png 315w,
/static/1a31889900d9f6791e839395c7e1c624/f058b/6.png 630w,
/static/1a31889900d9f6791e839395c7e1c624/084e2/6.png 632w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;개발자는 VPN 클라이언트로 VPN에 접속할 수 있습니다. 집이나 카페에서 서버 네트워크에 접근해야 할 때 이 방식을 씁니다.&lt;/p&gt;
&lt;h2&gt;프로토콜과 TCP, UDP, QUIC&lt;/h2&gt;
&lt;p&gt;네트워크에서 두 노드가 데이터를 주고받기 위해 정한 규칙을 &lt;strong&gt;프로토콜&lt;/strong&gt;(protocol)이라고 합니다. 네트워크는 여러 계층으로 구성되고 각 계층마다 사용하는 프로토콜이 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCP/IP 모델의 계층별 프로토콜과 전송 단위:&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;프로토콜&lt;/th&gt;
&lt;th&gt;전송 단위&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;응용 계층&lt;/td&gt;
&lt;td&gt;HTTP, FTP, SMTP&lt;/td&gt;
&lt;td&gt;메시지 (Message)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;전송 계층&lt;/td&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;세그먼트 (Segment)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;전송 계층&lt;/td&gt;
&lt;td&gt;UDP&lt;/td&gt;
&lt;td&gt;데이터그램 (Datagram)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;네트워크 계층&lt;/td&gt;
&lt;td&gt;IP&lt;/td&gt;
&lt;td&gt;패킷 (Packet)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;TCP (Transmission Control Protocol)&lt;/h3&gt;
&lt;p&gt;TCP는 연결 기반 프로토콜입니다. 전화 통화처럼 먼저 연결을 맺고 나서 데이터를 주고받습니다. TCP에서 두 노드가 연결을 맺는 과정을 &lt;strong&gt;3-Way Handshake&lt;/strong&gt;라고 부릅니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 288px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cb29290e24696aca7edccfca61f34e87/477c9/7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 101.26582278481011%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABq0lEQVR42pWUaavCMBBF/f8/SEFQUUE/+EXrgoIK7rjv+zKPM5CSatOngdCSSU7u3BkS22w2UqlUpN1uS6fTkapXleVyKYzX6yVRg33NZlMOh4O/P7ZarcTzPBmPxzIajRS83+8DB9kYBl+v19Lr9YJAs3GxWEir1dL/5/MZgLnG8XiURqMR2OcD+/2+JJNJhXGjWecQMdsGE0NhJpMJiPCBg8FACoWC/m+3W8EKvlhRr9dlOp1+KMb/XC7nBhaLxUCQ7+l0kvP5rHBU4i+qjcJsNhsOJC0DfDweoZ6xlwuwxPiXSqXcQJMyQdYp1GQyUQBqUGgO3m436Xa7bg/fgUzaiPXZbKYdUC6X9RL8vVwu6mtkygZ4v981bQ6RGubzNet2UZxAipJIJOR6vWpqpAgEqKsXI4EojMfjkUX5GZhOpzWAKkxnUFVi+GYX7CtgPp/3+4u52+10nQeAav+s8L2xKQITlTQ0l9DgxldUf93YYYVgHSuA0pu1Wi26sd8V/vd8zedzt0LeNbuxo4b92jiBw+FQSqXSV0D7gf0AmiDmY/YvgzNU2n5g/wCoNQWFHlgvlQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3handshake&quot;
        title=&quot;&quot;
        src=&quot;/static/cb29290e24696aca7edccfca61f34e87/477c9/7.png&quot;
        srcset=&quot;/static/cb29290e24696aca7edccfca61f34e87/c26ae/7.png 158w,
/static/cb29290e24696aca7edccfca61f34e87/477c9/7.png 288w&quot;
        sizes=&quot;(max-width: 288px) 100vw, 288px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트 → 서버: SYN (Seq=1000)
서버 → 클라이언트: SYN-ACK (Seq=3000, Ack=1001)
클라이언트 → 서버: ACK (Seq=1001, Ack=3001)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Seq와 Ack가 뭔가요?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Seq(Sequence Number)&lt;/strong&gt;: &quot;내가 보내는 데이터의 번호&quot;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ack(Acknowledgment Number)&lt;/strong&gt;: &quot;다음에 받고 싶은 상대방 데이터의 번호&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;예를 들어 서버가 &lt;code class=&quot;language-text&quot;&gt;Ack=1001&lt;/code&gt;을 보내면 &quot;클라이언트님, 1000번까지 잘 받았고 이제 1001번 주세요&quot;라는 의미입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;왜 Sequence Number는 임의의 난수로 시작할까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;클라이언트와 서버 모두 각자의 Seq를 임의의 난수로 시작합니다. 위 예시에서 클라이언트는 1000, 서버는 3000으로 시작했죠.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;보안&lt;/strong&gt;: 예측 가능한 번호(0, 1, 2...)를 쓰면 공격자가 패킷을 위조하기 쉬움&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;이전 연결과 구분&lt;/strong&gt;: 같은 포트로 새 연결을 맺을 때, 이전 연결의 지연된 패킷과 섞이는 것 방지&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;TCP는 양방향 통신이라서 각자 자신의 송신 채널에 대한 Seq가 필요합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클라이언트의 Seq: 클라이언트 -&gt; 서버 데이터 추적&lt;/li&gt;
&lt;li&gt;서버의 Seq: 서버 -&gt; 클라이언트 데이터 추적&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b2b62ce43413961e186c907eaabc0bb5/e51a6/8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABOUlEQVR42nWSO0/EMBCE7/+XlPwACgoKGiQKaJGQ6GhoqMiLKE6c+JnH8fmSs0w4rMTZjHdmZ20fjucxjVPXdc654z9jWZa2bb33ETnwDtqzYIxRSmmtQbyfslLEJBKY0UV9JYtO8QTyw1tZVG1a5P0ju7q+iwVvnj7xlSbc3r88Pr8GMtWstcxCiKqqkOcXIzG173sQKSUJZVlikFWMBDKRnxbrx6+8lIMiZpAdyUY7wF6ZrKi0pacFkIQzeXbWm7zKhRTjMlrv1uY3slGAvZbFd8FMrJ3dyKntuq5X27/Ip8qYojIGV/ACOfackrUesCZVt1YOvmJlPgi7caJnrWwU3m0YM+eMNQKktw1j4dRn6LluGlTDk1T+e3M47XmeA5mtj7abpkF+Zzt1EeU4kcNF4R2YXskU+QFmPrlMmnHaUgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3handshake&quot;
        title=&quot;&quot;
        src=&quot;/static/b2b62ce43413961e186c907eaabc0bb5/f058b/8.png&quot;
        srcset=&quot;/static/b2b62ce43413961e186c907eaabc0bb5/c26ae/8.png 158w,
/static/b2b62ce43413961e186c907eaabc0bb5/6bdcf/8.png 315w,
/static/b2b62ce43413961e186c907eaabc0bb5/f058b/8.png 630w,
/static/b2b62ce43413961e186c907eaabc0bb5/e51a6/8.png 783w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;TCP 연결 종료: 4-Way Handshake&lt;/h3&gt;
&lt;p&gt;TCP 연결은 &lt;strong&gt;양방향 채널&lt;/strong&gt;입니다. 클라이언트 -&gt; 서버, 서버 -&gt; 클라이언트 두 개의 독립적인 채널이 있죠.&lt;/p&gt;
&lt;p&gt;연결을 끊으려면 &lt;strong&gt;각 채널을 따로 닫아야 합니다&lt;/strong&gt;. 그래서 4-Way가 필요합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트 → 서버: FIN (&quot;나는 더 보낼 거 없어&quot;)
서버 → 클라이언트: ACK (&quot;알겠어&quot;)
서버 → 클라이언트: FIN (&quot;나도 더 보낼 거 없어&quot;)
클라이언트 → 서버: ACK (&quot;알겠어&quot;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 3-Way가 아니라 4-Way인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;3-Way Handshake처럼 서버가 ACK+FIN을 동시에 보내면 안 될까요?&lt;/p&gt;
&lt;p&gt;문제는 서버가 &lt;strong&gt;아직 보낼 데이터가 남아있을 수 있다&lt;/strong&gt;는 겁니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트: &quot;나 다 보냈어&quot; (FIN)
서버: &quot;알겠어, 근데 나는 아직 보내는 중이야&quot; (ACK만)
서버: (남은 데이터 전송...)
서버: &quot;나도 이제 다 보냈어&quot; (FIN)
클라이언트: &quot;알겠어&quot; (ACK)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;만약 3-Way로 ACK+FIN을 동시에 보내면, 서버가 보내던 데이터가 중간에 끊길 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;서버가 먼저 FIN을 보낼 수도 있다&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;TCP는 대등한 양방향 통신이기 때문에, 누가 먼저 FIN을 보내든 상관없습니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP 서버가 응답을 다 보낸 후 먼저 연결을 끊는 경우&lt;/li&gt;
&lt;li&gt;서버가 타임아웃으로 연결을 정리하는 경우&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;핵심은 &lt;strong&gt;양쪽 모두 &quot;나는 더 보낼 게 없다&quot;고 선언해야 연결이 완전히 종료된다&lt;/strong&gt;는 것입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TIME_WAIT: 마지막 ACK 후에도 기다리는 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;클라이언트가 마지막 ACK를 보낸 후 바로 연결을 닫지 않고 &lt;strong&gt;TIME_WAIT&lt;/strong&gt; 상태로 일정 시간(보통 60초) 대기합니다.&lt;/p&gt;
&lt;p&gt;왜 기다릴까요?&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;마지막 ACK가 유실될 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;클라이언트 → 서버: ACK (마지막)
         ↑
      이게 유실되면?

서버: &quot;어? ACK 안 왔네, FIN 다시 보내야겠다&quot;
서버 → 클라이언트: FIN (재전송)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;클라이언트가 이미 연결을 닫았다면 서버의 FIN 재전송을 받을 수 없고, 서버는 계속 FIN을 보내며 대기하게 됩니다.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;strong&gt;지연된 패킷이 새 연결에 섞이는 것 방지&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이전 연결의 패킷이 네트워크 어딘가에서 지연되다가, 새 연결이 같은 포트를 사용하면 이전 연결의 패킷이 새 연결에 섞일 수 있습니다. TIME_WAIT으로 대기하면 이전 연결의 모든 패킷이 네트워크에서 사라질 시간을 확보합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/1.0&lt;/strong&gt;: 매 요청마다 새로운 TCP 연결을 맺어야 했습니다 (Connection: close가 기본값)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/1.1&lt;/strong&gt;: &lt;strong&gt;Keep-Alive&lt;/strong&gt;로 하나의 TCP 연결을 재사용할 수 있게 되었습니다 (Connection: keep-alive가 기본값)&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d835a9de463d539b677b5f425319b517/4ff83/9.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.88607594936708%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC80lEQVR42nVT7UtTURh/pm6uzTXnptO0uc05w2KmVzOxvJR7ueqducEg0BD6MKms8A03W50PGUzUypDKNLRSkQmWEZElXqfLCGYYmFIhfZD+jtt92co5euDynHvOc37Py+93AKKGI7HQjkyiGmQES89xMPvyoRbxHkAQieK8mEQaqEGlYPUYwOorEtl8BQC0AGKsEImg7IoSKjoywIoMYO7WwCmPnvv2G+aWcGA2pIUznXlQfl0LrkAi7M3aNRaSETefjbY+mNdFD6ZDW49nNna97Jqi6CTWXxx4VWzrmRhDFMX9uxASTa59fze5vuvkLiGaTmD9RPBr1a3p5VDLvZfaKODMyrf50dWfPCDNAz5aWG/xPl96y0BxFXkeTimmVre+jHzcqYupUGH2y7nZAEqItCXkWlHWy/bGqS0oA872ZP9tv75LBsWXcwGIZH5jhLm4eV8Dy3350DZoALQpguZxMSCmpQaPEpo6pFwcxextP9LCh7t6aH9iBJyp2B0WskdSu1eNud1CHpBm2PkxlAz+brnE0Ztlta6lYY5gViW5qjGQczhHAGuBQGLur3Fx+jBKkTtelMgbgyWp5xdNxY4V4nDD7Lk44gDHkzB85IgfC2vCWWEJDUz2Oo8CSCTZ2zLQIGgtnXOismBVR/kS1mheqdbbZ53xgC5GNnW92TC4dgAuvVFkO6gcVcMUFq3wN+NpQ2fehqnd2IaNnggVbMteY2E+GdMyN/NYbWFC/OSw4X3B+qEBjFIFsB15afVTfbRCmhEuzRDWZOmQphDe9Mi8BP8HLHSJgPRr4MJnJTRTqcDqzjGUwwhcHjsaJAaWaV50vCJqUSaQkVmzWWl9t3zx2DW1/XS/LoBvpjRVLGQ4zZ/yjfaZSrD5jsYBkkgVA0jcyIs8UUYNgJLo3M7MoKlV56gcLJor21KiwoCIPZOwme131DGkWPqlQKAcHi8CaL+tg/o+2f73KQRrW1rMZQIdjGOZuJr8Ly4yQ7JdxVTOvaQ/bznqEwV5Wg0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;파이프라이닝&quot;
        title=&quot;&quot;
        src=&quot;/static/d835a9de463d539b677b5f425319b517/f058b/9.png&quot;
        srcset=&quot;/static/d835a9de463d539b677b5f425319b517/c26ae/9.png 158w,
/static/d835a9de463d539b677b5f425319b517/6bdcf/9.png 315w,
/static/d835a9de463d539b677b5f425319b517/f058b/9.png 630w,
/static/d835a9de463d539b677b5f425319b517/4ff83/9.png 843w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;파이프라이닝 없음&lt;/strong&gt;: 요청을 보내고 응답을 받은 후에야 다음 요청을 보낼 수 있습니다&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; (요청-응답-요청-응답)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;파이프라이닝 있음&lt;/strong&gt;: 응답을 기다리지 않고 여러 요청을 연속으로 보낼 수 있습니다&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(요청-요청-요청 → 응답-응답-응답)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그렇지만 파이프 라이닝은 일부 패킷이 유실되면 그 패킷이 도착할 때까지 이후 패킷을 처리하지 못하는 &lt;strong&gt;HOL 블로킹&lt;/strong&gt;(Head-of-Line Blocking) 문제가 있습니다.&lt;/p&gt;
&lt;h2&gt;HTTP/2.0&lt;/h2&gt;
&lt;h3&gt;HTTP/1.1의 문제&lt;/h3&gt;
&lt;p&gt;HTTP/1.1은 &lt;strong&gt;한 번에 하나씩&lt;/strong&gt; 처리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;브라우저: &quot;index.html 줘&quot;
서버: &quot;여기&quot;
브라우저: &quot;style.css 줘&quot;
서버: &quot;여기&quot;
브라우저: &quot;image.png 줘&quot;
서버: &quot;여기&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;파일이 10개면 10번 왔다갔다 해야 합니다. 느리죠.&lt;/p&gt;
&lt;h3&gt;HTTP/2의 해결책: 멀티플렉싱&lt;/h3&gt;
&lt;p&gt;HTTP/2는 &lt;strong&gt;동시에 여러 개&lt;/strong&gt;를 요청합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;브라우저: &quot;index.html 줘, style.css 줘, image.png 줘&quot; (한꺼번에)
서버: (섞어서 보냄)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;근데 문제가 있습니다. 데이터가 섞여서 오면 &lt;strong&gt;어떤 게 index.html이고 어떤 게 style.css인지&lt;/strong&gt; 어떻게 구분할까요?&lt;/p&gt;
&lt;h3&gt;바이너리 프레이밍&lt;/h3&gt;
&lt;p&gt;그래서 HTTP/2는 데이터를 &lt;strong&gt;작은 조각&lt;/strong&gt;(Frame)으로 나누고, 각 조각에 &lt;strong&gt;번호표&lt;/strong&gt;(Stream ID)를 붙입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Frame: Stream 1번, index.html 조각]
[Frame: Stream 2번, style.css 조각]
[Frame: Stream 1번, index.html 조각]
[Frame: Stream 3번, image.png 조각]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;받는 쪽에서는 번호표를 보고 조각들을 다시 모읍니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Stream 1번 조각들 모으기 -&gt; index.html 완성&lt;/li&gt;
&lt;li&gt;Stream 2번 조각들 모으기 -&gt; style.css 완성&lt;/li&gt;
&lt;li&gt;Stream 3번 조각들 모으기 -&gt; image.png 완성&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HTTP/1.x는 Plain Text(평문)를 사용하고 개행으로 구별했지만, HTTP/2.0에서는 &lt;strong&gt;바이너리 포맷&lt;/strong&gt;으로 인코딩된 Message, Frame으로 구성됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ca41c32e632a7d7081411873edec7de2/33e10/10.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABeElEQVR42nWSbW+CMBRG/f+/QedkIRFkb06NsinC2AYWrOI0qCBFMaB+UBeX6D7MXYEQE7OTJzftbU/apE1JHFu5vuJzuXI2I+bzgUPW6/U2hBDiuu72H3zfT+HqHXqitNJN6zHXe2adQd+27WMIQohhGI7joBYKhWaz+RaCdRVWN5tNSpfqQ100sTTQm5+txtwl0I1kVVXT6TRFUTRNQy0Wi5IkaZqG0fvvfnuSMcbtEDgH6mKxSGTYBxrLsmDyPC/LsqIo0OzqrViufhh1fZRkMp1H8u7wjdp6JQQurJ1hGMbvz+4kl5DFSP0cj+h6u4w9y1smsud54/HYu2C1WsUy99G41UQIo77ct+XhjCSyO8LTnrCyFNIRJl1hMXqHMWRJBrFc7skPXYF+LRY0vmaptu8m8sxUAqMMQZWMXs1inoqmBNdiGV5sc8bhcIjkr/3ONeW9I0Ic5a4v0n6nFE2Xdit+quMF0I2+wcyxiNm5zHRiwmoQBH+BSft2wJ+BfgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;HTTP/2 바이너리 프레이밍&quot;
        title=&quot;&quot;
        src=&quot;/static/ca41c32e632a7d7081411873edec7de2/f058b/10.png&quot;
        srcset=&quot;/static/ca41c32e632a7d7081411873edec7de2/c26ae/10.png 158w,
/static/ca41c32e632a7d7081411873edec7de2/6bdcf/10.png 315w,
/static/ca41c32e632a7d7081411873edec7de2/f058b/10.png 630w,
/static/ca41c32e632a7d7081411873edec7de2/33e10/10.png 844w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/2의 구성 요소:&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;용어&lt;/th&gt;
&lt;th&gt;의미&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Frame&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;데이터 조각 + 번호표 (HTTP/2 통신의 최소 단위)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Stream&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;같은 번호표를 가진 조각들의 그룹 (= 하나의 요청/응답)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Message&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Stream을 모아서 완성한 전체 요청 또는 응답&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/15.gif&quot; alt=&quot;HTTP/2 멀티플렉싱 애니메이션&quot;&gt;&lt;/p&gt;
&lt;p&gt;위처럼, 하나의 커넥션에서 여러 병렬 스트림(3개)이 동시에 존재할 수 있습니다. 각 스트림의 프레임들이 뒤섞여서 전송되더라도, Stream Number를 통해 어떤 스트림에 속하는지 식별하여 정확하게 재조립됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/2 프레임과 TCP 세그먼트의 관계&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HTTP/2 프레임은 결국 TCP 세그먼트의 페이로드로 들어갑니다. 중요한 점은 &lt;strong&gt;TCP는 HTTP/2 프레임이 뭔지 모른다&lt;/strong&gt;는 겁니다. TCP 입장에서는 그냥 &quot;바이트 덩어리&quot;일 뿐이죠.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/2 레이어: [Frame A: Stream 1] [Frame B: Stream 3] [Frame C: Stream 1]
                        ↓
TCP 레이어: &quot;그냥 바이트 덩어리로 보임&quot;
                        ↓
TCP 세그먼트: [Frame A + Frame B 일부] [Frame B 나머지 + Frame C]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;하나의 TCP 세그먼트에 &lt;strong&gt;여러 개의 작은 프레임&lt;/strong&gt;이 담길 수 있습니다&lt;/li&gt;
&lt;li&gt;하나의 큰 프레임이 &lt;strong&gt;여러 TCP 세그먼트에 나뉘어&lt;/strong&gt; 담길 수도 있습니다&lt;/li&gt;
&lt;li&gt;같은 세그먼트 안에 &lt;strong&gt;서로 다른 스트림의 프레임&lt;/strong&gt;이 함께 있을 수 있습니다&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;수신 측의 HTTP/2 레이어가 각 프레임의 헤더에서 Stream ID와 길이를 읽고 &quot;여기부터 여기까지가 하나의 프레임이다&quot;를 파싱해서 재조립합니다.&lt;/p&gt;
&lt;h3&gt;HTTP/2의 한계: TCP HOL 블로킹&lt;/h3&gt;
&lt;p&gt;HTTP/2는 응용 계층에서의 HOL 블로킹을 해결했지만, &lt;strong&gt;TCP 레벨에서는 여전히 문제가 있습니다&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;계층별 동작 이해:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;네트워크는 계층으로 나뉘어 동작합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;응용 계층 (HTTP/2)&lt;/strong&gt;: 프레임과 스트림으로 멀티플렉싱 구현&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;전송 계층 (TCP)&lt;/strong&gt;: 순서를 보장하는 바이트 스트림 전송&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HTTP/2의 모든 스트림은 결국 &lt;strong&gt;하나의 TCP 연결&lt;/strong&gt;을 통해 전송됩니다. TCP는 HTTP/2의 스트림 개념을 모르고, 단지 순서대로 바이트를 전달할 뿐입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제 예시: 10MB 이미지 + 1KB CSS 파일 요청&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/1.1 (순차 처리):
1. 10MB 이미지 요청 → 완료 (10초)
2. 1KB CSS 요청 → 완료 (0.1초)
총 시간: 10.1초

HTTP/2 (멀티플렉싱):
1. 10MB 이미지 + 1KB CSS 동시 요청 (프레임 교대로 전송)
2. CSS는 1초 만에 완료 (이미지 중간에 끼워서 전송)
3. 이미지는 10초 만에 완료
총 시간: 10초 (CSS는 1초에 완료!)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/16.gif&quot; alt=&quot;HTTP/2 한계&quot;&gt;&lt;/p&gt;
&lt;p&gt;HTTP/2는 하나의 TCP 연결만 사용하기 때문에, 패킷 하나만 유실되어도 &lt;strong&gt;모든 스트림이 영향을 받습니다&lt;/strong&gt;. 오히려 HTTP/1.1이 여러 TCP 연결을 사용할 때보다 더 심각할 수 있죠.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCP 패킷 손실 시나리오:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;TCP 패킷: [1][2][3][4][5][6][7][8][9][10]
                ↑
           3번 패킷 유실!

TCP 패킷 손실 발생:
HTTP/1.1: 모든 데이터 정지 
HTTP/2: 모든 스트림 정지 

결과: 패킷 4~10번이 도착해도 처리 못함
→ TCP가 3번을 기다리느라 모든 HTTP/2 스트림이 멈춤&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Stream 우선순위&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84.gif&quot; alt=&quot;우선순위&quot;&gt;&lt;/p&gt;
&lt;p&gt;HTTP 메시지가 많은 개별 프레임으로 분할될 수 있고 여러 스트림의 프레임을 다중화(Multiplexing)할 수 있게 되면서, &lt;strong&gt;스트림들의 우선순위를 지정할 필요가 생겼습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;클라이언트는 우선순위 지정을 위해 &apos;우선순위 지정 트리&apos;를 사용하여 서버의 스트림 처리 우선순위를 지정할 수 있습니다. &lt;strong&gt;서버는 우선순위가 높은 응답이 클라이언트에 우선적으로 전달될 수 있도록 대역폭을 설정합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;HTTP 헤더 압축 (HPACK)&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/32365d82b3ad2829ce14a7bbe090d7e3/4ff83/12.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAPoAAAD6AG1e1JrAAACmUlEQVR42o2S60/aYBTG+38bF6Nyk4soVUAolksBC1haoBer406FgCAIODbnzGS4uJBliW5+2NwDOOe+6E7enLxpz+885/ISvV6v1WoNBoO7u7v7J/brj93c3DQajW63e3Fxcf+vERzHURRlMpkMBkOiqngz0YC6y9X2q9WqJEmapqXTaZZl19fXLRbL6uoq7rjAy7JMMAwD2G63G41Gpig4U0FKZcOlFKRA9vt9ZAkEAiRJOhwOq9WKYJvN5vP5ksnkBPZ4PPiq1+sBu0Rmkw8Brtfr2WwWBefz+RkMxmw2A4Oy1+t9gP1+P5Tn5uasYeeC22IObVijrk6nc3l5ORqNeJ4PhwI4JoNOv7ykW1pcXHhlWTFFIiFCEIRUKkXTNMrmT/JeOeKWwkInf3V19XNqo48ffpznv7/PVUUqGyebe4G3ldiRQtfzwkQZVaHm+fl5ktvW+dYMtGODp9EwRnJ4eAjlCBP0uF0rRj0EjbpleOgndxNEMBjcnJpOpwOzlthGCt9+rN1uFwoF+EqlgqE4nU60Bg1429QmPauqirnPZk6GqbiaThYkuZYbDoffpoZXgLh4PI4YrBM+FothweVymXjc+NnZWTQavX/WsC2k+/tIsEm012w2sU9sBTrIcnt7+xiBF1adGuavKAoawWX22ghVO45IRXdEYMTcVjQl105xxGp/PB7P4OHoc0brucI8u6dRMXFHqcx86ahH4Adz0LJHRFqp2UPpeKkvt0fS8SesagZ/GX+tnbzL1dra8Ztysw+m2OhWWqcng/MJjGiQSOHiciS75xVK4WzzEX7GHmBfuhKQax6+CB7iT5VfgIXGORjwKBtH74mKreF/wTuZ1042Y/PFKO7AEUzibCVUNnt0fX39IvwblxYUZWSHwBIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;HTTP 헤더 압축&quot;
        title=&quot;&quot;
        src=&quot;/static/32365d82b3ad2829ce14a7bbe090d7e3/f058b/12.png&quot;
        srcset=&quot;/static/32365d82b3ad2829ce14a7bbe090d7e3/c26ae/12.png 158w,
/static/32365d82b3ad2829ce14a7bbe090d7e3/6bdcf/12.png 315w,
/static/32365d82b3ad2829ce14a7bbe090d7e3/f058b/12.png 630w,
/static/32365d82b3ad2829ce14a7bbe090d7e3/4ff83/12.png 843w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이전 Header의 내용과 중복되는 필드를 재전송하지 않도록 하여 데이터를 절약합니다. 기존에 HTTP Header가 Plain Text(평문)이었지만, HTTP/2에서는 &lt;strong&gt;Huffman Coding&lt;/strong&gt;을 사용하는 &lt;strong&gt;HPACK&lt;/strong&gt;이라는 Header 압축방식을 이용하여 데이터 전송 효율을 높였습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Huffman Coding&lt;/strong&gt;: 데이터 문자의 빈도에 따라서 다른 길이의 부호를 사용하는 알고리즘&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCP의 장점은 신뢰성&lt;/strong&gt;입니다. 패킷 순서를 보장하고 패킷이 유실되면 재전송해줘서 &lt;strong&gt;안정적으로 데이터를 전송할 수 있습니다.&lt;/strong&gt; 그래서 &lt;strong&gt;HTTP, SMTP&lt;/strong&gt; 같은 많은 프로토콜이 TCP를 기반으로 동작합니다.&lt;/p&gt;
&lt;p&gt;하지만 시퀀스 번호, 확인 응답, 재전송 같은 기능 때문에 &lt;strong&gt;UDP보다는 느립니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;UDP (User Datagram Protocol)&lt;/h3&gt;
&lt;p&gt;TCP와 달리 UDP는 연결 과정 없이 바로 데이터를 보냅니다. &lt;strong&gt;데이터가 제대로 전송됐는지도 모르고, 순서도 보장하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;UDP를 쓰는 애플리케이션은 데이터가 유실될 수 있다고 가정하고 개발해야 합니다.&lt;/p&gt;
&lt;p&gt;UDP는 응답 확인이나 패킷 정렬 같은 과정이 없어서 &lt;strong&gt;TCP보다 빠릅니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;그래서 속도가 중요하거나 약간의 데이터 유실이 괜찮은 통신에 씁니다. &lt;strong&gt;DNS, VoIP, 게임 등이 UDP를 사용하는 대표적인 예입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;QUIC&lt;/h3&gt;
&lt;p&gt;TCP는 신뢰성이 있지만 느립니다. UDP는 빠르지만 신뢰성이 없죠. 이 둘의 장점을 합친 프로토콜이 &lt;strong&gt;QUIC&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;QUIC은 UDP를 기반으로 하면서 TCP의 연결 관리 기능을 프로토콜 수준에서 제공합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;데이터에 연결 ID&lt;/strong&gt;(Connection ID)를 포함시켜 연결을 유지합니다&lt;/li&gt;
&lt;li&gt;TCP의 혼잡 제어나 패킷 유실 복구 기능을 QUIC에서 제어합니다&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TLS를 통합해서 기본적으로 암호화됩니다&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;멀티플렉싱으로 한 연결에서 여러 스트림을 동시에 처리합니다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;HTTP/3&lt;/h3&gt;
&lt;p&gt;HTTP/3 프로토콜은 QUIC을 기반으로 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTP/3는 TCP를 버리고 UDP 위에 QUIC을 만들었습니다:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/1.1: 여러 TCP 연결 (한 연결 막혀도 다른 연결은 OK)
HTTP/2:  하나의 TCP 연결 (패킷 하나 유실 → 전체 멈춤)
HTTP/3:  QUIC 스트림들 (각 스트림이 독립적으로 동작!)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;QUIC의 독립적인 스트림:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Stream 1: 패킷 유실 → Stream 1만 대기
Stream 2: 정상 진행 ✓
Stream 3: 정상 진행 ✓&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 QUIC 스트림이 &lt;strong&gt;자체적으로 순서 보장과 재전송을 처리&lt;/strong&gt;하기 때문에, 한 스트림의 패킷 유실이 다른 스트림에 영향을 주지 않습니다. 마치 여러 개의 독립적인 TCP 연결을 쓰는 것처럼요!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;QUIC의 순서 보장: 스트림 간이 아니라 스트림 내부&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;QUIC은 &lt;strong&gt;스트림 간의 순서&lt;/strong&gt;는 보장하지 않습니다. 스트림 1이 먼저 끝나든 스트림 3이 먼저 끝나든 상관없습니다.&lt;/p&gt;
&lt;p&gt;대신 &lt;strong&gt;스트림 내부의 순서&lt;/strong&gt;를 보장합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;받는 쪽 (QUIC 라이브러리):
  UDP 데이터그램 수신
  ↓
  Stream ID 확인 후 각 스트림 버퍼에 분류
  ↓
  Stream 1 버퍼: [1][ ][3] ← 2번 아직 안 옴, 대기
  Stream 2 버퍼: [1][2][3] ← 완성! 애플리케이션에 전달
  Stream 3 버퍼: [1][2]    ← 정상 진행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;TCP는 OS 커널이 &lt;strong&gt;연결 전체&lt;/strong&gt;에서 순서를 맞추지만, QUIC은 애플리케이션 레벨에서 &lt;strong&gt;스트림별로 독립된 버퍼&lt;/strong&gt;를 관리합니다. 그래서 한 스트림의 패킷 유실이 다른 스트림에 영향을 주지 않습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HOL 블로킹 비교:&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;HTTP/1.x&lt;/th&gt;
&lt;th&gt;HTTP/2&lt;/th&gt;
&lt;th&gt;HTTP/3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;응용 계층 HOL&lt;/td&gt;
&lt;td&gt;O (순차 응답)&lt;/td&gt;
&lt;td&gt;X (멀티플렉싱)&lt;/td&gt;
&lt;td&gt;X&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;전송 계층 HOL&lt;/td&gt;
&lt;td&gt;O (TCP)&lt;/td&gt;
&lt;td&gt;O (TCP)&lt;/td&gt;
&lt;td&gt;X (QUIC)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;HTTP/1.x는 응답을 순서대로 보내야 해서 무거운 요청이 앞에 있으면 뒤의 가벼운 요청이 대기합니다. HTTP/2는 멀티플렉싱으로 이를 해결했지만, TCP를 사용하기 때문에 패킷 유실 시 모든 스트림이 멈춥니다. HTTP/3(QUIC)만이 두 계층 모두에서 HOL 블로킹을 해결했습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;현재 지원 현황:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;브라우저&lt;/strong&gt;: 크롬, 에지, 사파리 등 주요 브라우저&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;기업&lt;/strong&gt;: 구글, 페이스북 등 주요 기업&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CDN&lt;/strong&gt;: 아카마이, 클라우드플레어, AWS 클라우드프론트 등&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;TCP 연결은 65,535개가 한계인가?&lt;/h3&gt;
&lt;p&gt;포트 번호는 부호 없는 16비트 정수를 씁니다. 그래서 65,535가 포트 번호의 최대값입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;하지만&lt;/strong&gt; 한 장비에서 만들 수 있는 TCP 연결 개수는 이론적으로 &lt;strong&gt;2^96개&lt;/strong&gt;입니다.&lt;/p&gt;
&lt;p&gt;TCP의 각 연결은 다음 4가지 조합으로 구분되거든요:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;로컬 IP&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;로컬 포트&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;원격 IP&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;원격 포트&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;하나의 로컬 IP에서 특정 원격 IP의 1개 포트에 연결할 수 있는 TCP 연결이 65,535개인 겁니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;실제로는 OS 설정(파일 디스크립터 개수, 포트 범위 설정 등)에 따라 제약을 받습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;웹 통신의 큰 흐름: &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt; 접속 과정&lt;/h2&gt;
&lt;p&gt;면접에서 자주 나오는 질문입니다. 한 질문으로 DNS, TCP, 라우팅, 프로토콜 스택까지 다양한 개념을 확인할 수 있기 때문입니다.&lt;/p&gt;
&lt;h3&gt;1단계: 브라우저의 URL 파싱&lt;/h3&gt;
&lt;p&gt;브라우저에 &lt;code class=&quot;language-text&quot;&gt;https://www.google.com&lt;/code&gt;을 입력하면, 브라우저는 URL을 파싱해서 다음을 추출합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;프로토콜: HTTPS&lt;/li&gt;
&lt;li&gt;도메인: &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;포트: 443 (HTTPS 기본 포트)&lt;/li&gt;
&lt;li&gt;경로: / (루트)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;URI와 URL의 차이&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;URI (Uniform Resource Identifier) - 리소스 식별자
├── URL (Uniform Resource Locator) - 위치로 식별
└── URN (Uniform Resource Name) - 이름으로 식별&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;URL&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;https://google.com/search&lt;/code&gt; - 위치(주소)로 리소스를 찾음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;URN&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;urn:isbn:0451450523&lt;/code&gt; - 고유한 이름으로 리소스를 찾음 (웹에서 거의 안 씀)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;웹에서는 거의 URL만 쓰기 때문에 URI = URL로 봐도 무방합니다.&lt;/p&gt;
&lt;h3&gt;2단계: DNS Lookup&lt;/h3&gt;
&lt;p&gt;도메인으로는 패킷을 보낼 수 없습니다. IP 주소가 필요하죠. 브라우저는 다음 순서로 IP를 찾습니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;브라우저 DNS 캐시&lt;/strong&gt; 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OS의 hosts 파일&lt;/strong&gt; 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OS DNS 캐시&lt;/strong&gt; 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DNS 서버에 질의&lt;/strong&gt; (앞서 설명한 DNS 조회 과정)&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;3단계: 브라우저에서 OS로 전송 요청&lt;/h3&gt;
&lt;p&gt;여기서 중요한 개념이 나옵니다. &lt;strong&gt;브라우저는 직접 네트워크 통신을 할 수 없습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;브라우저는 User Space에서 실행되는 일반 프로세스입니다. 네트워크 하드웨어(랜카드)에 접근하려면 Kernel Space의 권한이 필요합니다. 그래서 브라우저는 &lt;strong&gt;시스템 콜&lt;/strong&gt;을 통해 OS에 전송을 요청합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;┌─────────────────────────────────────┐
│         User Space                  │
│  ┌─────────┐  ┌─────────┐           │
│  │ Chrome  │  │ Slack   │  ...      │
│  └────┬────┘  └────┬────┘           │
│       │            │                │
│       ▼            ▼                │
│  ┌─────────────────────────────┐    │
│  │      System Call            │    │
│  │  socket(), connect(), send()│    │
│  └─────────────────────────────┘    │
├─────────────────────────────────────┤
│         Kernel Space                │
│  ┌─────────────────────────────┐    │
│  │     Protocol Stack          │    │
│  │  (TCP/IP 처리)               │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │     Network Driver          │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │     NIC (랜카드)              │    │
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;브라우저가 직접 랜카드를 제어할 수 없습니다. 하드웨어 접근은 커널만 가능하거든요. 그래서 브라우저는 &lt;code class=&quot;language-text&quot;&gt;socket()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;connect()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;send()&lt;/code&gt; 같은 시스템 콜을 통해 OS에 &quot;이 데이터 좀 보내줘&quot;라고 요청하는 겁니다.&lt;/p&gt;
&lt;h3&gt;4단계: TCP 연결 (3-Way Handshake)&lt;/h3&gt;
&lt;p&gt;OS의 &lt;strong&gt;프로토콜 스택&lt;/strong&gt;이 TCP 연결을 맺습니다. 프로토콜 스택은 OS에 내장된 네트워크 제어 소프트웨어입니다.&lt;/p&gt;
&lt;p&gt;TCP 연결은 &quot;브라우저 - 구글 서버&quot; 사이에 맺어지지만, 실제 SYN/ACK 패킷 처리는 &lt;strong&gt;양쪽 OS 커널&lt;/strong&gt;이 담당합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[내 PC]                           [구글 서버]
Chrome -&gt; Kernel(TCP) &amp;lt;---------&gt; Kernel(TCP) -&gt; Nginx
              ^                        ^
        실제 패킷 처리는 여기서 발생&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;TCP 스택의 구조&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;TCP 스택은 OS 커널에 내장된 &lt;strong&gt;TCP/IP 프로토콜 처리 소프트웨어 전체&lt;/strong&gt;입니다. 패킷 생성, 순서 보장, 재전송, 흐름 제어 등 TCP의 모든 기능을 담당합니다.&lt;/p&gt;
&lt;p&gt;TCP 스택은 크게 두 가지 역할을 합니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;연결 관리&lt;/strong&gt;: SYN Queue, Accept Queue로 연결 요청을 관리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;데이터 전송&lt;/strong&gt;: 각 연결(소켓)마다 Send/Receive Buffer로 데이터를 버퍼링&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/57bba669b9310351688b828dd8802588/27f8b/tcp.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.9367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAD9klEQVR42nWT2W9UZRiHJzEsCa1QEy0xtrOdMz3nzNp2zmyn09Lp7DNdhhm6CYkgQUValiIFKYUoEjSVVEQIFlsFJAZiuMALTZQbvfDOP+nxnZlWi+DFk9/3vd/Jm3f5HZvDY2JXe4XwPzg8TexqD76eLKFoGTO5j6BZbMQ23p/HxObSoqj+PlRfH4q3qS49jlOLbSLa1Ofiz+LSItg83jiR2B56w1aDWHyQUE8Crz+CPxAVRIOiwcgzBP5D/RvFiGHTjF5OFZwsjodYqOqczrQxn2vjfOEVFkttXCrv4qPhXVwe28mVyk6u7n2Zz2qtLI23cm2yleXJFm7u38HS5E50n7SsGz1cqbpZO57l5sFuVt6J8vXhbu68HeD+TJwbtTa+GNvGV9Xt3Kpt5/b4Nu5MbmVteit392/h/oEtPDz4EqsHtktXZr3lKNmUTimvU8x2MVzyMVr2MVI2GBvxyrmLsbJKZURl76hKdUylVlEZrwo1lYmah+lJhVpVo57L5vBFeOPAAIH3x9DeK6MfG0GbHcE/V8M5k2fHIZOWIzFa303QejRByzFh1qLlRB8tJ5O0zg3QMj/ArpMDuAMyQ4fXRD/cT2FxiuhcmdTCPpLnKyQXKmQvT9ExG+fVYybtJyK8dko4HaX9TIz2s3F2f2ix+7xF+0WL18+JS4KS0C2bccVjOOJijcQ6fWKDPtGkaH8ch6ijHhsQ2+xJ4BxM4KqTauJMW3K3qOeyNYztCv+LUwzqMnG4zaY6TboCSYzoIE4l2rg34pvZiG0YuytgCQm0uvoTqDJctxHBrTdR/TE8Mh+3Ycr9RYQbWs9lU8XYoWiGgJkmFMvRHc+jdQ/i8iYl0QCK4PY2UQOD66TWGVon3VBFl5ZdhoWSmsUoXsCTu0BH8izhvUskp28Rqtykt/YN1v4HxN98hFr6gY7cIzoLT+gs/kJn6Sn20h90Dv8l+juKrx+b4pWE1lsoySMo/UdxJWcw0mfw5RbQ04sY2Y/lfBVv/nOU9DWcqes4h27JIlZwZr7FlbmPM/ej6HfUc8mWLdTBoxi5D9Cy89iTc4RHL9M3cY3ukSXCletYEyvEJ9ZQ8yvYh1axZ77Hnn2IPfcYe/4n7MWnOPJPmhW6jQSe/kPoQzN0pY43KvSm5wkWLqKlL0mFnxAsLeEvLkuFy7iGvsSVvi0VrkqFd4UHOPOPpcJ7mypMSZv5c2jSpr1/HrPyKcmpG3SPXidcvY01fZfE1APU4j06JIFdWuzMyRwLP2Mv/Caz/FP01/UZGnHZUH2bewTZYFC2JRtz+0WDGTln5JfKiuZQQ/l1ipsoCcMNdetiG7d4R9E3E/kfzBcQRtE2aPrwbyBbkYWRlGx/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tcp 스택 정리&quot;
        title=&quot;&quot;
        src=&quot;/static/57bba669b9310351688b828dd8802588/f058b/tcp.png&quot;
        srcset=&quot;/static/57bba669b9310351688b828dd8802588/c26ae/tcp.png 158w,
/static/57bba669b9310351688b828dd8802588/6bdcf/tcp.png 315w,
/static/57bba669b9310351688b828dd8802588/f058b/tcp.png 630w,
/static/57bba669b9310351688b828dd8802588/40601/tcp.png 945w,
/static/57bba669b9310351688b828dd8802588/78612/tcp.png 1260w,
/static/57bba669b9310351688b828dd8802588/27f8b/tcp.png 1730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;연결 관리 큐:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SYN Queue&lt;/strong&gt;: SYN 받고 SYN-ACK 보낸 상태 (반쯤 연결된 상태)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Accept Queue&lt;/strong&gt;: 3-Way 완료됐지만 아직 &lt;code class=&quot;language-text&quot;&gt;accept()&lt;/code&gt; 안 된 연결&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;데이터 전송 버퍼:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Send Buffer&lt;/strong&gt;: 애플리케이션이 보낼 데이터를 담아두는 버퍼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Receive Buffer&lt;/strong&gt;: 네트워크에서 받은 데이터를 담아두는 버퍼&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;중요&lt;/strong&gt;: Accept Queue는 &lt;strong&gt;이미 3-Way Handshake가 완료된&lt;/strong&gt; 연결들입니다. 커널 레벨에서는 연결이 완료됐지만, 서버 애플리케이션이 아직 &lt;code class=&quot;language-text&quot;&gt;accept()&lt;/code&gt;를 호출하지 않아 대기 중인 상태입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;1000개 연결 시 몇 개의 큐와 버퍼가 생길까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;서버가 80 포트에서 &lt;code class=&quot;language-text&quot;&gt;listen()&lt;/code&gt;하고 1000개의 클라이언트가 연결했다면:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;개수&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Listen Socket&lt;/td&gt;
&lt;td&gt;1개&lt;/td&gt;
&lt;td&gt;80 포트에서 연결 대기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SYN Queue&lt;/td&gt;
&lt;td&gt;1개&lt;/td&gt;
&lt;td&gt;Listen Socket당 1개&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Accept Queue&lt;/td&gt;
&lt;td&gt;1개&lt;/td&gt;
&lt;td&gt;Listen Socket당 1개&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TCP Buffer 쌍&lt;/td&gt;
&lt;td&gt;1000개&lt;/td&gt;
&lt;td&gt;연결(소켓)당 1쌍&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;핵심 포인트:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;큐는 Listen Socket당 1개&lt;/strong&gt;: 포트 80으로 연결 요청이 오면 하나의 SYN Queue, 하나의 Accept Queue로 관리&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;버퍼는 연결당 1쌍&lt;/strong&gt;: 1000개 연결이면 1000개의 Send Buffer + 1000개의 Receive Buffer&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;포트 80 Listen Socket
├── SYN Queue (1개) ─────────────┐
├── Accept Queue (1개) ──────────┤ 연결 요청 관리
│                             
└── 연결된 소켓들 ────────────────────┐
    ├── Client 1: [Send] [Recv]    │
    ├── Client 2: [Send] [Recv]    │
    │                              │
    ├── Client 3: [Send] [Recv]    │ 1000개의 버퍼 쌍
    │    ...                       │
    └── Client 1000: [Send] [Recv] ┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Backlog가 가득 차면 새 연결 요청이 거부됩니다. 서버 튜닝할 때 다음 설정으로 큐 크기를 조절합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;net.core.somaxconn&lt;/code&gt;: Accept Queue 크기&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;net.ipv4.tcp_max_syn_backlog&lt;/code&gt;: SYN Queue 크기&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5단계: 패킷 생성 및 전송&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/adbe98da5e3b97a0de6ed52f28c02f18/87488/protocol.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 89.24050632911393%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD40lEQVR42n3UWW8bVRTAcX+ApkFtMmN77BnbY0/GdrzFseN6TZylzuLEiZs0pGq6qUWqhOABFNSFUtKWgLoAKiWhEhU0Aipo+1KJh4gH+swTQnwHPsWf40kCSCAefjpntjNz77l3XN5gDt0cwxfsGMcfmhBH8Qcb6KFJgta0mBFNMSvmCFmtPfOE+hYw+9piES1UwmVaS9Qrm8zNPKLVfExzclt8y9z098xNPaU0uC2+ozz4A5Xcc/GCWv5HakM7jBR+ol74mdHCSxql30gm3sEVjMxSHNpgrH6X+vA9RqqfMly9T732OaO1LYYGPiOffsBQZotC9kuK2a8odl6S+4ZS/gmV/FPxTIrvEI1dxKUaCVQ9Qa+v36H4E47ePe5AEj02iJHIO/n/6dRyKUaSHj1Fr5HepafleF+KQ74E/sQRAumSkx/2J/ek/kXRk7i8wSShUJRAwCIYiBAM7jJNm3AkLmJEzBiW5BFL4j9EIrbDEn2WjS8kX1hJBrk87eXddoz3j/ezvhzj1orEBT/XJrtYb3ZzY7abW62DbMx38VG7i9vHDnDveBcPTqlsnlbYOqOyfb6bdtmPq5oMcLXp4/pykpsnMtw6keLD1TQ3jxlcnzqwV/AgH7S6/ip4Z/EAH0vBzTNuvjgrzrnZvtDNsbIPlyZDDodtzFBYmIRNIdGKWNh2XMQc0WicqB2VuCvWibbliIl4tA+/2WmKTHCPJk3R0o4eR4Yer0SvNMUt3fMP4DEGnfywRxrg/g+q1PBJU9x2CveRNEohiXJEHi6mUEtp3OUMakViLYN7eMDhqWd3jYqxQTzjHTk8E2IyhzudwdVbkiG/XiO/1iazNkfucpuBK/NkrraobaxiX2nwypsD9L5doGdtiMOXChy6PETgxiix2zPE7swQv9skcH8CZSEnCzuVwjOdxZgrYrTEfJFAu4SvXcBYKuNdLMiNgyiLOZTjeZRl8aos8hMFtNUS2qki2ukS3vMlGVVWCsocqjJ2RZNdIgvXiULdy1UtgVcWuWZknNwt9zo0ec6R+FtnDjvbRelsPX0/9jsUoQbknPCGUmjhDIqxe26fYuzr370mXN7oCGb5LFb1ApHqRazhN7Drb2GNrGGU19DLl8Q19Mo6enUDvXYbf+0T9OEHBMceEhx/hDnxmFDjOd7UOVye/mmyC+tUV+5QWZE/zeoWjQvb1E5vYzY20ccfYhz9GqPxBGPyGfrUC/TpHQLNl8SXfyG58ivZ1d+Jn/wDb/49KRjO44mOo9odR1HsBkrfFGq0idbfQku0hfw8E0toyWWxIk7K16ziSZ4SZ1AT5/CkXsNjjfIngUhXlFm8uH8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;프로토콜 스택&quot;
        title=&quot;&quot;
        src=&quot;/static/adbe98da5e3b97a0de6ed52f28c02f18/f058b/protocol.png&quot;
        srcset=&quot;/static/adbe98da5e3b97a0de6ed52f28c02f18/c26ae/protocol.png 158w,
/static/adbe98da5e3b97a0de6ed52f28c02f18/6bdcf/protocol.png 315w,
/static/adbe98da5e3b97a0de6ed52f28c02f18/f058b/protocol.png 630w,
/static/adbe98da5e3b97a0de6ed52f28c02f18/40601/protocol.png 945w,
/static/adbe98da5e3b97a0de6ed52f28c02f18/78612/protocol.png 1260w,
/static/adbe98da5e3b97a0de6ed52f28c02f18/87488/protocol.png 1282w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;프로토콜 스택이 HTTP 요청 메시지를 패킷으로 만들고, 각 계층에서 헤더를 붙입니다:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;계층&lt;/th&gt;
&lt;th&gt;추가되는 정보&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;요청 메시지 (GET / HTTP/1.1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;출발지/목적지 포트, 시퀀스 번호&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IP&lt;/td&gt;
&lt;td&gt;출발지/목적지 IP 주소&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ethernet&lt;/td&gt;
&lt;td&gt;MAC 주소&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;완성된 패킷은 &lt;strong&gt;LAN 어댑터&lt;/strong&gt;(NIC)로 전달되고, 전기 신호로 변환되어 송출됩니다.&lt;/p&gt;
&lt;h3&gt;6단계: 네트워크 경유&lt;/h3&gt;
&lt;p&gt;패킷은 여러 장비를 거쳐 목적지로 이동합니다:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;내 PC -&gt; 공유기 -&gt; ISP 라우터 -&gt; 인터넷 코어 -&gt; 구글 라우터 -&gt; 구글 서버&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 라우터는 패킷의 목적지 IP를 보고 다음 경로를 결정합니다.&lt;/p&gt;
&lt;h3&gt;7단계: 서버 도착 및 응답&lt;/h3&gt;
&lt;p&gt;구글 서버에 도착한 패킷은:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;방화벽&lt;/strong&gt;이 검사&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;로드밸런서&lt;/strong&gt;가 적절한 서버로 분배&lt;/li&gt;
&lt;li&gt;서버의 &lt;strong&gt;프로토콜 스택&lt;/strong&gt;이 패킷에서 HTTP 메시지 추출&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;웹 서버&lt;/strong&gt;(Nginx 등)가 요청 처리&lt;/li&gt;
&lt;li&gt;응답 데이터를 같은 경로로 회신&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;전체 흐름 요약&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. URL 입력
2. DNS로 IP 획득
3. 브라우저 -&gt; OS (시스템 콜)
4. OS 커널에서 TCP 3-Way Handshake
5. HTTP 요청을 패킷으로 만들어 전송
6. 라우터들을 거쳐 서버 도착
7. 서버가 응답 패킷 회신
8. 브라우저가 HTML 렌더링&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Blocking & Non-Blocking I/O로 성능 개선하기]]></title><description><![CDATA[이 글은 주니어 백엔드 개발자가 반드시 알아야 할 핵심 지식을 기반으로 작성되었습니다. I/O 병목, 어떻게 해결할까? 서버는 네트워크 기반으로 동작합니다. DB, 외부 API, 레디스 등 대부분의 통신이 네트워크를 통해 이뤄집니다.  네트워크 I/O…]]></description><link>https://gotobill.github.io/non-blocking/</link><guid isPermaLink="false">https://gotobill.github.io/non-blocking/</guid><pubDate>Mon, 15 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;이 글은 주니어 백엔드 개발자가 반드시 알아야 할 핵심 지식을 기반으로 작성되었습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;I/O 병목, 어떻게 해결할까?&lt;/h2&gt;
&lt;p&gt;서버는 &lt;strong&gt;네트워크 기반&lt;/strong&gt;으로 동작합니다. DB, 외부 API, 레디스 등 대부분의 통신이 네트워크를 통해 이뤄집니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 411px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/555f83330e8aeb3301ec6d97a00198b6/2a432/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVR42oWR2QqEMAxF+//f6IsgIlrRLu5LhpMh89gJhKZp7jFc3XVdEkKUvu9lGLzM8yzrusp93xJj1DqlpPWyLL83m0sp6/u+75ruPE/puk6qqpK6rhWMENE4jpJzFu+99hFy37ZN7wCZIYGhc8/zCFAAJDU9gvM4DhUCoaaH+H1fPZknreekEAwQJrIeYuBsZMlHsa8ItO1DCOqhbc/Ztq2CsQnLgGFHEfj9YUGaplERtW1qAKxgO/P9L5DNMH2aJgXSK8UH9/Ih5gePnMAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;서버는 다양한 구성요소와 네트워크로 데이터를 주고받습니다&quot;
        title=&quot;&quot;
        src=&quot;/static/555f83330e8aeb3301ec6d97a00198b6/2a432/1.png&quot;
        srcset=&quot;/static/555f83330e8aeb3301ec6d97a00198b6/c26ae/1.png 158w,
/static/555f83330e8aeb3301ec6d97a00198b6/6bdcf/1.png 315w,
/static/555f83330e8aeb3301ec6d97a00198b6/2a432/1.png 411w&quot;
        sizes=&quot;(max-width: 411px) 100vw, 411px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;네트워크 I/O 과정에서 스레드는 데이터 전송이 완료될 때까지 &lt;strong&gt;대기&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;outputStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 출력 스트림으로 데이터 보내기&lt;/span&gt;
inputStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 완료될 때까지 대기&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 249px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/90cbe4b350e82531d400f0629f9246b1/6a5fb/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 134.81012658227846%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLklEQVR42qVV2Y7CMAzs//8VL4hDQghxtaV3S0/uo9xexmxWLQuFQiQraUIm9nhsJHowLpcLbTYbiqKI0jSlMkO6B8IAmKIo1Gw2KQiC3FkpwOzF9XrNwGWHlAWCnc9n/ka4sDLeFXro+z65rvtv/9UDDLharWg0GtF8PqfhcMiGkLG/3W7Lc4hLYRgyiKZpNB6PaTqdUpzEvLfb7Rh8v98zrzgT1LwdsqXZZCo2g/f7fer1epQkCT+I9eFweC8pl/MNMHRi8vXw6n2aOy+dFPq9E9ghjTWfQwQQwkWYx+ORvYOJNc4w43eFgIERUhzHJMsyixxZV1WVDd/tdpsTCAoqlQrn4imHWQ9Pp1POQ3wLD4UhcYUehk5EwRMOX+oQL0AemOER1qZqkdbTuZYHgwGHNZlMOEzYvWzEI5Ios1qtxtVRr9ep1WrRbDajZJKw2JfLJXOJzrNYLHj9zEspJ5mrgR8Mz/LI1V1+rNvtUqfTYSDDMDgpbwv7j0M7Il8LmAIhDTwmknLPaS7kIh2m6fa7fvgHaEGH0U2HikyNRoNs2+bSQ8jgGTRAh5ZlceLAb7GHesA/gqGOkX0kSDQI7IuOhDXoeM6hG7OHWR1+1WBN9Rpe32DtOY7D2YWE0DcRciEgQOAuZpFRcJfECYem6zqZpsmhom96nlcMCBFD/dBctVplwgVfH3VsUfSYUQ2YUTVorkLojzT3FoeiAsATpJLd+ygp4jK4g4dl/0Z/ABM2M9t2Z0MqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;입출력(I/O)을 진행하는 동안 스레드는 대기합니다&quot;
        title=&quot;&quot;
        src=&quot;/static/90cbe4b350e82531d400f0629f9246b1/6a5fb/2.png&quot;
        srcset=&quot;/static/90cbe4b350e82531d400f0629f9246b1/c26ae/2.png 158w,
/static/90cbe4b350e82531d400f0629f9246b1/6a5fb/2.png 249w&quot;
        sizes=&quot;(max-width: 249px) 100vw, 249px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;I/O 대기 시간이 전체 실행 시간의 대부분을 차지합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
실측 결과 전체 실행 시간 800ms 중 CPU 사용 시간은 4ms에 불과했습니다. 99.5%가 I/O 대기 시간이었습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;블로킹 I/O의 문제점&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;블로킹 I/O는 I/O 완료 시까지 스레드를 대기시킵니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
I/O 대기 중인 스레드는 CPU를 전혀 사용하지 않습니다. CPU 효율을 높이려면 더 많은 스레드가 필요합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;요청 당 스레드(thread per request)&lt;/strong&gt; 방식으로 스레드를 늘리면 2가지 문제가 발생합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 메모리 병목&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;스레드 1개당 수백 KB~수 MB의 메모리를 사용합니다. 1만 개 스레드면 약 10GB의 메모리가 필요합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. 컨텍스트 스위칭 오버헤드&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;컨텍스트 스위칭(Context Switching)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
OS가 스레드를 전환할 때 현재 스레드 상태를 저장하고 다음 스레드 상태를 복원하는 과정입니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
마이크로초 단위로 실행되지만, 스레드가 많아지면 CPU 효율에 영향을 줍니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;성능 개선의 2가지 방법&lt;/h3&gt;
&lt;p&gt;자원 효율을 높여 성능을 개선하는 방법은 2가지입니다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;가상 스레드&lt;/strong&gt;(경량 스레드) 사용&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;논블로킹 I/O&lt;/strong&gt; 사용&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;성능 개선은 필요할 때만&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
트래픽이 적다면 성능 개선이 불필요합니다. 실제 문제가 발생하거나 예상 트래픽이 높을 때만 적용하세요.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;가상 스레드로 자원 효율 높이기&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;가상 스레드는 I/O 대기 시 다른 작업을 수행합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
블로킹 I/O 코드 그대로 사용하면서 CPU 효율을 높일 수 있습니다. 자바의 가상 스레드나 Go의 고루틴이 이에 해당합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;가상 스레드의 구조&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;경량 스레드&lt;/strong&gt;는 OS가 아닌 언어 런타임(JVM)이 관리하는 스레드입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 453px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/277af4289611a5163dd64fbe825c96c0/2108e/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVR42oVUiW7aQBDl/7+rUqWqCUloChiMjQ92ba9PfGEMrzNjEZG0SVca7TH27DvGnuGT0XUdmqZB27ZvwWd5niNJElnf5+q6lrPZZwW52L9G3/c4Ho9/nV8uFyksBa/X67vgwUkuylGWJbIsk5lRDMOAy3jBOI4U08xnXyK8FeSRmAT2zoaOtOzLqoS38bF5sbGcr7Bd7GBUitNwwqxre8RhAuVrKE8jizOcz2ehlWc5ojBG4IbQQUQRI41zKKVkr/YKgRPg4B5QZCVOJyp4LGq4Sw+ruYXlwxqhrSbxixxaaUKxxc9vj/j9sIL1tKU8vVwUSEIjKL2Nh73lCxBByPz7rsdwGtDTDXzLjTI7xyZMGp0pN+nUda2wctd77FaOFExvBbumQ+wbKFfj4CikOhOBq6pCalJoL4Zr7RHsDlCOJq0ypGkKo1NEQUIRI/JjlEK5x6wua+xeXayeLKJNlOlFRlWUBSIdw37dYf79mSgvJR8QZR1F8O0Q9i9HJOE5UWZCyP3DiEaa2Qxe37vMe26l8TIKdZakJcq5KaSIIUbxwaAqKpKMEVYNPCsQJJuFTU5Hby6bxMj5y48F5bZTfh8hCALSz8PmeYvl40oMjakb+PJZSxqyBkw1JBqszb2GoXOAQ+L7diDPJIyGcmVeibN5koshx/IoUn3Z2BwfB9Nnl7m9uI2W1E7r+UZcH1jD6Sm8++xu3zLT5lunmFqK103bCCJGWJhSUNbVfxDefgJM72PwZewom8DB7cL9yf38B+dmeDTs7DMvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;가상 스레드 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/277af4289611a5163dd64fbe825c96c0/2108e/3.png&quot;
        srcset=&quot;/static/277af4289611a5163dd64fbe825c96c0/c26ae/3.png 158w,
/static/277af4289611a5163dd64fbe825c96c0/6bdcf/3.png 315w,
/static/277af4289611a5163dd64fbe825c96c0/2108e/3.png 453w&quot;
        sizes=&quot;(max-width: 453px) 100vw, 453px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;JVM은 CPU 코어 개수만큼 플랫폼 스레드를 생성하고, 플랫폼 스레드가 여러 가상 스레드를 번갈아 실행합니다.&lt;/p&gt;
&lt;h3&gt;메모리 효율 비교&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;플랫폼 스레드 1만 개&lt;/strong&gt;: 약 9.8GB&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;스레드당 1MB 스택 메모리 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;가상 스레드 1만 개&lt;/strong&gt;: 약 28MB&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;가상 스레드당 평균 2KB&lt;/li&gt;
&lt;li&gt;플랫폼 스레드 8개 추가 (8MB)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;300배 이상 메모리 효율&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;생성 시간 비교 (10만 개 기준)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;플랫폼 스레드: 21,467ms&lt;/li&gt;
&lt;li&gt;가상 스레드: 196ms&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;100배 이상 빠름&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;가상 스레드의 동작 방식&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 527px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4fa59e41f0c8dba186b1d3095b30127e/44385/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42lWR2W7EIAxF8/9f2FajNiQMYTEQkknIMqPb2A8d9cFCgDk61zTTNCHnjGVZsK4rtm2D1hohBKlaq1S4E3wX0H51sK1HdBnWWTjnQEQYxxHneaJhEBeDHo+HrMYYeO8FyPu6VTjtYdrhAioETUg+Xz1Oeq21SCm9gfM8i0WMEV3XCYitM2X8fCioy6rkguM4/hIwJFLEVjfs+y7p+L5hKwZyYylFYjA4jwk5jWg/Fe7fBuuy4vl8Sd9gBvhwJaCA/div8/M6r/8NefU6SBzFsXpCMCQP8pihlBIrnhc/LKmA7lHsu1sP3wexbfhTuNiUTBRgf9MgnRBtkjg8cLbiOXGKNzDJXK1yiEMS4C/Xjca1vjTKXQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;가상 스레드 변경&quot;
        title=&quot;&quot;
        src=&quot;/static/4fa59e41f0c8dba186b1d3095b30127e/44385/4.png&quot;
        srcset=&quot;/static/4fa59e41f0c8dba186b1d3095b30127e/c26ae/4.png 158w,
/static/4fa59e41f0c8dba186b1d3095b30127e/6bdcf/4.png 315w,
/static/4fa59e41f0c8dba186b1d3095b30127e/44385/4.png 527w&quot;
        sizes=&quot;(max-width: 527px) 100vw, 527px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;마운트(mount)와 언마운트(unmount)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
가상 스레드가 플랫폼 스레드(캐리어 스레드)에 연결되면 &lt;strong&gt;마운트&lt;/strong&gt;, 해제되면 &lt;strong&gt;언마운트&lt;/strong&gt;됩니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
I/O 블로킹 발생 시 언마운트되고, 플랫폼 스레드는 다른 가상 스레드를 실행합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;동작 과정&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;플랫폼 스레드 1이 가상 스레드 1 실행&lt;/li&gt;
&lt;li&gt;가상 스레드 1이 I/O 대기 시 언마운트&lt;/li&gt;
&lt;li&gt;플랫폼 스레드 1이 가상 스레드 2 실행&lt;/li&gt;
&lt;li&gt;I/O 완료 시 가상 스레드 1 재개&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;주의: synchronized 사용 시&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
synchronized로 인한 블로킹은 언마운트되지 않습니다. 플랫폼 스레드도 함께 블로킹됩니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
가상 스레드 사용 시 ReentrantLock 사용을 권장합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;가상 스레드 적용 시점&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;I/O 중심 작업에만 효과적입니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
네트워크 I/O, DB 쿼리 등 I/O 대기가 많은 작업에서 효과를 발휘합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
CPU 중심 작업(이미지 처리, 정렬 등)에서는 효과가 없거나 오히려 성능이 나빠질 수 있습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;가상 스레드 효과를 얻기 위한 조건&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;가상 스레드 개수 &gt; 플랫폼 스레드 개수&lt;/p&gt;
&lt;p&gt;예: CPU 코어 16개, 동시 요청 10개&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;플랫폼 스레드 16개 &gt; 가상 스레드 10개&lt;/li&gt;
&lt;li&gt;효과 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;해결: CPU 코어를 4개로 줄이거나 트래픽을 늘려 동시 요청 100개 이상으로 증가&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;가상 스레드의 장점&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;strong&gt;기존 코드를 거의 수정하지 않아도 됩니다.&lt;/strong&gt; 스프링, JDBC 드라이버 등 주요 라이브러리가 이미 지원합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
처리량을 높이는 것이지, 개별 요청의 실행 속도를 빠르게 하는 것은 아닙니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;논블로킹 I/O로 성능 더 높이기&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;경량 스레드도 한계가 있습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
트래픽이 폭발적으로 증가하면 경량 스레드도 메모리와 스케줄링 오버헤드가 발생합니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
이때는 &lt;strong&gt;논블로킹 I/O&lt;/strong&gt;로 구조적 변경이 필요합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nginx, Netty, Node.js 등이 논블로킹 I/O를 사용합니다.&lt;/p&gt;
&lt;h3&gt;논블로킹 I/O 동작 방식&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;데이터를 읽을 때까지 대기하지 않습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;channel.read()&lt;/code&gt;는 읽을 데이터가 없으면 즉시 0을 리턴합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; byteReads &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 대기하지 않음&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 읽은 데이터가 없어도 다음 코드 즉시 실행&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심: Selector를 이용한 이벤트 루프&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;실행 가능한 I/O 연산이 있을 때까지 대기&lt;/li&gt;
&lt;li&gt;실행 가능한 I/O 연산 목록 조회&lt;/li&gt;
&lt;li&gt;각 I/O 연산 처리&lt;/li&gt;
&lt;li&gt;반복&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/50ce36d9d77970e6b0889a0f8452fc87/432e7/5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVR42oWSbY+DIBCE/f//8HJJcxVQQFEQ+2KrnWP2zn60GoLsxmd2Z6lw8LxeL0x5gmkM2raB8xbX6/XoF1RHyW3bkMYEWzuok4FTHnOecb/fsSwLcs5IKWGaJok9Ho/PwDhE2LND/a3gdYdYBMZxFIgxBnVdQyklscvlgorU5/OJfeda11V2VsH4vwHl3eR8u92kdedcsaKFtRbzPEu8ItV7L6XHGEWJysMwyLlzPTrdQ58adCYgTxl5zgghCIjApim5rvurkNR9UZ1eMMEK+J3ihL4N4mOwQzknESeQIC5C38AjD9k622aznPi2rUV0ebdMCGFsnTBp+dNQxj7C/Xicv2q4s0fog9hBAGFaa6mSQ6JI9ekeypSVRVOXe6idmL9bw2tDEPfdsl+tfreajhNq5wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;자바 논블로킹 IO&quot;
        title=&quot;&quot;
        src=&quot;/static/50ce36d9d77970e6b0889a0f8452fc87/432e7/5.png&quot;
        srcset=&quot;/static/50ce36d9d77970e6b0889a0f8452fc87/c26ae/5.png 158w,
/static/50ce36d9d77970e6b0889a0f8452fc87/6bdcf/5.png 315w,
/static/50ce36d9d77970e6b0889a0f8452fc87/432e7/5.png 570w&quot;
        sizes=&quot;(max-width: 570px) 100vw, 570px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;I/O 멀티플렉싱(Multiplexing)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
단일 이벤트 루프에서 여러 I/O 작업을 처리하는 방식입니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
OS별로 epoll(리눅스), IOCP(윈도우) 등을 사용합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;논블로킹 I/O의 장점&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;블로킹 I/O: 클라이언트 1,000개 = 스레드 1,000개&lt;/li&gt;
&lt;li&gt;논블로킹 I/O: 클라이언트 수와 무관하게 소수의 스레드 사용 (보통 CPU 코어 수만큼)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 509px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1ab3afd07db9070bf67be3ba56e319b9/71554/6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVR42o2S6YqFMAyF+/7P6A/B5bp73XczfIGIM8igENOTpKdJT528/I7jkK7rpKoq6fte8dPn3hLu+66EcRyrB78mXNdV5nlWvyzLr3VRFBfGY9u2XTHHSQTMGGWaJsnzXNI0VQI6SpJEMeOWZamY8b/fr2RZJp/PR8ZxFMePgjAMZRgGNTZByCY8hGwAk+cQRoewrmuNg2nE0VXbtmq0jHEIxogUsbaRwMQx4oatxvGLokh831fSpmkuBc/zVDOVjRx/V/le52Cnbca2cZ8UJMaInudp7etnY2ra+HfMNJDdVbccnkOdtWwnkqRLukZBrsAwa7sWcqzJIRp5Vflvh4jE6DwR7hbPBl4BmE0oD0ZtroF4EATPhHy0b51Bhv9vjVHPs/kBJ42krUa0qiQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;논블로킹 IO에서 동시성을 높이기 위해 N개의 스레드를 씀&quot;
        title=&quot;&quot;
        src=&quot;/static/1ab3afd07db9070bf67be3ba56e319b9/71554/6.png&quot;
        srcset=&quot;/static/1ab3afd07db9070bf67be3ba56e319b9/c26ae/6.png 158w,
/static/1ab3afd07db9070bf67be3ba56e319b9/6bdcf/6.png 315w,
/static/1ab3afd07db9070bf67be3ba56e319b9/71554/6.png 509w&quot;
        sizes=&quot;(max-width: 509px) 100vw, 509px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;리액터 패턴&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;리액터(Reactor) 패턴&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
이벤트 루프가 이벤트를 대기하고 핸들러에 전달하는 패턴입니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Netty, Nginx, Node.js가 리액터 패턴을 사용합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;구조&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;이벤트 발생 대기&lt;/li&gt;
&lt;li&gt;이벤트를 처리할 핸들러 조회&lt;/li&gt;
&lt;li&gt;핸들러가 이벤트 처리&lt;/li&gt;
&lt;li&gt;반복&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;멀티코어 활용&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Netty: 여러 개의 이벤트 루프 생성&lt;/li&gt;
&lt;li&gt;Node.js: 별도 스레드 풀로 CPU 중심 작업 처리&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;프레임워크 사용 권장&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;저수준 논블로킹 I/O API는 복잡합니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
Netty, Reactor Netty 등 프레임워크를 사용하면 더 간단하게 구현할 수 있습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;성능 개선 효과&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 432px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e1cd7755fb475baa51b36a49bc45521e/0e0c3/7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUUlEQVR42q2TTUvDQBCGgwfxDwge/EHeFfEq4q3nYvHU0n/hVS+iCIL0oHgUET2ooIdCSBpCvtoUyVez2eR1s93EJlTbgwNhyezOszvzzkj4xbIs46tlWdB1HbIsI47jcq/YR7EKk6Io4kFhGFYOL/poQpDEE2RpWvFzoGEY8H1/KSA7AUJTPH30cf/8Bn045nGpAEtBEHBgvi6yVKSnOmOs77chbTfRPr/lvoQBy5RN0yyBf6YpglTHxcZBBys7TXQEkCT0J2VN0+B53v8Ac+XyFy5Tw6WAhJA5KVfbpw4csBpuHnaxunuE7sXdFEhngHVRYnZbXxlA1Y1SiFlRFNvF2l4L0lYDx2e9qShUiMJ/kgR5LUsVWcDlwyuuH98x/PLLtkjFC0degNZpD42TK9y8fHIfpaJt6pNRXKAqCmzW8HOniIFHtgXXsUAmUWVSvgHhrTxqEjMA0AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;논블로킹 IO 성능&quot;
        title=&quot;&quot;
        src=&quot;/static/e1cd7755fb475baa51b36a49bc45521e/0e0c3/7.png&quot;
        srcset=&quot;/static/e1cd7755fb475baa51b36a49bc45521e/c26ae/7.png 158w,
/static/e1cd7755fb475baa51b36a49bc45521e/6bdcf/7.png 315w,
/static/e1cd7755fb475baa51b36a49bc45521e/0e0c3/7.png 432w&quot;
        sizes=&quot;(max-width: 432px) 100vw, 432px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실측 결과 (힙 메모리 1.5G 조건)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;블로킹 I/O: 최대 동접 6천&lt;/li&gt;
&lt;li&gt;논블로킹 I/O: 최대 동접 12만&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;20배 성능 향상&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;비교표: 블로킹 vs 논블로킹 vs 가상 스레드&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;블로킹 I/O&lt;/th&gt;
&lt;th&gt;가상 스레드&lt;/th&gt;
&lt;th&gt;논블로킹 I/O&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;스레드 사용&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;요청당 1개&lt;/td&gt;
&lt;td&gt;요청당 1개 (경량)&lt;/td&gt;
&lt;td&gt;CPU 코어 수만큼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;메모리 (1만 요청)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;~10GB&lt;/td&gt;
&lt;td&gt;~28MB&lt;/td&gt;
&lt;td&gt;~수십MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;구현 복잡도&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;낮음&lt;/td&gt;
&lt;td&gt;낮음&lt;/td&gt;
&lt;td&gt;높음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;코드 수정&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;최소&lt;/td&gt;
&lt;td&gt;대폭&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;최대 동시 처리&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;수천&lt;/td&gt;
&lt;td&gt;수십만~백만&lt;/td&gt;
&lt;td&gt;수십만~백만&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;적용 난이도&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;쉬움&lt;/td&gt;
&lt;td&gt;어려움&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;프레임워크 지원&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;모든 프레임워크&lt;/td&gt;
&lt;td&gt;주요 프레임워크 지원&lt;/td&gt;
&lt;td&gt;Netty, Reactor 등&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;실전 적용 가이드&lt;/h2&gt;
&lt;h3&gt;1. 성능 문제 확인&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;먼저 문제가 있는지 확인하세요.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
성능 문제가 없다면 굳이 변경할 필요가 없습니다.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
논블로킹 I/O는 코드 복잡도를 크게 높입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;2. 문제 원인 파악&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;I/O 문제가 아닌 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DB 쿼리 느림: 쿼리 최적화, 캐시 사용&lt;/li&gt;
&lt;li&gt;CPU 중심 작업(이미지 처리 등): 가상 스레드/논블로킹 I/O 효과 없음&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;I/O 문제인 경우&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;동시 접속자 증가로 메모리 부족: 가상 스레드 적용&lt;/li&gt;
&lt;li&gt;극대 트래픽: 논블로킹 I/O 고려&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. 적용 우선순위&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1순위: 가상 스레드&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;기존 코드 거의 수정 불필요&lt;/li&gt;
&lt;li&gt;빠른 적용 가능&lt;/li&gt;
&lt;li&gt;대부분의 경우 충분한 성능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2순위: 서버 확장&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;가상 스레드 적용 불가 시&lt;/li&gt;
&lt;li&gt;구현 변경 여유 없을 시&lt;/li&gt;
&lt;li&gt;비용 증가 감수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3순위: 논블로킹 I/O&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;최고 성능 필요 시&lt;/li&gt;
&lt;li&gt;팀에 기술 역량 있을 시&lt;/li&gt;
&lt;li&gt;장기적 투자 가능 시&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[JVM 핵심 정리]]></title><description><![CDATA[JVM이란? **JVM(Java Virtual Machine)**은 Java 바이트코드를 실행하는 가상 머신입니다. Java는 한 번 작성하면 어디서나 실행할 수 있습니다(Write Once, Run Anywhere). 이게 가능한 이유가 JVM…]]></description><link>https://gotobill.github.io/java/</link><guid isPermaLink="false">https://gotobill.github.io/java/</guid><pubDate>Mon, 15 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;JVM이란?&lt;/h2&gt;
&lt;p&gt;**JVM(Java Virtual Machine)**은 Java 바이트코드를 실행하는 가상 머신입니다.&lt;/p&gt;
&lt;p&gt;Java는 한 번 작성하면 어디서나 실행할 수 있습니다(Write Once, Run Anywhere). 이게 가능한 이유가 JVM입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Java 코드 (.java)
      ↓ 컴파일 (javac)
바이트코드 (.class)
      ↓
    JVM → 각 OS에 맞게 실행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;바이트코드&lt;/h3&gt;
&lt;p&gt;Java 소스 코드를 컴파일하면 &lt;strong&gt;바이트코드&lt;/strong&gt;(.class 파일)가 생성됩니다.&lt;/p&gt;
&lt;p&gt;바이트코드는 기계어가 아닌 &lt;strong&gt;중간 언어&lt;/strong&gt;입니다. JVM이 이 바이트코드를 읽어서 각 운영체제에 맞는 기계어로 변환해 실행합니다.&lt;/p&gt;
&lt;p&gt;Windows에서는 Windows용 JVM이, Mac에서는 Mac용 JVM이 동일한 바이트코드를 실행합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/e3189/jvmPlat.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 88.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADaUlEQVR42mWUzY/bRBjGlxM3pDbZtsRf448kdhLbseNkk2ySdUh2t7TZqtkWyqEBUQpSq0I/qOCAEAfEHwBHJA4gvg4gtVw4gsQf9vDMONvNwuHRa894fvO+7zPjLV2vo5C/oQZMM2aMoGuMWhuGnjAmjB1YVofzrbXCM9o6Cwqg6TXYYoQ0+grjwTeYjr/Ffv49ZuOfsL/3G/Ynf2CcPYdr5zCMgJBoDYu4UfRfYJOqwuHHnfhrLC7/iOXR71gunmN59U/cOv4LN47+Qd77G54zJ9BfAwuYEC+AgSrTMBpqV8MIFdQypzCNKfz6AvXagu8HcMQVeN7rqiVFyacwIWIJ3IRJNdknQiuekk5V3SZc4fPdhalxXGM0/g8Toi2BZ2EmYRW3i3OTFbbnd1Gaf4DS4T2cv/wA5688wrmjp3jl6sfQq30IZrgJU8AzmckSKnVcauzh5Vtfwn/6Heqf/oD6Z79C/+RneF88g/75M7z00S+oRHPYXCfsU9gGkGYoNQqnRYJydg3lnWNsD95AafAmSsO3UB7dRmnyNrWC4crjE8IixHoBTCSwqYByUgj5QQSbzw7NkRLcoGZHqIoWbD67ZgOeyTknhuOmcAl2nFTBbFsCNQIp1+ZOOkF0z2FPbKdNpxMIq01XM7hOh8YkPC6EeB14BHkcc0RK07pMIqUIfLUXorwk5J0RxJ0Rtu90oXXbMC82Uelw7jqbvhrCeW+C7Xcz6CNmcymGlsZcR5dvD+HdzXHh/R6MPCNwFKG84s4fTuE+fg3lRwNowxTWhRYqfS5ateE+yFF9Mkf5YR/6LIN9kddxJ1HrnPt7xdwTzh30ZA9bdLcJjf3STek0r5ERnl4n1ddQnQCLbZEtODHAdhKOxWrctlkyy9+SZlTZk8DfgU/VquwHP5Bgeb5cLqrXe2g1dxl3lAnSVdlfKZ9jfr2PWq2ner0lF3U6U8xmSxwe3ESWzbgoVY47NCYI+sin1zCfHyNus7xqT2UonfWYyGBwiPFkgVZrxA37MsPi+hRXiOlb8brc1vooFSXKcVUWs5LPJ2VLsMza87qMzHDzXyZ/Cr7fQ7PZV7HRGKhyZTlBMOD7ULVFjgfBUL07PDrFRkXcABZZpumELcgRhrtIkpzwIcvZ5Xiu3sNwjDZLl0rTKYGZgp7oX305JvZCondKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;JVM 플랫폼 독립성&quot;
        title=&quot;&quot;
        src=&quot;/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/f058b/jvmPlat.png&quot;
        srcset=&quot;/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/c26ae/jvmPlat.png 158w,
/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/6bdcf/jvmPlat.png 315w,
/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/f058b/jvmPlat.png 630w,
/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/40601/jvmPlat.png 945w,
/static/fe7ab04283b5bcfaf8bb2e81c1b7b14a/e3189/jvmPlat.png 1035w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;JVM 구조&lt;/h2&gt;
&lt;p&gt;JVM은 크게 4가지 컴포넌트로 구성됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4cdaf191887a94958e85b96083d4e63a/d7ba6/jvmArci.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXUlEQVR42k2Ua28UZRSAiR+4JCZGu6XQdnd2Z3a23Xbvu7P33W6BtnvptmwvlIKtSGhBoViovVGsKBFFqoJCIRAVNNLYBKIGSTQaRWP84BfjH3o8M0Xhw5Mz887ss+c958y7yW4PoDijOF0RIYrLFbMw1xRnTNaexvgflyuOS/2PhJC0frfJXPAFuvGHSrT7ixb+UAW3J7vxspbYQH0SVS2J6k5uRC31mDSaO2MKk/jajxEKzJBKLJLPLpNOLhNsXxSWhGXC/nNEAueJBi4IF4kFL2EEP8AIXSYe+phE+IZcr6B7CiJ0ZUXwHrs6rtNXucPo8DrDtXV6Ou/SmVmjkPqabGxduE/O+E54SD7+A4X4z3QmHtGZ/J09yb+se09LjynMEAktE49eYnfhE/YUVunqvEnXrk8pd39BpfsrUrHbJCNfkoqukbbk90T8rfBA5A8pJH4ha9zH4+lik1VgpxTUmUKxJywc9rgVXUoCpyOBW02hS43MaOF6jJq21nWpoe6W57rU0ClFdrQXcfirtBhDtMZHaE2MohsHcARHUcJjwiGckcMokQmU6DHhOErsJE5jWpjBGV/AFTuFZtZQUTN4Cq/gKy/QceB9ikeuUZq4Scf4TbyVqzi7V2nefYvmrjvYe9awF+9jLz3AXv4Re+VX4Q/sfX/jKP+G5i1JhloGvXCClm7pavU8wf6LhGuXCdWukX3xNv7a5xgja8RH76GU1kX4jQi/F+FPInuEvfdPEf5jCd2m0Bwbp3RHaZXZ8/Xjbq+h+wblehjdP4Lm248eOIgeHEP1jaP6XxJeRg0cESaEo8Jx3IFJGZsOUyiN8EZxtIVoag1aNHsD2OXe4Quj+OULCghBIfSYcPQJkShqNIIWNkSYky174jQOiHA8QXiqhHG6j9T8AN6TXew4EqdhIo5t0sB2TOLxBLapJLbXUtSfSmObSVM/m6F+MUPDdE52JRkqHgPlYBLtaIbYbIXM0gCRhQq5c0OElypsPyGyqRi2aRHOCLMinRfporCUwnY2Td3babYvZHH787Jld4LGvMHO3ZJ+MY1aztFclD+o5lF6M+wsyw56kzRWUzT2Cf1pGvemaRrI0DQoDGVpGslhr+XRvZKhKk1xu5LocnpojhiqPWJFTYnhkWctMrStMrQmLdoGXrlus8gIWdq0LF4tL1+KzGGLO85Y2sGrnU3M1cKc2RdlaSTKQs3LdFcDp7u383pPPXMlG/MVG2d6bZyt2ljut3Fubx1v1ep4d/B5zvTvxN8mTWnTo/KywoUBhSuHAqxORrg+GeTGZIAPh22s7N3GR4PbuDK8lav7trK6fws3Dmzh1sHNfDa2mdvjm7l7+Bmujz1L2JcxM0xwOOtgatcOZns9zFV15vs0zg56mSs2MF+qY7FsY6m3jjeqdbzZL1lJZucls3cGJLuhF1gZeY7l2g7J0GyKdfKmhZR1eDotZNhdcpBKjVSpkSa4dZPcU+Q38Jh0CAVr/V/Vv5bMp8swkQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;JVM 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/4cdaf191887a94958e85b96083d4e63a/f058b/jvmArci.png&quot;
        srcset=&quot;/static/4cdaf191887a94958e85b96083d4e63a/c26ae/jvmArci.png 158w,
/static/4cdaf191887a94958e85b96083d4e63a/6bdcf/jvmArci.png 315w,
/static/4cdaf191887a94958e85b96083d4e63a/f058b/jvmArci.png 630w,
/static/4cdaf191887a94958e85b96083d4e63a/40601/jvmArci.png 945w,
/static/4cdaf191887a94958e85b96083d4e63a/d7ba6/jvmArci.png 1107w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;1. Class Loader&lt;/h3&gt;
&lt;p&gt;클래스 파일(.class)을 메모리에 로드하는 역할을 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 과정&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;단계&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Loading&lt;/td&gt;
&lt;td&gt;.class 파일을 메모리로 로드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Linking - Verification&lt;/td&gt;
&lt;td&gt;바이트코드가 JVM 스펙에 맞는지 검증&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Linking - Preparation&lt;/td&gt;
&lt;td&gt;static 변수 메모리 할당, 기본값 초기화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Linking - Resolution&lt;/td&gt;
&lt;td&gt;심볼릭 레퍼런스를 실제 메모리 주소로 변환&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Initialization&lt;/td&gt;
&lt;td&gt;static 블록 실행, static 변수에 실제 값 할당&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Class Loader 계층 (Delegation Model)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;클래스 로딩 요청이 오면 먼저 부모 클래스 로더에게 위임합니다. 부모가 찾지 못하면 자신이 직접 찾습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Class Loader&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Bootstrap&lt;/td&gt;
&lt;td&gt;핵심 라이브러리 로드 (&lt;code class=&quot;language-text&quot;&gt;java.lang.*&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;java.util.*&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Platform (Extension)&lt;/td&gt;
&lt;td&gt;플랫폼 클래스 로드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Application&lt;/td&gt;
&lt;td&gt;애플리케이션 클래스패스의 클래스 로드&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3&gt;2. Runtime Data Area&lt;/h3&gt;
&lt;p&gt;JVM이 프로그램 실행 중 사용하는 메모리 영역입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/85ab1eabdbf5ede014fbdcb96143a5b2/27e9a/jvmRuntime.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTklEQVR42j3R2U7bUBCA4TxGC7WTeN93O3HqEAccQikQBLSAoAJUKEVV1fe/+jtJ1F58Gs+RNTNnTk/tRxhmjWGM0Y0Rmj7GNBt0vWYwKES5oWkjOdtaf/+zzo2NWvKK3vowCFfilDA6IwjOyPJ7yS/k57k0OsAUhtEy1GfScC4N5czusP5biKX809BT1ZJ6/MCoesQyrnCsaxzzBte6x3ceCdzvuPY9cXXJ/uc3poev2NktWnSDntyjx48SnzGSFwyrpdfvj6TYM9PmF3HwiGc/bIoEzovEH0T+L3z3mai6ZtK9UndveNUTWvKAnr6gZz/Fb4zsj0y9T28wqLCtM5lshW2eS7wQlzLhFzxn7VYmvMJ0jzH9FVZwLi4x/CuM4Ku4wQzvsIRpzugp/QB1GKIOIokRymAtpq/FDPREpFtaKjvM0IxU5OhmIXFLN7f5UC9kh26INZ+IBqORl97/iH28x7Cu2PUT3nkR7/0YJc5QkwwlyUXGThizG6UoaY6alah5xTCQgh/sEH1vTLSco8/G7DQpH9oCpc7JRzkHB1PatqaqAnm8gFJiIQWW05bFZMpenNNI4ybMZA1ScMcJ8E9aZt8uyK6W7O7n7CwKdtuM5XzE890pX08butrieOqw+GizKMf8+HTCU7fkPExZSY2VH+H4pUzoyu7akmEn1z2coHZy1a5EkSknk5jFLGGvdmknHl3jMWt8JnLlo7TYWMg6joKEI5nQCqSgooUoTvyf6iYipS+GbozmJeheuuVnW55czy22vALTKzc0u+QvlXxd15lN0iQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Runtime Data Area&quot;
        title=&quot;&quot;
        src=&quot;/static/85ab1eabdbf5ede014fbdcb96143a5b2/f058b/jvmRuntime.png&quot;
        srcset=&quot;/static/85ab1eabdbf5ede014fbdcb96143a5b2/c26ae/jvmRuntime.png 158w,
/static/85ab1eabdbf5ede014fbdcb96143a5b2/6bdcf/jvmRuntime.png 315w,
/static/85ab1eabdbf5ede014fbdcb96143a5b2/f058b/jvmRuntime.png 630w,
/static/85ab1eabdbf5ede014fbdcb96143a5b2/40601/jvmRuntime.png 945w,
/static/85ab1eabdbf5ede014fbdcb96143a5b2/27e9a/jvmRuntime.png 1253w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;스레드 공유 영역&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;영역&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Heap&lt;/td&gt;
&lt;td&gt;객체와 배열이 저장되는 영역. GC 대상&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Method Area&lt;/td&gt;
&lt;td&gt;클래스 메타데이터, static 변수, 상수 풀 저장&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;스레드별 독립 영역&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;영역&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JVM Stack&lt;/td&gt;
&lt;td&gt;메서드 호출 시 프레임 생성. 지역 변수, 연산 스택 저장&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PC Register&lt;/td&gt;
&lt;td&gt;현재 실행 중인 명령어 주소 저장&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Native Method Stack&lt;/td&gt;
&lt;td&gt;네이티브 메서드(C/C++) 실행 시 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3&gt;3. Execution Engine&lt;/h3&gt;
&lt;p&gt;바이트코드를 실제로 실행하는 엔진입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Interpreter&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;바이트코드를 한 줄씩 해석해서 실행합니다. 시작은 빠르지만 반복 실행 시 매번 해석해야 해서 느립니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JIT Compiler (Just-In-Time)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;자주 실행되는 코드(Hotspot)를 감지해서 네이티브 코드로 컴파일합니다. 이후에는 컴파일된 코드를 바로 실행해서 빠릅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;처음 실행: Interpreter로 해석
     ↓
Runtime Profiler가 호출 횟수 모니터링
     ↓
임계값 초과 (Hotspot 감지)
     ↓
JIT Compiler가 네이티브 코드로 컴파일
     ↓
이후 실행: 컴파일된 코드 직접 실행&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Tiered Compilation (HotSpot VM)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HotSpot VM은 두 가지 JIT 컴파일러를 사용합니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;단계&lt;/th&gt;
&lt;th&gt;컴파일러&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Level 0&lt;/td&gt;
&lt;td&gt;Interpreter&lt;/td&gt;
&lt;td&gt;해석 실행&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Level 1-3&lt;/td&gt;
&lt;td&gt;C1&lt;/td&gt;
&lt;td&gt;빠른 컴파일, 기본 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Level 4&lt;/td&gt;
&lt;td&gt;C2&lt;/td&gt;
&lt;td&gt;느린 컴파일, 고급 최적화&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;호출 횟수가 증가하면 더 높은 레벨로 재컴파일됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JIT 최적화 기법&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;기법&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Inlining&lt;/td&gt;
&lt;td&gt;메서드 호출을 메서드 본문으로 대체&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Loop Unrolling&lt;/td&gt;
&lt;td&gt;루프를 풀어서 반복 오버헤드 제거&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Escape Analysis&lt;/td&gt;
&lt;td&gt;객체가 메서드 밖으로 나가지 않으면 스택에 할당&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Inlining 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Before&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// After (Inlined)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;메서드 호출 오버헤드(스택 프레임 생성, 매개변수 전달, 반환)가 제거됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Loop Unrolling 예시&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Before&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// After (Unrolled)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;인덱스 증가, 조건 검사 오버헤드가 제거됩니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;4. Garbage Collector&lt;/h3&gt;
&lt;p&gt;더 이상 참조되지 않는 객체를 자동으로 메모리에서 제거합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Heap 구조&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Heap
├── Young Generation
│   ├── Eden        (새 객체 할당)
│   └── Survivor    (Minor GC 생존 객체)
└── Old Generation  (오래 살아남은 객체)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;GC 종류&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;이벤트&lt;/th&gt;
&lt;th&gt;대상&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Minor GC&lt;/td&gt;
&lt;td&gt;Young Generation&lt;/td&gt;
&lt;td&gt;자주 발생, 빠름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Major GC&lt;/td&gt;
&lt;td&gt;Old Generation&lt;/td&gt;
&lt;td&gt;드물게 발생, 느림&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;GC 알고리즘 (Java 11+)&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;GC&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;th&gt;사용 시점&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;G1&lt;/td&gt;
&lt;td&gt;기본 GC. 대용량 힙에 적합&lt;/td&gt;
&lt;td&gt;일반적인 서버 애플리케이션&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ZGC&lt;/td&gt;
&lt;td&gt;초저지연 (10ms 이하)&lt;/td&gt;
&lt;td&gt;지연 시간이 중요한 경우&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Shenandoah&lt;/td&gt;
&lt;td&gt;저지연, 동시 처리&lt;/td&gt;
&lt;td&gt;ZGC와 유사한 요구사항&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;스택 기반 아키텍처&lt;/h2&gt;
&lt;p&gt;JVM은 스택 기반으로 동작합니다. 연산 시 스택에 값을 push/pop합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;PUSH 5      → Stack: [5]
PUSH 3      → Stack: [5, 3]
ADD         → Stack: [8]  (5, 3을 pop하고 결과 push)
STORE c     → Stack: []   (8을 pop해서 c에 저장)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;왜 스택 기반인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;레지스터 기반(Dalvik, V8)은 CPU 아키텍처마다 레지스터 개수와 사용 방식이 다릅니다. 스택 기반은 하드웨어에 독립적이라 &lt;strong&gt;이식성&lt;/strong&gt;이 높습니다. Java의 &quot;Write Once, Run Anywhere&quot; 철학에 맞습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;JDK vs JRE vs JVM&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;JDK (Java Development Kit)
├── JRE (Java Runtime Environment)
│   ├── JVM
│   └── 표준 라이브러리
├── javac (컴파일러)
├── jdb (디버거)
└── 기타 개발 도구&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구성&lt;/th&gt;
&lt;th&gt;용도&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JVM&lt;/td&gt;
&lt;td&gt;바이트코드 실행&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JRE&lt;/td&gt;
&lt;td&gt;Java 프로그램 실행 (JVM + 라이브러리)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JDK&lt;/td&gt;
&lt;td&gt;Java 프로그램 개발 (JRE + 개발 도구)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;정리&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;컴포넌트&lt;/th&gt;
&lt;th&gt;역할&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Class Loader&lt;/td&gt;
&lt;td&gt;.class 파일을 메모리에 로드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Runtime Data Area&lt;/td&gt;
&lt;td&gt;프로그램 실행에 필요한 메모리 관리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Execution Engine&lt;/td&gt;
&lt;td&gt;바이트코드를 기계어로 변환해 실행&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Garbage Collector&lt;/td&gt;
&lt;td&gt;사용하지 않는 객체 메모리 해제&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;JVM 덕분에 Java는 플랫폼 독립적이고, 개발자가 메모리 관리를 직접 하지 않아도 됩니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JIT 컴파일러 심화]]></title><description><![CDATA[컴파일 vs 인터프리터 프로그래밍 언어 실행 방식은 크게 두 가지입니다. 방식 특징 대표 언어 컴파일 전체 코드를 기계어로 변환 후 실행. 빠르지만 컴파일 시간 필요 C, C…]]></description><link>https://gotobill.github.io/jvm-jit-compiler/</link><guid isPermaLink="false">https://gotobill.github.io/jvm-jit-compiler/</guid><pubDate>Fri, 12 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;컴파일 vs 인터프리터&lt;/h2&gt;
&lt;p&gt;프로그래밍 언어 실행 방식은 크게 두 가지입니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;방식&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;th&gt;대표 언어&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;컴파일&lt;/td&gt;
&lt;td&gt;전체 코드를 기계어로 변환 후 실행. 빠르지만 컴파일 시간 필요&lt;/td&gt;
&lt;td&gt;C, C++&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;인터프리터&lt;/td&gt;
&lt;td&gt;한 줄씩 해석하며 실행. 시작은 빠르지만 실행 속도 느림&lt;/td&gt;
&lt;td&gt;Python, JavaScript&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Java는 두 방식을 결합했습니다.&lt;/strong&gt; 소스 코드를 바이트코드로 컴파일하고, JVM이 바이트코드를 해석하면서 필요한 부분만 기계어로 컴파일합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;JIT 컴파일러란?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;JIT(Just-In-Time) 컴파일러&lt;/strong&gt;는 자주 실행되는 코드(Hotspot)를 찾아 네이티브 코드로 컴파일해 성능을 높입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;프로그램 시작
     ↓
Interpreter로 바이트코드 해석 실행
     ↓
Runtime Profiler가 메서드 호출 횟수 모니터링
     ↓
임계값 초과 (Hotspot 감지)
     ↓
JIT Compiler가 네이티브 코드로 컴파일
     ↓
이후 호출: 컴파일된 코드 직접 실행 (빠름)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심&lt;/strong&gt;: 모든 코드를 컴파일하지 않습니다. 자주 실행되는 코드만 컴파일해서 컴파일 오버헤드와 실행 속도의 균형을 맞춥니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;C1 vs C2 컴파일러&lt;/h2&gt;
&lt;p&gt;JVM에는 두 가지 JIT 컴파일러가 있습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;컴파일러&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;th&gt;용도&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;C1 (Client)&lt;/td&gt;
&lt;td&gt;빠른 컴파일, 기본 최적화&lt;/td&gt;
&lt;td&gt;빠른 시작이 중요한 경우&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C2 (Server)&lt;/td&gt;
&lt;td&gt;느린 컴파일, 고급 최적화&lt;/td&gt;
&lt;td&gt;장기 실행 서버 애플리케이션&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;티어드 컴파일 (Tiered Compilation)&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Java 8부터 기본 활성화.&lt;/strong&gt; C1과 C2를 함께 사용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Level 0: Interpreter (해석 실행)
     ↓ 호출 횟수 증가
Level 1-3: C1 컴파일 (빠른 컴파일, 기본 최적화)
     ↓ 호출 횟수 계속 증가
Level 4: C2 컴파일 (느린 컴파일, 고급 최적화)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;처음에는 C1으로 빠르게 컴파일해서 시작 속도를 높이고, 정말 자주 실행되는 코드는 C2로 재컴파일해서 최적의 성능을 냅니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;JIT 최적화 기법&lt;/h2&gt;
&lt;h3&gt;인라이닝 (Inlining)&lt;/h3&gt;
&lt;p&gt;메서드 호출을 메서드 본문으로 대체합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Before&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// After (Inlined)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;메서드 호출 오버헤드(스택 프레임 생성, 매개변수 전달)가 제거됩니다.&lt;/p&gt;
&lt;h3&gt;루프 언롤링 (Loop Unrolling)&lt;/h3&gt;
&lt;p&gt;루프를 펼쳐서 반복 오버헤드를 줄입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Before&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// After (Unrolled)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;탈출 분석 (Escape Analysis)&lt;/h3&gt;
&lt;p&gt;객체가 메서드 밖으로 나가지 않으면 최적화를 적용합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Point&lt;/span&gt; p &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Point&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 루프 내에서만 사용&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;스택 할당&lt;/strong&gt;: 힙 대신 스택에 할당 (GC 부담 감소)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;동기화 제거&lt;/strong&gt;: 불필요한 lock 제거&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스칼라 치환&lt;/strong&gt;: 객체를 개별 필드로 분해&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;OSR (On-Stack Replacement)&lt;/h3&gt;
&lt;p&gt;긴 루프가 실행 중일 때, 루프가 끝날 때까지 기다리지 않고 즉시 컴파일된 코드로 전환합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10_000_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 루프 도중에 JIT 컴파일 코드로 교체&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;compute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;역최적화 (Deoptimization)&lt;/h2&gt;
&lt;p&gt;JVM이 기존에 컴파일한 코드를 다시 인터프리터 모드로 되돌리는 과정입니다.&lt;/p&gt;
&lt;h3&gt;발생 원인: 다형성 변화&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;MemberRepository&lt;/span&gt; repo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MemberRepositoryImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 100만 번 실행 → JVM이 MemberRepositoryImpl 기준으로 최적화&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1_000_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;User-&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 새로운 구현체로 교체 → 기존 최적화 무효화&lt;/span&gt;
repo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggingMemberRepository&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MemberRepositoryImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 역최적화 발생, 다시 프로파일링 시작&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1_000_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;User-&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;JVM은 단일 타입(Monomorphic)으로 호출되는 메서드를 적극적으로 인라이닝합니다. 다른 구현체가 등장하면 기존 최적화가 무효화되고 역최적화가 발생합니다.&lt;/p&gt;
&lt;h3&gt;Inline Cache 상태&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;상태&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;성능&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Monomorphic&lt;/td&gt;
&lt;td&gt;단일 타입&lt;/td&gt;
&lt;td&gt;가장 빠름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Polymorphic&lt;/td&gt;
&lt;td&gt;2~4개 타입&lt;/td&gt;
&lt;td&gt;빠름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Megamorphic&lt;/td&gt;
&lt;td&gt;다수 타입&lt;/td&gt;
&lt;td&gt;느림 (vtable 사용)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;웜업 (Warm-up)&lt;/h2&gt;
&lt;p&gt;프로그램 시작 직후에는 인터프리터로 실행되므로 성능이 낮습니다. JIT 컴파일이 완료되면 성능이 향상됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 초기 실행: 인터프리터 모드 (느림)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;compute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 웜업 후: JIT 컴파일 완료 (빠름)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;compute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실제 측정 시 웜업을 고려해야 합니다. 벤치마크 도구(JMH)는 자동으로 웜업을 수행합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;JVM 튜닝 옵션&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;옵션&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;기본값&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:+TieredCompilation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;티어드 컴파일 활성화&lt;/td&gt;
&lt;td&gt;true (Java 8+)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:CompileThreshold=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;컴파일 임계값&lt;/td&gt;
&lt;td&gt;10,000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:ReservedCodeCacheSize=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;코드 캐시 크기&lt;/td&gt;
&lt;td&gt;240MB (Tiered)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:CICompilerCount=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;컴파일 스레드 수&lt;/td&gt;
&lt;td&gt;CPU에 비례&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:MaxInlineSize=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;인라이닝 대상 메서드 크기&lt;/td&gt;
&lt;td&gt;35 bytes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:+DoEscapeAnalysis&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;탈출 분석 활성화&lt;/td&gt;
&lt;td&gt;true&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;코드 캐시 부족 문제&lt;/h3&gt;
&lt;p&gt;코드 캐시가 가득 차면 JIT 컴파일이 중단되고 인터프리터로 실행됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 코드 캐시 크기 증가&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:ReservedCodeCacheSize&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;512m MyApplication&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;컴파일 로그 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컴파일 로그 출력&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+PrintCompilation&lt;/span&gt; MyApplication

&lt;span class=&quot;token comment&quot;&gt;# 인라이닝 로그&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+PrintInlining&lt;/span&gt; MyApplication&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;정리&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;개념&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JIT 컴파일러&lt;/td&gt;
&lt;td&gt;자주 실행되는 코드를 네이티브 코드로 컴파일&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tiered Compilation&lt;/td&gt;
&lt;td&gt;C1(빠른 컴파일) + C2(고급 최적화) 조합&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;인라이닝&lt;/td&gt;
&lt;td&gt;메서드 호출을 본문으로 대체&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;탈출 분석&lt;/td&gt;
&lt;td&gt;객체가 스코프를 벗어나지 않으면 스택 할당&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;역최적화&lt;/td&gt;
&lt;td&gt;다형성 변화 시 기존 최적화 무효화&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;웜업&lt;/td&gt;
&lt;td&gt;JIT 컴파일 완료까지의 초기 성능 저하 구간&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;JIT 컴파일러 덕분에 Java는 인터프리터 언어의 이식성과 컴파일 언어의 성능을 모두 얻을 수 있습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Garbage Collection 핵심 정리]]></title><description><![CDATA[가비지 컬렉션이란? Garbage Collection(GC)은 더 이상 참조되지 않는 객체를 자동으로 메모리에서 제거하는 메커니즘입니다. C/C++에서는 개발자가 직접 /로 메모리를 관리해야 합니다. Java는 GC…]]></description><link>https://gotobill.github.io/javaGarbage/</link><guid isPermaLink="false">https://gotobill.github.io/javaGarbage/</guid><pubDate>Wed, 10 Sep 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;가비지 컬렉션이란?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Garbage Collection&lt;/strong&gt;(GC)은 더 이상 참조되지 않는 객체를 자동으로 메모리에서 제거하는 메커니즘입니다.&lt;/p&gt;
&lt;p&gt;C/C++에서는 개발자가 직접 &lt;code class=&quot;language-text&quot;&gt;malloc&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;free&lt;/code&gt;로 메모리를 관리해야 합니다. Java는 GC가 자동으로 처리하므로 메모리 해제를 신경 쓰지 않아도 됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;C/C++: 개발자가 직접 메모리 해제 → 실수 시 메모리 누수
Java:  GC가 자동으로 메모리 해제 → 메모리 관리 부담 감소&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;힙 메모리 구조&lt;/h2&gt;
&lt;p&gt;GC는 &lt;strong&gt;힙(Heap)&lt;/strong&gt; 영역을 관리합니다. 힙은 객체와 배열이 저장되는 공간입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e4c02b970833d0216f2e3c7f231c02bb/076ca/memory.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADXUlEQVR42j2T7U9bZRjG+8kNtmnnOIe3c0p7Tk97Sk/f31sKrNC1ZYCryzpqg4wxwFpxyN4izvhGXLKwOYgMl7lhhnFmvmTRLO6DRhOTffCD8T/6+YjGD79c94fnvnJfee7bpruKmJ7TeIwaXmNK1A18nml83hn6vbOCOfzmvGARy2xi+VoEfEsEfct76nTGcTj8dHQYSJKBLWQtUz/1iLHSDunYHTKx+4IHZONfkYs/YiDxPfnEjwwmnzKU/Jmjqd8opH9nJPOH0GdikGH8/gS6HkNRAtgsX5N8dpOh3AaDmS1SUUHkM9LRu2SiO4JdsrGH5GLfCvPH/5k/Eea/MJT4CbeeR3dH6O216OryYXOGqgQLl9AzyzhSF3BmV3Hl3kcb+Bgtv442uIk2tI0+fA/96AP0wtfoI9+hF5+gjTzGqedQVb+I69nD5kw0qJzbIDq5hj76Ed7yOkZpE7WwhTpyD3X0S9TiN6ilH1DLT1Erv6JUnqEc/0von7jNIgErjWEkhHEQmxqbEI0LuIot9PJb6GOX0cZW6T12FaX0oWi6hjK2Lgw2UMdvo0zcRZn8AqX6UOguTncOzRWiu8f/b+SuUYvD9X4O1/p5sR7gyHSQjjMhpLkw0nwEaVHwepSON2JIb8aRlgUrCaTLSaQLSfp8EfoU8b7Dgyx5sfWUQoy+O0VkqUz3mRhdZ2PIc4JzgsU4cjOB3EoiL6WQz6eRVwQXM8hXssiXsvSZEQwzicsSkfUQNqkSpq81jPraID3NAY4sJLEvJLA3hbZS2JfS2Jcz2Fey2C8KruSwvz3AC1fz2Ffz9PVH0TWxMq4gPQ6xNvqwH61qoFe9eGp+vHULsxHANy2YCdI/G8I/J5gP418MYzXDBFoRAucFrSiamNDxf2QT2ytJhZuNIGtVN+8UDvLesef5oHyItcohro0f5PrkAW6cOMAn1XY2T7azdaqd7Vobn9f3sz3VRsAbxO1J43JFxGKLX57JdrP5qsmNaR/XawrrtW5uNVRu1WVuvtzGhjD49HQbt+tt3GkIo+n93J/Zx+7Z59iZ3UfIDOLxZsWl/HOCYWwJ06BgOSgEnBTDGqWIRjmqUYlpjAmOxzXGExoTSY3JlMaJtEY17eJk1sVLojb0yJ5Rp2zS2enjbykpy1NEAkAKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;메모리 구조&quot;
        title=&quot;&quot;
        src=&quot;/static/e4c02b970833d0216f2e3c7f231c02bb/f058b/memory.png&quot;
        srcset=&quot;/static/e4c02b970833d0216f2e3c7f231c02bb/c26ae/memory.png 158w,
/static/e4c02b970833d0216f2e3c7f231c02bb/6bdcf/memory.png 315w,
/static/e4c02b970833d0216f2e3c7f231c02bb/f058b/memory.png 630w,
/static/e4c02b970833d0216f2e3c7f231c02bb/076ca/memory.png 914w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;영역&lt;/th&gt;
&lt;th&gt;저장 내용&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;코드 영역&lt;/td&gt;
&lt;td&gt;실행할 프로그램 코드&lt;/td&gt;
&lt;td&gt;컴파일 시 결정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;데이터 영역&lt;/td&gt;
&lt;td&gt;전역 변수, static 변수&lt;/td&gt;
&lt;td&gt;프로그램 시작 시 할당&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;힙 영역&lt;/td&gt;
&lt;td&gt;객체, 배열&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;GC 대상&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;스택 영역&lt;/td&gt;
&lt;td&gt;지역 변수, 매개변수&lt;/td&gt;
&lt;td&gt;메서드 호출 시 생성/소멸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MemoryExample&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                    &lt;span class=&quot;token comment&quot;&gt;// 데이터 영역 (static 변수)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                  &lt;span class=&quot;token comment&quot;&gt;// 코드 영역 (메서드 바이트코드)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                          &lt;span class=&quot;token comment&quot;&gt;// 스택 영역 (primitive 지역 변수)&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// name(참조): 스택, String 객체: 힙&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;              &lt;span class=&quot;token comment&quot;&gt;// user(참조): 스택, User 객체: 힙&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;user&lt;/code&gt;는 &lt;strong&gt;참조 변수&lt;/strong&gt;(포인터)로 스택에 8바이트 주소가 저장됩니다.&lt;/p&gt;
&lt;p&gt;실제 객체는 힙에 생성되고, 스택의 참조 변수가 힙의 객체 주소를 가리킵니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Mark and Sweep&lt;/h2&gt;
&lt;p&gt;GC의 기본 알고리즘입니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mark 단계&lt;/strong&gt;: 루트 객체(GC Root)에서 시작해 참조 가능한 모든 객체를 마킹합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Sweep 단계&lt;/strong&gt;: 마킹되지 않은 객체를 메모리에서 제거합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;GC Root
├── 스택의 지역 변수
├── 메서드의 매개변수
├── static 변수
└── JNI 참조

Mark: GC Root → 참조 체인을 따라 살아있는 객체 마킹
Sweep: 마킹되지 않은 객체 제거&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;GC Root에서 도달할 수 없는 객체 = 가비지&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;세대별 가비지 컬렉션&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Weak Generational Hypothesis&lt;/strong&gt;: 대부분의 객체는 생성 직후 곧바로 쓸모없어집니다.&lt;/p&gt;
&lt;p&gt;이 가설을 기반으로 힙을 &lt;strong&gt;Young&lt;/strong&gt;과 &lt;strong&gt;Old&lt;/strong&gt; 세대로 나눠 관리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Heap
├── Young Generation
│   ├── Eden        (새 객체 할당)
│   ├── Survivor 0  (Minor GC 생존 객체)
│   └── Survivor 1  (Minor GC 생존 객체)
└── Old Generation  (오래 살아남은 객체)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;Minor GC&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Young Generation&lt;/strong&gt;에서 발생하는 GC입니다. 자주 발생하고 빠르게 끝납니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6444c0e4fc845e87b6ec50778f9cfa0c/46115/gc1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADaklEQVR42mWU3W/bVBjG/T8ATdvUOfaJE9tJ/JnEduJ8tWlK2xHWdZN2031IDYOKre0mxKRJiIsJCbGtfIwLuAGhITEEXIGQoHcICf6rh8duYay7eHRk+3cev+953/co85qHTEa9A9NNoVsRn10s6B4Wdf8FZWxBOBDVNkyvB81s/8cv8Jti2DHKVgyz0UWVptKMoFVauVQjfM4se/6Xr9YYQL0LncY5b7RQMppQ3O4IDcrvj2EnfciQG5oJKq0Oo23zrydm2d/LdgS3M4KbLsMfjFEjXyZvkDfIG/UYSnlvBPFmDy9fa6LwRhuFtxLM3e6icCuF8NpYFDSUFI3VWhNytw+x18dLV0LMzdqY20vwyn4Xc4eMNqZh7d4Eg5tdhO+vonuQYnTQhfvxJgp3Iwi/hYWSd3I+NC41mtBmEcpktH0ezTsptLs8x/d6KNxj6p0Iir6xDfnaDkrTGfTNLcjpJagXrqF0fheC5yR4LjpTVcshBFcxfh2Lq5dR3NhFaXMbYroN9fwVqFszSH8IxZl+jur0ByxNfoMcPoS5/hjF5e8hJr9C1NewJF3Y/oBVbUKYPfiXj+Bff4LKxWPo/U9grz/C0spTqJNjSO8iI0zvoNS/DzH6FHpnH7L/LsTwI2jDI2j2gKk6LE5M44CGHVRXD1Hbug9j4zNoyW3yd8h/mO+XzqtQpBWyVQLopk8Fp/JzqUZwWmE3r3KJbVM2GWk5YKuc5fm9EkLx22sIonWE8QZ7ccReHFJcG0NCz7eNZA8G0TPeck75xglv1Fjl4fABkugBouARovAx4vBLdJtPkLa+ZgMv08ihYcBKu2ziHnr9D5B2jtD2H/6P/4b8t7Dq56BMtr/C5s53GI9+Qr/1CwbtY6zEf2El+YNTsUbDBg1DGjqQ1RHG0y9w7upTrI5/JPsz9Tv5PzFO/obduMRJaV2FH8/gBTfguHtwvZvwvUP4/i2m3MlTLeYRetCqCdzmDvyEfHgDbsa7b5M/yPcYNttmQauxkpRucyJszAuTw26iQOXFOL0QMmXP88JGQbW4Wjm/KC0ymUxm4kLJzqcoQ0YR5qkZzewGiSGtBCUOvqRhpdrKW0dSOt+X2fA6mYwv6s/2ZsVTzl5PRivNq2k6PU5IQkMPFi+JSnYbOWm+Wm6Ppkk+32f3/wPxfwlaX6ZD7wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Minor GC 과정&quot;
        title=&quot;&quot;
        src=&quot;/static/6444c0e4fc845e87b6ec50778f9cfa0c/f058b/gc1.png&quot;
        srcset=&quot;/static/6444c0e4fc845e87b6ec50778f9cfa0c/c26ae/gc1.png 158w,
/static/6444c0e4fc845e87b6ec50778f9cfa0c/6bdcf/gc1.png 315w,
/static/6444c0e4fc845e87b6ec50778f9cfa0c/f058b/gc1.png 630w,
/static/6444c0e4fc845e87b6ec50778f9cfa0c/40601/gc1.png 945w,
/static/6444c0e4fc845e87b6ec50778f9cfa0c/78612/gc1.png 1260w,
/static/6444c0e4fc845e87b6ec50778f9cfa0c/46115/gc1.png 1290w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;동작 과정&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;새 객체가 &lt;strong&gt;Eden&lt;/strong&gt;에 할당됩니다&lt;/li&gt;
&lt;li&gt;Eden이 가득 차면 &lt;strong&gt;Minor GC&lt;/strong&gt; 발생&lt;/li&gt;
&lt;li&gt;Eden + 현재 Survivor의 살아있는 객체가 &lt;strong&gt;반대편 Survivor&lt;/strong&gt;로 이동&lt;/li&gt;
&lt;li&gt;매 Minor GC마다 S0 ↔ S1을 번갈아 사용&lt;/li&gt;
&lt;li&gt;여러 번 살아남은 객체는 &lt;strong&gt;Old Generation&lt;/strong&gt;으로 승격&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[1차 Minor GC] Eden → S0 (S1은 비어있음)
[2차 Minor GC] Eden + S0 → S1 (S0 비움)
[3차 Minor GC] Eden + S1 → S0 (S1 비움)
... 반복 ...
[N회 생존] → Old Generation으로 승격&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;카드 테이블&lt;/h3&gt;
&lt;p&gt;Minor GC는 Young 영역만 스캔합니다. 그런데 Old 영역의 객체가 Young 영역 객체를 참조하고 있다면 어떻게 될까요?&lt;/p&gt;
&lt;p&gt;Young 영역만 스캔하면 해당 객체가 참조되지 않는 것처럼 보여서 &lt;strong&gt;잘못 삭제될 수 있습니다&lt;/strong&gt;. 그렇다고 매번 Old 영역 전체를 스캔하면 Minor GC가 느려져서 의미가 없습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;카드 테이블&lt;/strong&gt;은 이 문제를 해결합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Old→Young&lt;/strong&gt; 참조가 발생하면 해당 위치를 미리 기록해두고, Minor GC 시 기록된 영역만 추가로 스캔합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/01d838c81cdcf16502e35f6294594adb/e996b/card1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVR42o2RS2/TUBCF8yOokjhvX8fPGxzfh5+NQ9IkqJEQEkjAij0L1Eq8pG4AsQGEBCyQEH/2MHZSWtoisfg0M9eeM+fObRijKSragxCt/m20+yEMN4KhBMxZDns9Qy/RdW0IgU4VNRESw13vZRqGuRNjogBfb+BnCxhLhYMXMcw3K3TPjjB8OcetkxjNZwmaz1McnFL+JIHRIxHzquA+6TByxcjdiJgINMsY/F6G2dMcnTKFUWp0DsnpjJgTWsEY3OTwXJCw+QIsyGA7DyH97ziKX2ObvUUxPYMKvkEG7yl+RMy/gLsnaI8C6o1uFmwPIzC+hsnnsL3H0OIXyvwdyuIziuQDlPhJfKLzr9DyB/jkFfX8Q7BNy7XcEF7A4foBBnaEvqORRw4elV14PMTIVTBdSQgwT9E/4tp1/wi2aBeOH0LJEEJQs6Mw9Ascpx5Otx1EUwkroBendYwJZ5LTgLjuq8ycUwv2mMDQVugySS+m6HFo+rhComtptJhGf1/vuMirvsv0LIGGSZPy8hh3Vvch0iNYfkxOUnKS1tHmu3x85awmuMChekRrali0lwczBzJZIEpXmOolCa+QHN6FzjeQ6RrTeIlQLeo6SqqhyV9DxvshtSDzNHRc0I9LyGwNRU0VutjUAvl8Cy7m+6ZsT3oNZ0KCLglWO2F+hurqphfTCyZUUyQXVV65qb/9B/2xxG8WMXRRPBg/wgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;카드 테이블&quot;
        title=&quot;&quot;
        src=&quot;/static/01d838c81cdcf16502e35f6294594adb/f058b/card1.png&quot;
        srcset=&quot;/static/01d838c81cdcf16502e35f6294594adb/c26ae/card1.png 158w,
/static/01d838c81cdcf16502e35f6294594adb/6bdcf/card1.png 315w,
/static/01d838c81cdcf16502e35f6294594adb/f058b/card1.png 630w,
/static/01d838c81cdcf16502e35f6294594adb/40601/card1.png 945w,
/static/01d838c81cdcf16502e35f6294594adb/e996b/card1.png 1050w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;개념&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Card&lt;/td&gt;
&lt;td&gt;힙의 512바이트 메모리 블록&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dirty Card&lt;/td&gt;
&lt;td&gt;Old→Young 참조가 있는 카드&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Write Barrier&lt;/td&gt;
&lt;td&gt;참조 변경 시 카드를 Dirty로 마킹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Minor GC 시 &lt;strong&gt;Dirty 카드가 가리키는 영역만 추가로 스캔&lt;/strong&gt;합니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Major GC (Full GC)&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Old Generation&lt;/strong&gt;에서 발생하는 GC입니다. 드물게 발생하지만 오래 걸립니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;Minor GC&lt;/th&gt;
&lt;th&gt;Major GC&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;대상&lt;/td&gt;
&lt;td&gt;Young Generation&lt;/td&gt;
&lt;td&gt;Old Generation (+ Young)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;빈도&lt;/td&gt;
&lt;td&gt;자주 발생&lt;/td&gt;
&lt;td&gt;드물게 발생&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;속도&lt;/td&gt;
&lt;td&gt;빠름&lt;/td&gt;
&lt;td&gt;느림&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;동작 과정&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Old Generation이 가득 차면 Major GC 발생&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mark&lt;/strong&gt;: 살아있는 객체 마킹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sweep&lt;/strong&gt;: 죽은 객체 제거&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Compact&lt;/strong&gt; (선택): 메모리 단편화 해소&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;Stop-the-World&lt;/h2&gt;
&lt;p&gt;GC 실행 중에는 &lt;strong&gt;모든 애플리케이션 스레드가 일시 정지&lt;/strong&gt;됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;애플리케이션 스레드: ====[정지]=====&gt;
GC 스레드:              [GC 실행]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Minor GC&lt;/strong&gt;: STW 시간이 짧다 (밀리초 단위)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Major GC&lt;/strong&gt;: STW 시간이 길다 (수백 밀리초~초 단위)&lt;/p&gt;
&lt;p&gt;STW 시간을 줄이는 것이 GC 튜닝의 핵심입니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;객체 할당 최적화&lt;/h2&gt;
&lt;h3&gt;Bump the Pointer&lt;/h3&gt;
&lt;p&gt;Eden 영역에서 빠르게 객체를 할당하는 기법입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;마지막 할당 위치를 기억 → 다음 객체는 바로 그 뒤에 할당&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;빈 공간을 찾지 않고 포인터만 증가시키면 되므로 매우 빠릅니다.&lt;/p&gt;
&lt;h3&gt;TLAB (Thread-Local Allocation Buffers)&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3e840b661baa16d3adce7afe1fd36eea/d8817/tla.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3UlEQVR42o2RW2/TQBCF8y8gib3rey6O7fiyjmOnqZU0CQUVUPqAEBLqA5XoA0Ig8YIEf/1w1o1alRd4+LSz9szZMzO95zJC34oxsBMMLGLPnzB05hB+0SE9BWdawZlVsEYlhFd0mF7+kN+L5zuMJw3coEQwWTKuYPsKhpvxoaQ73ZAimlhh3NaIdzuMyjWciN8S5k/KR8GQYprpfItIXWA2W8GhuOlRkK5NK4O8qjD8rOBeH7F4+xvi0xbG1xr9byuIny1kW2FgUpDd9KxAW89ZmEA4KaSTQdCV6Z4EbcabEv0jv7/aw7u8gfm+hfhYY0CGtyvIJQXFSTBPD0jCFtPoHGG2QZRvkZd7hHQqR4oP5ZCvKXjXQH2Y4Muth/aOxd9bmD/WMH9ph8tHh8JOYbk57NECth44Z+iFDexAdTMx6FCsOKPLEuNdhvN9guiKizg2MK9rGO9qSMX/8jRDg+0afo6hmz7dMNvXC9EblC43bBcwHIVnxGAs6Fwj9eneb3rIml65fomzzRvExQZB1GCSnGEUr040dLuES+d6094J92+mVZdncUS9tDkgq3ZIFxfI6wMWfEA1LzoK3v1ZfS/4Dx4EAw7f58WfLRGwWJ9aRMc6SQZFl/g/6Lb/ABeRM/BFHvGIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tlab&quot;
        title=&quot;&quot;
        src=&quot;/static/3e840b661baa16d3adce7afe1fd36eea/f058b/tla.png&quot;
        srcset=&quot;/static/3e840b661baa16d3adce7afe1fd36eea/c26ae/tla.png 158w,
/static/3e840b661baa16d3adce7afe1fd36eea/6bdcf/tla.png 315w,
/static/3e840b661baa16d3adce7afe1fd36eea/f058b/tla.png 630w,
/static/3e840b661baa16d3adce7afe1fd36eea/40601/tla.png 945w,
/static/3e840b661baa16d3adce7afe1fd36eea/d8817/tla.png 1238w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;멀티스레드 환경에서 Bump the Pointer를 사용하면 문제가 생깁니다.&lt;/p&gt;
&lt;p&gt;여러 스레드가 동시에 Eden에 객체를 할당하면, 같은 포인터 위치에 객체를 쓰려고 경쟁합니다.&lt;/p&gt;
&lt;p&gt;이를 방지하려면 &lt;strong&gt;락&lt;/strong&gt;이 필요한데, 객체 할당은 매우 빈번하게 발생하므로 락 경합이 심해져 &lt;strong&gt;성능이 급격히 저하됩니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TLAB&lt;/strong&gt;은 이 문제를 해결합니다. Eden 영역을 스레드별로 나눠서 &lt;strong&gt;각 스레드에 전용 할당 공간&lt;/strong&gt;을 부여합니다. 각 스레드는 자신만의 포인터를 가지므로 다른 스레드와 경쟁할 필요가 없습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Thread 1 → [TLAB 1] ← Bump the Pointer (동기화 불필요)
Thread 2 → [TLAB 2] ← Bump the Pointer (동기화 불필요)
Thread 3 → [TLAB 3] ← Bump the Pointer (동기화 불필요)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 스레드는 자신의 TLAB에서만 객체를 할당하므로 락 없이 빠르게 할당할 수 있습니다.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Java 버전별 기본 GC&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Java 버전&lt;/th&gt;
&lt;th&gt;기본 GC&lt;/th&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Java 8&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Parallel GC&lt;/td&gt;
&lt;td&gt;높은 &lt;strong&gt;처리량&lt;/strong&gt;(Throughput) 목표&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Java 9~21&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;G1 GC&lt;/td&gt;
&lt;td&gt;처리량과 지연 시간의 균형&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;GC 알고리즘 비교&lt;/h2&gt;
&lt;h3&gt;Serial GC&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseSerialGC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;단일 스레드&lt;/strong&gt;로 GC를 수행합니다. 가장 단순한 GC입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[STW 시작]
애플리케이션:  ──────[정지]──────────────────&gt;
GC Thread 1:        [Mark → Sweep → Compact]
[STW 종료]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;힙이 작고 CPU 코어가 1개인 환경에 적합&lt;/li&gt;
&lt;li&gt;클라이언트 애플리케이션이나 임베디드 시스템용&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Parallel GC&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseParallelGC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;여러 GC 스레드&lt;/strong&gt;가 동시에 GC를 수행합니다. Serial GC의 멀티스레드 버전입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[STW 시작]
애플리케이션:  ──────[정지]──────────────────&gt;
GC Thread 1:        [Eden 일부 스캔]
GC Thread 2:        [Eden 일부 스캔]
GC Thread 3:        [Survivor 스캔]
GC Thread 4:        [Old 일부 스캔]
[STW 종료]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Java 8의 기본 GC&lt;/li&gt;
&lt;li&gt;여러 스레드가 힙을 &lt;strong&gt;분할해서 병렬 처리&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;처리량&lt;/strong&gt;(Throughput)을 최대화&lt;/li&gt;
&lt;li&gt;STW 동안 모든 GC 스레드가 전력으로 작업하므로 &lt;strong&gt;총 GC 시간은 짧지만&lt;/strong&gt;, STW 자체는 발생&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;G1 GC (Garbage-First)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseG1GC&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# Java 9+ 기본값&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;힙을 &lt;strong&gt;동일 크기의 리전&lt;/strong&gt;(Region)으로 분할하고, 가비지가 많은 리전부터 우선 정리합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;힙 구조 (전통적 GC)          힙 구조 (G1 GC)
┌─────────────────┐        ┌──┬──┬──┬──┬──┬──┐
│     Young       │        │E │E │S │O │O │H │
├─────────────────┤   →    ├──┼──┼──┼──┼──┼──┤
│      Old        │        │O │E │O │S │O │O │
└─────────────────┘        └──┴──┴──┴──┴──┴──┘
                           E=Eden, S=Survivor, O=Old, H=Humongous&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;동작 방식&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;힙을 1~32MB 크기의 리전으로 분할&lt;/li&gt;
&lt;li&gt;각 리전은 Eden, Survivor, Old 중 하나의 역할을 동적으로 할당받음&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;가비지 비율이 높은 리전&lt;/strong&gt;부터 먼저 정리 (Garbage-First)&lt;/li&gt;
&lt;li&gt;목표 STW 시간(기본 200ms) 내에 정리할 수 있는 리전만 선택&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Minor GC]
가비지 80%: Region 3 ← 우선 정리
가비지 60%: Region 7 ← 다음 정리
가비지 20%: Region 1 ← 나중에 정리&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Java 9부터 기본 GC&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;예측 가능한 STW 시간&lt;/strong&gt; 제공 (&lt;code class=&quot;language-text&quot;&gt;-XX:MaxGCPauseMillis=200&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;힙 4GB~32GB에서 최적&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ZGC&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseZGC&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+ZGenerational&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# Java 21+&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;애플리케이션과 동시에&lt;/strong&gt; GC를 수행합니다. STW가 거의 없습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;애플리케이션: ═══════════════════════════════&gt;
             ↑       ↑           ↑
ZGC:         [동시 Mark]  [동시 Relocate]
             (앱 실행 중)  (앱 실행 중)

STW: 단 1ms 미만 (스레드 동기화 시점에만)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;핵심 기술: Colored Pointer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d31ba55c8be2107810e880ae91f34da5/669eb/zg.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.0759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADD0lEQVR42o2U2WoUQRSG+yHUzJJket+m9226Z8kscRJNHI2OG15JICB6IYh4JUQhEAQJeCfqnW/kC/3+1UkkURQvPvpUVZ9Tp875qyTNKWEHQ+jdCm01Qkv5N+0z/rYuqXYBL96A6VVQrAyaU0C1c8hWCo1rv6OYWY1mFX8gc14SQVQtgcsMs3zOnz0ssrc4WvyAfGuEK3c9rCxjXHuY4OrjBMbBFM7zORr7PawclGg8q9B40Ufj5QCdQY8BmY0bDhEmE2TFHKZfYFrt4+nWCZzZBMpmBfPGCObNEazdDXQXY0TLLVi3J1i/0UNnp0Rnt0Jn0YecFJBkHiMoZwjzU1wev1sMYWc5gnAML5whzebISBRtwu+WiKMJfH8MQ+/BJMYZqplDWtdTnr1Ah4OmHKIlRzVtOUFDCdBUQjTkACukwfWmEtdzTTawrcVoXYRzPHIPlj+A7pZY05NftOjUMXpY13OsGwk3zEhKOz3ttppglUEu+oixZLgTRPmCXS7roKLbBhvUYnZ+soP+eAkvHXPTPhzWWqw3ZR9hegfdeAadqjDoZ7AUKm3JCgaYbC9RDLfhZRtc6FE6OXdL6DBCObqJgAE92j7razOwyDDtb6Mc73CzDQQFa8qv7rLL4jiyS+wEmpdjTQ0gGyJ91lZIyiNd6s7PoUdCa2m9plCnipNAD5hhyE4bMf1SETCmkIWzqJvH4wi6bIDLOnlY1f1LtFWx5qDRcYnDf4ni0tet/SXdnsGLlnCDPSjGDkx3Acffg2YuoBqC2+QO2SN3yT3o1n10g0f87xHthzWG9YT+u2yK/QCB/5q8Qhi8waB6h9n0GFl8iDR6z+8ROUYef0CRfCQnKNNP2Jp/xfXpN1TpZ1TZFwyL74jDQyGblJ3L2QzWyM34UJTwkmFtG6ydXpNeQmPtnN6A4q9ox5xLalTOS+JCi+5oDpXOWyOkEfHGiLFASOl3NGrXH7JU5aR+MM7nhX8dUGjM8itm1691JsY25XT+Av0vHdFl8TgE2ZQ64qUvZrQnvNPT2haBhUz+FyHBn8eXESDxjrxFAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ZGC Colored Pointer&quot;
        title=&quot;&quot;
        src=&quot;/static/d31ba55c8be2107810e880ae91f34da5/f058b/zg.png&quot;
        srcset=&quot;/static/d31ba55c8be2107810e880ae91f34da5/c26ae/zg.png 158w,
/static/d31ba55c8be2107810e880ae91f34da5/6bdcf/zg.png 315w,
/static/d31ba55c8be2107810e880ae91f34da5/f058b/zg.png 630w,
/static/d31ba55c8be2107810e880ae91f34da5/40601/zg.png 945w,
/static/d31ba55c8be2107810e880ae91f34da5/669eb/zg.png 1244w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;64비트 포인터에서 실제 주소로 44비트만 사용합니다.&lt;/p&gt;
&lt;p&gt;44비트면 16TB 주소 공간을 표현할 수 있어서 대부분의 서버에 충분합니다.&lt;/p&gt;
&lt;p&gt;남는 비트 중 4개를 &lt;strong&gt;색상 비트&lt;/strong&gt;로 활용해서 객체 상태를 저장합니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;색상 비트&lt;/th&gt;
&lt;th&gt;의미&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Marked0/Marked1&lt;/td&gt;
&lt;td&gt;살아있는 객체 표시 (GC 사이클마다 번갈아 사용)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Remapped&lt;/td&gt;
&lt;td&gt;포인터가 새 주소를 가리킴 (참조 갱신 완료)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Finalizable&lt;/td&gt;
&lt;td&gt;finalizer를 통해서만 도달 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Marked vs Remapped&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Marked&lt;/strong&gt;: &quot;이 객체는 살아있다&quot; (삭제 대상 아님)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Remapped&lt;/strong&gt;: &quot;이 포인터는 새 주소를 가리킨다&quot; (참조 갱신 완료)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;두 비트는 서로 다른 정보입니다. Marked는 객체의 생존 여부, Remapped는 포인터의 갱신 여부를 나타냅니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ZGC 사이클&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. Mark 단계
   - GC Root에서 도달 가능한 객체에 Marked 비트 설정
   - &quot;이 객체는 살아있다&quot;

2. Relocate 단계
   - 살아있는 객체를 새 위치로 복사
   - Forwarding Table에 이전 주소 → 새 주소 매핑 저장
   - 아직 모든 포인터가 갱신되지 않음

3. 참조 갱신 (Load Barrier)
   - 객체 접근 시 색상 비트 확인
   - Remapped가 아니면 → Forwarding Table에서 새 주소 조회 → 포인터 갱신 → Remapped 설정
   - Remapped면 → 이미 갱신됨, 그냥 사용&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Forwarding Table&lt;/h4&gt;
&lt;p&gt;객체가 이동할 때 이전 주소와 새 주소의 매핑을 저장합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Forwarding Table
┌─────────────────┬─────────────────┐
│ Old Address     │ New Address     │
├─────────────────┼─────────────────┤
│ 0x1000          │ 0x5000          │
│ 0x2000          │ 0x6000          │
└─────────────────┴─────────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Load Barrier가 Remapped가 아닌 포인터를 만나면 이 테이블에서 새 주소를 조회합니다.&lt;/p&gt;
&lt;p&gt;모든 참조가 갱신되면(Remapped 상태가 되면) 해당 테이블 항목은 삭제됩니다.&lt;/p&gt;
&lt;h4&gt;Load Barrier&lt;/h4&gt;
&lt;p&gt;객체를 읽을 때마다 JVM이 자동으로 색상 비트를 확인합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; field&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// JVM이 Load Barrier 삽입&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 1. 포인터의 색상 비트 확인&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 2. Remapped가 아니면 → Forwarding Table에서 새 주소 조회&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 3. 포인터를 새 주소로 갱신하고 Remapped 설정&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 4. 정상 진행&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;기존 GC&lt;/strong&gt;(G1, Parallel)는 객체 이동 후 &lt;strong&gt;모든 참조를 한 번에 업데이트&lt;/strong&gt;해야 해서 STW가 길었습니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ZGC&lt;/strong&gt;는 객체 접근 시점에 &lt;strong&gt;점진적으로 업데이트&lt;/strong&gt;하므로 STW가 1ms 미만입니다.&lt;/p&gt;
&lt;h4&gt;ZPage&lt;/h4&gt;
&lt;p&gt;ZGC도 G1처럼 힙을 분할합니다. &lt;strong&gt;ZPage&lt;/strong&gt;라는 단위를 사용합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7cefb571feb199bf99abdca02267f1f9/78612/zpa.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC1klEQVR42lVTSXITQRCcR5jAYKxZNPuqWbpn08hCkmUbDARgOwAfuPADrlwJglcn2S02HzJqprqruiqzynACiSidcGzmRIan9uIvntgJfSkezzJ9/s9f4pFZ4Vj7H8YYZtYg3JyhHV+i6i8wjyTRwvIrhMlbNN07yOkKZbunX8AKW0TRAs9lBrG8Rs0YN251nOU3MKxcorjcQY6XyOo13KSDn/awgwpl8xH9dAMxniOtzuDxzIk6pCzi8qyFmK5RyJ32zQkrEDBcBov9C1T7S5S7C4TVEl7cMaFA2V2gX98Qd3xsx0qkDo5ZxO2rFp9eC3y+mWgl7t80yApWeOpWcBJejA+w2ZYTCph+rV91415D0eCEqi0BN6qxGg44G4W267GGR79h85KfDgzqWFkPyxP/yLeKBzgIl+MxcfSswKPTEkenC9oDnlgURb3ekdx++QpVt0e+2sIl8fNAaqJVm4ps9Wi7uqJwOyy6K2TNlhWXPBf6jpf8FsXMqdzdCPv9Etb7Afb9hNNbkr/r4YUHgRy24scvMLQ/UVdf0cnvxA+I5hvi7JoJ64OQpMpw0hbF1Q7BesJ8ZPDAZBN5kz18qhpkvR6XKN9gWH5BIz8gyW810uIWYbaBxxxBNmiODdNrECVLBMmIuc+y5w1sV2gu1RgotZVwVlAjYDc+FbaDBWZ+TuFyzLxKt2oS6p5xQrKfkeSTWa55M50KJjdBWUt9OyUC8uxHA79r2Hxw7kkNl5Qk+QouCwk4ETaLMCyPcofqUEJ051xDKs7EPsdE+SO2UoktN+ac86c66TXUvUpu0Y0USmzI5chxapmQLfnZgfyF3CAqRr1KaiuUDfMRebPmpqz0t/KpbXI1v4PeLp88u0l7EEUnTDudoOn3DBo4j60W5A/Kdou62z3wKSTlxF1m5YulzuFQPGPGllVmhXhBpeP27/8fRMWSmPQG/e8P2Kbyq0rt39v1C7n40cFrsv/uAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ZPage&quot;
        title=&quot;&quot;
        src=&quot;/static/7cefb571feb199bf99abdca02267f1f9/f058b/zpa.png&quot;
        srcset=&quot;/static/7cefb571feb199bf99abdca02267f1f9/c26ae/zpa.png 158w,
/static/7cefb571feb199bf99abdca02267f1f9/6bdcf/zpa.png 315w,
/static/7cefb571feb199bf99abdca02267f1f9/f058b/zpa.png 630w,
/static/7cefb571feb199bf99abdca02267f1f9/40601/zpa.png 945w,
/static/7cefb571feb199bf99abdca02267f1f9/78612/zpa.png 1260w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ZPage 종류&lt;/th&gt;
&lt;th&gt;크기&lt;/th&gt;
&lt;th&gt;저장 객체&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Small&lt;/td&gt;
&lt;td&gt;2MB&lt;/td&gt;
&lt;td&gt;256KB 이하&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Medium&lt;/td&gt;
&lt;td&gt;32MB&lt;/td&gt;
&lt;td&gt;256KB ~ 4MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Large&lt;/td&gt;
&lt;td&gt;N x 2MB (가변)&lt;/td&gt;
&lt;td&gt;4MB 초과 (1개만 저장)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Generational ZGC (Java 21+)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;초기 ZGC는 세대 구분 없이 전체 힙을 동일하게 취급했습니다.&lt;/p&gt;
&lt;p&gt;Java 21부터 &lt;strong&gt;Generational ZGC&lt;/strong&gt;가 도입되어 Young/Old 세대를 구분합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Young Generation          Old Generation
┌──────┬──────┬──────┐    ┌──────┬──────┬──────┐
│Small │Small │Medium│    │Medium│Large │Small │
└──────┴──────┴──────┘    └──────┴──────┴──────┘
   새 객체 할당              오래 살아남은 객체&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;비교&lt;/th&gt;
&lt;th&gt;G1 GC&lt;/th&gt;
&lt;th&gt;Generational ZGC&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;분할 단위&lt;/td&gt;
&lt;td&gt;Region (1~32MB 고정)&lt;/td&gt;
&lt;td&gt;ZPage (2MB/32MB/가변)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;세대 구분&lt;/td&gt;
&lt;td&gt;Eden, Survivor, Old&lt;/td&gt;
&lt;td&gt;Young, Old&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STW&lt;/td&gt;
&lt;td&gt;수백 ms 가능&lt;/td&gt;
&lt;td&gt;1ms 미만&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;참조 갱신&lt;/td&gt;
&lt;td&gt;STW 중 일괄 처리&lt;/td&gt;
&lt;td&gt;Load Barrier로 점진적&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Java 21&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseZGC&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+ZGenerational&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Java 23+ (기본값)&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseZGC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;초저지연 GC&lt;/strong&gt; (STW 1ms 미만)&lt;/li&gt;
&lt;li&gt;힙 크기와 관계없이 일정한 지연 시간&lt;/li&gt;
&lt;li&gt;수백 GB~TB 규모의 대용량 힙에 적합&lt;/li&gt;
&lt;li&gt;Java 15+ 프로덕션 사용 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Shenandoah GC&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token parameter variable&quot;&gt;-XX:+UseShenandoahGC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ZGC와 마찬가지로 &lt;strong&gt;애플리케이션과 동시에&lt;/strong&gt; GC를 수행합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;핵심 기술: Brooks Pointer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;각 객체 앞에 &lt;strong&gt;포워딩 포인터&lt;/strong&gt;를 추가합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;일반 객체              Shenandoah 객체
┌─────────┐           ┌─────────────┐
│ 객체     │           │ Forward Ptr │ ← 자기 자신 또는 새 위치
└─────────┘           ├─────────────┤
                      │ 객체         │
                      └─────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;객체가 이동하면 Forward Ptr만 새 주소로 갱신합니다. 이전 참조도 Forward Ptr을 통해 새 객체를 찾습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Red Hat에서 개발&lt;/li&gt;
&lt;li&gt;STW 1~10ms 범위&lt;/li&gt;
&lt;li&gt;8~64GB 중간 크기 힙에 최적&lt;/li&gt;
&lt;li&gt;OpenJDK에서 사용 가능 (Oracle JDK 미포함)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;선택 가이드&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;상황&lt;/th&gt;
&lt;th&gt;권장 GC&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;범용 애플리케이션&lt;/td&gt;
&lt;td&gt;G1 GC (기본값 사용)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;힙 &amp;#x3C; 32GB&lt;/td&gt;
&lt;td&gt;G1 GC&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;힙 &gt; 64GB + 초저지연 필요&lt;/td&gt;
&lt;td&gt;ZGC&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;힙 8~64GB + 저지연 필요&lt;/td&gt;
&lt;td&gt;Shenandoah&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;높은 처리량 + 지연 덜 중요&lt;/td&gt;
&lt;td&gt;Parallel GC&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2&gt;JVM 튜닝 옵션&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;옵션&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;기본값&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-Xms&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;초기 힙 크기&lt;/td&gt;
&lt;td&gt;물리 메모리의 1/64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-Xmx&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;최대 힙 크기&lt;/td&gt;
&lt;td&gt;물리 메모리의 1/4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:NewRatio=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Old/Young 비율&lt;/td&gt;
&lt;td&gt;2 (Old:Young = 2:1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:SurvivorRatio=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Eden/Survivor 비율&lt;/td&gt;
&lt;td&gt;8 (Eden:S0:S1 = 8:1:1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;-XX:MaxGCPauseMillis=N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;목표 STW 시간 (G1)&lt;/td&gt;
&lt;td&gt;200ms&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;GC 로그 확인&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Java 8&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+PrintGCDetails&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-XX:+PrintGCDateStamps&lt;/span&gt; MyApp

&lt;span class=&quot;token comment&quot;&gt;# Java 9+&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; -Xlog:gc*:file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;gc.log MyApp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;정리&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;개념&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;GC&lt;/td&gt;
&lt;td&gt;참조되지 않는 객체를 자동으로 메모리에서 제거&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mark and Sweep&lt;/td&gt;
&lt;td&gt;GC Root에서 도달 가능한 객체를 마킹하고 나머지 제거&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;세대별 GC&lt;/td&gt;
&lt;td&gt;Young(새 객체)과 Old(오래된 객체)를 분리 관리&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Minor GC&lt;/td&gt;
&lt;td&gt;Young Generation 대상, 자주 발생, 빠름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Major GC&lt;/td&gt;
&lt;td&gt;Old Generation 대상, 드물게 발생, 느림&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Stop-the-World&lt;/td&gt;
&lt;td&gt;GC 중 애플리케이션 스레드 일시 정지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;G1 GC&lt;/td&gt;
&lt;td&gt;Java 9+ 기본, 예측 가능한 STW 시간&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ZGC&lt;/td&gt;
&lt;td&gt;초저지연 GC, 대용량 힙에 적합&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;GC를 이해하면 메모리 문제를 진단하고 애플리케이션 성능을 최적화할 수 있습니다.&lt;/p&gt;</content:encoded></item></channel></rss>