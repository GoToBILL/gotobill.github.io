<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF Token Defense</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #111827;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 40px 20px;
            gap: 40px;
        }
        .container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #e0e7ff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 24px;
        }
        .section {
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 14px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .scenario {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .actor {
            width: 80px;
            padding: 8px 6px;
            border-radius: 8px;
            text-align: center;
            font-size: 10px;
            font-weight: 600;
            color: #e0e7ff;
            flex-shrink: 0;
        }
        .user { background: linear-gradient(135deg, #312e81 0%, #4338ca 100%); border: 1px solid rgba(165, 180, 252, 0.3); }
        .evil { background: linear-gradient(135deg, #7f1d1d 0%, #dc2626 100%); border: 1px solid rgba(239, 68, 68, 0.3); }
        .bank { background: linear-gradient(135deg, #14532d 0%, #15803d 100%); border: 1px solid rgba(134, 239, 172, 0.3); }
        .arrow-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .arrow-label {
            font-size: 9px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 3px;
            text-align: center;
        }
        .arrow-svg { width: 100%; height: 10px; }
        .step-num {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #111827;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 8px;
            color: rgba(255,255,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .result-box {
            margin-top: 10px;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 10px;
            color: rgba(255,255,255,0.8);
        }
        .danger { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); }
        .success { background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); }
        .highlight { color: #fbbf24; font-weight: 600; }
        .key-point {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 9px;
            color: rgba(255,255,255,0.5);
            margin: 10px 0;
            text-align: center;
        }
        .info {
            margin-top: 16px;
            padding: 14px;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .info-title {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 10px;
            font-weight: 600;
        }
        .info-row {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 9px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 6px;
        }
        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-top: 3px;
            flex-shrink: 0;
        }
        .dot.red { background: #ef4444; }
        .dot.green { background: #22c55e; }
        .dot.yellow { background: #fbbf24; }
        .preflight-table {
            width: 100%;
            margin-top: 12px;
            border-collapse: collapse;
        }
        .preflight-table th, .preflight-table td {
            padding: 8px 10px;
            font-size: 9px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .preflight-table th {
            color: rgba(255,255,255,0.4);
            font-weight: 600;
        }
        .preflight-table td {
            color: rgba(255,255,255,0.6);
        }
        .preflight-table .yes { color: #22c55e; }
        .preflight-table .no { color: #ef4444; }
    </style>
</head>
<body>

<!-- 정상 요청 시나리오 (스크린샷 1) -->
<div class="container">
    <h1>1. 정상 요청 (Simple Request)</h1>

    <div class="section">
        <div class="section-title">토큰은 사용자마다 다르다</div>
        <div class="key-point">
            사용자 A 접속 → 토큰: "abc123" &nbsp;|&nbsp; 사용자 B 접속 → 토큰: "xyz789"<br>
            <span class="highlight">evil.com은 "현재 사용자"의 토큰을 알 방법이 없다</span>
        </div>
    </div>

    <div class="section">
        <div class="section-title">정상 요청 흐름</div>
        <div class="scenario">
            <div class="row">
                <span class="step-num">1</span>
                <div class="actor user">User</div>
                <div class="arrow-area">
                    <span class="arrow-label">bank.com/transfer 접속</span>
                    <svg class="arrow-svg" viewBox="0 0 200 10" preserveAspectRatio="none">
                        <line x1="0" y1="5" x2="190" y2="5" stroke="rgba(134,239,172,0.5)" stroke-width="1.5"/>
                        <polygon points="190,2 200,5 190,8" fill="rgba(134,239,172,0.5)"/>
                    </svg>
                </div>
                <div class="actor bank">bank.com</div>
            </div>
            <div class="row">
                <span class="step-num">2</span>
                <div class="actor user">User</div>
                <div class="arrow-area">
                    <span class="arrow-label">HTML + <span class="highlight">csrf_token="abc123"</span></span>
                    <svg class="arrow-svg" viewBox="0 0 200 10" preserveAspectRatio="none">
                        <line x1="10" y1="5" x2="200" y2="5" stroke="rgba(134,239,172,0.5)" stroke-width="1.5"/>
                        <polygon points="10,2 0,5 10,8" fill="rgba(134,239,172,0.5)"/>
                    </svg>
                </div>
                <div class="actor bank">bank.com</div>
            </div>
            <div class="row">
                <span class="step-num">3</span>
                <div class="actor user">User</div>
                <div class="arrow-area">
                    <span class="arrow-label">송금 요청 + <span class="highlight">token="abc123"</span></span>
                    <svg class="arrow-svg" viewBox="0 0 200 10" preserveAspectRatio="none">
                        <line x1="0" y1="5" x2="190" y2="5" stroke="rgba(134,239,172,0.5)" stroke-width="1.5"/>
                        <polygon points="190,2 200,5 190,8" fill="rgba(134,239,172,0.5)"/>
                    </svg>
                </div>
                <div class="actor bank">bank.com</div>
            </div>
        </div>
        <div class="result-box success">
            서버: 세션의 토큰 "abc123" == 요청의 토큰 "abc123" → 처리
        </div>
    </div>
</div>

<!-- 공격 시도 시나리오 (스크린샷 2) -->
<div class="container">
    <h1>2. CSRF 공격 시도 (Simple Request)</h1>

    <div class="section">
        <div class="section-title">공격 시나리오</div>
        <div class="scenario">
            <div class="row">
                <span class="step-num">1</span>
                <div class="actor evil">evil.com</div>
                <div class="arrow-area">
                    <span class="arrow-label">fetch()로 토큰 알아내려고 bank.com 요청</span>
                    <svg class="arrow-svg" viewBox="0 0 200 10" preserveAspectRatio="none">
                        <line x1="0" y1="5" x2="190" y2="5" stroke="rgba(239,68,68,0.5)" stroke-width="1.5"/>
                        <polygon points="190,2 200,5 190,8" fill="rgba(239,68,68,0.5)"/>
                    </svg>
                </div>
                <div class="actor bank">bank.com</div>
            </div>
            <div class="key-point" style="margin: 8px 0;">
                Same-Origin Policy: 요청은 가지만 <span class="highlight">응답을 evil.com이 읽을 수 없음</span>
            </div>
            <div class="row">
                <span class="step-num">2</span>
                <div class="actor evil">evil.com</div>
                <div class="arrow-area">
                    <span class="arrow-label">&lt;form&gt;으로 토큰 없이 송금 요청 (쿠키만 자동 첨부)</span>
                    <svg class="arrow-svg" viewBox="0 0 200 10" preserveAspectRatio="none">
                        <line x1="0" y1="5" x2="190" y2="5" stroke="rgba(239,68,68,0.5)" stroke-width="1.5"/>
                        <polygon points="190,2 200,5 190,8" fill="rgba(239,68,68,0.5)"/>
                    </svg>
                </div>
                <div class="actor bank">bank.com</div>
            </div>
        </div>
        <div class="result-box danger">
            서버: 세션의 토큰 "abc123" != 요청의 토큰 (없음) → 거부
        </div>
    </div>

    <div class="info">
        <div class="info-title">Preflight 발생 조건 (요청 기준)</div>
        <table class="preflight-table">
            <tr>
                <th>요청 유형</th>
                <th>Preflight</th>
                <th>서버 도달</th>
                <th>CSRF 토큰 필요</th>
            </tr>
            <tr>
                <td>&lt;form&gt; POST (application/x-www-form-urlencoded)</td>
                <td class="no">X</td>
                <td class="yes">O</td>
                <td class="yes">O</td>
            </tr>
            <tr>
                <td>fetch() + Content-Type: application/json</td>
                <td class="yes">O</td>
                <td class="no">X</td>
                <td class="no">X (권장)</td>
            </tr>
            <tr>
                <td>fetch() + Authorization 헤더</td>
                <td class="yes">O</td>
                <td class="no">X</td>
                <td class="no">X (권장)</td>
            </tr>
        </table>
    </div>

    <div class="info">
        <div class="info-title">방어가 성공하는 이유</div>
        <div class="info-row">
            <div class="dot red"></div>
            <span><strong>쿠키</strong>: 브라우저가 자동 첨부 → evil.com이 악용 가능</span>
        </div>
        <div class="info-row">
            <div class="dot green"></div>
            <span><strong>CSRF 토큰</strong>: 자동 첨부 안 됨 + 사용자마다 다름 + 응답 읽기 차단 → 알 수 없음</span>
        </div>
        <div class="info-row">
            <div class="dot yellow"></div>
            <span><strong>Preflight</strong>: 복잡한 요청(JSON, 커스텀 헤더)은 OPTIONS로 먼저 확인 → 허용 안 되면 본 요청 자체가 안 감</span>
        </div>
    </div>
</div>

</body>
</html>
