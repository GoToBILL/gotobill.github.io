<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Switching 오버헤드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 30px;
            color: #e2e8f0;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 25px;
            color: #f8fafc;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        .panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
        }
        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .title-few { color: #34d399; }
        .title-many { color: #f87171; }

        /* CPU Diagram */
        .cpu-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .cpu-core {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        .cpu-label {
            font-size: 10px;
            color: #94a3b8;
            margin-bottom: 4px;
        }
        .cpu-active {
            background: linear-gradient(135deg, #14532d 0%, #15803d 100%);
        }
        .cpu-busy {
            background: linear-gradient(135deg, #7f1d1d 0%, #dc2626 100%);
        }
        .cpu-idle {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d3d 100%);
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }

        /* Thread Timeline */
        .timeline {
            margin-top: 20px;
        }
        .timeline-label {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 10px;
        }
        .timeline-bar {
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            display: flex;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .time-slot {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            border-right: 1px solid rgba(0, 0, 0, 0.3);
        }
        .slot-work {
            background: linear-gradient(135deg, #14532d 0%, #15803d 100%);
        }
        .slot-switch {
            background: linear-gradient(135deg, #713f12 0%, #a16207 100%);
        }
        .slot-work-red {
            background: linear-gradient(135deg, #1e3a5f 0%, #1d4ed8 100%);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }
        .stat-label {
            font-size: 11px;
            color: #64748b;
            margin-bottom: 4px;
        }
        .stat-value {
            font-family: 'SF Mono', monospace;
            font-size: 18px;
            font-weight: 600;
        }
        .stat-good { color: #34d399; }
        .stat-bad { color: #f87171; }

        /* Bottom Panel */
        .bottom-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
        }
        .bottom-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }
        .overhead-list {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .overhead-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .overhead-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .overhead-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .overhead-desc {
            font-size: 12px;
            color: #94a3b8;
            line-height: 1.4;
        }
        .overhead-cost {
            margin-top: 8px;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            color: #fbbf24;
        }

        /* Formula */
        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .formula-title {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 12px;
        }
        .formula {
            font-family: 'SF Mono', monospace;
            font-size: 16px;
            color: #fbbf24;
        }
        .formula-note {
            font-size: 13px;
            color: #64748b;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Context Switching 오버헤드</h1>

        <div class="main-content">
            <!-- Few Threads -->
            <div class="panel">
                <div class="panel-title title-few">적정 스레드 (4 Core / 8 Thread)</div>

                <div class="cpu-container">
                    <div class="cpu-core cpu-active">
                        <div class="cpu-label">Core 1</div>
                        T1
                    </div>
                    <div class="cpu-core cpu-active">
                        <div class="cpu-label">Core 2</div>
                        T2
                    </div>
                    <div class="cpu-core cpu-active">
                        <div class="cpu-label">Core 3</div>
                        T3
                    </div>
                    <div class="cpu-core cpu-active">
                        <div class="cpu-label">Core 4</div>
                        T4
                    </div>
                </div>

                <div class="timeline">
                    <div class="timeline-label">CPU 시간 사용</div>
                    <div class="timeline-bar">
                        <div class="time-slot slot-work" style="width: 95%">실제 작업</div>
                        <div class="time-slot slot-switch" style="width: 5%"></div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Context Switch</div>
                        <div class="stat-value stat-good">~100/s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">CPU 효율</div>
                        <div class="stat-value stat-good">95%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Cache Hit</div>
                        <div class="stat-value stat-good">높음</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">메모리</div>
                        <div class="stat-value stat-good">8MB</div>
                    </div>
                </div>
            </div>

            <!-- Many Threads -->
            <div class="panel">
                <div class="panel-title title-many">과도한 스레드 (4 Core / 500 Thread)</div>

                <div class="cpu-container">
                    <div class="cpu-core cpu-busy">
                        <div class="cpu-label">Core 1</div>
                        T1~125
                    </div>
                    <div class="cpu-core cpu-busy">
                        <div class="cpu-label">Core 2</div>
                        T126~250
                    </div>
                    <div class="cpu-core cpu-busy">
                        <div class="cpu-label">Core 3</div>
                        T251~375
                    </div>
                    <div class="cpu-core cpu-busy">
                        <div class="cpu-label">Core 4</div>
                        T376~500
                    </div>
                </div>

                <div class="timeline">
                    <div class="timeline-label">CPU 시간 사용</div>
                    <div class="timeline-bar">
                        <div class="time-slot slot-work-red" style="width: 12%">T1</div>
                        <div class="time-slot slot-switch" style="width: 4%"></div>
                        <div class="time-slot slot-work-red" style="width: 12%">T2</div>
                        <div class="time-slot slot-switch" style="width: 4%"></div>
                        <div class="time-slot slot-work-red" style="width: 12%">T3</div>
                        <div class="time-slot slot-switch" style="width: 4%"></div>
                        <div class="time-slot slot-work-red" style="width: 12%">T4</div>
                        <div class="time-slot slot-switch" style="width: 4%"></div>
                        <div class="time-slot slot-work-red" style="width: 12%">T5</div>
                        <div class="time-slot slot-switch" style="width: 4%"></div>
                        <div class="time-slot slot-work-red" style="width: 12%">...</div>
                        <div class="time-slot slot-switch" style="width: 8%"></div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Context Switch</div>
                        <div class="stat-value stat-bad">~50000/s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">CPU 효율</div>
                        <div class="stat-value stat-bad">60%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Cache Hit</div>
                        <div class="stat-value stat-bad">낮음</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">메모리</div>
                        <div class="stat-value stat-bad">500MB</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Context Switch Cost -->
        <div class="bottom-panel">
            <div class="bottom-title">Context Switching 비용</div>
            <div class="overhead-list">
                <div class="overhead-item">
                    <div class="overhead-name">레지스터 저장/복원</div>
                    <div class="overhead-desc">CPU 레지스터 값을<br>메모리에 저장</div>
                    <div class="overhead-cost">~1us</div>
                </div>
                <div class="overhead-item">
                    <div class="overhead-name">TLB Flush</div>
                    <div class="overhead-desc">가상 메모리 변환<br>캐시 무효화</div>
                    <div class="overhead-cost">~5us</div>
                </div>
                <div class="overhead-item">
                    <div class="overhead-name">CPU Cache Miss</div>
                    <div class="overhead-desc">L1/L2/L3 캐시<br>다시 채워야 함</div>
                    <div class="overhead-cost">~100us</div>
                </div>
                <div class="overhead-item">
                    <div class="overhead-name">스케줄러 오버헤드</div>
                    <div class="overhead-desc">다음 스레드 선택<br>우선순위 계산</div>
                    <div class="overhead-cost">~10us</div>
                </div>
            </div>

            <div class="formula-box">
                <div class="formula-title">권장 스레드 수 공식 (I/O 집약적)</div>
                <div class="formula">Threads = CPU Cores x (1 + Wait Time / Service Time)</div>
                <div class="formula-note">예: 8코어, 처리 10ms, DB 대기 90ms = 8 x (1 + 90/10) = 80 스레드</div>
            </div>
        </div>
    </div>
</body>
</html>
